<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smile Xplorer - Movie Discovery Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXX"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="movie.css">

</head>

<body>
    <!-- Preloader -->
    <div id="preloader">
        <div class="loader-container">
            <div class="loader"></div>
            <div class="loader-text">SMILE XPLORER</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div class="loading-status" id="loading-status">Initializing...</div>
        </div>
    </div>

    <!-- Error Overlay -->
    <div id="error-overlay" class="error-overlay">
        <div class="error-content">
            <div class="error-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h2 class="error-title">Oops! Something went wrong</h2>
            <p class="error-message" id="error-message">
                We're having trouble connecting to our servers. Please check your internet connection and try again.
            </p>
            <button class="retry-btn" id="retry-btn">
                <i class="fas fa-redo"></i> Try Again
            </button>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="logo" onclick="location.reload()">
               <a href="#" class="logo">
                SMILE
                
                <div class="logo-icon">X</div>
                <p style="margin-left:-4% ;">PLORER</p>
            </a>
        </div>
        <div class="nav-actions">
            <div class="search-container">
                <input type="text" class="search-input" id="search-input" placeholder="Search for movies...">
                <button class="search-btn" id="search-btn">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            <button class="premium-btn" id="premium-btn">
                <i class="fas fa-crown"></i>
                <span id="premium-btn-text">Go Premium</span>
            </button>
        </div>
    </nav>

    <!-- TMDB Attribution (Required by TMDB ToS) -->
    <div class="tmdb-attribution" style="background-color: black; border: 1px solid gold;" >
        <div class="tmdb-logo" style="color: black; background: gold;">TMDB</div>
        <div class="tmdb-text" style="color: gold;">
            This product uses the TMDB API but is not endorsed or certified by TMDB.
        </div>
    </div>

    <!-- Premium Modal -->
    <div id="premium-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-crown"></i>
                    Smile Xplorer Premium
                </h2>
                <button class="close-btn" onclick="closeModal('premium-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="premium-features">
                    <div class="feature-item">
                        <i class="fas fa-heart feature-icon"></i>
                        <span>Personal watchlists and favorites</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-bell feature-icon"></i>
                        <span>Release notifications for upcoming movies</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-comment feature-icon"></i>
                        <span>Write and read user reviews</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-calendar feature-icon"></i>
                        <span>Movie reminders and calendar integration</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-robot feature-icon"></i>
                        <span>AI-generated movie summaries and recommendations</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-ad feature-icon"></i>
                        <span>Ad-free browsing experience</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-palette feature-icon"></i>
                        <span>Dark mode and custom UI themes</span>
                    </div>
                </div>

                <div class="premium-pricing">
                    <div class="price-display">WHAT ARE YOU WAITING FOR </div>
                    <div class="price-period">subscribe to have fun</div>
                    <a href="cancel.html">click here to subscribe</a>
                    <br>
                     <p> Hint: Subscribe now to unlock all premium feature in the web</p>
                
                </div>

                <p style="text-align: center; color: var(--text-secondary); font-size: 0.9rem; margin-top: 1rem;">
                    ‚úÖ All TMDB movie data remains free and accessible<br>
                    ‚úÖ Premium enhances your experience with exclusive features
                </p>
            </div>
        </div>
    </div>

    <!-- Movie Details Modal -->
    <div id="movie-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-movie-title">Movie Details</h2>
                <button class="close-btn" onclick="closeModal('movie-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="movie-details">
                    <img id="modal-movie-poster" class="movie-poster-large" src="/placeholder.svg" alt="Movie Poster">
                    <div class="movie-info-details">
                        <div class="movie-meta" id="modal-movie-meta">
                            <!-- Meta information will be inserted here -->
                        </div>
                        <div class="movie-description" id="modal-movie-description">
                            <!-- Movie description will be inserted here -->
                        </div>
                        
                        <!-- Premium Features Section -->
                         
                        <div id="premium-features-section">
                            <!-- AI Summary (Premium Only) 
                            <div id="ai-summary-section" class="premium-feature-locked">
                                <h3><i class="fas fa-robot"></i> AI Movie Summary</h3>
                                <p>Get intelligent insights and personalized recommendations</p>
                                <button class="unlock-premium-btn" onclick="showPremiumModal()">
                                    <i class="fas fa-crown"></i> Unlock Premium
                                </button>
                            </div>

                        -->

                            <!-- User Reviews (Premium Only) 
                            <div id="reviews-section" class="premium-feature-locked">
                                <h3><i class="fas fa-comment"></i> User Reviews</h3>
                                <p>Read and write reviews from our premium community</p>
                                <button class="unlock-premium-btn" onclick="showPremiumModal()">
                                    <i class="fas fa-crown"></i> Unlock Premium
                                </button>
                            </div>

                        -->

                            
                        </div>
                    </div>
                </div>
                
                <div class="movie-actions" style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="watch-movie-btn" id="watch-movie-btn" style="flex: 1;">
                        <i class="fas fa-external-link-alt"></i> Find Streaming Options
                    </button>
                    <button class="action-btn favorite-btn" id="favorite-btn" onclick="toggleFavorite()" style="flex: 0 0 auto; padding: 15px;">
                        <i class="fas fa-heart"></i>
                    </button>
                    <!--
                    <button class="action-btn" id="reminder-btn" onclick="setReminder()" style="flex: 0 0 auto; padding: 15px; background: var(--warning-color); color: var(--primary-bg);">
                        <i class="fas fa-bell"></i>
                    </button>

                -->
                </div>
            </div>
        </div>
    </div>

    <!-- Watch Options Modal -->
    <div id="watch-options-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Find Streaming Options</h2>
                <button class="close-btn" onclick="closeModal('watch-options-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="platform-disclaimer">
                    <p><i class="fas fa-info-circle"></i> <!--These buttons will search for the movie on external streaming platforms-->. Sorry, Smile Xplorer does not host or stream movies directly,check back later.</p>
                </div>

                <br>

                
                <div class="watch-options">

                    <!--
                    <button class="watch-option-btn" id="watch-netflix-btn">
                        <i class="fas fa-external-link-alt"></i>
                        Search on Netflix
                    </button>
                    <button class="watch-option-btn" id="watch-amazon-btn">
                        <i class="fas fa-external-link-alt"></i>
                        Search on Amazon Prime
                    </button>
                    <button class="watch-option-btn" id="watch-hulu-btn">
                        <i class="fas fa-external-link-alt"></i>
                        Search on Hulu
                    </button>
                    <button class="watch-option-btn" id="watch-disney-btn">
                        <i class="fas fa-external-link-alt"></i>
                        Search on Disney+
                    </button>

                
                    <button class="watch-option-btn disabled" tabindex="-1" aria-disabled="true" onclick="watchmovie()" id="watch">
                        <i class="fas fa-play-circle"></i>
                        Watch on web (Not Available)
                    </button>

                -->
                </div>
            </div>
        </div>
    </div>


        <!-- Ad Banner (Hidden for Premium Users) -->
         <!--
        <div class="ad-banner" id="top-ad-banner">
            <div class="ad-label">
                <i class="fas fa-ad"></i> Advertisement
            </div>
            <ins class="adsbygoogle"
                 style="display:block; min-height: 100px;"
                 data-ad-client="ca-pub-XXXXXXXXXX"
                 data-ad-slot="1234567890"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <p style="margin-top: 10px; color: var(--text-secondary); font-size: 0.9rem;">
                Support SmileX by viewing ads or <button onclick="showPremiumModal()" style="background: none; border: none; color: var(--premium-color); text-decoration: underline; cursor: pointer;">upgrade to Premium</button> for ad-free experience!
            </p>
        </div>

    -->

    

        <h1 class="section-title">Trending Movies</h1>
        
        <!-- Premium Watchlist Section -->
        <div id="watchlist-section" class="watchlist-section" style="display: none;">
            <h2 class="watchlist-title">
                <i class="fas fa-heart"></i> My Watchlist
                <span class="premium-badge">Premium</span>
            </h2>
            <div class="movie-grid" id="watchlist-grid">
                <!-- Watchlist movies will be loaded here -->
            </div>
        </div>

        <div class="movie-grid" id="movie-grid">
            <!-- Movies will be loaded here -->
        </div>
        
    
        <div class="loading-container" id="loading-container" style="display: none;">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading amazing movies...</div>
        </div>


    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <script>
      /**
 * Smile X - TMDB Compliant Movie Platform
 * Enhanced for Full TMDB Terms of Service Compliance
 * Version 3.2 - Debugged Non-Intrusive Individual Movie Attribution
 */
class SmileXApp {
    constructor() {
        // Configuration
        this.API_KEY = "48ea0449a84effd8baed92d45fa6175f"
        this.BASE_URL = "https://api.themoviedb.org/3"
        this.IMG_BASE_URL = "https://image.tmdb.org/t/p/w500"
        this.CACHE_DURATION = 30 * 60 * 1000 // 30 minutes
        this.REQUEST_DELAY = 1000 // 1 second between requests

        // State management
        this.cache = new Map()
        this.lastRequestTime = 0
        this.isLoading = false
        this.currentPage = 1
        this.currentMovie = null
        // Updated premium system with expiration tracking
        this.isPremium = this.checkPremiumStatus()
        this.watchlist = JSON.parse(localStorage.getItem("watchlist")) || []
        this.favorites = JSON.parse(localStorage.getItem("favorites")) || []
        this.reminders = JSON.parse(localStorage.getItem("reminders")) || []

        // Initialize app
        this.init()
    }

    // Added premium expiration checking system
    checkPremiumStatus() {
        const isPremium = localStorage.getItem("isPremium") === "true"
        const premiumExpiry = localStorage.getItem("premiumExpiry")
        
        if (isPremium && premiumExpiry) {
            const expiryDate = new Date(premiumExpiry)
            const now = new Date()
            
            if (now > expiryDate) {
                // Premium has expired
                localStorage.setItem("isPremium", "false")
                localStorage.removeItem("premiumExpiry")
                this.showNotification("Your premium subscription has expired", "warning")
                return false
            }
            return true
        }
        
        return isPremium
    }

    async init() {
        try {
            await this.showPreloader()
            this.setupEventListeners()
            this.updatePremiumUI()
            this.initializeAds()
            await this.loadTrendingMovies()
            this.hidePreloader()
            this.showNotification("Welcome Smile Xplorer User!", "success")
        } catch (error) {
            this.handleError(error, "Failed to initialize the application")
        }
    }

    showPreloader() {
        return new Promise((resolve) => {
            const progressFill = document.getElementById("progress-fill")
            const loadingStatus = document.getElementById("loading-status")

            const steps = [
                { progress: 20, status: "Connecting..." },
                { progress: 40, status: "Loading movie database..." },
                { progress: 60, status: "Preparing recommendations..." },
                { progress: 80, status: "Optimizing experience..." },
                { progress: 100, status: "Ready to discover movies!" },
            ]

            let currentStep = 0
            const updateProgress = () => {
                if (currentStep < steps.length) {
                    const step = steps[currentStep]
                    if (progressFill) progressFill.style.width = `${step.progress}%`
                    if (loadingStatus) loadingStatus.textContent = step.status
                    currentStep++
                    setTimeout(updateProgress, 800)
                } else {
                    setTimeout(resolve, 500)
                }
            }

            updateProgress()
        })
    }

    hidePreloader() {
        const preloader = document.getElementById("preloader")
        const mainContent = document.getElementById("main-content")

        if (preloader) {
            preloader.classList.add("fade-out")
            setTimeout(() => {
                preloader.style.display = "none"
                if (mainContent) {
                    mainContent.style.display = "block"
                    mainContent.classList.add("fade-in")
                }
            }, 800)
        }
    }

    setupEventListeners() {
        const searchInput = document.getElementById("search-input")
        const searchBtn = document.getElementById("search-btn")
        const retryBtn = document.getElementById("retry-btn")
        const watchMovieBtn = document.getElementById("watch-movie-btn")
        const watchNetflixBtn = document.getElementById("watch-netflix-btn")
        const watchAmazonBtn = document.getElementById("watch-amazon-btn")
        const watchHuluBtn = document.getElementById("watch-hulu-btn")
        const watchDisneyBtn = document.getElementById("watch-disney-btn")
        const premiumBtn = document.getElementById("premium-btn")
        // Added event listener for the watch on web button
        const watchOnWebBtn = document.getElementById("watchmovie")

        // Search functionality
        if (searchInput) {
            searchInput.addEventListener("keypress", (e) => {
                if (e.key === "Enter") {
                    this.searchMovies()
                }
            })
        }

        if (searchBtn) {
            searchBtn.addEventListener("click", () => {
                this.searchMovies()
            })
        }

        // Premium button
        if (premiumBtn) {
            premiumBtn.addEventListener("click", () => {
                this.showPremiumModal()
            })
        }

        // Retry functionality
        if (retryBtn) {
            retryBtn.addEventListener("click", () => {
                this.hideError()
                this.init()
            })
        }

        // Watch movie button
        if (watchMovieBtn) {
            watchMovieBtn.addEventListener("click", () => {
                this.showWatchOptions()
            })
        }

        // Added watch on web functionality
        if (watchOnWebBtn) {
            // Enable the button
            watchOnWebBtn.classList.remove("disabled")
            watchOnWebBtn.removeAttribute("tabindex")
            watchOnWebBtn.removeAttribute("aria-disabled")
            watchOnWebBtn.innerHTML = `
                <i class="fas fa-play-circle"></i>
                Watch on web (Available)
            `
            
            watchOnWebBtn.addEventListener("click", () => {
                this.watchOnWeb()
            })
        }

        // Close modals when clicking outside
        document.addEventListener("click", (e) => {
            if (e.target.classList.contains("modal-overlay")) {
                this.closeAllModals()
            }
        })

        // Infinite scroll
        window.addEventListener("scroll", () => {
            if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 1000) {
                this.loadMoreMovies()
            }
        })
    }

    initializeAds() {
        if (this.isPremium) {
            document.body.classList.add("premium-active")
            return
        }

        // Initialize AdSense
        try {
            ;(window.adsbygoogle = window.adsbygoogle || []).push({})
            ;(window.adsbygoogle = window.adsbygoogle || []).push({})
            console.log("üì¢ Ads initialized for free users")
        } catch (error) {
            console.warn("Ad initialization failed:", error)
        }
    }

    updatePremiumUI() {
        const premiumBtn = document.getElementById("premium-btn")
        const premiumBtnText = document.getElementById("premium-btn-text")
        const watchlistSection = document.getElementById("watchlist-section")

        if (this.isPremium) {
            if (premiumBtn) {
                premiumBtn.classList.add("active")
            }
            if (premiumBtnText) {
                premiumBtnText.textContent = "Premium Active"
            }
            document.body.classList.add("premium-active")

            // Show premium features
            if (watchlistSection) {
                watchlistSection.style.display = "block"
                this.loadWatchlist()
            }
        }
    }

    showPremiumFeatures() {
        const aiSummarySection = document.getElementById("ai-summary-section")
        const reviewsSection = document.getElementById("reviews-section")

        if (aiSummarySection && this.currentMovie) {
            aiSummarySection.innerHTML = `
                <div class="premium-content">
                    <h3><i class="fas fa-robot"></i> AI Movie Summary</h3>
                    <div style="background: rgba(255, 215, 0, 0.1); padding: 15px; border-radius: 8px; margin-top: 10px;">
                        <p style="color: var(--text-secondary); line-height: 1.6;">
                            ${this.generateAISummary(this.currentMovie)}
                        </p>
                    </div>
                </div>
            `
        }

        if (reviewsSection) {
            reviewsSection.innerHTML = `
                <div class="premium-content">
                    <h3><i class="fas fa-comment"></i> User Reviews</h3>
                    <div class="review-form">
                        <textarea class="review-textarea" placeholder="Write your review..." id="review-textarea"></textarea>
                        <button class="submit-review-btn" onclick="smileXApp.submitReview()">Submit Review</button>
                    </div>
                    <div class="sample-review">
                        <div class="reviewer">Premium User</div>
                        <div class="review-text">"Amazing cinematography and storyline! Highly recommended."</div>
                        <div class="rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    </div>
                </div>
            `
        }
    }

    generateAISummary(movie) {
        // Simulate AI-generated summary based on TMDB data
        const genres = movie.genres ? movie.genres.map((g) => g.name).join(", ") : "Various genres"
        const rating = movie.vote_average ? movie.vote_average.toFixed(1) : "N/A"

        return `This ${genres.toLowerCase()} film has received a ${rating}/10 rating . Based on the plot elements and viewer feedback, this movie offers ${this.getMovieInsight(movie)}. The film's themes and execution make it particularly appealing to fans of ${genres.toLowerCase()} cinema. Our AI recommends this for viewers who enjoyed similar titles in this genre.`
    }

    getMovieInsight(movie) {
        const insights = [
            "compelling character development and engaging storytelling",
            "stunning visual effects and memorable performances",
            "thought-provoking themes and excellent direction",
            "intense action sequences and emotional depth",
            "brilliant cinematography and outstanding soundtrack",
        ]
        return insights[Math.floor(Math.random() * insights.length)]
    }

    async makeAPIRequest(endpoint, useCache = true) {
        // Rate limiting to respect TMDB API limits
        const now = Date.now()
        const timeSinceLastRequest = now - this.lastRequestTime
        if (timeSinceLastRequest < this.REQUEST_DELAY) {
            await new Promise((resolve) => setTimeout(resolve, this.REQUEST_DELAY - timeSinceLastRequest))
        }

        // Check cache first
        if (useCache && this.cache.has(endpoint)) {
            const cached = this.cache.get(endpoint)
            if (now - cached.timestamp < this.CACHE_DURATION) {
                return cached.data
            }
        }

        try {
            this.lastRequestTime = Date.now()
            const response = await fetch(`${this.BASE_URL}${endpoint}`)

            if (!response.ok) {
                throw new Error(`TMDB API Error ${response.status}: ${response.statusText}`)
            }

            const data = await response.json()

            // Cache the response
            this.cache.set(endpoint, {
                data: data,
                timestamp: now,
            })

            return data
        } catch (error) {
            // Try to use stale cache data if available
            if (this.cache.has(endpoint)) {
                console.warn("Using cached data due to API error:", error)
                return this.cache.get(endpoint).data
            }
            throw error
        }
    }

    async loadTrendingMovies() {
        if (this.isLoading) return

        this.isLoading = true
        this.showLoading()

        try {
            const data = await this.makeAPIRequest(`/trending/movie/week?api_key=${this.API_KEY}&page=${this.currentPage}`)
            this.renderMovies(data.results)
        } catch (error) {
            this.handleError(error, "Failed to load trending movies . Please try again later.")
        } finally {
            this.isLoading = false
            this.hideLoading()
        }
    }

    async searchMovies() {
        const searchInput = document.getElementById("search-input")
        if (!searchInput) return

        const query = searchInput.value.trim()
        if (!query) return

        if (this.isLoading) return

        this.isLoading = true
        this.showLoading()
        this.clearMovies()

        try {
            const data = await this.makeAPIRequest(`/search/movie?api_key=${this.API_KEY}&query=${encodeURIComponent(query)}`)

            if (data.results.length === 0) {
                this.showNoResults()
            } else {
                this.renderMovies(data.results)
            }
        } catch (error) {
            this.handleError(error, "Failed to search movies. Please check your connection and try again.")
        } finally {
            this.isLoading = false
            this.hideLoading()
        }
    }

    async loadMoreMovies() {
        if (this.isLoading) return

        this.currentPage++
        await this.loadTrendingMovies()
    }

    renderMovies(movies) {
        const movieGrid = document.getElementById("movie-grid")
        if (!movieGrid) return

        movies.forEach((movie) => {
            if (!movie.poster_path) return // Skip movies without posters

            const movieCard = this.createMovieCard(movie)
            movieGrid.appendChild(movieCard)
        })
    }

    createMovieCard(movie) {
        const movieCard = document.createElement("div")
        movieCard.className = "movie-card fade-in"

        const releaseYear = movie.release_date ? new Date(movie.release_date).getFullYear() : "N/A"
        const rating = movie.vote_average ? movie.vote_average.toFixed(1) : "N/A"
        const isFavorite = this.favorites.includes(movie.id)

        movieCard.innerHTML = `
            <img src="${this.IMG_BASE_URL}${movie.poster_path}" 
                 alt="${movie.title}" 
                 class="movie-poster"
                 loading="lazy">
            <div class="movie-overlay">
                <h3 class="movie-title">${movie.title}</h3>
                <div class="movie-info">
                    <span class="movie-rating">‚òÖ ${rating}</span>
                    <span class="movie-year">${releaseYear}</span>
                </div>
                <div class="movie-actions">
                    <button class="action-btn preview-btn" onclick="smileXApp.previewMovie(${movie.id})">
                        <i class="fas fa-play"></i> Trailer
                    </button>
                    <button class="action-btn watch-btn" onclick="smileXApp.watchFullMovie(${movie.id})">
                        <i class="fas fa-info-circle"></i> Details
                    </button>
                    ${
                        this.isPremium
                            ? ``
                            : ""
                    }
                </div>
            </div>
        
        `

        return movieCard
    }

    async previewMovie(movieId) {
        try {
            const data = await this.makeAPIRequest(`/movie/${movieId}/videos?api_key=${this.API_KEY}`)
            const trailer = data.results.find(
                (video) => video.site === "YouTube" && (video.type === "Trailer" || video.type === "Teaser"),
            )

            if (trailer) {
                window.open(`https://www.youtube.com/watch?v=${trailer.key}`, "_blank")
                this.showNotification("Opening trailer ", "info")
            } else {
                this.showNotification("No trailer available for this movie", "warning")
            }
        } catch (error) {
            this.showNotification("Failed to load movie trailer", "error")
        }
    }

    async watchFullMovie(movieId) {
        try {
            // Fetch movie details from TMDB
            const movieData = await this.makeAPIRequest(`/movie/${movieId}?api_key=${this.API_KEY}`)
            this.currentMovie = movieData

            // Show movie details modal
            this.showMovieModal(movieData)
        } catch (error) {
            this.showNotification("Failed to load movie ", "error")
        }
    }

    showMovieModal(movie) {
        const modal = document.getElementById("movie-modal")
        const title = document.getElementById("modal-movie-title")
        const poster = document.getElementById("modal-movie-poster")
        const meta = document.getElementById("modal-movie-meta")
        const description = document.getElementById("modal-movie-description")
        const favoriteBtn = document.getElementById("favorite-btn")

        if (!modal || !title || !poster || !meta || !description) return

        // Set movie title with TMDB attribution
        title.innerHTML = `
            ${movie.title}
            <a href="https://www.themoviedb.org/movie/${movie.id}" 
               target="_blank" 
               rel="noopener noreferrer" 
               style="margin-left: 15px; color: #01d277; text-decoration: none; font-size: 14px;">
                View on TMDB
            </a>
        `

        // Set movie poster
        poster.src = `${this.IMG_BASE_URL}${movie.poster_path}`
        poster.alt = movie.title

        // Set movie meta information (all from TMDB)
        const releaseYear = movie.release_date ? new Date(movie.release_date).getFullYear() : "N/A"
        const runtime = movie.runtime ? `${movie.runtime} min` : "N/A"
        const rating = movie.vote_average ? movie.vote_average.toFixed(1) : "N/A"
        const genres = movie.genres ? movie.genres.map((g) => g.name).join(", ") : "N/A"

        meta.innerHTML = `
            <span class="meta-item"><i class="fas fa-calendar"></i> ${releaseYear}</span>
            <span class="meta-item"><i class="fas fa-clock"></i> ${runtime}</span>
            <span class="meta-item"><i class="fas fa-star"></i> ${rating}/10</span>
            <span class="meta-item"><i class="fas fa-tags"></i> ${genres}</span>
        `

        // Set movie description (from TMDB)
        description.innerHTML = `
            <p>${movie.overview || "No description available for this movie."}</p>
            <div style="margin-top: 15px; padding: 10px; background: rgba(1, 210, 119, 0.1); border-radius: 8px; border: 1px solid rgba(1, 210, 119, 0.3);">
                <small style="color: var(--text-secondary);">
                    Movie data provided by The Movie Database (TMDB)
                </small>
            </div>
        `

        // Update favorite button (Premium feature)
        const isFavorite = this.favorites.includes(movie.id)
        if (favoriteBtn) {
            favoriteBtn.classList.toggle("active", isFavorite)
            favoriteBtn.style.display = this.isPremium ? "block" : "none"
        }

        // Show premium features if user is premium
        if (this.isPremium) {
            this.showPremiumFeatures()
        }

        // Show modal
        modal.classList.add("show")
    }

    showWatchOptions() {
        // Hide movie details modal
        const movieModal = document.getElementById("movie-modal")
        if (movieModal) {
            movieModal.classList.remove("show")
        }

        // Show watch options modal
        const watchOptionsModal = document.getElementById("watch-options-modal")
        if (watchOptionsModal) {
            watchOptionsModal.classList.add("show")
        }
    }

    watchOnPlatform(platform) {
        if (this.currentMovie) {
            let url = ""
            const movieTitle = encodeURIComponent(this.currentMovie.title)

            switch (platform) {
                case "netflix":
                    url = `https://www.netflix.com/search?q=${movieTitle}`
                    break
                case "amazon":
                    url = `https://www.amazon.com/s?k=${movieTitle}&i=instant-video`
                    break
                case "hulu":
                    url = `https://www.hulu.com/search?q=${movieTitle}`
                    break
                case "disney":
                    url = `https://www.disneyplus.com/search?q=${movieTitle}`
                    break
            }

            window.open(url, "_blank")
            this.closeAllModals()
            this.showNotification(`Searching for "${this.currentMovie.title}" on ${platform.charAt(0).toUpperCase() + platform.slice(1)}...`, "info")
        }
    }

    // Added watch on web functionality
    watchOnWeb() {
        if (!this.currentMovie) {
            this.showNotification("Please select a movie first", "warning")
            return
        }

        // Create a movie watching page URL with movie details
        const movieData = encodeURIComponent(JSON.stringify({
            id: this.currentMovie.id,
            title: this.currentMovie.title,
            poster: this.currentMovie.poster_path,
            overview: this.currentMovie.overview,
            rating: this.currentMovie.vote_average,
            releaseDate: this.currentMovie.release_date
        }))

        // Redirect to movie watching page
        const watchUrl = `watch.html?movie=${movieData}`
        window.location.href = watchUrl
    }

    // Premium Features
    toggleFavorite() {
        if (!this.isPremium) {
            this.showNotification("Favorites are a Premium feature!", "warning")
            this.showPremiumModal()
            return
        }

        if (!this.currentMovie) return

        const movieId = this.currentMovie.id
        const isFavorite = this.favorites.includes(movieId)

        if (isFavorite) {
            this.favorites = this.favorites.filter((id) => id !== movieId)
            this.showNotification("Removed from favorites", "info")
        } else {
            this.favorites.push(movieId)
            this.showNotification("Added to favorites!", "success")
        }

        localStorage.setItem("favorites", JSON.stringify(this.favorites))

        // Update UI
        const favoriteBtn = document.getElementById("favorite-btn")
        if (favoriteBtn) {
            favoriteBtn.classList.toggle("active", !isFavorite)
        }

        this.loadWatchlist()
    }

    toggleMovieFavorite(movieId) {
        if (!this.isPremium) {
            this.showNotification("Favorites are a Premium feature!", "warning")
            this.showPremiumModal()
            return
        }

        const isFavorite = this.favorites.includes(movieId)

        if (isFavorite) {
            this.favorites = this.favorites.filter((id) => id !== movieId)
            this.showNotification("Removed from favorites", "info")
        } else {
            this.favorites.push(movieId)
            this.showNotification("Added to favorites!", "success")
        }

        localStorage.setItem("favorites", JSON.stringify(this.favorites))

        // Update all favorite buttons for this movie
        const favoriteButtons = document.querySelectorAll(`[onclick="smileXApp.toggleMovieFavorite(${movieId})"]`)
        favoriteButtons.forEach((btn) => {
            btn.classList.toggle("active", !isFavorite)
        })

        this.loadWatchlist()
    }

    setReminder() {
        if (!this.isPremium) {
            this.showNotification("Movie reminders are a Premium feature!", "warning")
            this.showPremiumModal()
            return
        }

        if (!this.currentMovie) return

        const movieId = this.currentMovie.id
        const hasReminder = this.reminders.includes(movieId)

        if (hasReminder) {
            this.reminders = this.reminders.filter((id) => id !== movieId)
            this.showNotification("Reminder removed", "info")
        } else {
            this.reminders.push(movieId)
            this.showNotification("Reminder set! We'll notify you about this movie.", "success")
        }

        localStorage.setItem("reminders", JSON.stringify(this.reminders))

        // Update reminder button
        const reminderBtn = document.getElementById("reminder-btn")
        if (reminderBtn) {
            reminderBtn.classList.toggle("active", !hasReminder)
        }
    }

    submitReview() {
        if (!this.isPremium) {
            this.showNotification("Reviews are a Premium feature!", "warning")
            this.showPremiumModal()
            return
        }

        const reviewTextarea = document.getElementById("review-textarea")
        if (reviewTextarea && reviewTextarea.value.trim()) {
            reviewTextarea.value = ""
            this.showNotification("Review submitted! Thank you for your feedback.", "success")
        } else {
            this.showNotification("Please write a review before submitting.", "warning")
        }
    }

    async loadWatchlist() {
        if (!this.isPremium || this.favorites.length === 0) return

        const watchlistGrid = document.getElementById("watchlist-grid")
        if (!watchlistGrid) return

        watchlistGrid.innerHTML = ""

        try {
            for (const movieId of this.favorites.slice(0, 6)) {
                // Show first 6 favorites
                const movieData = await this.makeAPIRequest(`/movie/${movieId}?api_key=${this.API_KEY}`)
                const movieCard = this.createMovieCard(movieData)
                watchlistGrid.appendChild(movieCard)
            }
        } catch (error) {
            console.warn("Failed to load watchlist:", error)
        }
    }

    showPremiumModal() {
        const premiumModal = document.getElementById("premium-modal")
        if (premiumModal) {
            premiumModal.classList.add("show")
        }
    }

    subscribeToPremium() {
        // Updated premium subscription with 30-day expiration
        this.isPremium = true
        const now = new Date()
        const expiryDate = new Date(now.getTime() + (30 * 24 * 60 * 60 * 1000)) // 30 days from now
        
        localStorage.setItem("isPremium", "true")
        localStorage.setItem("premiumExpiry", expiryDate.toISOString())

        this.closeAllModals()
        this.showNotification("Welcome to Smile Xplorer Premium! üéâ Enjoy 30 days of premium features!", "success")

        // Update UI for premium features
        this.updatePremiumUI()

        // Hide ads
        document.body.classList.add("premium-active")

        // Reload current movie modal if open
        if (this.currentMovie) {
            this.showMovieModal(this.currentMovie)
        }

        // Enable watch on web button for premium users
        const watchOnWebBtn = document.getElementById("watchmovie")
        if (watchOnWebBtn) {
            watchOnWebBtn.classList.remove("disabled")
            watchOnWebBtn.removeAttribute("tabindex")
            watchOnWebBtn.removeAttribute("aria-disabled")
            watchOnWebBtn.innerHTML = `
                <i class="fas fa-play-circle"></i>
                Watch on web (Premium)
            `
        }
    }

    closeAllModals() {
        const modals = ["movie-modal", "watch-options-modal", "premium-modal"]
        modals.forEach((modalId) => {
            const modal = document.getElementById(modalId)
            if (modal) {
                modal.classList.remove("show")
            }
        })
    }

    showLoading() {
        const loadingContainer = document.getElementById("loading-container")
        if (loadingContainer) {
            loadingContainer.style.display = "flex"
        }
    }

    hideLoading() {
        const loadingContainer = document.getElementById("loading-container")
        if (loadingContainer) {
            loadingContainer.style.display = "none"
        }
    }

    clearMovies() {
        const movieGrid = document.getElementById("movie-grid")
        if (movieGrid) {
            movieGrid.innerHTML = ""
        }
        this.currentPage = 1
    }

    showNoResults() {
        const movieGrid = document.getElementById("movie-grid")
        if (movieGrid) {
            movieGrid.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 50px;">
                    <i class="fas fa-search" style="font-size: 60px; color: var(--text-secondary); margin-bottom: 20px;"></i>
                    <h3 style="color: var(--text-secondary); margin-bottom: 10px;">No movies found</h3>
                    <p style="color: var(--text-secondary);">Try searching with different keywords</p>
                </div>
            `
        }
    }

    handleError(error, message) {
        console.error("SmileX Error:", error)
        this.showError(message)
        this.hideLoading()
    }

    showError(message) {
        const errorMessage = document.getElementById("error-message")
        const errorOverlay = document.getElementById("error-overlay")

        if (errorMessage) {
            errorMessage.textContent = message
        }
        if (errorOverlay) {
            errorOverlay.style.display = "flex"
        }
    }

    hideError() {
        const errorOverlay = document.getElementById("error-overlay")
        if (errorOverlay) {
            errorOverlay.style.display = "none"
        }
    }

    showNotification(message, type = "info") {
        const notification = document.getElementById("notification")
        if (notification) {
            notification.textContent = message
            notification.className = `notification ${type} show`

            setTimeout(() => {
                notification.classList.remove("show")
            }, 4000)
        }
    }
}

// Global function to close modals
function closeModal(modalId) {
    const modal = document.getElementById(modalId)
    if (modal) {
        modal.classList.remove("show")
    }
}

// Global function to show premium modal
function showPremiumModal() {
    if (window.smileXApp) {
        window.smileXApp.showPremiumModal()
    }
}

// Global function to subscribe to premium
function subscribeToPremium() {
    if (window.smileXApp) {
        window.smileXApp.subscribeToPremium()
    }
}

// Global function to toggle favorite
function toggleFavorite() {
    if (window.smileXApp) {
        window.smileXApp.toggleFavorite()
    }
}

// Global function to set reminder
function setReminder() {
    if (window.smileXApp) {
        window.smileXApp.setReminder()
    }
}

// Added global function for watch on web
function watchmovie() {
    if (window.smileXApp) {
        window.smileXApp.watchOnWeb()
    }
}

// Initialize the application when DOM is loaded
document.addEventListener("DOMContentLoaded", () => {
    // Initialize the application
    window.smileXApp = new SmileXApp()

    // Security measures
    document.addEventListener("keydown", (e) => {
        if (
            e.key === "F12" ||
            (e.ctrlKey && (e.key === "u" || e.key === "U")) ||
            (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "i"))
        ) {
            e.preventDefault()
        }
    })

    document.addEventListener("contextmenu", (e) => e.preventDefault())

    // Detect DevTools
    let devtoolsOpen = false
    setInterval(() => {
        const width = window.outerWidth - window.innerWidth > 100
        const height = window.outerHeight - window.innerHeight > 100
        if ((width || height) && !devtoolsOpen) {
            devtoolsOpen = true
        }
        if (!(width || height) && devtoolsOpen) {
            devtoolsOpen = false
        }
    }, 1000)

    console.log("üé¨ Smile Xplorer - TMDB Compliant Movie Platform Loaded")
    console.log("‚úÖ Fully compliant with TMDB Terms of Service")
    console.log("‚úÖ Non-intrusive individual movie TMDB attribution")
    console.log("‚úÖ Proper TMDB attribution displayed prominently")
    console.log("‚úÖ Premium features add value beyond TMDB data")
    console.log("‚úÖ All TMDB data remains freely accessible")
    console.log("‚úÖ Clear labeling for external platform searches")
    console.log("üì¢ Ad system active for free users")
    console.log("üëë Premium features: Watchlists, Reviews, AI Summaries, Ad-free")
})

    </script>
</body>
</html>
