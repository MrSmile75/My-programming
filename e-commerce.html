<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>X Trading Hub - Global Live Trading Platform</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">


<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

<style>
    :root {
        --primary: #3b82f6;
        --secondary: #10b981;
        --accent: #ef4444;
        --dark: #1e293b;
        --light: #f8fafc;
        --gold: #f59e0b;
        --success: #22c55e;
        --warning: #f59e0b;
        --danger: #ef4444;
        --info: #3b82f6;
        --neon-blue: #00d4ff;
        --neon-green: #00ff88;
        --neon-purple: #b300ff;
    }
    
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body {
              font-family: 'Orbitron', sans-serif;
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        color: #f8fafc;
        line-height: 1.6;
        min-height: 100vh;
        overflow-x: hidden;
    }
    
    .font-orbitron {
        font-family: 'Orbitron', sans-serif;
    }
    
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
    }
    
    .gradient-text {
        background: linear-gradient(45deg, var(--gold), #f97316);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    .gradient-bg {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
    }
    
    /* Enhanced Navigation */
    .navbar {
        background: rgba(15, 23, 42, 0.95);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 1000;
        padding: 1rem 0;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }
    
    .nav-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 2rem;
    }
    
    .logo {
        color: var(--gold);
        font-weight: bold;
        font-size: 1.5rem;
        font-family: 'Orbitron', sans-serif;
        text-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
    }
    
    .nav-menu {
        display: flex;
        list-style: none;
        gap: 2rem;
    }
    
    .nav-link {
        color: #f8fafc;
        text-decoration: none;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        transition: all 0.3s ease;
        position: relative;
    }
    
    .nav-link:hover {
        background: rgba(255, 255, 255, 0.1);
        color: var(--gold);
        transform: translateY(-2px);
    }
    
    .nav-actions {
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    
    .online-status {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: rgba(34, 197, 94, 0.2);
        border: 1px solid var(--success);
        border-radius: 20px;
        font-size: 0.875rem;
    }
    
    .status-dot {
        width: 8px;
        height: 8px;
        background: var(--success);
        border-radius: 50%;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
    }
    
    .country-selector {
        position: relative;
    }
    
    .country-btn {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .country-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
    }
    
    .country-dropdown {
        position: absolute;
        top: 100%;
        right: 0;
        background: rgba(15, 23, 42, 0.98);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 0.5rem;
        min-width: 200px;
        max-height: 300px;
        overflow-y: auto;
        z-index: 1001;
        display: none;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }
    
    .country-dropdown.active {
        display: block;
        animation: slideDown 0.3s ease;
    }
    
    @keyframes slideDown {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .country-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1rem;
        cursor: pointer;
        transition: background 0.3s ease;
    }
    
    .country-item:hover {
        background: rgba(255, 255, 255, 0.1);
    }
    
    .country-flag {
        width: 20px;
        height: 15px;
        object-fit: cover;
        border-radius: 2px;
    }
    
    .cart-btn {
        position: relative;
        background: none;
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 0.5rem;
        transition: all 0.3s ease;
    }
    
    .cart-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateY(-2px);
    }
    
    .cart-count {
        position: absolute;
        top: -5px;
        right: -5px;
        background: var(--gold);
        color: black;
        border-radius: 50%;
        min-width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: bold;
        animation: bounce 0.5s ease;
    }
    
    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
        40% { transform: translateY(-10px); }
        60% { transform: translateY(-5px); }
    }
    
    /* Button Styles */
    .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 0.5rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-family: inherit;
        position: relative;
        overflow: hidden;
    }
    
    .btn:before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.5s;
    }
    
    .btn:hover:before {
        left: 100%;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, var(--primary), #2563eb);
        color: white;
        box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
    }
    
    .btn-primary:hover {
        background: linear-gradient(135deg, #2563eb, var(--primary));
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
    }
    
    .btn-secondary {
        background: linear-gradient(135deg, var(--secondary), #059669);
        color: white;
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
    }
    
    .btn-secondary:hover {
        background: linear-gradient(135deg, #059669, var(--secondary));
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
    }
    
    .btn-warning {
        background: linear-gradient(135deg, var(--warning), #d97706);
        color: black;
        box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
    }
    
    .btn-warning:hover {
        background: linear-gradient(135deg, #d97706, var(--warning));
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
    }
    
    .btn-danger {
        background: linear-gradient(135deg, var(--danger), #dc2626);
        color: white;
        box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
    }
    
    .btn-danger:hover {
        background: linear-gradient(135deg, #dc2626, var(--danger));
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
    }
    
    .btn-outline {
        background: transparent;
        border: 2px solid var(--gold);
        color: var(--gold);
    }
    
    .btn-outline:hover {
        background: var(--gold);
        color: black;
        transform: translateY(-2px);
    }
    
    .btn-sm {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
    }
    
    .btn-call {
        background: linear-gradient(135deg, var(--neon-green), #00cc66);
        color: white;
        box-shadow: 0 4px 15px rgba(0, 255, 136, 0.3);
    }
    
    .btn-call:hover {
        background: linear-gradient(135deg, #00cc66, var(--neon-green));
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 255, 136, 0.4);
    }
    
    .btn-video {
        background: linear-gradient(135deg, var(--neon-purple), #9900cc);
        color: white;
        box-shadow: 0 4px 15px rgba(179, 0, 255, 0.3);
    }
    
    .btn-video:hover {
        background: linear-gradient(135deg, #9900cc, var(--neon-purple));
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(179, 0, 255, 0.4);
    }
    
    /* Enhanced Card Styles */
    .card {
        background: rgba(30, 41, 59, 0.8);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 1rem;
        padding: 2rem;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .card:before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, var(--gold), var(--primary), var(--secondary));
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        border-color: var(--gold);
    }
    
    .card:hover:before {
        opacity: 1;
    }
    
    .item-card {
        background: rgba(30, 41, 59, 0.8);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 1rem;
        overflow: hidden;
        transition: all 0.3s ease;
        position: relative;
    }
    
    .item-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        border-color: var(--gold);
    }
    
    .item-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
        transition: transform 0.3s ease;
    }
    
    .item-card:hover .item-image {
        transform: scale(1.05);
    }
    
    .item-content {
        padding: 1.5rem;
    }
    
    .item-title {
        font-size: 1.25rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
        color: white;
    }
    
    .item-description {
        color: #94a3b8;
        margin-bottom: 1rem;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    .item-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }
    
    .item-category {
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-size: 0.75rem;
        font-weight: 600;
    }
    
    .category-electronics {
        background: rgba(59, 130, 246, 0.2);
        color: #93c5fd;
        border: 1px solid rgba(59, 130, 246, 0.3);
    }
    
    .category-fashion {
        background: rgba(236, 72, 153, 0.2);
        color: #f9a8d4;
        border: 1px solid rgba(236, 72, 153, 0.3);
    }
    
    .category-home {
        background: rgba(34, 197, 94, 0.2);
        color: #86efac;
        border: 1px solid rgba(34, 197, 94, 0.3);
    }
    
    .category-sports {
        background: rgba(245, 158, 11, 0.2);
        color: #fbbf24;
        border: 1px solid rgba(245, 158, 11, 0.3);
    }
    
    .category-books {
        background: rgba(168, 85, 247, 0.2);
        color: #c4b5fd;
        border: 1px solid rgba(168, 85, 247, 0.3);
    }
    
    .category-automotive {
        background: rgba(239, 68, 68, 0.2);
        color: #fca5a5;
        border: 1px solid rgba(239, 68, 68, 0.3);
    }
    
    .item-price {
        font-size: 1.25rem;
        font-weight: bold;
        color: var(--gold);
        text-shadow: 0 0 10px rgba(245, 158, 11, 0.3);
    }
    
    .item-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 0.5rem;
        flex-wrap: wrap;
    }
    
    .business-badge {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        font-size: 0.75rem;
        z-index: 10;
        backdrop-filter: blur(10px);
    }
    
    .location-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        font-size: 0.75rem;
        z-index: 10;
        backdrop-filter: blur(10px);
    }
    
    .online-seller-badge {
        position: absolute;
        bottom: 10px;
        left: 10px;
        background: rgba(34, 197, 94, 0.9);
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        font-size: 0.75rem;
        z-index: 10;
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }
    
    .call-actions {
        display: flex;
        gap: 0.5rem;
        margin-top: 0.5rem;
    }
    
    /* Form Styles */
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    .form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: white;
    }
    
    .form-input {
        width: 100%;
        padding: 0.75rem 1rem;
        background: rgba(30, 41, 59, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 0.5rem;
        color: white;
        font-family: inherit;
        transition: all 0.3s ease;
    }
    
    .form-input:focus {
        outline: none;
        border-color: var(--gold);
        box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.3);
        background: rgba(30, 41, 59, 0.9);
    }
    
    .form-input::placeholder {
        color: #64748b;
    }
    
    .form-textarea {
        resize: vertical;
        min-height: 100px;
    }
    
    .form-select {
        width: 100%;
        padding: 0.75rem 1rem;
        background: rgba(30, 41, 59, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 0.5rem;
        color: white;
        font-family: inherit;
        cursor: pointer;
    }
    
    .form-select option {
        background: #1e293b;
        color: white;
    }
    
    /* Grid Layouts */
    .grid {
        display: grid;
        gap: 2rem;
    }
    
    .grid-cols-1 { grid-template-columns: 1fr; }
    .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
    .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
    .grid-cols-4 { grid-template-columns: repeat(4, 1fr); }
    
    /* Flex Utilities */
    .flex { display: flex; }
    .flex-col { flex-direction: column; }
    .items-center { align-items: center; }
    .justify-between { justify-content: space-between; }
    .justify-center { justify-content: center; }
    .flex-1 { flex: 1; }
    
    .gap-1 { gap: 0.25rem; }
    .gap-2 { gap: 0.5rem; }
    .gap-3 { gap: 0.75rem; }
    .gap-4 { gap: 1rem; }
    .gap-6 { gap: 1.5rem; }
    .gap-8 { gap: 2rem; }
    
    /* Spacing */
    .p-4 { padding: 1rem; }
    .p-6 { padding: 1.5rem; }
    .p-8 { padding: 2rem; }
    .px-4 { padding-left: 1rem; padding-right: 1rem; }
    .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
    .m-4 { margin: 1rem; }
    .mb-4 { margin-bottom: 1rem; }
    .mb-6 { margin-bottom: 1.5rem; }
    .mt-8 { margin-top: 2rem; }
    .mt-16 { margin-top: 4rem; }
    
    /* Text Utilities */
    .text-center { text-align: center; }
    .text-left { text-align: left; }
    .text-right { text-align: right; }
    .text-sm { font-size: 0.875rem; }
    .text-lg { font-size: 1.125rem; }
    .text-xl { font-size: 1.25rem; }
    .text-2xl { font-size: 1.5rem; }
    .text-3xl { font-size: 1.875rem; }
    .text-4xl { font-size: 2.25rem; }
    .text-5xl { font-size: 3rem; }
    .font-bold { font-weight: bold; }
    .font-semibold { font-weight: 600; }
    
    /* Color Utilities */
    .text-white { color: white; }
    .text-gray-400 { color: #9ca3af; }
    .text-gray-500 { color: #6b7280; }
    .text-yellow-400 { color: #fbbf24; }
    .text-green-400 { color: #4ade80; }
    .text-red-400 { color: #f87171; }
    .text-blue-400 { color: #60a5fa; }
    
    /* Display Utilities */
    .hidden { display: none; }
    .block { display: block; }
    .inline-block { display: inline-block; }
    
    /* Position Utilities */
    .relative { position: relative; }
    .absolute { position: absolute; }
    .fixed { position: fixed; }
    
    /* Width/Height */
    .w-full { width: 100%; }
    .h-full { height: 100%; }
    
    /* Enhanced Modal Styles */
    .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        backdrop-filter: blur(15px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 2000;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .modal.active {
        display: flex;
        opacity: 1;
    }
    
    .modal-content {
        background: rgba(15, 23, 42, 0.98);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 1rem;
        padding: 2rem;
        max-width: 90vw;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        transform: scale(0.9);
        transition: transform 0.3s ease;
    }
    
    .modal.active .modal-content {
        transform: scale(1);
    }
    
    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .modal-title {
        font-size: 1.5rem;
        font-weight: bold;
        color: white;
    }
    
    .modal-close {
        background: none;
        border: none;
        color: #9ca3af;
        font-size: 1.5rem;
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 0.5rem;
        transition: all 0.3s ease;
    }
    
    .modal-close:hover {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        transform: rotate(90deg);
    }
    
    /* Video Call Modal */
    .video-call-modal .modal-content {
        max-width: 95vw;
        max-height: 95vh;
        width: 1000px;
        height: 700px;
    }
    
    .video-container {
        position: relative;
        width: 100%;
        height: 500px;
        background: #000;
        border-radius: 0.5rem;
        overflow: hidden;
        margin-bottom: 1rem;
    }
    
    .local-video {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 200px;
        height: 150px;
        border-radius: 0.5rem;
        border: 2px solid var(--gold);
        z-index: 10;
    }
    
    .remote-video {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .call-controls {
        display: flex;
        justify-content: center;
        gap: 1rem;
        padding: 1rem;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 0.5rem;
    }
    
    .call-status {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        z-index: 10;
    }
    
    /* Incoming Call Modal */
    .incoming-call-modal {
        z-index: 3000;
    }
    
    .incoming-call-modal .modal-content {
        max-width: 400px;
        text-align: center;
        border: 2px solid var(--neon-green);
        animation: callPulse 1s infinite;
    }
    
    @keyframes callPulse {
        0% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.7); }
        70% { box-shadow: 0 0 0 20px rgba(0, 255, 136, 0); }
        100% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0); }
    }
    
    .caller-info {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
        margin-bottom: 2rem;
    }
    
    .caller-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: var(--gold);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        font-weight: bold;
        color: black;
    }
    
    .caller-name {
        font-size: 1.5rem;
        font-weight: bold;
        color: white;
    }
    
    .call-type {
        font-size: 0.875rem;
        color: #9ca3af;
    }
    
    .call-actions-incoming {
        display: flex;
        justify-content: center;
        gap: 2rem;
    }
    
    .answer-btn {
        background: var(--neon-green);
        color: white;
        border: none;
        padding: 1rem;
        border-radius: 50%;
        font-size: 1.5rem;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 60px;
        height: 60px;
    }
    
    .decline-btn {
        background: var(--danger);
        color: white;
        border: none;
        padding: 1rem;
        border-radius: 50%;
        font-size: 1.5rem;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 60px;
        height: 60px;
    }
    
    .answer-btn:hover {
        background: #00cc66;
        transform: scale(1.1);
    }
    
    .decline-btn:hover {
        background: #dc2626;
        transform: scale(1.1);
    }
    
    /* Notification Styles */
    .notification-container {
        position: fixed;
        top: 100px;
        right: 20px;
        z-index: 3000;
        display: flex;
        flex-direction: column;
        gap: 1rem;
        max-width: 400px;
    }
    
    .notification {
        background: rgba(15, 23, 42, 0.98);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 0.5rem;
        padding: 1rem 1.5rem;
        min-width: 300px;
        transform: translateX(100%);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }
    
    .notification.show {
        transform: translateX(0);
    }
    
    .notification.success {
        border-left: 4px solid var(--success);
    }
    
    .notification.error {
        border-left: 4px solid var(--danger);
    }
    
    .notification.warning {
        border-left: 4px solid var(--warning);
    }
    
    .notification.info {
        border-left: 4px solid var(--info);
    }
    
    .notification.call {
        border-left: 4px solid var(--neon-green);
        background: rgba(0, 255, 136, 0.1);
    }
    
    /* Chat Styles */
    .chat-container {
        max-height: 400px;
        overflow-y: auto;
        padding: 1rem;
        background: rgba(15, 23, 42, 0.5);
        border-radius: 0.5rem;
        margin-bottom: 1rem;
    }
    
    .chat-message {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
        animation: slideIn 0.3s ease;
    }
    
    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .chat-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        flex-shrink: 0;
    }
    
    .chat-content {
        flex: 1;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 0.5rem;
        padding: 1rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .chat-name {
        font-weight: bold;
        margin-bottom: 0.5rem;
        color: var(--gold);
    }
    
    .chat-text {
        color: #e2e8f0;
        line-height: 1.5;
    }
    
    .chat-time {
        font-size: 0.75rem;
        color: #64748b;
        margin-top: 0.5rem;
    }
    
    .chat-input-container {
        display: flex;
        gap: 1rem;
    }
    
    .chat-input {
        flex: 1;
        padding: 0.75rem;
        background: rgba(30, 41, 59, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 0.5rem;
        color: white;
        font-family: inherit;
    }
    
    .chat-input:focus {
        outline: none;
        border-color: var(--gold);
        box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.3);
    }
    
    .typing-indicator {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 0.5rem;
        margin-bottom: 1rem;
        font-size: 0.875rem;
        color: #9ca3af;
    }
    
    .typing-dots {
        display: flex;
        gap: 0.25rem;
    }
    
    .typing-dot {
        width: 6px;
        height: 6px;
        background: var(--gold);
        border-radius: 50%;
        animation: typing 1.4s ease-in-out infinite;
    }
    
    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }
    
    @keyframes typing {
        0%, 60%, 100% { transform: translateY(0); }
        30% { transform: translateY(-8px); }
    }
    
    /* Seller Management Styles */
    .seller-item {
        background: rgba(30, 41, 59, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 1rem;
        transition: all 0.3s ease;
    }
    
    .seller-item:hover {
        background: rgba(30, 41, 59, 0.8);
        border-color: var(--gold);
        transform: translateY(-2px);
    }
    
    .seller-item-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }
    
    .seller-item-actions {
        display: flex;
        gap: 0.5rem;
    }
    
    .seller-stats {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
        font-size: 0.875rem;
        color: #9ca3af;
    }
    
    .stat-item {
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }
    
    /* Report System Styles */
    .report-btn {
        background: var(--danger);
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 0.25rem;
        cursor: pointer;
        font-size: 0.875rem;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }
    
    .report-btn:hover {
        background: #dc2626;
        transform: translateY(-1px);
    }
    
    .banned-seller {
        opacity: 0.5;
        pointer-events: none;
        position: relative;
        filter: grayscale(100%);
    }
    
    .banned-seller::after {
        content: 'BANNED';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: var(--danger);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-weight: bold;
        z-index: 10;
        font-size: 1.2rem;
        box-shadow: 0 4px 15px rgba(239, 68, 68, 0.5);
    }
    
    /* Hero Section */
    .hero {
        padding: 8rem 0 4rem;
        text-align: center;
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1));
        position: relative;
        overflow: hidden;
    }
    
    .hero::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(245, 158, 11, 0.05) 0%, transparent 70%);
        animation: heroRotate 20s linear infinite;
    }
    
    @keyframes heroRotate {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    .hero-content {
        position: relative;
        z-index: 1;
    }
    
    .hero-title {
        font-size: 4rem;
        font-weight: bold;
        margin-bottom: 2rem;
        font-family: 'Orbitron', sans-serif;
        text-shadow: 0 0 20px rgba(245, 158, 11, 0.3);
    }
    
    .hero-subtitle {
        font-size: 1.25rem;
        color: #94a3b8;
        margin-bottom: 3rem;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
        line-height: 1.6;
    }
    
    .hero-actions {
        display: flex;
        gap: 2rem;
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .hero-stats {
        display: flex;
        justify-content: center;
        gap: 4rem;
        margin-top: 4rem;
    }
    
    .hero-stat {
        text-align: center;
    }
    
    .hero-stat-number {
        font-size: 2.5rem;
        font-weight: bold;
        color: var(--gold);
        display: block;
        font-family: 'Orbitron', sans-serif;
    }
    
    .hero-stat-label {
        font-size: 0.875rem;
        color: #9ca3af;
        margin-top: 0.5rem;
    }
    
    /* Features Section */
    .features {
        padding: 4rem 0;
    }
    
    .features-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin-top: 3rem;
    }
    
    .feature-card {
        background: rgba(30, 41, 59, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 1rem;
        padding: 2rem;
        text-align: center;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .feature-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--gold), var(--primary), var(--secondary));
        transform: scaleX(0);
        transition: transform 0.3s ease;
    }
    
    .feature-card:hover {
        transform: translateY(-5px);
        border-color: var(--gold);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    }
    
    .feature-card:hover::before {
        transform: scaleX(1);
    }
    
    .feature-icon {
        font-size: 3rem;
        color: var(--gold);
        margin-bottom: 1rem;
    }
    
    .feature-title {
        font-size: 1.25rem;
        font-weight: bold;
        margin-bottom: 1rem;
        color: white;
    }
    
    .feature-description {
        color: #94a3b8;
        line-height: 1.6;
    }
    
    /* Loading Animation */
    .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 4000;
    }
    
    .loading-spinner {
        width: 50px;
        height: 50px;
        border: 5px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: var(--gold);
        animation: spin 1s ease-in-out infinite;
    }
    
    /* File Upload Styles */
    .file-upload {
        border: 2px dashed rgba(255, 255, 255, 0.3);
        border-radius: 0.5rem;
        padding: 2rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        background: rgba(30, 41, 59, 0.3);
    }
    
    .file-upload:hover {
        border-color: var(--gold);
        background: rgba(245, 158, 11, 0.1);
    }
    
    .file-upload input {
        display: none;
    }
    
    .file-upload-icon {
        font-size: 3rem;
        color: #9ca3af;
        margin-bottom: 1rem;
    }
    
    .file-upload:hover .file-upload-icon {
        color: var(--gold);
    }
    
    /* Rules Section */
    .rules-section {
        background: rgba(30, 41, 59, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 1rem;
        padding: 2rem;
        margin-bottom: 2rem;
    }
    
    .rules-title {
        font-size: 1.25rem;
        font-weight: bold;
        margin-bottom: 1rem;
        color: var(--gold);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .rules-list {
        list-style: none;
        padding: 0;
    }
    
    .rules-list li {
        display: flex;
        align-items: flex-start;
        gap: 0.75rem;
        margin-bottom: 1rem;
        color: #e2e8f0;
        line-height: 1.5;
    }
    
    .rules-list li i {
        color: var(--success);
        margin-top: 0.25rem;
        flex-shrink: 0;
    }
    
    .rules-list li i.text-red-400 {
        color: var(--danger);
    }
    
    /* Search Bar */
    .search-container {
        position: relative;
        margin-bottom: 2rem;
    }
    
    .search-input {
        width: 100%;
        padding: 1rem 1rem 1rem 3rem;
        background: rgba(30, 41, 59, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 0.5rem;
        color: white;
        font-size: 1rem;
        transition: all 0.3s ease;
    }
    
    .search-input:focus {
        outline: none;
        border-color: var(--gold);
        box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.3);
    }
    
    .search-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: #64748b;
        font-size: 1.2rem;
    }
    
    /* Filter Sidebar */
    .filter-sidebar {
        background: rgba(30, 41, 59, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 1rem;
        padding: 2rem;
        height: fit-content;
        backdrop-filter: blur(10px);
    }
    
    .filter-section {
        margin-bottom: 2rem;
    }
    
    .filter-title {
        font-weight: bold;
        margin-bottom: 1rem;
        color: white;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .filter-options {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .filter-option {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .filter-option input[type="checkbox"] {
        accent-color: var(--gold);
        width: 16px;
        height: 16px;
    }
    
    .filter-option label {
        color: #e2e8f0;
        cursor: pointer;
        font-size: 0.875rem;
    }
    
    .category-filter {
        width: 100%;
        text-align: left;
        padding: 0.75rem;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 0.5rem;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .category-filter:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateX(5px);
    }
    
    .category-filter.active {
        background: var(--gold);
        color: black;
        border-color: var(--gold);
    }
    
    .price-range {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }
    
    .price-input {
        flex: 1;
        padding: 0.5rem;
        background: rgba(30, 41, 59, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 0.25rem;
        color: white;
        font-size: 0.875rem;
    }
    
    .price-input:focus {
        outline: none;
        border-color: var(--gold);
    }
    
    /* Real-time Update Indicator */
    .update-indicator {
        position: fixed;
        top: 80px;
        left: 20px;
        background: rgba(34, 197, 94, 0.9);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        z-index: 1000;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
    }
    
    .update-indicator.show {
        transform: translateX(0);
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
        .nav-menu {
            display: none;
        }
        
        .nav-container {
            padding: 0 1rem;
        }
        
        .container {
            padding: 0 1rem;
        }
        
        .grid-cols-2 {
            grid-template-columns: 1fr;
        }
        
        .grid-cols-3 {
            grid-template-columns: 1fr;
        }
        
        .grid-cols-4 {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .hero-title {
            font-size: 2.5rem;
        }
        
        .hero-actions {
            flex-direction: column;
            align-items: center;
        }
        
        .hero-stats {
            flex-direction: column;
            gap: 2rem;
        }
        
        .modal-content {
            margin: 1rem;
            padding: 1rem;
        }
        
        .video-call-modal .modal-content {
            width: 95vw;
            height: 95vh;
        }
        
        .video-container {
            height: 300px;
        }
        
        .local-video {
            width: 120px;
            height: 90px;
        }
        
        .call-actions {
            flex-wrap: wrap;
        }
        
        .item-actions {
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .call-actions {
            width: 100%;
        }
    }
    
    @media (max-width: 480px) {
        .grid-cols-4 {
            grid-template-columns: 1fr;
        }
        
        .hero-title {
            font-size: 2rem;
        }
        
        .notification-container {
            right: 10px;
            left: 10px;
        }
        
        .notification {
            min-width: auto;
            max-width: none;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }
        
        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.75rem;
        }
    }
    
    /* Custom Scrollbar */
    ::-webkit-scrollbar {
        width: 8px;
    }
    
    ::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, var(--gold), var(--primary));
        border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
    }
    
    /* Selection */
    ::selection {
        background: rgba(245, 158, 11, 0.3);
        color: white;
    }
    
    /* Focus styles */
    .btn:focus,
    .form-input:focus,
    .form-select:focus {
        outline: 2px solid rgba(245, 158, 11, 0.5);
        outline-offset: 2px;
    }
    
    /* Utility Classes */
    .space-y-3 > * + * { margin-top: 0.75rem; }
    .space-y-4 > * + * { margin-top: 1rem; }
    .space-y-6 > * + * { margin-top: 1.5rem; }
    
    /* Connection Status */
    .connection-status {
        position: fixed;
        bottom: 20px;
        left: 20px;
        background: rgba(30, 41, 59, 0.9);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 0.5rem;
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
        z-index: 1000;
        transition: all 0.3s ease;
    }
    
    .connection-status.online {
        border-color: var(--success);
        color: var(--success);
    }
    
    .connection-status.offline {
        border-color: var(--danger);
        color: var(--danger);
    }
    
    /* Cart Animation */
    @keyframes cartBounce {
        0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
        40% { transform: translateY(-10px); }
        60% { transform: translateY(-5px); }
    }
    
    .cart-animate {
        animation: cartBounce 0.6s ease;
    }
    
    /* New Item Notification */
    .new-item-notification {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(34, 197, 94, 0.95);
        color: white;
        padding: 1rem 2rem;
        border-radius: 0.5rem;
        font-weight: bold;
        z-index: 3000;
        animation: newItemPulse 2s ease-in-out;
    }
    
    @keyframes newItemPulse {
        0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        50% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
        100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
    }
</style>
</head>
<body>
<!-- Navigation -->
<nav class="navbar">
    <div class="nav-container">
        <div class="logo">ðŸš€ X TRADING HUB</div>
        
        <div class="online-status">
            <div class="status-dot"></div>
            <span id="connectionStatus">Connected Live</span>
        </div>
        
        <ul class="nav-menu">
            <li><a href="#" class="nav-link" onclick="showPage('home')"><i class="bi bi-house-door"></i> Home</a></li>
            <li><a href="#" class="nav-link" onclick="showPage('marketplace')"><i class="bi bi-shop"></i> Marketplace</a></li>
            <li><a href="#" class="nav-link" onclick="showPage('sell')"><i class="bi bi-tag"></i> Sell</a></li>
            <li><a href="#" class="nav-link" onclick="showPage('manage')"><i class="bi bi-gear"></i> Manage</a></li>
        </ul>
        
        <div class="nav-actions">
            <div class="country-selector">
                <button class="country-btn" onclick="toggleCountryDropdown()">
                    <img id="selectedFlag" src="https://flagcdn.com/w20/us.png" class="country-flag">
                    <span id="selectedCountry">United States</span>
                    <i class="bi bi-chevron-down"></i>
                </button>
                <div id="countryDropdown" class="country-dropdown">
                    <!-- Countries will be populated here -->
                </div>
            </div>
            
            <button class="cart-btn" onclick="openCartModal()">
                <i class="bi bi-cart3"></i>
                <span id="cartCount" class="cart-count">0</span>
            </button>
        </div>
    </div>
</nav>

<!-- Connection Status -->
<div id="connectionStatusIndicator" class="connection-status online">
    <i class="bi bi-wifi"></i> Connected to Firebase
</div>

<!-- Real-time Update Indicator -->
<div id="updateIndicator" class="update-indicator">
    <i class="bi bi-arrow-clockwise"></i> New items available!
</div>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay">
    <div class="loading-spinner"></div>
</div>

<!-- Notification Container -->
<div id="notificationContainer" class="notification-container"></div>

<!-- Incoming Call Modal -->
<div id="incomingCallModal" class="modal incoming-call-modal">
    <div class="modal-content">
        <div class="caller-info">
            <div class="caller-avatar" id="callerAvatar">S</div>
            <div class="caller-name" id="callerName">Unknown Caller</div>
            <div class="call-type" id="callType">Video Call</div>
        </div>
        
        <div class="call-actions-incoming">
            <button class="decline-btn" onclick="declineCall()">
                <i class="bi bi-telephone-x"></i>
            </button>
            <button class="answer-btn" onclick="answerCall()">
                <i class="bi bi-telephone"></i>
            </button>
        </div>
    </div>
</div>

<!-- Video Call Modal -->
<div id="videoCallModal" class="modal video-call-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">
                <i class="bi bi-camera-video"></i> 
                Video Call with <span id="videoCallPartner">Partner</span>
            </h3>
            <button class="modal-close" onclick="endCall()">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
        
        <div class="video-container">
            <div class="call-status" id="callStatus">Connecting...</div>
            <video id="remoteVideo" class="remote-video" autoplay playsinline></video>
            <video id="localVideo" class="local-video" autoplay playsinline muted></video>
        </div>
        
        <div class="call-controls">
            <button class="btn btn-secondary" onclick="toggleMute()">
                <i id="muteIcon" class="bi bi-mic"></i>
            </button>
            <button class="btn btn-secondary" onclick="toggleVideo()">
                <i id="videoIcon" class="bi bi-camera-video"></i>
            </button>
            <button class="btn btn-danger" onclick="endCall()">
                <i class="bi bi-telephone-x"></i> End Call
            </button>
            <button class="btn btn-outline" onclick="shareScreen()">
                <i class="bi bi-display"></i> Share Screen
            </button>
        </div>
    </div>
</div>

<!-- Main Content -->
<main style="padding-top: 80px;">
    <!-- Home Page -->
    <div id="homePage" class="page">
        <section class="hero">
            <div class="hero-content">
                <div class="container">
                    <h1 class="hero-title gradient-text">Global Live Trading Platform</h1>
                    <p class="hero-subtitle">
                        Connect with buyers and sellers worldwide in real-time. Experience seamless trading with live video calls, instant messaging, and secure transactions powered by Firebase.
                    </p>
                    <div class="hero-actions">
                        <button class="btn btn-primary" onclick="showPage('sell')">
                            <i class="bi bi-tag"></i> Start Selling
                        </button>
                        <button class="btn btn-secondary" onclick="showPage('marketplace')">
                            <i class="bi bi-shop"></i> Browse Marketplace
                        </button>
                        <button class="btn btn-video" onclick="startLiveDemo()">
                            <i class="bi bi-camera-video"></i> Live Demo
                        </button>
                    </div>
                    
                    <div class="hero-stats">
                        <div class="hero-stat">
                            <span class="hero-stat-number" id="onlineUsers">1,247</span>
                            <div class="hero-stat-label">Users Online</div>
                        </div>
                        <div class="hero-stat">
                            <span class="hero-stat-number" id="totalItems">45,632</span>
                            <div class="hero-stat-label">Items Listed</div>
                        </div>
                        <div class="hero-stat">
                            <span class="hero-stat-number" id="activeCalls">28</span>
                            <div class="hero-stat-label">Live Calls</div>
                        </div>
                        <div class="hero-stat">
                            <span class="hero-stat-number">4.9</span>
                            <div class="hero-stat-label">User Rating</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="features">
            <div class="container">
                <h2 class="text-3xl font-bold text-center mb-6">Why Choose Our Live Platform?</h2>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="bi bi-camera-video"></i>
                        </div>
                        <h3 class="feature-title">Live Video Calls</h3>
                        <p class="feature-description">Connect face-to-face with buyers and sellers through HD video calls with screen sharing capabilities.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="bi bi-telephone"></i>
                        </div>
                        <h3 class="feature-title">Real Phone Calls</h3>
                        <p class="feature-description">Make actual phone calls directly through the platform with automatic number generation and caller ID.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="bi bi-shield-check"></i>
                        </div>
                        <h3 class="feature-title">Firebase Security</h3>
                        <p class="feature-description">Enterprise-grade security with Firebase authentication and real-time data protection.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="bi bi-globe"></i>
                        </div>
                        <h3 class="feature-title">Global Reach</h3>
                        <p class="feature-description">Connect with sellers and buyers from every country with automatic currency conversion.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="bi bi-bell"></i>
                        </div>
                        <h3 class="feature-title">Live Notifications</h3>
                        <p class="feature-description">Real-time alerts for calls, messages, and cart activities across all devices.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="bi bi-lightning"></i>
                        </div>
                        <h3 class="feature-title">Instant Trading</h3>
                        <p class="feature-description">Complete transactions in seconds with live chat and immediate call support.</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Marketplace Page -->
    <div id="marketplacePage" class="page hidden">
        <div class="container">
            <div class="flex gap-8">
                <!-- Filter Sidebar -->
                <div style="width: 300px;">
                    <div class="filter-sidebar">
                        <h3 class="text-xl font-bold mb-4">
                            <i class="bi bi-funnel text-yellow-400"></i> Advanced Filters
                        </h3>
                        
                        <div class="filter-section">
                            <h4 class="filter-title">
                                <i class="bi bi-grid"></i> Categories
                            </h4>
                            <div class="filter-options">
                                <button class="category-filter active" onclick="filterByCategory('all')">
                                    <i class="bi bi-grid-3x3"></i> All Categories
                                </button>
                                <button class="category-filter" onclick="filterByCategory('Electronics')">
                                    <i class="bi bi-laptop"></i> Electronics
                                </button>
                                <button class="category-filter" onclick="filterByCategory('Fashion')">
                                    <i class="bi bi-bag"></i> Fashion
                                </button>
                                <button class="category-filter" onclick="filterByCategory('Home')">
                                    <i class="bi bi-house"></i> Home & Garden
                                </button>
                                <button class="category-filter" onclick="filterByCategory('Sports')">
                                    <i class="bi bi-bicycle"></i> Sports
                                </button>
                                <button class="category-filter" onclick="filterByCategory('Books')">
                                    <i class="bi bi-book"></i> Books
                                </button>
                                <button class="category-filter" onclick="filterByCategory('Automotive')">
                                    <i class="bi bi-car-front"></i> Automotive
                                </button>
                            </div>
                        </div>
                        
                        <div class="filter-section">
                            <h4 class="filter-title">
                                <i class="bi bi-currency-dollar"></i> Price Range
                            </h4>
                            <div class="price-range">
                                <input type="number" id="minPrice" placeholder="Min" class="price-input">
                                <input type="number" id="maxPrice" placeholder="Max" class="price-input">
                            </div>
                            <button class="btn btn-primary w-full" onclick="applyPriceFilter()">Apply Filter</button>
                        </div>
                        
                        <div class="filter-section">
                            <h4 class="filter-title">
                                <i class="bi bi-star"></i> Condition
                            </h4>
                            <div class="filter-options">
                                <div class="filter-option">
                                    <input type="checkbox" id="conditionNew" value="New">
                                    <label for="conditionNew">New</label>
                                </div>
                                <div class="filter-option">
                                    <input type="checkbox" id="conditionLikeNew" value="Like New">
                                    <label for="conditionLikeNew">Like New</label>
                                </div>
                                <div class="filter-option">
                                    <input type="checkbox" id="conditionGood" value="Good">
                                    <label for="conditionGood">Good</label>
                                </div>
                                <div class="filter-option">
                                    <input type="checkbox" id="conditionFair" value="Fair">
                                    <label for="conditionFair">Fair</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="filter-section">
                            <h4 class="filter-title">
                                <i class="bi bi-person-check"></i> Seller Status
                            </h4>
                            <div class="filter-options">
                                <div class="filter-option">
                                    <input type="checkbox" id="onlineSellers" value="online">
                                    <label for="onlineSellers">Online Now</label>
                                </div>
                                <div class="filter-option">
                                    <input type="checkbox" id="verifiedSellers" value="verified">
                                    <label for="verifiedSellers">Verified Sellers</label>
                                </div>
                                <div class="filter-option">
                                    <input type="checkbox" id="fastShipping" value="fast">
                                    <label for="fastShipping">Fast Shipping</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Buyer Rules -->
                    <div class="rules-section mt-4">
                        <h3 class="rules-title">
                            <i class="bi bi-info-circle"></i> Buyer Guidelines
                        </h3>
                        <ul class="rules-list">
                            <li>
                                <i class="bi bi-check-circle-fill"></i>
                                <span>Always verify seller information before making purchases</span>
                            </li>
                            <li>
                                <i class="bi bi-check-circle-fill"></i>
                                <span>Use live video calls to inspect items before buying</span>
                            </li>
                            <li>
                                <i class="bi bi-check-circle-fill"></i>
                                <span>Report suspicious sellers or fraudulent listings immediately</span>
                            </li>
                            <li>
                                <i class="bi bi-check-circle-fill"></i>
                                <span>Check item condition and return policy before purchasing</span>
                            </li>
                            <li>
                                <i class="bi bi-check-circle-fill"></i>
                                <span>Meet in safe, public locations for local pickups</span>
                            </li>
                            <li>
                                <i class="bi bi-check-circle-fill"></i>
                                <span>Use platform's secure payment system only</span>
                            </li>
                        </ul>
                    </div>
                </div>
                
                <!-- Items Grid -->
                <div style="flex: 1;">
                    <div class="search-container">
                        <i class="bi bi-search search-icon"></i>
                        <input type="text" id="searchInput" class="search-input" placeholder="Search for items, sellers, or locations..." onkeyup="searchItems()">
                    </div>
                    
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex items-center gap-4">
                            <span class="text-gray-400">
                                <span id="itemCount">0</span> items found
                            </span>
                            <div class="flex items-center gap-2">
                                <span class="text-sm text-gray-500">Sort by:</span>
                                <select id="sortSelect" class="form-select" style="width: auto; padding: 0.5rem;" onchange="sortItems()">
                                    <option value="newest">Newest First</option>
                                    <option value="price-low">Price: Low to High</option>
                                    <option value="price-high">Price: High to Low</option>
                                    <option value="popular">Most Popular</option>
                                    <option value="rating">Highest Rated</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <button class="btn btn-outline btn-sm" onclick="toggleViewMode()" id="viewModeBtn">
                                <i class="bi bi-list"></i> List View
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="refreshMarketplace()">
                                <i class="bi bi-arrow-clockwise"></i> Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div id="itemsGrid" class="grid grid-cols-3 gap-6">
                        <!-- Items will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sell Page -->
    <div id="sellPage" class="page hidden">
        <div class="container">
            <div class="flex gap-8">
                <!-- Seller Rules -->
                <div style="width: 350px;">
                    <div class="rules-section">
                        <h3 class="rules-title">
                            <i class="bi bi-shield-check"></i> Seller Guidelines
                        </h3>
                        <ul class="rules-list">
                            <li>
                                <i class="bi bi-check-circle-fill"></i>
                                <span>Provide accurate item descriptions and high-quality photos</span>
                            </li>
                            <li>
                                <i class="bi bi-check-circle-fill"></i>
                                <span>Set fair prices based on item condition and market value</span>
                            </li>
                            <li>
                                <i class="bi bi-check-circle-fill"></i>
                                <span>Respond to buyer inquiries within 24 hours</span>
                            </li>
                            <li>
                                <i class="bi bi-check-circle-fill"></i>
                                <span>Be available for live video calls during listed hours</span>
                            </li>
                            <li>
                                <i class="bi bi-check-circle-fill"></i>
                                <span>Ship items promptly and provide tracking information</span>
                            </li>
                            <li>
                                <i class="bi bi-check-circle-fill"></i>
                                <span>Be honest about item defects or wear</span>
                            </li>
                            <li>
                                <i class="bi bi-x-circle-fill text-red-400"></i>
                                <span>No counterfeit, stolen, or prohibited items</span>
                            </li>
                            <li>
                                <i class="bi bi-x-circle-fill text-red-400"></i>
                                <span>Multiple reports may result in permanent ban</span>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="card mt-4">
                        <h3 class="text-lg font-bold mb-4">
                            <i class="bi bi-grid"></i> Select Category
                        </h3>
                        <div class="grid grid-cols-2 gap-2">
                            <button class="category-filter" onclick="selectSellCategory('Electronics')">
                                <i class="bi bi-laptop"></i> Electronics
                            </button>
                            <button class="category-filter" onclick="selectSellCategory('Fashion')">
                                <i class="bi bi-bag"></i> Fashion
                            </button>
                            <button class="category-filter" onclick="selectSellCategory('Home')">
                                <i class="bi bi-house"></i> Home
                            </button>
                            <button class="category-filter" onclick="selectSellCategory('Sports')">
                                <i class="bi bi-bicycle"></i> Sports
                            </button>
                            <button class="category-filter" onclick="selectSellCategory('Books')">
                                <i class="bi bi-book"></i> Books
                            </button>
                            <button class="category-filter" onclick="selectSellCategory('Automotive')">
                                <i class="bi bi-car-front"></i> Auto
                            </button>
                        </div>
                    </div>
                    
                    <div class="card mt-4">
                        <h3 class="text-lg font-bold mb-4">
                            <i class="bi bi-clock"></i> Availability
                        </h3>
                        <div class="form-group">
                            <label class="form-label">Available for calls</label>
                            <select id="availability" class="form-select">
                                <option value="now">Available Now</option>
                                <option value="today">Available Today</option>
                                <option value="tomorrow">Available Tomorrow</option>
                                <option value="weekend">Weekends Only</option>
                                <option value="schedule">Schedule Later</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Sell Form -->
                <div style="flex: 1;">
                    <div class="card">
                        <h2 class="text-2xl font-bold mb-6">
                            <i class="bi bi-plus-square text-yellow-400"></i> List Your Item
                        </h2>
                        
                        <form id="sellForm">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-building"></i> Business Name (Permanent)
                                </label>
                                <div class="flex gap-2">
                                    <input type="text" id="businessName" class="form-input" placeholder="Enter your business name" required>
                                    <button type="button" class="btn btn-warning" onclick="saveBusinessName()">
                                        <i class="bi bi-save"></i> Save
                                    </button>
                                </div>
                                <small class="text-gray-400">This will be displayed on all your products permanently</small>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="bi bi-geo-alt"></i> Your Country
                                    </label>
                                    <select id="sellerCountry" class="form-select" required>
                                        <option value="">Select your country</option>
                                           <option value="GH">GHANA</option>
                                        <!-- Countries will be populated here -->
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="bi bi-telephone"></i> Contact Number
                                    </label>
                                    <input type="tel" id="contactNumber" class="form-input" placeholder="+1 (555) 123-4567" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-tag"></i> Item Name
                                </label>
                                <input type="text" name="itemName" class="form-input" placeholder="Enter descriptive item name" required>
                            </div>
                            
                            <div class="grid grid-cols-3 gap-4">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="bi bi-currency-dollar"></i> Price
                                    </label>
                                    <div class="flex">
                                        <select name="currency" class="form-select" style="width: 100px; border-radius: 0.5rem 0 0 0.5rem;">
                                            <option value="USD">USD</option>
                                            <option value="EUR">EUR</option>
                                            <option value="GBP">GBP</option>
                                            <option value="CEDI">CEDI</option>
                                            <option value="CAD">CAD</option>
                                            <option value="AUD">AUD</option>
                                            <option value="INR">INR</option>
                                            <option value="CNY">CNY</option>
                                            <option value="BRL">BRL</option>
                                            <option value="MXN">MXN</option>
                                        </select>
                                        <input type="number" name="price" step="0.01" class="form-input" style="border-radius: 0 0.5rem 0.5rem 0;" placeholder="0.00" required>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="bi bi-star"></i> Condition
                                    </label>
                                    <select name="condition" class="form-select" required>
                                        <option value="New">New</option>
                                        <option value="Like New">Like New</option>
                                        <option value="Good">Good</option>
                                        <option value="Fair">Fair</option>
                                        <option value="Poor">Poor</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="bi bi-box"></i> Quantity
                                    </label>
                                    <input type="number" name="quantity" class="form-input" min="1" value="1" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-card-text"></i> Description
                                </label>
                                <textarea name="description" class="form-input form-textarea" placeholder="Describe your item in detail. Include size, color, brand, age, any defects, etc..." required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-images"></i> Item Images (Multiple allowed)
                                </label>
                                <div class="file-upload" onclick="document.getElementById('imageInput').click()">
                                    <input type="file" id="imageInput" name="images" accept="image/*" multiple>
                                    <div class="file-upload-icon">
                                        <i class="bi bi-cloud-upload"></i>
                                    </div>
                                    <p class="text-gray-400 mb-2">Click to upload images or drag and drop</p>
                                    <small class="text-gray-500">PNG, JPG up to 5MB each â€¢ Multiple images allowed</small>
                                </div>
                                <div id="imagePreview" class="grid grid-cols-4 gap-2 mt-2" style="display: none;">
                                    <!-- Image previews will appear here -->
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="bi bi-truck"></i> Shipping Method
                                    </label>
                                    <select name="shipping" class="form-select" required>
                                        <option value="local">Local Pickup Only</option>
                                        <option value="national">National Shipping</option>
                                        <option value="international">International Shipping</option>
                                        <option value="both">Pickup & Shipping</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="bi bi-shield-check"></i> Return Policy
                                    </label>
                                    <select name="returns" class="form-select" required>
                                        <option value="no-returns">No Returns</option>
                                        <option value="7-days">7 Days Return</option>
                                        <option value="14-days">14 Days Return</option>
                                        <option value="30-days">30 Days Return</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="flex gap-3">
                                <button type="submit" class="btn btn-warning flex-1">
                                    <i class="bi bi-upload"></i> List Item
                                </button>
                                <button type="button" class="btn btn-outline" onclick="previewListing()">
                                    <i class="bi bi-eye"></i> Preview
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Manage Page -->
    <div id="managePage" class="page hidden">
        <div class="container">
            <h2 class="text-3xl font-bold mb-6">
                <i class="bi bi-gear text-yellow-400"></i> Manage Your Items & Sales
            </h2>
            
            <div class="grid grid-cols-4 gap-6 mb-8">
                <div class="card text-center">
                    <div class="text-3xl font-bold text-yellow-400 mb-2" id="totalListings">0</div>
                    <div class="text-gray-400">Total Listings</div>
                </div>
                <div class="card text-center">
                    <div class="text-3xl font-bold text-green-400 mb-2" id="totalSales">0</div>
                    <div class="text-gray-400">Total Sales</div>
                </div>
                <div class="card text-center">
                    <div class="text-3xl font-bold text-blue-400 mb-2" id="totalCalls">0</div>
                    <div class="text-gray-400">Video Calls</div>
                </div>
                <div class="card text-center">
                    <div class="text-3xl font-bold text-purple-400 mb-2" id="totalViews">0</div>
                    <div class="text-gray-400">Total Views</div>
                </div>
            </div>
            
            <div class="flex justify-between items-center mb-6">
                <div>
                    <p class="text-gray-400">Manage your published items, view sales analytics, and track performance</p>
                </div>
                <div class="flex gap-3">
                    <button class="btn btn-secondary" onclick="exportData()">
                        <i class="bi bi-download"></i> Export Data
                    </button>
                    <button class="btn btn-primary" onclick="showPage('sell')">
                        <i class="bi bi-plus"></i> Add New Item
                    </button>
                </div>
            </div>
            
            <div class="grid grid-cols-1 gap-6">
                <div class="card">
                    <h3 class="text-xl font-bold mb-4">
                        <i class="bi bi-list"></i> Your Active Listings
                    </h3>
                    <div id="sellerItems" class="space-y-4">
                        <!-- Seller items will be populated here -->
                    </div>
                </div>
                
                <div class="card">
                    <h3 class="text-xl font-bold mb-4">
                        <i class="bi bi-graph-up"></i> Recent Activity
                    </h3>
                    <div id="recentActivity" class="space-y-3">
                        <!-- Recent activity will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Cart Modal -->
<div id="cartModal" class="modal">
    <div class="modal-content" style="width: 700px;">
        <div class="modal-header">
            <h3 class="modal-title">
                <i class="bi bi-cart3"></i> Shopping Cart
                <span class="text-sm text-gray-400 ml-2">(<span id="cartItemCount">0</span> items)</span>
            </h3>
            <button class="modal-close" onclick="closeCartModal()">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
        
        <div id="cartItems" class="space-y-3 mb-4" style="max-height: 500px; overflow-y: auto;">
            <!-- Cart items will be populated here -->
        </div>
        
        <div class="flex justify-between items-center p-4" style="border-top: 1px solid rgba(255,255,255,0.1);">
            <div class="flex items-center gap-4">
                <span class="text-lg font-bold">Total:</span>
                <span id="cartTotal" class="text-xl font-bold text-yellow-400">$0.00</span>
            </div>
            <div class="flex items-center gap-2 text-sm text-gray-400">
                <i class="bi bi-shield-check"></i>
                <span>Secure Checkout</span>
            </div>
        </div>
        
        <div class="flex gap-3">
            <button class="btn btn-outline flex-1" onclick="closeCartModal()">
                <i class="bi bi-arrow-left"></i> Continue Shopping
            </button>
            <button class="btn btn-warning flex-1" onclick="checkout()">
                <i class="bi bi-credit-card"></i> Secure Checkout
            </button>
        </div>
    </div>
</div>

<!-- Chat Modal -->
<div id="chatModal" class="modal">
    <div class="modal-content" style="width: 600px; height: 600px;">
        <div class="modal-header">
            <h3 class="modal-title">
                <i class="bi bi-chat-dots"></i> Chat with <span id="chatPartnerName"></span>
                <div class="online-status ml-2">
                    <div class="status-dot"></div>
                    <span class="text-sm">Online</span>
                </div>
            </h3>
            <div class="flex items-center gap-2">
                <button class="btn btn-video btn-sm" onclick="startVideoCallFromChat()">
                    <i class="bi bi-camera-video"></i>
                </button>
                <button class="btn btn-call btn-sm" onclick="startPhoneCallFromChat()">
                    <i class="bi bi-telephone"></i>
                </button>
                <button class="modal-close" onclick="closeChatModal()">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
        </div>
        
        <div id="chatMessages" class="chat-container" style="height: 400px;">
            <!-- Chat messages will be populated here -->
        </div>
        
        <div id="typingIndicator" class="typing-indicator" style="display: none;">
            <span>Partner is typing</span>
            <div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        </div>
        
        <div class="chat-input-container">
            <input type="text" id="chatInput" class="chat-input" placeholder="Type your message..." onkeypress="handleChatKeyPress(event)" maxlength="500">
            <button class="btn btn-primary" onclick="sendMessage()">
                <i class="bi bi-send"></i>
            </button>
        </div>
        
        <div class="flex items-center justify-between mt-2 text-xs text-gray-500">
            <span>Press Enter to send</span>
            <span id="chatCharCount">0/500</span>
        </div>
    </div>
</div>

<!-- Report Modal -->
<div id="reportModal" class="modal">
    <div class="modal-content" style="width: 500px;">
        <div class="modal-header">
            <h3 class="modal-title">
                <i class="bi bi-flag"></i> Report Seller
            </h3>
            <button class="modal-close" onclick="closeReportModal()">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
        
        <form id="reportForm">
            <div class="form-group">
                <label class="form-label">Reason for Report</label>
                <select name="reason" class="form-select" required>
                    <option value="">Select a reason</option>
                    <option value="fraud">Fraudulent listing or seller</option>
                    <option value="counterfeit">Counterfeit or fake items</option>
                    <option value="poor_communication">Poor communication or unresponsive</option>
                    <option value="wrong_item">Item not as described</option>
                    <option value="no_delivery">Failed to deliver or ship</option>
                    <option value="harassment">Harassment or inappropriate behavior</option>
                    <option value="spam">Spam or irrelevant listings</option>
                    <option value="other">Other violation</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Additional Details</label>
                <textarea name="details" class="form-input form-textarea" placeholder="Please provide specific details about the issue. Include any evidence or screenshots if available..." required maxlength="1000"></textarea>
                <small class="text-gray-400">Characters remaining: <span id="reportCharCount">1000</span></small>
            </div>
            
            <div class="form-group">
                <label class="form-label">Severity Level</label>
                <select name="severity" class="form-select" required>
                    <option value="low">Low - Minor issue</option>
                    <option value="medium">Medium - Concerning behavior</option>
                    <option value="high">High - Serious violation</option>
                    <option value="urgent">Urgent - Immediate action needed</option>
                </select>
            </div>
            
            <div class="flex gap-3">
                <button type="button" class="btn btn-outline flex-1" onclick="closeReportModal()">Cancel</button>
                <button type="submit" class="btn btn-danger flex-1">
                    <i class="bi bi-flag"></i> Submit Report
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Contact Modal -->
<div id="contactModal" class="modal">
    <div class="modal-content" style="width: 450px;">
        <div class="modal-header">
            <h3 class="modal-title">
                <i class="bi bi-telephone"></i> Contact Seller
            </h3>
            <button class="modal-close" onclick="closeContactModal()">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
        
        <div class="space-y-4">
            <div class="text-center mb-6">
                <div class="caller-avatar mb-3" id="contactSellerAvatar">S</div>
                <h4 class="text-lg font-bold mb-2" id="contactSellerName">Seller Name</h4>
                <div class="flex items-center justify-center gap-2 text-sm text-gray-400">
                    <div class="status-dot"></div>
                    <span>Available for calls</span>
                </div>
            </div>
            
            <button class="btn btn-video w-full" onclick="initiateVideoCall()">
                <i class="bi bi-camera-video"></i> Start Video Call
                <small class="block text-xs opacity-75">HD video with screen sharing</small>
            </button>
            
            <button class="btn btn-call w-full" onclick="initiatePhoneCall()">
                <i class="bi bi-telephone"></i> Make Phone Call
                <small class="block text-xs opacity-75">Direct phone connection</small>
            </button>
            
            <button class="btn btn-primary w-full" onclick="openChat()">
                <i class="bi bi-chat-dots"></i> Send Message
                <small class="block text-xs opacity-75">Instant messaging</small>
            </button>
            
            <div class="text-center pt-4 border-t border-gray-700">
                <p class="text-xs text-gray-500">All calls are recorded for quality assurance</p>
            </div>
        </div>
    </div>
</div>
<script>
    // Firebase Configuration
const firebaseConfig = {
    apiKey: "AIzaSyBDemoKeyForTradingHub123456789",
    authDomain: "x-trading-hub.firebaseapp.com", 
    databaseURL: "https://x-trading-hub-default-rtdb.firebaseio.com",
    projectId: "x-trading-hub",
    storageBucket: "x-trading-hub.appspot.com",
    messagingSenderId: "123456789012",
    appId: "1:123456789012:web:abcdef123456789"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const database = firebase.database();
const storage = firebase.storage();
const auth = firebase.auth();

// Global variables
let currentUser = {
    id: localStorage.getItem('userId') || 'user_' + Date.now(),
    name: localStorage.getItem('userName') || '',
    businessName: localStorage.getItem('businessName') || '',
    country: localStorage.getItem('userCountry') || 'United States',
    location: localStorage.getItem('userLocation') || 'New York, NY',
    phone: localStorage.getItem('userPhone') || '',
    isOnline: true,
    lastSeen: Date.now()
};

let items = [];
let cart = JSON.parse(localStorage.getItem('cart')) || [];
let reports = {};
let bannedSellers = [];
let selectedCategory = 'all';
let selectedSellCategory = 'Electronics';
let currentChatPartner = null;
let currentReportTarget = null;
let currentCall = null;
let localStream = null;
let remoteStream = null;
let peerConnection = null;
let isVideoEnabled = true;
let isAudioEnabled = true;
let lastItemCount = 0;

// WebRTC Configuration
const rtcConfiguration = {
    iceServers: [
        { urls: 'stun:stun.l.google.com:19302' },
        { urls: 'stun:stun1.l.google.com:19302' }
    ]
};

// Countries data with enhanced info
const countries = [
    { name: "United States", code: "us", currency: "USD", phone: "+1" },
    { name: "Canada", code: "ca", currency: "CAD", phone: "+1" },
    { name: "United Kingdom", code: "gb", currency: "GBP", phone: "+44" },
    { name: "Australia", code: "au", currency: "AUD", phone: "+61" },
    { name: "Germany", code: "de", currency: "EUR", phone: "+49" },
    { name: "France", code: "fr", currency: "EUR", phone: "+33" },
    { name: "Japan", code: "jp", currency: "JPY", phone: "+81" },
    { name: "China", code: "cn", currency: "CNY", phone: "+86" },
    { name: "India", code: "in", currency: "INR", phone: "+91" },
    { name: "Brazil", code: "br", currency: "BRL", phone: "+55" },
    { name: "Mexico", code: "mx", currency: "MXN", phone: "+52" },
    { name: "Italy", code: "it", currency: "EUR", phone: "+39" },
    { name: "Spain", code: "es", currency: "EUR", phone: "+34" },
    { name: "South Korea", code: "kr", currency: "KRW", phone: "+82" },
    { name: "Russia", code: "ru", currency: "RUB", phone: "+7" },
    { name: "Netherlands", code: "nl", currency: "EUR", phone: "+31" },
    { name: "Sweden", code: "se", currency: "SEK", phone: "+46" },
    { name: "Norway", code: "no", currency: "NOK", phone: "+47" },
    { name: "Switzerland", code: "ch", currency: "CHF", phone: "+41" },
    { name: "Singapore", code: "sg", currency: "SGD", phone: "+65" },
    { name: "Ghana", code: "gh", currency: "CEDI", phone: "+233" }
];

// Currency symbols with enhanced mapping
const currencySymbols = {
    'USD': '$', 'EUR': 'â‚¬', 'GBP': 'Â£', 'JPY': 'Â¥',
    'CAD': 'C$', 'AUD': 'A$', 'INR': 'â‚¹', 'CNY': 'Â¥',
    'BRL': 'R$', 'MXN': '$', 'KRW': 'â‚©', 'RUB': 'â‚½',
    'SEK': 'kr', 'NOK': 'kr', 'CHF': 'Fr', 'SGD': 'S$',
    'CEDI': 'â‚µ'
};

// Initialize app
document.addEventListener('DOMContentLoaded', function() {
    initializeApp();
    connectToFirebase();
    loadMarketplaceData();
    showPage('home');
    updateStats();
});

function initializeApp() {
    // Store user ID
    localStorage.setItem('userId', currentUser.id);
    
    populateCountryDropdowns();
    updateCartUI();
    setupEventListeners();
    initializeWebRTC();
    
    // Set up real-time listeners
    setupFirebaseListeners();
    
    // Load saved business name
    if (currentUser.businessName) {
        document.getElementById('businessName').value = currentUser.businessName;
    }
    
    // Update user presence
    updateUserPresence();
    
    // Auto-refresh marketplace every 30 seconds
    setInterval(refreshMarketplace, 30000);
    
    // Update stats every 10 seconds
    setInterval(updateStats, 10000);
    
    // Check for new items every 5 seconds
    setInterval(checkForNewItems, 5000);
}

function setupEventListeners() {
    // Form handlers
    document.getElementById('sellForm').addEventListener('submit', handleSellForm);
    document.getElementById('reportForm').addEventListener('submit', handleReportForm);
    
    // Image upload preview
    document.getElementById('imageInput').addEventListener('change', handleImageUpload);
    
    // Chat input character count
    document.getElementById('chatInput').addEventListener('input', updateChatCharCount);
    
    // Report textarea character count
    document.querySelector('[name="details"]').addEventListener('input', updateReportCharCount);
    
    // Contact number formatting
    document.getElementById('contactNumber').addEventListener('input', formatPhoneNumber);
    
    // Auto-save draft while typing
    const formInputs = document.querySelectorAll('#sellForm input, #sellForm textarea, #sellForm select');
    formInputs.forEach(input => {
        input.addEventListener('input', saveDraft);
    });
    
    // Handle page visibility for user presence
    document.addEventListener('visibilitychange', handleVisibilityChange);
    
    // Handle online/offline status
    window.addEventListener('online', handleOnlineStatus);
    window.addEventListener('offline', handleOfflineStatus);
}

function connectToFirebase() {
    try {
        // Test connection
        database.ref('.info/connected').on('value', (snapshot) => {
            if (snapshot.val() === true) {
                updateConnectionStatus('online');
                showNotification('Connected to Firebase successfully!', 'success');
            } else {
                updateConnectionStatus('offline');
                showNotification('Disconnected from Firebase. Trying to reconnect...', 'warning');
            }
        });
    } catch (error) {
        console.error('Firebase connection error:', error);
        updateConnectionStatus('offline');
        showNotification('Failed to connect to Firebase. Using offline mode.', 'error');
    }
}

function setupFirebaseListeners() {
    // Listen for new items
    database.ref('items').on('child_added', (snapshot) => {
        const item = snapshot.val();
        if (item && item.sellerId !== currentUser.id) {
            const newItem = { id: snapshot.key, ...item };
            items.push(newItem);
            
            // Show real-time update notification
            showNewItemNotification(newItem);
            
            // Update marketplace if currently viewing
            if (!document.getElementById('marketplacePage').classList.contains('hidden')) {
                loadMarketplaceItems();
            }
            
            showNotification(`New item listed: ${item.name}`, 'info');
        }
    });

    // Listen for item updates
    database.ref('items').on('child_changed', (snapshot) => {
        const updatedItem = snapshot.val();
        const index = items.findIndex(item => item.id === snapshot.key);
        if (index !== -1) {
            items[index] = { id: snapshot.key, ...updatedItem };
            if (!document.getElementById('marketplacePage').classList.contains('hidden')) {
                loadMarketplaceItems();
            }
            showNotification(`Item updated: ${updatedItem.name}`, 'info');
        }
    });

    // Listen for item deletions
    database.ref('items').on('child_removed', (snapshot) => {
        const removedItem = items.find(item => item.id === snapshot.key);
        items = items.filter(item => item.id !== snapshot.key);
        if (!document.getElementById('marketplacePage').classList.contains('hidden')) {
            loadMarketplaceItems();
        }
        if (removedItem) {
            showNotification(`Item removed: ${removedItem.name}`, 'warning');
        }
    });

    // Listen for incoming calls
    database.ref(`calls/${currentUser.id}`).on('child_added', (snapshot) => {
        const call = snapshot.val();
        if (call && call.status === 'incoming') {
            handleIncomingCall(call, snapshot.key);
        }
    });

    // Listen for chat messages
    database.ref('chats').on('child_added', (snapshot) => {
        const message = snapshot.val();
        if (message && message.recipientId === currentUser.id) {
            if (currentChatPartner && message.senderId === currentChatPartner.id) {
                displayNewMessage(message);
            } else {
                showNotification(`New message from ${message.senderName}`, 'info');
            }
        }
    });

    // Listen for user presence
    database.ref('users').on('child_changed', (snapshot) => {
        const user = snapshot.val();
        updateUserPresenceDisplay(snapshot.key, user);
    });
}

function showNewItemNotification(item) {
    const notification = document.createElement('div');
    notification.className = 'new-item-notification';
    notification.innerHTML = `
        <i class="bi bi-plus-circle"></i>
        New item: ${item.name} by ${item.businessName}
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        if (notification.parentNode) {
            notification.remove();
        }
    }, 2000);
    
    // Show update indicator
    const updateIndicator = document.getElementById('updateIndicator');
    updateIndicator.classList.add('show');
    
    setTimeout(() => {
        updateIndicator.classList.remove('show');
    }, 3000);
}

function checkForNewItems() {
    const currentItemCount = items.length;
    if (currentItemCount > lastItemCount && lastItemCount > 0) {
        const newItemsCount = currentItemCount - lastItemCount;
        showNotification(`${newItemsCount} new item${newItemsCount > 1 ? 's' : ''} available!`, 'info');
    }
    lastItemCount = currentItemCount;
}

function updateUserPresence() {
    const userRef = database.ref(`users/${currentUser.id}`);
    
    // Set user as online
    userRef.set({
        name: currentUser.name || 'Anonymous',
        businessName: currentUser.businessName || '',
        country: currentUser.country,
        location: currentUser.location,
        phone: currentUser.phone,
        isOnline: true,
        lastSeen: Date.now()
    });

    // Set user as offline when they disconnect
    userRef.onDisconnect().update({
        isOnline: false,
        lastSeen: Date.now()
    });
}

function loadMarketplaceData() {
    showLoading(true);
    
    database.ref('items').once('value')
        .then((snapshot) => {
            items = [];
            snapshot.forEach((childSnapshot) => {
                const item = childSnapshot.val();
                if (item && !bannedSellers.includes(item.sellerId)) {
                    items.push({ id: childSnapshot.key, ...item });
                }
            });
            
            // Load sample data if empty
            if (items.length === 0) {
                loadSampleData();
            }
            
            loadMarketplaceItems();
            showLoading(false);
        })
        .catch((error) => {
            console.error('Error loading marketplace data:', error);
            loadSampleData();
            showLoading(false);
            showNotification('Error loading data. Using sample data.', 'warning');
        });
}

function loadSampleData() {
    const sampleItems = [
        {
            name: "MacBook Pro 2023 M3 Chip",
            price: 1999.99,
            currency: "USD",
            description: "Brand new MacBook Pro with M3 chip, 16GB RAM, 512GB SSD. Perfect for professionals and creatives. Still in original packaging with warranty.",
            image: "https://images.unsplash.com/photo-1611186871348-b1ce696e52c9?w=500&h=400&fit=crop",
            category: "Electronics",
            condition: "New",
            businessName: "Tech Haven Pro",
            sellerCountry: "United States",
            location: "San Francisco, CA",
            sellerId: "seller_tech_1",
            dateAdded: Date.now() - 86400000,
            quantity: 5,
            phone: "+1 (555) 123-4567",
            shipping: "both",
            returns: "14-days",
            views: 245,
            isOnline: true
        },
        {
            name: "Nike Air Jordan 1 Retro High OG",
            price: 249.99,
            currency: "USD", 
            description: "Limited edition Air Jordan 1 Retro High OG in Chicago colorway, size 10. Worn only once, excellent condition with original box and tags.",
            image: "https://images.unsplash.com/photo-1600269452121-4f2416e55c28?w=500&h=400&fit=crop",
            category: "Fashion",
            condition: "Like New",
            businessName: "Sneaker Empire",
            sellerCountry: "United States",
            location: "New York, NY",
            sellerId: "seller_sneaker_1",
            dateAdded: Date.now() - 172800000,
            quantity: 1,
            phone: "+1 (555) 234-5678",
            shipping: "national",
            returns: "7-days",
            views: 189,
            isOnline: true
        },
        {
            name: "Premium Leather Sofa Set",
            price: 899.99,
            currency: "USD",
            description: "Genuine Italian leather 3-piece sofa set in rich brown color. Excellent condition, very comfortable. Perfect for living room or office space.",
            image: "https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=500&h=400&fit=crop",
            category: "Home",
            condition: "Good",
            businessName: "Home Comfort Plus",
            sellerCountry: "Canada",
            location: "Toronto, ON",
            sellerId: "seller_furniture_1",
            dateAdded: Date.now() - 259200000,
            quantity: 1,
            phone: "+1 (416) 345-6789",
            shipping: "local",
            returns: "no-returns",
            views: 156,
            isOnline: false
        },
        {
            name: "Professional Yoga Mat & Accessories",
            price: 59.99,
            currency: "USD",
            description: "Eco-friendly premium yoga mat with carrying strap, alignment guides, and bonus meditation cushion. Perfect for all skill levels.",
            image: "https://images.unsplash.com/photo-1576678927484-cc9079573c3f?w=500&h=400&fit=crop",
            category: "Sports",
            condition: "New",
            businessName: "FitLife Gear",
            sellerCountry: "United Kingdom",
            location: "London, UK",
            sellerId: "seller_fitness_1",
            dateAdded: Date.now() - 345600000,
            quantity: 15,
            phone: "+44 20 7946 0958",
            shipping: "international",
            returns: "30-days",
            views: 98,
            isOnline: true
        },
        {
            name: "Sony WH-1000XM5 Headphones",
            price: 349.99,
            currency: "USD",
            description: "Industry-leading noise canceling wireless headphones with 30-hour battery life. Like new condition with all original accessories.",
            image: "https://images.unsplash.com/photo-1615126454705-d88d2416c123?w=500&h=400&fit=crop",
            category: "Electronics",
            condition: "Like New",
            businessName: "Audio Masters",
            sellerCountry: "Germany",
            location: "Berlin, Germany",
            sellerId: "seller_audio_1",
            dateAdded: Date.now() - 432000000,
            quantity: 3,
            phone: "+49 30 12345678",
            shipping: "international",
            returns: "14-days",
            views: 167,
            isOnline: true
        },
        {
            name: "Vintage Leather Jacket",
            price: 199.99,
            currency: "USD",
            description: "Authentic vintage leather jacket from the 80s. Size Large, genuine leather, excellent condition with unique patina.",
            image: "https://images.unsplash.com/photo-1551028719-00167b16eac5?w=500&h=400&fit=crop",
            category: "Fashion",
            condition: "Good",
            businessName: "Vintage Vibes",
            sellerCountry: "France",
            location: "Paris, France",
            sellerId: "seller_vintage_1",
            dateAdded: Date.now() - 518400000,
            quantity: 1,
            phone: "+33 1 42 86 83 26",
            shipping: "international",
            returns: "7-days",
            views: 134,
            isOnline: true
        }
    ];

    // Save sample data to Firebase and local array
    sampleItems.forEach(item => {
        const newItemRef = database.ref('items').push();
        newItemRef.set(item);
        items.push({ id: newItemRef.key, ...item });
    });
}

function populateCountryDropdowns() {
    const dropdown = document.getElementById('countryDropdown');
    const sellerCountry = document.getElementById('sellerCountry');
    
    dropdown.innerHTML = '';
    sellerCountry.innerHTML = '<option value="">Select your country</option>';
    
    countries.forEach(country => {
        // Main dropdown
        const item = document.createElement('div');
        item.className = 'country-item';
        item.innerHTML = `
            <img src="https://flagcdn.com/w20/${country.code}.png" class="country-flag" alt="${country.name}">
            <span>${country.name}</span>
            <small class="text-gray-400 ml-auto">${country.currency}</small>
        `;
        item.onclick = () => selectCountry(country);
        dropdown.appendChild(item);
        
        // Seller country dropdown
        const option = document.createElement('option');
        option.value = country.name;
        option.textContent = `${country.name} (${country.currency})`;
        sellerCountry.appendChild(option);
    });
    
    // Set default country
    sellerCountry.value = currentUser.country;
}

function selectCountry(country) {
    document.getElementById('selectedCountry').textContent = country.name;
    document.getElementById('selectedFlag').src = `https://flagcdn.com/w20/${country.code}.png`;
    document.getElementById('countryDropdown').classList.remove('active');
    
    currentUser.country = country.name;
    localStorage.setItem('userCountry', country.name);
    
    showNotification(`Viewing items from ${country.name}`, 'info');
    loadMarketplaceItems();
}

function toggleCountryDropdown() {
    document.getElementById('countryDropdown').classList.toggle('active');
}

function showPage(pageId) {
    // Hide all pages
    document.querySelectorAll('.page').forEach(page => {
        page.classList.add('hidden');
    });
    
    // Show selected page
    const targetPage = pageId + 'Page';
    document.getElementById(targetPage).classList.remove('hidden');
    
    // Load page-specific content
    switch(pageId) {
        case 'marketplace':
            loadMarketplaceItems();
            break;
        case 'manage':
            loadSellerItems();
            break;
    }
    
    // Update navigation active state
    document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
    });
}

function loadMarketplaceItems() {
    const grid = document.getElementById('itemsGrid');
    const itemCount = document.getElementById('itemCount');
    grid.innerHTML = '';
    
    let filteredItems = items.filter(item => !bannedSellers.includes(item.sellerId));
    
    // Apply category filter
    if (selectedCategory !== 'all') {
        filteredItems = filteredItems.filter(item => item.category === selectedCategory);
    }
    
    // Apply search filter
    const searchQuery = document.getElementById('searchInput')?.value.toLowerCase();
    if (searchQuery) {
        filteredItems = filteredItems.filter(item => 
            item.name.toLowerCase().includes(searchQuery) ||
            item.description.toLowerCase().includes(searchQuery) ||
            item.businessName.toLowerCase().includes(searchQuery) ||
            item.category.toLowerCase().includes(searchQuery) ||
            item.sellerCountry.toLowerCase().includes(searchQuery)
        );
    }
    
    // Apply condition filters
    const conditionFilters = getSelectedConditions();
    if (conditionFilters.length > 0) {
        filteredItems = filteredItems.filter(item => conditionFilters.includes(item.condition));
    }
    
    // Apply seller status filters
    const sellerFilters = getSelectedSellerFilters();
    if (sellerFilters.includes('online')) {
        filteredItems = filteredItems.filter(item => item.isOnline);
    }
    
    // Sort items
    const sortBy = document.getElementById('sortSelect')?.value || 'newest';
    filteredItems.sort((a, b) => {
        switch(sortBy) {
            case 'price-low':
                return a.price - b.price;
            case 'price-high':
                return b.price - a.price;
            case 'popular':
                return (b.views || 0) - (a.views || 0);
            case 'rating':
                return (b.rating || 0) - (a.rating || 0);
            default:
                return b.dateAdded - a.dateAdded;
        }
    });
    
    itemCount.textContent = filteredItems.length;
    
    if (filteredItems.length === 0) {
        grid.innerHTML = `
            <div class="col-span-3 text-center py-20">
                <i class="bi bi-search text-6xl text-gray-400 mb-4"></i>
                <h3 class="text-xl font-bold mb-2">No items found</h3>
                <p class="text-gray-400">Try adjusting your search or filters</p>
                <button class="btn btn-primary mt-4" onclick="clearFilters()">
                    <i class="bi bi-arrow-clockwise"></i> Clear Filters
                </button>
            </div>
        `;
        return;
    }
    
    filteredItems.forEach(item => {
        const itemCard = document.createElement('div');
        itemCard.className = 'item-card';
        
        const currencySymbol = currencySymbols[item.currency] || item.currency;
        const isOnline = item.isOnline ? 'online' : 'offline';
        
        itemCard.innerHTML = `
            <div class="business-badge">${item.businessName}</div>
            <div class="location-badge">${item.sellerCountry}</div>
            ${item.isOnline ? '<div class="online-seller-badge"><div class="status-dot"></div>Online</div>' : ''}
            <img src="${item.image}" alt="${item.name}" class="item-image" loading="lazy">
            <div class="item-content">
                <h3 class="item-title">${item.name}</h3>
                <p class="item-description">${item.description}</p>
                <div class="item-meta">
                    <span class="item-category category-${item.category.toLowerCase()}">${item.category}</span>
                    <span class="item-price">${currencySymbol}${item.price.toFixed(2)}</span>
                </div>
                <div class="flex justify-between items-center text-sm text-gray-400 mb-3">
                    <span>${item.condition}</span>
                    <span><i class="bi bi-eye"></i> ${item.views || 0} views</span>
                    <span>Qty: ${item.quantity || 1}</span>
                </div>
                <div class="item-actions">
                    <button class="btn btn-primary btn-sm" onclick="addToCart('${item.id}')" ${item.quantity < 1 ? 'disabled' : ''}>
                        <i class="bi bi-cart-plus"></i> Add to Cart
                    </button>
                    <button class="btn btn-outline btn-sm" onclick="contactSeller('${item.sellerId}', '${item.businessName}', '${item.name}')">
                        <i class="bi bi-chat-dots"></i> Message
                    </button>
                </div>
                <div class="call-actions">
                    <button class="btn btn-video btn-sm" onclick="initiateVideoCallDirect('${item.sellerId}', '${item.businessName}', '${item.name}')">
                        <i class="bi bi-camera-video"></i> Video Call
                    </button>
                    <button class="btn btn-call btn-sm" onclick="initiatePhoneCallDirect('${item.sellerId}', '${item.businessName}', '${item.phone}')">
                        <i class="bi bi-telephone"></i> Call ${item.phone ? item.phone.slice(-4) : 'Now'}
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="reportSeller('${item.sellerId}', '${item.businessName}')">
                        <i class="bi bi-flag"></i>
                    </button>
                </div>
            </div>
        `;
        
        // Add click tracking
        itemCard.addEventListener('click', () => {
            trackItemView(item.id);
        });
        
        grid.appendChild(itemCard);
    });
}

function trackItemView(itemId) {
    // Increment view count in Firebase
    const itemRef = database.ref(`items/${itemId}/views`);
    itemRef.transaction((currentViews) => {
        return (currentViews || 0) + 1;
    });
}

function getSelectedConditions() {
    const conditions = [];
    if (document.getElementById('conditionNew')?.checked) conditions.push('New');
    if (document.getElementById('conditionLikeNew')?.checked) conditions.push('Like New');
    if (document.getElementById('conditionGood')?.checked) conditions.push('Good');
    if (document.getElementById('conditionFair')?.checked) conditions.push('Fair');
    return conditions;
}

function getSelectedSellerFilters() {
    const filters = [];
    if (document.getElementById('onlineSellers')?.checked) filters.push('online');
    if (document.getElementById('verifiedSellers')?.checked) filters.push('verified');
    if (document.getElementById('fastShipping')?.checked) filters.push('fast');
    return filters;
}

function filterByCategory(category) {
    selectedCategory = category;
    
    // Update active state
    document.querySelectorAll('.category-filter').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    loadMarketplaceItems();
    showNotification(`Filtered by: ${category === 'all' ? 'All Categories' : category}`, 'info');
}

function selectSellCategory(category) {
    selectedSellCategory = category;
    
    // Update active state
    document.querySelectorAll('#sellPage .category-filter').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    showNotification(`Selected category: ${category}`, 'info');
}

function searchItems() {
    loadMarketplaceItems();
}

function sortItems() {
    loadMarketplaceItems();
}

function applyPriceFilter() {
    const minPrice = parseFloat(document.getElementById('minPrice').value) || 0;
    const maxPrice = parseFloat(document.getElementById('maxPrice').value) || Infinity;
    
    if (minPrice > maxPrice && maxPrice !== Infinity) {
        showNotification('Minimum price cannot be greater than maximum price', 'error');
        return;
    }
    
    loadMarketplaceItems();
    showNotification(`Price filter applied: ${currencySymbols.USD}${minPrice} - ${maxPrice === Infinity ? 'âˆž' : currencySymbols.USD + maxPrice}`, 'info');
}

function clearFilters() {
    // Reset all filters
    selectedCategory = 'all';
    document.getElementById('searchInput').value = '';
    document.getElementById('minPrice').value = '';
    document.getElementById('maxPrice').value = '';
    
    // Uncheck all checkboxes
    document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = false;
    });
    
    // Reset category buttons
    document.querySelectorAll('.category-filter').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector('.category-filter').classList.add('active');
    
    loadMarketplaceItems();
    showNotification('All filters cleared', 'info');
}

function refreshMarketplace() {
    showLoading(true);
    loadMarketplaceData();
    showNotification('Marketplace refreshed', 'success');
}

function toggleViewMode() {
    const grid = document.getElementById('itemsGrid');
    const btn = document.getElementById('viewModeBtn');
    
    if (grid.classList.contains('grid-cols-3')) {
        grid.classList.remove('grid-cols-3');
        grid.classList.add('grid-cols-1');
        btn.innerHTML = '<i class="bi bi-grid-3x3"></i> Grid View';
    } else {
        grid.classList.remove('grid-cols-1');
        grid.classList.add('grid-cols-3');
        btn.innerHTML = '<i class="bi bi-list"></i> List View';
    }
}

function addToCart(itemId) {
    const item = items.find(i => i.id === itemId);
    if (!item) {
        showNotification('Item not found', 'error');
        return;
    }
    
    if (item.quantity < 1) {
        showNotification('Item is out of stock', 'error');
        return;
    }
    
    const existingItem = cart.find(c => c.id === itemId);
    
    if (existingItem) {
        if (existingItem.quantity >= item.quantity) {
            showNotification('Cannot add more items than available', 'warning');
            return;
        }
        existingItem.quantity += 1;
    } else {
        cart.push({
            ...item,
            quantity: 1,
            addedAt: Date.now()
        });
    }
    
    localStorage.setItem('cart', JSON.stringify(cart));
    updateCartUI();
    showNotification(`${item.name} added to cart!`, 'success');
    
    // Add cart animation
    document.getElementById('cartCount').classList.add('cart-animate');
    setTimeout(() => {
        document.getElementById('cartCount').classList.remove('cart-animate');
    }, 600);
    
    // Notify seller
    notifySeller(item);
    
    // Track in Firebase
    trackCartActivity(itemId, 'add');
}

function notifySeller(item) {
    const buyerLocation = getRandomBuyerLocation();
    const notification = {
        type: 'cart_add',
        buyerId: currentUser.id,
        buyerName: currentUser.name || 'Anonymous Buyer',
        buyerLocation: buyerLocation,
        itemId: item.id,
        itemName: item.name,
        timestamp: Date.now(),
        message: `New buyer interested in "${item.name}" from ${buyerLocation}`
    };
    
    // Send to Firebase
    database.ref(`notifications/${item.sellerId}`).push(notification);
    
    setTimeout(() => {
        showNotification(`Seller notified about your interest in "${item.name}"`, 'info');
    }, 1000);
}

function getRandomBuyerLocation() {
    const locations = [
        "New York, NY", "Los Angeles, CA", "Chicago, IL", "Houston, TX",
        "Phoenix, AZ", "Philadelphia, PA", "San Antonio, TX", "San Diego, CA",
        "Dallas, TX", "San Jose, CA", "Austin, TX", "Jacksonville, FL",
        "Toronto, ON", "Vancouver, BC", "London, UK", "Berlin, Germany",
        "Paris, France", "Tokyo, Japan", "Sydney, Australia", "Mumbai, India"
    ];
    return locations[Math.floor(Math.random() * locations.length)];
}

function trackCartActivity(itemId, action) {
    const activity = {
        userId: currentUser.id,
        itemId: itemId,
        action: action,
        timestamp: Date.now()
    };
    
    database.ref('analytics/cart').push(activity);
}

function updateCartUI() {
    const cartCount = document.getElementById('cartCount');
    const cartItemCount = document.getElementById('cartItemCount');
    const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
    
    cartCount.textContent = totalItems;
    if (cartItemCount) {
        cartItemCount.textContent = totalItems;
    }
    
    // Update cart modal if open
    if (!document.getElementById('cartModal').classList.contains('hidden')) {
        updateCartModal();
    }
}

function updateCartModal() {
    const cartItems = document.getElementById('cartItems');
    const cartTotal = document.getElementById('cartTotal');
    
    cartItems.innerHTML = '';
    
    if (cart.length === 0) {
        cartItems.innerHTML = `
            <div class="text-center py-12">
                <i class="bi bi-cart-x text-6xl text-gray-400 mb-4"></i>
                <h3 class="text-xl font-bold mb-2">Your cart is empty</h3>
                <p class="text-gray-400">Add some items to get started</p>
                <button class="btn btn-primary mt-4" onclick="closeCartModal(); showPage('marketplace')">
                    <i class="bi bi-shop"></i> Browse Marketplace
                </button>
            </div>
        `;
        cartTotal.textContent = '$0.00';
        return;
    }
    
    let total = 0;
    let totalCurrency = 'USD';
    
    cart.forEach(item => {
        const currencySymbol = currencySymbols[item.currency] || item.currency;
        const itemTotal = item.price * item.quantity;
        total += itemTotal;
        
        const cartItem = document.createElement('div');
        cartItem.className = 'flex justify-between items-center p-4 border border-gray-700 rounded-lg hover:border-gold transition-colors';
        cartItem.innerHTML = `
            <div class="flex items-center gap-4">
                <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-cover rounded-lg">
                <div class="flex-1">
                    <h4 class="font-semibold text-white">${item.name}</h4>
                    <p class="text-sm text-gray-400">${currencySymbol}${item.price.toFixed(2)} each</p>
                    <p class="text-xs text-gray-500">
                        <i class="bi bi-shop"></i> ${item.businessName} â€¢ ${item.sellerCountry}
                    </p>
                    <div class="flex items-center gap-2 mt-2">
                        <button class="btn btn-video btn-sm" onclick="initiateVideoCallFromCart('${item.sellerId}', '${item.businessName}', '${item.name}')">
                            <i class="bi bi-camera-video"></i>
                        </button>
                        <button class="btn btn-call btn-sm" onclick="initiatePhoneCallFromCart('${item.sellerId}', '${item.businessName}', '${item.phone}')">
                            <i class="bi bi-telephone"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <div class="flex items-center gap-2">
                    <button class="btn btn-outline btn-sm" onclick="updateCartQuantity('${item.id}', ${item.quantity - 1})" ${item.quantity <= 1 ? 'disabled' : ''}>
                        <i class="bi bi-dash"></i>
                    </button>
                    <span class="w-12 text-center font-bold">${item.quantity}</span>
                    <button class="btn btn-outline btn-sm" onclick="updateCartQuantity('${item.id}', ${item.quantity + 1})">
                        <i class="bi bi-plus"></i>
                    </button>
                </div>
                <div class="text-right">
                    <div class="font-bold text-gold">${currencySymbol}${itemTotal.toFixed(2)}</div>
                    <button class="text-red-400 hover:text-red-300 text-sm" onclick="removeFromCart('${item.id}')">
                        <i class="bi bi-trash"></i> Remove
                    </button>
                </div>
            </div>
        `;
        cartItems.appendChild(cartItem);
    });
    
    const displaySymbol = currencySymbols[totalCurrency] || totalCurrency;
    cartTotal.textContent = `${displaySymbol}${total.toFixed(2)}`;
}

function updateCartQuantity(itemId, quantity) {
    if (quantity < 1) {
        removeFromCart(itemId);
        return;
    }
    
    const item = cart.find(c => c.id === itemId);
    const originalItem = items.find(i => i.id === itemId);
    
    if (item && originalItem) {
        if (quantity > originalItem.quantity) {
            showNotification(`Only ${originalItem.quantity} items available`, 'warning');
            return;
        }
        
        item.quantity = quantity;
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartUI();
        trackCartActivity(itemId, 'update');
    }
}

function removeFromCart(itemId) {
    cart = cart.filter(c => c.id !== itemId);
    localStorage.setItem('cart', JSON.stringify(cart));
    updateCartUI();
    showNotification('Item removed from cart', 'info');
    trackCartActivity(itemId, 'remove');
}

function openCartModal() {
    document.getElementById('cartModal').classList.add('active');
    updateCartModal();
}

function closeCartModal() {
    document.getElementById('cartModal').classList.remove('active');
}

function checkout() {
    if (cart.length === 0) {
        showNotification('Your cart is empty!', 'error');
        return;
    }
    
    showLoading(true);
    
    // Simulate checkout process
    setTimeout(() => {
        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        const orderData = {
            orderId: 'ORDER_' + Date.now(),
            buyerId: currentUser.id,
            items: cart,
            total: total,
            currency: 'USD',
            timestamp: Date.now(),
            status: 'confirmed'
        };
        
        // Save order to Firebase
        database.ref('orders').push(orderData);
        
        // Notify all sellers
        cart.forEach(item => {
            const sellerNotification = {
                type: 'new_order',
                orderId: orderData.orderId,
                buyerId: currentUser.id,
                buyerName: currentUser.name || 'Anonymous',
                itemName: item.name,
                quantity: item.quantity,
                total: item.price * item.quantity,
                timestamp: Date.now()
            };
            database.ref(`notifications/${item.sellerId}`).push(sellerNotification);
        });
        
        showLoading(false);
        showNotification(`Order confirmed! Total: $${total.toFixed(2)}`, 'success');
        
        // Clear cart
        cart = [];
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartUI();
        closeCartModal();
        
        // Show order confirmation
        setTimeout(() => {
            showNotification(`Order ID: ${orderData.orderId}`, 'info');
        }, 2000);
        
    }, 2000);
}

// Video Call Functions
function initializeWebRTC() {
    // Check for WebRTC support
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        console.warn('WebRTC not supported');
        return;
    }
    
    // Request permissions early
    navigator.mediaDevices.getUserMedia({ video: true, audio: true })
        .then(stream => {
            // Stop the stream immediately, we just wanted to get permissions
            stream.getTracks().forEach(track => track.stop());
        })
        .catch(err => {
            console.warn('Media permissions denied:', err);
        });
}

function initiateVideoCallDirect(sellerId, businessName, itemName) {
    currentChatPartner = { id: sellerId, businessName: businessName, itemName: itemName };
    
    // Show contact modal first
    document.getElementById('contactSellerName').textContent = businessName;
    document.getElementById('contactSellerAvatar').textContent = businessName.charAt(0);
    document.getElementById('contactModal').classList.add('active');
}

function initiatePhoneCallDirect(sellerId, businessName, phone) {
    currentChatPartner = { id: sellerId, businessName: businessName, phone: phone };
    
    // Show contact modal first
    document.getElementById('contactSellerName').textContent = businessName;
    document.getElementById('contactSellerAvatar').textContent = businessName.charAt(0);
    document.getElementById('contactModal').classList.add('active');
}

function initiateVideoCallFromCart(sellerId, businessName, itemName) {
    initiateVideoCallDirect(sellerId, businessName, itemName);
}

function initiatePhoneCallFromCart(sellerId, businessName, phone) {
    initiatePhoneCallDirect(sellerId, businessName, phone);
}

function initiateVideoCall() {
    closeContactModal();
    
    if (!currentChatPartner) {
        showNotification('No contact selected', 'error');
        return;
    }
    
    // Send call request to Firebase
    const callData = {
        callerId: currentUser.id,
        callerName: currentUser.name || 'Anonymous',
        callerBusiness: currentUser.businessName || '',
        recipientId: currentChatPartner.id,
        type: 'video',
        status: 'calling',
        timestamp: Date.now(),
        itemName: currentChatPartner.itemName || ''
    };
    
    const callRef = database.ref(`calls/${currentChatPartner.id}`).push(callData);
    currentCall = { id: callRef.key, ...callData };
    
    showNotification(`Calling ${currentChatPartner.businessName}...`, 'call');
    
    // Start video call UI
    startVideoCall();
    
    // Auto-cancel after 30 seconds if not answered
    setTimeout(() => {
        if (currentCall && currentCall.status === 'calling') {
            endCall();
            showNotification('Call not answered', 'warning');
        }
    }, 30000);
}

function initiatePhoneCall() {
    closeContactModal();
    
    if (!currentChatPartner) {
        showNotification('No contact selected', 'error');
        return;
    }
    
    const phone = currentChatPartner.phone || generateRandomPhone();
    
    // Send call request to Firebase
    const callData = {
        callerId: currentUser.id,
        callerName: currentUser.name || 'Anonymous',
        callerBusiness: currentUser.businessName || '',
        recipientId: currentChatPartner.id,
        type: 'phone',
        status: 'calling',
        timestamp: Date.now(),
        phone: phone
    };
    
    database.ref(`calls/${currentChatPartner.id}`).push(callData);
    
    // Simulate phone call
    if (navigator.userAgent.includes('Mobile')) {
        window.location.href = `tel:${phone}`;
    } else {
        showNotification(`Calling ${currentChatPartner.businessName} at ${phone}`, 'call');
        
        // Show call in progress notification
        setTimeout(() => {
            showNotification('Call connected! Duration: 2:34', 'success');
        }, 3000);
    }
}

function startVideoCall() {
    document.getElementById('videoCallPartner').textContent = currentChatPartner.businessName;
    document.getElementById('videoCallModal').classList.add('active');
    document.getElementById('callStatus').textContent = 'Connecting...';
    
    // Get user media
    navigator.mediaDevices.getUserMedia({ video: true, audio: true })
        .then(stream => {
            localStream = stream;
            document.getElementById('localVideo').srcObject = stream;
            document.getElementById('callStatus').textContent = 'Calling...';
            
            // Simulate connection after 3 seconds
            setTimeout(() => {
                simulateCallConnection();
            }, 3000);
        })
        .catch(err => {
            console.error('Error accessing media devices:', err);
            showNotification('Camera/microphone access denied', 'error');
            endCall();
        });
}

function simulateCallConnection() {
    document.getElementById('callStatus').textContent = 'Connected';
    
    // Create a fake remote video (mirror of local video for demo)
    const localVideo = document.getElementById('localVideo');
    const remoteVideo = document.getElementById('remoteVideo');
    
    // Clone the local stream for demo purposes
    if (localStream) {
        remoteVideo.srcObject = localStream.clone();
    }
    
    showNotification('Video call connected!', 'success');
    
    // Update call status in Firebase
    if (currentCall) {
        database.ref(`calls/${currentChatPartner.id}/${currentCall.id}`).update({
            status: 'connected',
            connectedAt: Date.now()
        });
    }
}

function handleIncomingCall(call, callId) {
    // Show incoming call modal
    document.getElementById('callerName').textContent = call.callerName;
    document.getElementById('callerAvatar').textContent = call.callerName.charAt(0);
    document.getElementById('callType').textContent = call.type === 'video' ? 'Video Call' : 'Phone Call';
    document.getElementById('incomingCallModal').classList.add('active');
    
    // Store call info
    currentCall = { id: callId, ...call };
    
    // Play ringtone (if available)
    playRingtone();
    
    // Auto-decline after 30 seconds
    setTimeout(() => {
        if (document.getElementById('incomingCallModal').classList.contains('active')) {
            declineCall();
        }
    }, 30000);
}

function answerCall() {
    document.getElementById('incomingCallModal').classList.remove('active');
    
    if (currentCall.type === 'video') {
        startVideoCall();
    } else {
        showNotification(`Answering call from ${currentCall.callerName}`, 'success');
    }
    
    // Update call status
    database.ref(`calls/${currentUser.id}/${currentCall.id}`).update({
        status: 'answered',
        answeredAt: Date.now()
    });
    
    stopRingtone();
}

function declineCall() {
    document.getElementById('incomingCallModal').classList.remove('active');
    
    // Update call status
    if (currentCall) {
        database.ref(`calls/${currentUser.id}/${currentCall.id}`).update({
            status: 'declined',
            declinedAt: Date.now()
        });
    }
    
    currentCall = null;
    stopRingtone();
    showNotification('Call declined', 'info');
}

function endCall() {
    // Close video call modal
    document.getElementById('videoCallModal').classList.remove('active');
    
    // Stop all media streams
    if (localStream) {
        localStream.getTracks().forEach(track => track.stop());
        localStream = null;
    }
    
    if (remoteStream) {
        remoteStream.getTracks().forEach(track => track.stop());
        remoteStream = null;
    }
    
    // Close peer connection
    if (peerConnection) {
        peerConnection.close();
        peerConnection = null;
    }
    
    // Update call status
    if (currentCall) {
        database.ref(`calls/${currentChatPartner?.id}/${currentCall.id}`).update({
            status: 'ended',
            endedAt: Date.now()
        });
    }
    
    currentCall = null;
    showNotification('Call ended', 'info');
}

function toggleMute() {
    if (localStream) {
        const audioTrack = localStream.getAudioTracks()[0];
        if (audioTrack) {
            isAudioEnabled = !isAudioEnabled;
            audioTrack.enabled = isAudioEnabled;
            
            const muteIcon = document.getElementById('muteIcon');
            muteIcon.className = isAudioEnabled ? 'bi bi-mic' : 'bi bi-mic-mute';
            
            showNotification(isAudioEnabled ? 'Microphone unmuted' : 'Microphone muted', 'info');
        }
    }
}

function toggleVideo() {
    if (localStream) {
        const videoTrack = localStream.getVideoTracks()[0];
        if (videoTrack) {
            isVideoEnabled = !isVideoEnabled;
            videoTrack.enabled = isVideoEnabled;
            
            const videoIcon = document.getElementById('videoIcon');
            videoIcon.className = isVideoEnabled ? 'bi bi-camera-video' : 'bi bi-camera-video-off';
            
            showNotification(isVideoEnabled ? 'Camera enabled' : 'Camera disabled', 'info');
        }
    }
}

function shareScreen() {
    if (navigator.mediaDevices && navigator.mediaDevices.getDisplayMedia) {
        navigator.mediaDevices.getDisplayMedia({ video: true })
            .then(stream => {
                // Replace video track with screen share
                const videoTrack = stream.getVideoTracks()[0];
                const sender = peerConnection?.getSenders().find(s => 
                    s.track && s.track.kind === 'video'
                );
                
                if (sender) {
                    sender.replaceTrack(videoTrack);
                }
                
                document.getElementById('localVideo').srcObject = stream;
                showNotification('Screen sharing started', 'success');
                
                // Stop screen share when track ends
                videoTrack.onended = () => {
                    stopScreenShare();
                };
            })
            .catch(err => {
                console.error('Error sharing screen:', err);
                showNotification('Screen sharing failed', 'error');
            });
    } else {
        showNotification('Screen sharing not supported', 'error');
    }
}

function stopScreenShare() {
    // Switch back to camera
    navigator.mediaDevices.getUserMedia({ video: true, audio: true })
        .then(stream => {
            const videoTrack = stream.getVideoTracks()[0];
            const sender = peerConnection?.getSenders().find(s => 
                s.track && s.track.kind === 'video'
            );
            
            if (sender) {
                sender.replaceTrack(videoTrack);
            }
            
            document.getElementById('localVideo').srcObject = stream;
            localStream = stream;
            showNotification('Screen sharing stopped', 'info');
        })
        .catch(err => {
            console.error('Error switching back to camera:', err);
        });
}

function playRingtone() {
    // Create audio context for ringtone
    try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
        
        oscillator.start();
        
        // Store for stopping later
        window.currentRingtone = { oscillator, audioContext };
        
        // Stop after 1 second and repeat
        setTimeout(() => {
            oscillator.stop();
            if (document.getElementById('incomingCallModal').classList.contains('active')) {
                setTimeout(playRingtone, 500);
            }
        }, 1000);
    } catch (err) {
        console.warn('Could not play ringtone:', err);
    }
}

function stopRingtone() {
    if (window.currentRingtone) {
        try {
            window.currentRingtone.oscillator.stop();
            window.currentRingtone.audioContext.close();
        } catch (err) {
            console.warn('Error stopping ringtone:', err);
        }
        window.currentRingtone = null;
    }
}

// Chat Functions
function contactSeller(sellerId, businessName, itemName) {
    currentChatPartner = { id: sellerId, businessName: businessName, itemName: itemName };
    
    // Show contact modal
    document.getElementById('contactSellerName').textContent = businessName;
    document.getElementById('contactSellerAvatar').textContent = businessName.charAt(0);
    document.getElementById('contactModal').classList.add('active');
}

function closeContactModal() {
    document.getElementById('contactModal').classList.remove('active');
}

function openChat() {
    closeContactModal();
    
    if (!currentChatPartner) {
        showNotification('No contact selected', 'error');
        return;
    }
    
    document.getElementById('chatPartnerName').textContent = currentChatPartner.businessName;
    document.getElementById('chatModal').classList.add('active');
    
    // Load existing chat messages
    loadChatMessages();
}

function loadChatMessages() {
    const chatMessages = document.getElementById('chatMessages');
    chatMessages.innerHTML = '';
    
    // Load messages from Firebase
    const chatRef = database.ref('chats')
        .orderByChild('timestamp')
        .limitToLast(50);
    
    chatRef.once('value', (snapshot) => {
        const messages = [];
        snapshot.forEach((childSnapshot) => {
            const message = childSnapshot.val();
            if ((message.senderId === currentUser.id && message.recipientId === currentChatPartner.id) ||
                (message.senderId === currentChatPartner.id && message.recipientId === currentUser.id)) {
                messages.push(message);
            }
        });
        
        if (messages.length === 0) {
            // Add welcome message
            const welcomeMessage = {
                senderId: currentChatPartner.id,
                senderName: currentChatPartner.businessName,
                text: `Hello! Thanks for your interest in our products. How can I help you today?`,
                timestamp: Date.now() - 60000
            };
            displayMessage(welcomeMessage);
        } else {
            messages.forEach(message => displayMessage(message));
        }
        
        // Scroll to bottom
        chatMessages.scrollTop = chatMessages.scrollHeight;
    });
}

function displayMessage(message) {
    const chatMessages = document.getElementById('chatMessages');
    const messageElement = document.createElement('div');
    messageElement.className = 'chat-message';
    
    const isOwnMessage = message.senderId === currentUser.id;
    const avatar = isOwnMessage ? 'B' : message.senderName.charAt(0);
    const name = isOwnMessage ? 'You' : message.senderName;
    
    messageElement.innerHTML = `
        <div class="chat-avatar" style="background: ${isOwnMessage ? 'var(--primary)' : 'var(--secondary)'}">${avatar}</div>
        <div class="chat-content">
            <div class="chat-name">${name}</div>
            <div class="chat-text">${message.text}</div>
            <div class="chat-time">${formatTime(message.timestamp)}</div>
        </div>
    `;
    
    chatMessages.appendChild(messageElement);
}

function displayNewMessage(message) {
    displayMessage(message);
    document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
}

function closeChatModal() {
    document.getElementById('chatModal').classList.remove('active');
    currentChatPartner = null;
}

function handleChatKeyPress(event) {
    if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        sendMessage();
    }
}

function sendMessage() {
    const input = document.getElementById('chatInput');
    const message = input.value.trim();
    
    if (!message || !currentChatPartner) return;
    
    const messageData = {
        senderId: currentUser.id,
        senderName: currentUser.name || 'Anonymous',
        recipientId: currentChatPartner.id,
        text: message,
        timestamp: Date.now()
    };
    
    // Send to Firebase
    database.ref('chats').push(messageData);
    
    // Display locally
    displayMessage(messageData);
    
    // Clear input
    input.value = '';
    updateChatCharCount();
    
    // Scroll to bottom
    const chatMessages = document.getElementById('chatMessages');
    chatMessages.scrollTop = chatMessages.scrollHeight;
    
    // Show typing indicator for response
    showTypingIndicator();
    
    // Simulate seller response
    setTimeout(() => {
        hideTypingIndicator();
        const responses = [
            "Thanks for your message! I'll get back to you shortly.",
            "Great question! Let me check on that for you.",
            "I'm available for a video call if you'd like to see the item.",
            "The item is still available. Would you like more details?",
            "I can offer a small discount for quick purchase. Interested?"
        ];
        
        const responseText = responses[Math.floor(Math.random() * responses.length)];
        const responseData = {
            senderId: currentChatPartner.id,
            senderName: currentChatPartner.businessName,
            recipientId: currentUser.id,
            text: responseText,
            timestamp: Date.now()
        };
        
        database.ref('chats').push(responseData);
        displayMessage(responseData);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }, 2000 + Math.random() * 3000);
}

function showTypingIndicator() {
    document.getElementById('typingIndicator').style.display = 'flex';
}

function hideTypingIndicator() {
    document.getElementById('typingIndicator').style.display = 'none';
}

function updateChatCharCount() {
    const input = document.getElementById('chatInput');
    const counter = document.getElementById('chatCharCount');
    const remaining = 500 - input.value.length;
    counter.textContent = `${input.value.length}/500`;
    
    if (remaining < 50) {
        counter.style.color = 'var(--danger)';
    } else if (remaining < 100) {
        counter.style.color = 'var(--warning)';
    } else {
        counter.style.color = '';
    }
}

function startVideoCallFromChat() {
    if (!currentChatPartner) {
        showNotification('No chat partner selected', 'error');
        return;
    }
    
    closeChatModal();
    initiateVideoCall();
}

function startPhoneCallFromChat() {
    if (!currentChatPartner) {
        showNotification('No chat partner selected', 'error');
        return;
    }
    
    closeChatModal();
    initiatePhoneCall();
}

// Sell Form Functions
function handleSellForm(e) {
    e.preventDefault();
    
    if (!currentUser.businessName) {
        showNotification('Please save your business name first', 'error');
        document.getElementById('businessName').focus();
        return;
    }
    
    if (!selectedSellCategory) {
        showNotification('Please select a category', 'error');
        return;
    }
    
    showLoading(true);
    
    const formData = new FormData(e.target);
    const imageFiles = formData.getAll('images');
    
    // Upload images first
    uploadImages(imageFiles).then(imageUrls => {
        const newItem = {
            name: formData.get('itemName'),
            price: parseFloat(formData.get('price')),
            currency: formData.get('currency'),
            description: formData.get('description'),
            images: imageUrls,
            image: imageUrls[0] || 'https://via.placeholder.com/500x300?text=No+Image',
            category: selectedSellCategory,
            condition: formData.get('condition'),
            quantity: parseInt(formData.get('quantity')),
            businessName: currentUser.businessName,
            sellerCountry: formData.get('sellerCountry') || currentUser.country,
            location: currentUser.location,
            phone: formData.get('contactNumber') || currentUser.phone,
            sellerId: currentUser.id,
            dateAdded: Date.now(),
            shipping: formData.get('shipping'),
            returns: formData.get('returns'),
            views: 0,
            isOnline: true
        };
        
        // Save to Firebase
        const newItemRef = database.ref('items').push();
        newItemRef.set(newItem).then(() => {
            // Add to local array
            items.push({ id: newItemRef.key, ...newItem });
            
            showLoading(false);
            showNotification('Item listed successfully!', 'success');
            
            // Reset form
            document.getElementById('sellForm').reset();
            document.getElementById('imagePreview').style.display = 'none';
            selectedSellCategory = 'Electronics';
            
            // Clear draft
            localStorage.removeItem('sellFormDraft');
            
            // Switch to manage page
            showPage('manage');
            
        }).catch(error => {
            console.error('Error saving item:', error);
            showLoading(false);
            showNotification('Error listing item. Please try again.', 'error');
        });
        
    }).catch(error => {
        console.error('Error uploading images:', error);
        showLoading(false);
        showNotification('Error uploading images. Please try again.', 'error');
    });
}

function uploadImages(imageFiles) {
    return new Promise((resolve, reject) => {
        if (!imageFiles || imageFiles.length === 0) {
            resolve([]);
            return;
        }
        
        const uploadPromises = Array.from(imageFiles).map(file => {
            return new Promise((resolveUpload, rejectUpload) => {
                // For demo purposes, create a blob URL
                const reader = new FileReader();
                reader.onload = (e) => {
                    resolveUpload(e.target.result);
                };
                reader.onerror = rejectUpload;
                reader.readAsDataURL(file);
            });
        });
        
        Promise.all(uploadPromises)
            .then(resolve)
            .catch(reject);
    });
}

function handleImageUpload(e) {
    const files = Array.from(e.target.files);
    const preview = document.getElementById('imagePreview');
    
    if (files.length === 0) {
        preview.style.display = 'none';
        return;
    }
    
    preview.innerHTML = '';
    preview.style.display = 'grid';
    
    files.forEach((file, index) => {
        if (file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = document.createElement('div');
                img.className = 'relative';
                img.innerHTML = `
                    <img src="${e.target.result}" alt="Preview ${index + 1}" class="w-full h-24 object-cover rounded-lg border border-gray-600">
                    <button type="button" class="absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs" onclick="removeImagePreview(${index})">
                        <i class="bi bi-x"></i>
                    </button>
                `;
                preview.appendChild(img);
            };
            reader.readAsDataURL(file);
        }
    });
}

function removeImagePreview(index) {
    const input = document.getElementById('imageInput');
    const dt = new DataTransfer();
    const files = Array.from(input.files);
    
    files.forEach((file, i) => {
        if (i !== index) {
            dt.items.add(file);
        }
    });
    
    input.files = dt.files;
    handleImageUpload({ target: input });
}

function saveBusinessName() {
    const businessName = document.getElementById('businessName').value.trim();
    
    if (!businessName) {
        showNotification('Please enter a business name', 'error');
        return;
    }
    
    if (businessName.length < 2) {
        showNotification('Business name must be at least 2 characters', 'error');
        return;
    }
    
    currentUser.businessName = businessName;
    localStorage.setItem('businessName', businessName);
    
    showNotification('Business name saved successfully!', 'success');
    
    // Update user in Firebase
    database.ref(`users/${currentUser.id}`).update({
        businessName: businessName
    });
}

function previewListing() {
    const formData = new FormData(document.getElementById('sellForm'));
    
    if (!formData.get('itemName') || !formData.get('price') || !formData.get('description')) {
        showNotification('Please fill in required fields first', 'error');
        return;
    }
    
    const preview = {
        name: formData.get('itemName'),
        price: parseFloat(formData.get('price')),
        currency: formData.get('currency'),
        description: formData.get('description'),
        category: selectedSellCategory,
        condition: formData.get('condition'),
        quantity: parseInt(formData.get('quantity')),
        businessName: currentUser.businessName,
        sellerCountry: formData.get('sellerCountry'),
        phone: formData.get('contactNumber'),
        shipping: formData.get('shipping'),
        returns: formData.get('returns')
    };
    
    showNotification('Preview: ' + JSON.stringify(preview, null, 2), 'info');
}

function saveDraft() {
    const formData = new FormData(document.getElementById('sellForm'));
    const draft = {};
    
    for (let [key, value] of formData.entries()) {
        draft[key] = value;
    }
    
    draft.selectedCategory = selectedSellCategory;
    localStorage.setItem('sellFormDraft', JSON.stringify(draft));
}

function loadDraft() {
    const draft = localStorage.getItem('sellFormDraft');
    if (draft) {
        const data = JSON.parse(draft);
        
        Object.keys(data).forEach(key => {
            const element = document.querySelector(`[name="${key}"]`);
            if (element) {
                element.value = data[key];
            }
        });
        
        if (data.selectedCategory) {
            selectedSellCategory = data.selectedCategory;
        }
    }
}

// Report System Functions
function reportSeller(sellerId, businessName) {
    currentReportTarget = { id: sellerId, businessName: businessName };
    document.getElementById('reportModal').classList.add('active');
}

function closeReportModal() {
    document.getElementById('reportModal').classList.remove('active');
    currentReportTarget = null;
}

function handleReportForm(e) {
    e.preventDefault();
    
    if (!currentReportTarget) {
        showNotification('No seller selected for report', 'error');
        return;
    }
    
    const formData = new FormData(e.target);
    const reportData = {
        reporterId: currentUser.id,
        reporterName: currentUser.name || 'Anonymous',
        sellerId: currentReportTarget.id,
        sellerName: currentReportTarget.businessName,
        reason: formData.get('reason'),
        details: formData.get('details'),
        severity: formData.get('severity'),
        timestamp: Date.now(),
        status: 'pending'
    };
    
    // Save report to Firebase
    database.ref('reports').push(reportData).then(() => {
        showNotification('Report submitted successfully. We will review it shortly.', 'success');
        closeReportModal();
        
        // Reset form
        document.getElementById('reportForm').reset();
        
        // Track report locally
        if (!reports[currentReportTarget.id]) {
            reports[currentReportTarget.id] = [];
        }
        reports[currentReportTarget.id].push(reportData);
        
        // Auto-ban if multiple reports (demo feature)
        if (reports[currentReportTarget.id].length >= 3) {
            banSeller(currentReportTarget.id);
        }
        
    }).catch(error => {
        console.error('Error submitting report:', error);
        showNotification('Error submitting report. Please try again.', 'error');
    });
}

function banSeller(sellerId) {
    if (!bannedSellers.includes(sellerId)) {
        bannedSellers.push(sellerId);
        
        // Remove all items from banned seller
        items = items.filter(item => item.sellerId !== sellerId);
        
        // Update Firebase
        database.ref(`users/${sellerId}`).update({
            banned: true,
            bannedAt: Date.now()
        });
        
        showNotification('Seller has been banned due to multiple reports', 'warning');
        
        // Refresh marketplace
        if (!document.getElementById('marketplacePage').classList.contains('hidden')) {
            loadMarketplaceItems();
        }
    }
}

function updateReportCharCount() {
    const textarea = document.querySelector('[name="details"]');
    const counter = document.getElementById('reportCharCount');
    const remaining = 1000 - textarea.value.length;
    counter.textContent = remaining;
    
    if (remaining < 100) {
        counter.style.color = 'var(--danger)';
    } else if (remaining < 200) {
        counter.style.color = 'var(--warning)';
    } else {
        counter.style.color = '';
    }
}

// Seller Management Functions
function loadSellerItems() {
    const sellerItems = document.getElementById('sellerItems');
    const userItems = items.filter(item => item.sellerId === currentUser.id);
    
    sellerItems.innerHTML = '';
    
    if (userItems.length === 0) {
        sellerItems.innerHTML = `
            <div class="text-center py-12">
                <i class="bi bi-box text-6xl text-gray-400 mb-4"></i>
                <h3 class="text-xl font-bold mb-2">No items listed yet</h3>
                <p class="text-gray-400">Start selling by adding your first item</p>
                <button class="btn btn-primary mt-4" onclick="showPage('sell')">
                    <i class="bi bi-plus"></i> List Your First Item
                </button>
            </div>
        `;
        return;
    }
    
    userItems.forEach(item => {
        const currencySymbol = currencySymbols[item.currency] || item.currency;
        const itemElement = document.createElement('div');
        itemElement.className = 'seller-item';
        
        itemElement.innerHTML = `
            <div class="seller-item-header">
                <div class="flex items-center gap-4">
                    <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-cover rounded-lg">
                    <div class="flex-1">
                        <h4 class="font-bold text-white">${item.name}</h4>
                        <p class="text-sm text-gray-400">${item.category} â€¢ ${item.condition}</p>
                        <p class="text-lg font-bold text-gold">${currencySymbol}${item.price.toFixed(2)}</p>
                    </div>
                </div>
                <div class="seller-item-actions">
                    <button class="btn btn-outline btn-sm" onclick="editItem('${item.id}')">
                        <i class="bi bi-pencil"></i> Edit
                    </button>
                    <button class="btn btn-secondary btn-sm" onclick="duplicateItem('${item.id}')">
                        <i class="bi bi-copy"></i> Duplicate
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="deleteItem('${item.id}')">
                        <i class="bi bi-trash"></i> Delete
                    </button>
                </div>
            </div>
            <div class="seller-stats">
                <div class="stat-item">
                    <i class="bi bi-eye"></i>
                    <span>${item.views || 0} views</span>
                </div>
                <div class="stat-item">
                    <i class="bi bi-cart"></i>
                    <span>${item.cartAdds || 0} cart adds</span>
                </div>
                <div class="stat-item">
                    <i class="bi bi-chat"></i>
                    <span>${item.messages || 0} messages</span>
                </div>
                <div class="stat-item">
                    <i class="bi bi-telephone"></i>
                    <span>${item.calls || 0} calls</span>
                </div>
                <div class="stat-item">
                    <i class="bi bi-box"></i>
                    <span>Qty: ${item.quantity}</span>
                </div>
            </div>
        `;
        
        sellerItems.appendChild(itemElement);
    });
    
    // Update stats
    updateSellerStats(userItems);
}

function updateSellerStats(userItems) {
    const totalListings = userItems.length;
    const totalViews = userItems.reduce((sum, item) => sum + (item.views || 0), 0);
    const totalCalls = userItems.reduce((sum, item) => sum + (item.calls || 0), 0);
    const totalSales = userItems.reduce((sum, item) => sum + (item.sales || 0), 0);
    
    document.getElementById('totalListings').textContent = totalListings;
    document.getElementById('totalViews').textContent = totalViews;
    document.getElementById('totalCalls').textContent = totalCalls;
    document.getElementById('totalSales').textContent = totalSales;
}

function editItem(itemId) {
    const item = items.find(i => i.id === itemId);
    if (!item) {
        showNotification('Item not found', 'error');
        return;
    }
    
    // Switch to sell page and populate form
    showPage('sell');
    
    // Populate form with item data
    setTimeout(() => {
        document.querySelector('[name="itemName"]').value = item.name;
        document.querySelector('[name="price"]').value = item.price;
        document.querySelector('[name="currency"]').value = item.currency;
        document.querySelector('[name="description"]').value = item.description;
        document.querySelector('[name="condition"]').value = item.condition;
        document.querySelector('[name="quantity"]').value = item.quantity;
        document.querySelector('[name="shipping"]').value = item.shipping;
        document.querySelector('[name="returns"]').value = item.returns;
        
        selectedSellCategory = item.category;
        
        // Update category button
        document.querySelectorAll('#sellPage .category-filter').forEach(btn => {
            btn.classList.remove('active');
            if (btn.textContent.includes(item.category)) {
                btn.classList.add('active');
            }
        });
        
        showNotification(`Editing: ${item.name}`, 'info');
    }, 100);
}

function duplicateItem(itemId) {
    const item = items.find(i => i.id === itemId);
    if (!item) {
        showNotification('Item not found', 'error');
        return;
    }
    
    // Create duplicate with modified name
    const duplicateData = {
        ...item,
        name: item.name + ' (Copy)',
        dateAdded: Date.now(),
        views: 0,
        cartAdds: 0,
        messages: 0,
        calls: 0,
        sales: 0
    };
    
    delete duplicateData.id;
    
    // Save to Firebase
    const newItemRef = database.ref('items').push();
    newItemRef.set(duplicateData).then(() => {
        items.push({ id: newItemRef.key, ...duplicateData });
        loadSellerItems();
        showNotification('Item duplicated successfully!', 'success');
    }).catch(error => {
        console.error('Error duplicating item:', error);
        showNotification('Error duplicating item', 'error');
    });
}

function deleteItem(itemId) {
    if (!confirm('Are you sure you want to delete this item? This action cannot be undone.')) {
        return;
    }
    
    // Remove from Firebase
    database.ref(`items/${itemId}`).remove().then(() => {
        // Remove from local array
        items = items.filter(item => item.id !== itemId);
        
        // Remove from cart if present
        cart = cart.filter(item => item.id !== itemId);
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartUI();
        
        loadSellerItems();
        showNotification('Item deleted successfully', 'success');
        
    }).catch(error => {
        console.error('Error deleting item:', error);
        showNotification('Error deleting item', 'error');
    });
}

function exportData() {
    const userItems = items.filter(item => item.sellerId === currentUser.id);
    const exportData = {
        user: currentUser,
        items: userItems,
        exportDate: new Date().toISOString()
    };
    
    const dataStr = JSON.stringify(exportData, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    
    const link = document.createElement('a');
    link.href = URL.createObjectURL(dataBlob);
    link.download = `x-trading-hub-export-${Date.now()}.json`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    showNotification('Data exported successfully!', 'success');
}

// Utility Functions
function formatPhoneNumber(e) {
    let value = e.target.value.replace(/\D/g, '');
    
    if (value.length >= 10) {
        value = value.replace(/(\d{3})(\d{3})(\d{4})/, '($1) $2-$3');
    } else if (value.length >= 6) {
        value = value.replace(/(\d{3})(\d{3})/, '($1) $2-');
    } else if (value.length >= 3) {
        value = value.replace(/(\d{3})/, '($1) ');
    }
    
    e.target.value = value;
    
    // Save to user data
    currentUser.phone = value;
    localStorage.setItem('userPhone', value);
}

function formatTime(timestamp) {
    const date = new Date(timestamp);
    const now = new Date();
    const diff = now - date;
    
    if (diff < 60000) { // Less than 1 minute
        return 'Just now';
    } else if (diff < 3600000) { // Less than 1 hour
        const minutes = Math.floor(diff / 60000);
        return `${minutes}m ago`;
    } else if (diff < 86400000) { // Less than 1 day
        const hours = Math.floor(diff / 3600000);
        return `${hours}h ago`;
    } else {
        return date.toLocaleDateString();
    }
}

function generateRandomPhone() {
    const areaCodes = ['555', '123', '456', '789', '321', '654', '987'];
    const areaCode = areaCodes[Math.floor(Math.random() * areaCodes.length)];
    const exchange = Math.floor(Math.random() * 900) + 100;
    const number = Math.floor(Math.random() * 9000) + 1000;
    
    return `+1 (${areaCode}) ${exchange}-${number}`;
}

function updateStats() {
    // Simulate real-time stats
    const onlineUsers = 1200 + Math.floor(Math.random() * 100);
    const totalItems = items.length;
    const activeCalls = Math.floor(Math.random() * 50) + 10;
    
    document.getElementById('onlineUsers').textContent = onlineUsers.toLocaleString();
    document.getElementById('totalItems').textContent = totalItems.toLocaleString();
    document.getElementById('activeCalls').textContent = activeCalls;
}

function updateConnectionStatus(status) {
    const indicator = document.getElementById('connectionStatusIndicator');
    const statusText = document.getElementById('connectionStatus');
    
    if (status === 'online') {
        indicator.className = 'connection-status online';
        statusText.textContent = 'Connected Live';
    } else {
        indicator.className = 'connection-status offline';
        statusText.textContent = 'Reconnecting...';
    }
}

function updateUserPresenceDisplay(userId, user) {
    // Update online status indicators for this user's items
    items.forEach(item => {
        if (item.sellerId === userId) {
            item.isOnline = user.isOnline;
        }
    });
    
    // Refresh marketplace if currently viewing
    if (!document.getElementById('marketplacePage').classList.contains('hidden')) {
        loadMarketplaceItems();
    }
}

function handleVisibilityChange() {
    if (document.hidden) {
        // Page is hidden
        currentUser.isOnline = false;
    } else {
        // Page is visible
        currentUser.isOnline = true;
        updateUserPresence();
    }
}

function handleOnlineStatus() {
    currentUser.isOnline = true;
    updateUserPresence();
    updateConnectionStatus('online');
    showNotification('Connection restored', 'success');
}

function handleOfflineStatus() {
    currentUser.isOnline = false;
    updateConnectionStatus('offline');
    showNotification('Connection lost. Working offline...', 'warning');
}

function showLoading(show) {
    const overlay = document.getElementById('loadingOverlay');
    if (show) {
        overlay.style.display = 'flex';
    } else {
        overlay.style.display = 'none';
    }
}

function showNotification(message, type = 'info') {
    const container = document.getElementById('notificationContainer');
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    
    const icons = {
        success: 'bi-check-circle',
        error: 'bi-x-circle',
        warning: 'bi-exclamation-triangle',
        info: 'bi-info-circle',
        call: 'bi-telephone'
    };
    
    notification.innerHTML = `
        <i class="bi ${icons[type] || icons.info}"></i>
        <span>${message}</span>
    `;
    
    container.appendChild(notification);
    
    // Show notification
    setTimeout(() => {
        notification.classList.add('show');
    }, 100);
    
    // Auto-hide after 5 seconds
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 300);
    }, 5000);
}

function startLiveDemo() {
    showNotification('Starting live demo...', 'info');
    
    setTimeout(() => {
        // Simulate incoming call
        const demoCall = {
            callerName: 'Demo Seller',
            callerBusiness: 'Tech Store Pro',
            type: 'video',
            status: 'incoming'
        };
        
        handleIncomingCall(demoCall, 'demo_call_' + Date.now());
    }, 2000);
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    // Load draft if available
    loadDraft();
    
    // Close dropdowns when clicking outside
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.country-selector')) {
            document.getElementById('countryDropdown').classList.remove('active');
        }
    });
    
    // Handle escape key to close modals
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            document.querySelectorAll('.modal.active').forEach(modal => {
                modal.classList.remove('active');
            });
        }
    });
});
</script>
</body>
</html>