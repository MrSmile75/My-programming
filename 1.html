        <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SmileX - Live Social Platform</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.tailwindcss.com/3.4.1"></script>

  <style>
      :root {
          --primary-color: #6a11cb;
          --secondary-color: #2575fc;
          --background-color: #f4f7f6;
          --text-color: #333;
          --accent-color: #00b4db;
      }

      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
          scrollbar-width: thick;
          scrollbar-color: auto;
      }

      body {
          font-family: 'Orbitron', sans-serif;
          background: black;
          color: white;
      }

      .chat-preloader {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: black;
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 10000;
          pointer-events: none;
          font-family: 'Orbitron', sans-serif;
      }

      .loader-container {
          background: transparent;
          pointer-events: none;
          text-align: center;
      }

      .chat-bubble-wrapper {
          position: relative;
          width: 200px;
          height: 200px;
          margin: 0 auto 20px;
      }

      .chat-bubble {
          position: absolute;
          width: 150px;
          height: 150px;
          background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
          border-radius: 50% 50% 50% 10%;
          box-shadow: 
              0 15px 30px rgba(0,0,0,0.2),
              inset 0 -5px 15px rgba(255,255,255,0.1);
          animation: 
              float 3s ease-in-out infinite,
              pulse 2s ease-in-out infinite alternate;
          transform-origin: center;
      }

      .chat-bubble::before {
          content: '';
          position: absolute;
          bottom: -30px;
          left: 50%;
          transform: translateX(-50%);
          width: 100px;
          height: 50px;
          background: rgba(255,255,255,0.2);
          border-radius: 50%;
          filter: blur(10px);
      }

      .loading-text {
          font-size: 24px;
          font-weight: 600;
          color: white;
          letter-spacing: 1px;
          text-transform: uppercase;
          background: linear-gradient(to right, var(--primary-color), var(--accent-color));
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          margin-bottom: 20px;
      }

      .progress-container {
          width: 350px;
          height: 15px;
          background: rgba(255,255,255,0.1);
          border-radius: 20px;
          overflow: hidden;
          margin: 0 auto 20px;
      }

      .progress-bar {
          width: 0;
          height: 100%;
          background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
          border-radius: 20px;
          animation: progress 2s ease-in-out infinite;
      }

      .dots {
          display: flex;
          gap: 10px;
          justify-content: center;
      }

      .dot {
          width: 15px;
          height: 15px;
          background: var(--primary-color);
          border-radius: 50%;
          animation: dot-pulse 1.5s ease-in-out infinite;
      }

      .dot:nth-child(2) { animation-delay: 0.3s; }
      .dot:nth-child(3) { animation-delay: 0.6s; }

      @keyframes float {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-20px); }
      }

      @keyframes pulse {
          0% { transform: scale(0.95); }
          100% { transform: scale(1.05); }
      }

      @keyframes progress {
          0% { width: 0; }
          50% { width: 100%; }
          100% { width: 0; }
      }

      @keyframes dot-pulse {
          0%, 100% { transform: scale(1); opacity: 0.7; }
          50% { transform: scale(1.2); opacity: 1; }
      }

      .overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.8);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 9999;
          opacity: 0;
          visibility: hidden;
          transition: opacity 0.3s ease, visibility 0.3s ease;
      }

      .onboarding-container {
          position: relative;
          max-width: 700px;
          width: 90%;
          max-height: 80vh;
          margin: 0 auto;
          background: white;
          color: black;
          border-radius: 15px;
          overflow-y: auto;
          box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
          border: 1px solid rgba(255, 255, 255, 0.2);
          padding: 40px;
          transform: scale(0.7);
          opacity: 0;
          transition: all 0.3s ease;
          font-family: 'Orbitron', sans-serif;
      }

      .overlay.active {
          opacity: 1;
          visibility: visible;
      }

      .overlay.active .onboarding-container {
          transform: scale(1);
          opacity: 1;
      }

      .onboarding-header {
          background: var(--primary-color);
          color: white;
          text-align: center;
          padding: 20px;
          margin: -40px -40px 20px -40px;
          border-radius: 15px 15px 0 0;
      }

      .form-control, .form-select {
          width: 100%;
          padding: 12px;
          border: 1px solid #ddd;
          border-radius: 8px;
          margin-bottom: 15px;
          font-family: 'Orbitron', sans-serif;
      }

      .consent-section {
          background-color: #f4f6f7;
          border-radius: 10px;
          padding: 15px;
          margin-top: 20px;
      }

      .consent-item {
          display: flex;
          align-items: center;
          margin-bottom: 10px;
      }

      .consent-item input {
          margin-right: 10px;
      }

      #submitBtn {
          background: linear-gradient(135deg, #00ff88, #00cc6a);
          border: none;
          color: white;
          padding: 12px 24px;
          border-radius: 25px;
          font-weight: bold;
          cursor: pointer;
          transition: all 0.3s ease;
          width: 100%;
      }

      #submitBtn:hover {
          transform: translateY(-2px);
          box-shadow: 0 8px 25px rgba(0, 255, 136, 0.3);
      }

      #submitBtn:disabled {
          background: #ccc;
          cursor: not-allowed;
          transform: none;
          box-shadow: none;
      }

      .post-card {
          transition: all 0.3s ease;
      }

      .post-card:hover {
          transform: translateY(-2px);
          box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      }

      .vote-button {
          transition: all 0.2s ease;
          cursor: pointer;
      }

      .vote-button:hover {
          transform: scale(1.1);
      }

      .vote-button.voted-up {
          color: #8b5cf6 !important;
      }

      .vote-button.voted-down {
          color: #3b82f6 !important;
      }

      .fade-in {
          animation: fadeIn 0.5s ease-out;
      }

      @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
      }

      .chat-container {
          position: fixed;
          bottom: 80px;
          right: 20px;
          width: 350px;
          max-height: 500px;
          background: #1a1a1a;
          border-radius: 12px;
          box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
          display: flex;
          flex-direction: column;
          z-index: 1000;
          transform: translateY(20px);
          opacity: 0;
          transition: all 0.3s ease;
          border: 1px solid #333;
      }

      .chat-container.active {
          transform: translateY(0);
          opacity: 1;
      }

      .chat-header {
          padding: 15px;
          background: linear-gradient(135deg, #6a11cb, #2575fc);
          color: white;
          border-top-left-radius: 12px;
          border-top-right-radius: 12px;
          display: flex;
          justify-content: space-between;
          align-items: center;
      }

      .chat-close {
          background: none;
          border: none;
          color: white;
          font-size: 18px;
          cursor: pointer;
      }

      .chat-messages {
          flex: 1;
          padding: 15px;
          overflow-y: auto;
          background: #1a1a1a;
          max-height: 300px;
      }

      .message {
          margin-bottom: 15px;
          display: flex;
          flex-direction: column;
      }

      .message-user {
          font-weight: 600;
          font-size: 12px;
          color: #8b5cf6;
          margin-bottom: 5px;
      }

      .message-text {
          background: #2d2d37;
          padding: 10px 15px;
          border-radius: 18px;
          font-size: 14px;
          max-width: 80%;
          word-wrap: break-word;
          color: white;
      }

      .message-time {
          font-size: 10px;
          color: #777;
          margin-top: 5px;
          align-self: flex-end;
      }

      .chat-input-container {
          padding: 15px;
          background: #22222a;
          border-bottom-left-radius: 12px;
          border-bottom-right-radius: 12px;
          display: flex;
          align-items: center;
      }

      .chat-input {
          flex: 1;
          padding: 10px 15px;
          border-radius: 20px;
          border: none;
          background: #383844;
          color: white;
          font-family: 'Orbitron', sans-serif;
          font-size: 14px;
          outline: none;
      }

      .chat-send {
          background: linear-gradient(135deg, #6a11cb, #2575fc);
          border: none;
          width: 40px;
          height: 40px;
          border-radius: 50%;
          margin-left: 10px;
          color: white;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.2s ease;
      }

      .chat-send:hover {
          transform: scale(1.05);
      }

      .chat-toggle {
          position: fixed;
          bottom: 20px;
          right: 20px;
          width: 60px;
          height: 60px;
          background: linear-gradient(135deg, #6a11cb, #2575fc);
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
          font-size: 24px;
          cursor: pointer;
          box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
          z-index: 1000;
          transition: all 0.3s ease;
          border: none;
      }

      .chat-toggle:hover {
          transform: scale(1.1);
      }

      .chat-toggle.active {
          transform: rotate(180deg);
      }

      .notification {
          position: fixed;
          top: 20px;
          right: 20px;
          background: linear-gradient(135deg, #00ff88, #00cc6a);
          color: white;
          padding: 15px 20px;
          border-radius: 8px;
          box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
          z-index: 10001;
          transform: translateX(400px);
          transition: transform 0.3s ease;
      }

      .notification.show {
          transform: translateX(0);
      }

      .gradient-text {
          background: linear-gradient(90deg, #f43f5e 0%, #8b5cf6 100%);
          -webkit-background-clip: text;
          background-clip: text;
          color: transparent;
      }

      ::-webkit-scrollbar {
          width: 8px;
          height: 8px;
      }

      ::-webkit-scrollbar-track {
          background: #1a1a1a;
      }

      ::-webkit-scrollbar-thumb {
          background: #6a11cb;
          border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb:hover {
          background: #2575fc;
      }

      .badge {
          display: inline-flex;
          align-items: center;
          padding: 0.15rem 0.5rem;
          border-radius: 9999px;
          font-size: 0.75rem;
          font-weight: 500;
      }

      .badge-private {
          background-color: #f97316;
          color: white;
      }

      .badge-public {
          background-color: #10b981;
          color: white;
      }

      .community-card {
          transition: all 0.3s ease;
      }

      .community-card:hover {
          transform: translateY(-3px);
          box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.2);
      }

      .tab-button {
          padding: 0.75rem 1rem;
          border-radius: 0.5rem;
          font-weight: 500;
          transition: all 0.2s ease;
      }

      .tab-button.active {
          background-color: #6a11cb;
          color: white;
      }

      .tab-button:not(.active):hover {
          background-color: rgba(106, 17, 203, 0.1);
      }

      @media (max-width: 640px) {
          .chat-container {
              width: 90%;
              right: 5%;
              bottom: 100px;
              max-height: 60vh;
          }
          
          .onboarding-container {
              width: 95%;
              padding: 20px;
              max-height: 90vh;
          }
      }
  </style>
</head>

<body>


  <!-- Onboarding Modal -->
  <div class="overlay" id="onboardingOverlay">
      <div class="onboarding-container">
          <div class="onboarding-header">
              <h2><i class="fas fa-user-circle"></i> Welcome to SmileX</h2>
              <p>Complete your profile to join our community</p>
          </div>

          <form id="registrationForm">
              <div>
                  <label><i class="fas fa-user"></i> Full Name</label>
                  <input type="text" class="form-control" name="fullName" placeholder="Enter your full name" required>
              </div>

              <div>
                  <label><i class="fas fa-envelope"></i> Email Address</label>
                  <input type="email" class="form-control" name="email" placeholder="your.email@example.com" required>
              </div>

              <div style="display: flex; gap: 15px;">
                  <div style="flex: 1;">
                      <label><i class="fas fa-venus-mars"></i> Gender</label>
                      <select class="form-select" name="gender" required>
                          <option value="">Select Gender</option>
                          <option value="male">Male</option>
                          <option value="female">Female</option>
                          <option value="other">Other</option>
                      </select>
                  </div>
                  <div style="flex: 1;">
                      <label><i class="fas fa-globe"></i> Country</label>
                      <select class="form-select" name="country" required>
                          <option value="">Select Country</option>
                          <option value="US">United States</option>
                          <option value="UK">United Kingdom</option>
                          <option value="CA">Canada</option>
                          <option value="AU">Australia</option>
                          <option value="DE">Germany</option>
                          <option value="FR">France</option>
                          <option value="JP">Japan</option>
                          <option value="IN">India</option>
                          <option value="BR">Brazil</option>
                          <option value="Other">Other</option>
                      </select>
                  </div>
              </div>

              <div class="consent-section">
                  <h4><i class="fas fa-shield-alt"></i> Platform Consent</h4>
                  <div class="consent-item">
                      <input type="checkbox" name="ageConsent" required>
                      <label>I am 13 years or older</label>
                  </div>
                  <div class="consent-item">
                      <input type="checkbox" name="termsConsent" required>
                      <label>I agree to the Terms of Service</label>
                  </div>
                  <div class="consent-item">
                      <input type="checkbox" name="privacyConsent" required>
                      <label>I consent to privacy policy</label>
                  </div>
              </div>

              <button type="submit" id="submitBtn" disabled>
                  <i class="fas fa-paper-plane"></i> Join SmileX
              </button>
          </form>
      </div>
  </div>

  <!-- Main Navigation -->
  <nav class="bg-black shadow-sm sticky top-0 z-50">
      <div class="container mx-auto px-4">
          <div class="flex items-center justify-between h-16">
              <div class="flex items-center space-x-8">
                  <div class="flex items-center">
                      <i class="fas fa-smile-beam text-2xl text-purple-500 mr-2"></i>
                      <span class="text-xl font-bold gradient-text">SmileX</span>
                  </div>
              </div>

              <div class="flex items-center space-x-4">
                  <div class="relative hidden md:block">
                      <input type="text" id="searchInput" placeholder="Search Communities..."
                          class="w-64 pl-10 pr-4 py-2 bg-gray-800 border border-gray-700 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                      <i class="fas fa-search absolute left-3 top-2.5 text-gray-400"></i>
                      <div id="searchResults" class="absolute left-0 right-0 mt-1 py-2 bg-gray-800 rounded-lg shadow-lg z-50 hidden"></div>
                  </div>

                  <button class="p-2 rounded-full bg-gray-800 text-gray-300 hover:bg-gray-700" id="notificationBtn">
                      <i class="fas fa-bell"></i>
                      <span class="notification-badge hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">3</span>
                  </button>

                  <div class="relative">
                      <button class="flex items-center space-x-2 focus:outline-none" id="userMenuBtn">
                          <div class="w-8 h-8 rounded-full bg-gradient-to-r from-purple-500 to-blue-500 flex items-center justify-center text-white font-bold">
                              <span id="userInitial">U</span>
                          </div>
                          <i class="fas fa-chevron-down text-xs text-gray-400"></i>
                      </button>
                  </div>
              </div>
          </div>
      </div>
  </nav>

  <!-- Main content -->
  <div class="container mx-auto px-4 py-6">
      <div class="flex flex-col lg:flex-row gap-6">
          <!-- Left sidebar -->
          <div class="lg:w-1/5 hidden lg:block">
              <div class="bg-gray-900 rounded-lg shadow-sm p-4 sticky top-24">
                  <h3 class="font-bold text-lg mb-4 flex items-center">
                      <i class="fas fa-users mr-2 text-purple-500"></i>
                      My Communities
                  </h3>
                  <ul class="space-y-2" id="communitiesList"></ul>
                  
                  <button class="w-full py-2 px-4 bg-gray-800 text-purple-400 rounded-lg font-medium hover:bg-gray-700 flex items-center justify-center mt-4" id="createCommunityBtn">
                      <i class="fas fa-plus mr-2"></i> Create Community
                  </button>

                  <div class="mt-6">
                      <h3 class="font-bold text-lg mb-4 flex items-center">
                          <i class="fas fa-compass mr-2 text-purple-500"></i>
                          Explore
                      </h3>
                      <button class="w-full py-2 px-4 bg-gray-800 text-purple-400 rounded-lg font-medium hover:bg-gray-700 flex items-center justify-center" id="browseCommunityBtn">
                          <i class="fas fa-globe mr-2"></i> Browse Communities
                      </button>
                  </div>
              </div>
          </div>

          <!-- Main feed -->
          <div class="lg:w-3/5">
              <!-- Create post card -->
              <div class="bg-gray-900 rounded-lg shadow-sm mb-6 post-card">
                  <div class="p-4">
                      <div class="flex items-center space-x-3">
                          <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-blue-500 flex items-center justify-center text-white font-bold">
                              <span id="createPostUserInitial">U</span>
                          </div>
                          <input type="text" placeholder="Create a post..." id="createPostInput"
                              class="flex-1 px-4 py-2 bg-gray-800 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent cursor-pointer">
                      </div>
                      <div class="flex justify-between mt-3">
                          <button class="flex-1 py-2 px-3 rounded-lg hover:bg-gray-800 text-gray-300 flex items-center justify-center" data-post-type="image">
                              <i class="far fa-image text-lg mr-2"></i> Image
                          </button>
                          <button class="flex-1 py-2 px-3 rounded-lg hover:bg-gray-800 text-gray-300 flex items-center justify-center" data-post-type="link">
                              <i class="fas fa-link text-lg mr-2"></i> Link
                          </button>
                          <button class="flex-1 py-2 px-3 rounded-lg hover:bg-gray-800 text-gray-300 flex items-center justify-center" data-post-type="text">
                              <i class="far fa-file-alt text-lg mr-2"></i> Text
                          </button>
                          <button class="flex-1 py-2 px-3 rounded-lg hover:bg-gray-800 text-gray-300 flex items-center justify-center" data-post-type="poll">
                              <i class="fas fa-poll text-lg mr-2"></i> Poll
                          </button>
                      </div>
                  </div>
              </div>

              <!-- Post sorting -->
              <div class="bg-gray-900 rounded-lg shadow-sm mb-6">
                  <div class="p-3 flex items-center space-x-4 overflow-x-auto">
                      <button class="px-3 py-1.5 bg-purple-600 text-white rounded-full text-sm font-medium" data-sort="hot">
                          <i class="fas fa-bolt mr-1"></i> Hot
                      </button>
                      <button class="px-3 py-1.5 bg-gray-800 text-gray-300 rounded-full text-sm font-medium hover:bg-gray-700" data-sort="new">
                          <i class="fas fa-certificate mr-1"></i> New
                      </button>
                      <button class="px-3 py-1.5 bg-gray-800 text-gray-300 rounded-full text-sm font-medium hover:bg-gray-700" data-sort="top">
                          <i class="fas fa-arrow-trend-up mr-1"></i> Top
                      </button>
                  </div>
              </div>

              <!-- Community filter toggle -->
              <div class="bg-gray-900 rounded-lg shadow-sm mb-6 p-3">
                  <div class="flex items-center justify-between">
                      <div class="flex items-center space-x-2">
                          <span class="text-sm font-medium">Viewing:</span>
                          <select id="feedFilter" class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-1 text-sm">
                              <option value="all">All Posts</option>
                              <option value="general">General Feed</option>
                              <option value="mycommunities">My Communities</option>
                          </select>
                      </div>
                      <div class="flex items-center">
                          <span class="text-xs text-gray-400">Filter by:</span>
                          <button id="communityFilterBtn" class="ml-2 text-purple-400 hover:text-purple-300 text-sm">
                              <i class="fas fa-filter mr-1"></i> Communities
                          </button>
                      </div>
                  </div>
              </div>

              <!-- Posts feed -->
              <div id="posts-feed" class="space-y-4">
                  <!-- Posts will be dynamically loaded here -->
              </div>

              <!-- Load more button -->
              <div class="mt-6 text-center">
                  <button class="px-6 py-2 bg-gray-800 text-purple-400 rounded-lg font-medium hover:bg-gray-700" id="loadMoreBtn">
                      Load more posts
                  </button>
              </div>
          </div>

          <!-- Right sidebar -->
          <div class="lg:w-1/5 hidden lg:block">
              <div class="bg-gray-900 rounded-lg shadow-sm p-4 sticky top-24">
                  <h3 class="font-bold text-lg mb-4 flex items-center">
                      <i class="fas fa-compass mr-2 text-purple-500"></i>
                      Discover
                  </h3>

                  <div class="space-y-4" id="recommendedCommunities">
                      <!-- Recommended communities will be loaded here -->
                  </div>

                  <!-- Premium ad -->
                  <div class="mt-6 bg-gradient-to-r from-purple-500 to-blue-500 rounded-lg p-4 text-white">
                      <div class="flex items-center mb-2">
                          <i class="fas fa-crown text-xl mr-2"></i>
                          <h4 class="font-bold">SmileX Premium</h4>
                      </div>
                      <p class="text-sm mb-3">Get ad-free browsing, exclusive awards, and support SmileX.</p>
                      <button class="w-full py-1.5 px-3 bg-white text-purple-600 rounded-full text-sm font-medium hover:bg-gray-100" id="premiumBtn">
                          TRY PREMIUM
                      </button>
                  </div>
              </div>
          </div>
      </div>
  </div>

  <!-- Create Post Modal -->
  <div id="create-post-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
      <div class="bg-gray-900 rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col">
          <div class="p-4 border-b border-gray-800 flex items-center justify-between">
              <h3 class="text-lg font-bold">Create a post</h3>
              <button id="closeCreatePostModal" class="text-gray-400 hover:text-gray-300">
                  <i class="fas fa-times"></i>
              </button>
          </div>

          <div class="p-4 flex-1 overflow-y-auto">
              <form id="createPostForm">
                  <div class="mb-4">
                      <label class="block text-sm font-medium text-gray-300 mb-1">Post visibility</label>
                      <select class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2" name="visibility" id="postVisibility" required>
                          <option value="general">General (visible to everyone)</option>
                          <option value="community">Community (visible to members)</option>
                      </select>
                  </div>

                  <div class="mb-4" id="postCommunityContainer" style="display: none;">
                      <label class="block text-sm font-medium text-gray-300 mb-1">Choose a community</label>
                      <select class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2" name="community" id="postCommunity">
                          <option value="">Select a community</option>
                          <!-- Community options will be loaded here -->
                      </select>
                  </div>

                  <div class="mb-4">
                      <input type="text" name="title" placeholder="Title" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2" required>
                  </div>

                  <div class="mb-4">
                      <textarea name="content" placeholder="What are your thoughts?" rows="6" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2"></textarea>
                  </div>

                  <div class="flex justify-end">
                      <button type="button" id="cancelCreatePost" class="px-4 py-2 bg-gray-800 text-gray-300 rounded-lg mr-2 hover:bg-gray-700">
                          Cancel
                      </button>
                      <button type="submit" class="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600">
                          Post
                      </button>
                  </div>
              </form>
          </div>
      </div>
  </div>

  <!-- Create Community Modal -->
  <div id="create-community-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
      <div class="bg-gray-900 rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col">
          <div class="p-4 border-b border-gray-800 flex items-center justify-between">
              <h3 class="text-lg font-bold">Create a Community</h3>
              <button id="closeCreateCommunityModal" class="text-gray-400 hover:text-gray-300">
                  <i class="fas fa-times"></i>
              </button>
          </div>

          <div class="p-4 flex-1 overflow-y-auto">
              <form id="createCommunityForm">
                  <div class="mb-4">
                      <label class="block text-sm font-medium text-gray-300 mb-1">Community Name</label>
                      <input type="text" name="name" placeholder="Enter community name" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2" required>
                      <p class="text-xs text-gray-400 mt-1">Community names can't contain spaces. Use 3-21 characters.</p>
                  </div>

                  <div class="mb-4">
                      <label class="block text-sm font-medium text-gray-300 mb-1">Display Name</label>
                      <input type="text" name="displayName" placeholder="Enter display name" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2" required>
                  </div>

                  <div class="mb-4">
                      <label class="block text-sm font-medium text-gray-300 mb-1">Description</label>
                      <textarea name="description" placeholder="What's your community about?" rows="4" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2"></textarea>
                  </div>

                  <div class="mb-4">
                      <label class="block text-sm font-medium text-gray-300 mb-1">Community Type</label>
                      <div class="flex space-x-4">
                          <div class="flex items-center">
                              <input type="radio" id="typePublic" name="type" value="public" checked class="mr-2">
                              <label for="typePublic" class="text-sm">Public</label>
                          </div>
                          <div class="flex items-center">
                              <input type="radio" id="typePrivate" name="type" value="private" class="mr-2">
                              <label for="typePrivate" class="text-sm">Private</label>
                          </div>
                      </div>
                      <p class="text-xs text-gray-400 mt-1">Private communities require members to be approved by moderators.</p>
                  </div>

                  <div class="mb-4">
                      <label class="block text-sm font-medium text-gray-300 mb-1">Community Topics (optional)</label>
                      <input type="text" name="topics" placeholder="Enter topics separated by commas" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2">
                  </div>

                  <div class="flex justify-end">
                      <button type="button" id="cancelCreateCommunity" class="px-4 py-2 bg-gray-800 text-gray-300 rounded-lg mr-2 hover:bg-gray-700">
                          Cancel
                      </button>
                      <button type="submit" class="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600">
                          Create Community
                      </button>
                  </div>
              </form>
          </div>
      </div>
  </div>

  <!-- Community Browse Modal -->
  <div id="browse-communities-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
      <div class="bg-gray-900 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col">
          <div class="p-4 border-b border-gray-800 flex items-center justify-between">
              <h3 class="text-lg font-bold">Browse Communities</h3>
              <button id="closeBrowseCommunitiesModal" class="text-gray-400 hover:text-gray-300">
                  <i class="fas fa-times"></i>
              </button>
          </div>

          <div class="p-4 border-b border-gray-800">
              <div class="flex items-center">
                  <div class="relative flex-1">
                      <input type="text" id="communitySearchInput" placeholder="Search for communities..." class="w-full pl-10 pr-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">
                      <i class="fas fa-search absolute left-3 top-2.5 text-gray-400"></i>
                  </div>
                  <div class="flex ml-4 space-x-2">
                      <button class="tab-button active" data-tab="all">All</button>
                      <button class="tab-button" data-tab="public">Public</button>
                      <button class="tab-button" data-tab="private">Private</button>
                  </div>
              </div>
          </div>

          <div class="p-4 flex-1 overflow-y-auto">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="communitiesBrowseList">
                  <!-- Communities will be loaded here -->
              </div>
              <div id="noCommunitiesMessage" class="text-center py-8 hidden">
                  <i class="fas fa-users text-4xl text-gray-500 mb-2"></i>
                  <p class="text-gray-400">No communities found</p>
              </div>
          </div>
      </div>
  </div>

  <!-- Community Detail Modal -->
  <div id="community-detail-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
      <div class="bg-gray-900 rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] flex flex-col">
          <div id="communityDetailHeader" class="p-6 border-b border-gray-800 relative">
              <!-- Community header content will be loaded here -->
          </div>

          <div class="p-4 flex-1 overflow-y-auto">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                  <div class="md:col-span-2">
                      <h3 class="text-lg font-medium mb-3">About this Community</h3>
                      <div id="communityDetailDescription" class="text-gray-300 mb-6"></div>
                      
                      <h3 class="text-lg font-medium mb-3">Recent Posts</h3>
                      <div id="communityPosts" class="space-y-4">
                          <!-- Community posts will be loaded here -->
                      </div>
                  </div>
                  <div>
                      <div class="bg-gray-800 p-4 rounded-lg mb-4">
                          <h4 class="font-medium mb-2">Community Info</h4>
                          <div class="space-y-2 text-sm">
                              <div class="flex justify-between">
                                  <span class="text-gray-400">Created</span>
                                  <span id="communityCreationDate"></span>
                              </div>
                              <div class="flex justify-between">
                                  <span class="text-gray-400">Members</span>
                                  <span id="communityMemberCount"></span>
                              </div>
                              <div class="flex justify-between">
                                  <span class="text-gray-400">Type</span>
                                  <span id="communityType"></span>
                              </div>
                          </div>
                      </div>

                      <div class="bg-gray-800 p-4 rounded-lg">
                          <h4 class="font-medium mb-2">Topics</h4>
                          <div id="communityTopics" class="flex flex-wrap gap-2">
                              <!-- Topics will be loaded here -->
                          </div>
                      </div>
                  </div>
              </div>
          </div>

          <div class="p-4 border-t border-gray-800 flex justify-between">
              <button id="closeCommunityDetailModal" class="px-4 py-2 bg-gray-800 text-gray-300 rounded-lg hover:bg-gray-700">
                  Close
              </button>
              <div>
                  <button id="joinLeaveButton" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                      Join
                  </button>
              </div>
          </div>
      </div>
  </div>

  <!-- Live Chat Toggle Button -->
  <button id="chat-toggle-btn" class="chat-toggle">
      <i class="fas fa-comment-dots"></i>
  </button>

  <!-- Live Chat Container -->
  <div id="chat-container" class="chat-container">
      <div class="chat-header">
          <h3>Live Chat Support</h3>
          <button id="chat-close-btn" class="chat-close">
              <i class="fas fa-times"></i>
          </button>
      </div>
      <div class="chat-messages" id="chat-messages">
          <div class="message">
              <div class="message-user">Support Agent</div>
              <div class="message-text">Hello! How can we help you today?</div>
              <div class="message-time">Just now</div>
          </div>
      </div>
      <div class="chat-input-container">
          <input type="text" id="chat-input" class="chat-input" placeholder="Type your message...">
          <button id="chat-send-btn" class="chat-send">
              <i class="fas fa-paper-plane"></i>
          </button>
      </div>
  </div>

  <!-- Mobile bottom navigation -->
  <div class="lg:hidden fixed bottom-0 left-0 right-0 bg-gray-900 shadow-lg border-t border-gray-800 z-50">
      <div class="flex justify-around items-center h-16">
          <a href="#" class="flex flex-col items-center justify-center text-purple-400">
              <i class="fas fa-home text-xl"></i>
              <span class="text-xs mt-1">Home</span>
          </a>
          <a href="#" class="flex flex-col items-center justify-center text-gray-400" id="mobileBrowseBtn">
              <i class="fas fa-compass text-xl"></i>
              <span class="text-xs mt-1">Explore</span>
          </a>
          <a href="#" class="flex flex-col items-center justify-center text-gray-400" id="mobileCreatePost">
              <i class="fas fa-plus-circle text-xl"></i>
              <span class="text-xs mt-1">Create</span>
          </a>
          <a href="#" class="flex flex-col items-center justify-center text-gray-400">
              <i class="fas fa-bell text-xl"></i>
              <span class="text-xs mt-1">Notifications</span>
          </a>
          <a href="#" class="flex flex-col items-center justify-center text-gray-400" id="mobileCreateCommunity">
              <i class="fas fa-users text-xl"></i>
              <span class="text-xs mt-1">Community</span>
          </a>
      </div>
  </div>

  <script>
      // Global variables
      let currentUser = null;
      let posts = [];
      let communities = [];
      let currentSort = 'hot';
      let currentFeedFilter = 'all';
      let currentCommunityTab = 'all';
      let currentCommunity = null;
      let userMemberships = [];

      // Initialize the application
      document.addEventListener('DOMContentLoaded', function() {
          initializeApp();
      });

      function initializeApp() {
          // Check if user is already registered
          const userData = localStorage.getItem('userData');
          const isRegistered = localStorage.getItem('userRegistered');

          if (userData && isRegistered === 'true') {
              currentUser = JSON.parse(userData);
              hideOnboarding();
              loadUserInterface();
          } else {
              showOnboarding();
          }

          // Initialize event listeners
          initializeEventListeners();
          
          // Load initial data
          loadInitialPosts();
          loadInitialCommunities();
          loadUserMemberships();
          updateCommunityLists();
          
          // Start preloader
          startPreloader();
      }

      function startPreloader() {
          setTimeout(() => {
              const preloader = document.getElementById('preloader');
              preloader.style.transition = 'all 0.8s ease';
              preloader.style.opacity = '0';
              preloader.style.transform = 'scale(0.8)';
              
              setTimeout(() => {
                  preloader.style.display = 'none';
                  
                  // Show onboarding if user not registered
                  if (!currentUser) {
                      showOnboarding();
                  }
              }, 800);
          }, 3000);
      }

      function showOnboarding() {
          document.getElementById('onboardingOverlay').classList.add('active');
      }

      function hideOnboarding() {
          document.getElementById('onboardingOverlay').classList.remove('active');
      }

      function loadUserInterface() {
          if (currentUser) {
              const initial = currentUser.fullName.charAt(0).toUpperCase();
              document.getElementById('userInitial').textContent = initial;
              document.getElementById('createPostUserInitial').textContent = initial;
          }
      }

      function initializeEventListeners() {
          // Registration form
          const registrationForm = document.getElementById('registrationForm');
          const submitBtn = document.getElementById('submitBtn');
          const inputs = registrationForm.querySelectorAll('input, select');
          const checkboxes = registrationForm.querySelectorAll('input[type="checkbox"]');

          // Form validation
          function validateForm() {
              const allInputsFilled = Array.from(inputs).filter(input => input.type !== 'checkbox').every(input => input.value.trim() !== '');
              const allCheckboxesChecked = Array.from(checkboxes).every(checkbox => checkbox.checked);
              submitBtn.disabled = !(allInputsFilled && allCheckboxesChecked);
          }

          inputs.forEach(input => {
              input.addEventListener('input', validateForm);
              input.addEventListener('change', validateForm);
          });

          checkboxes.forEach(checkbox => {
              checkbox.addEventListener('change', validateForm);
          });

          // Form submission
          registrationForm.addEventListener('submit', function(e) {
              e.preventDefault();
              const formData = new FormData(this);
              const userData = Object.fromEntries(formData.entries());
              
              // Remove consent checkboxes from stored data
              delete userData.ageConsent;
              delete userData.termsConsent;
              delete userData.privacyConsent;

              currentUser = userData;
              localStorage.setItem('userData', JSON.stringify(userData));
              localStorage.setItem('userRegistered', 'true');

              hideOnboarding();
              loadUserInterface();
              showNotification('Welcome to SmileX! Your profile is now complete.');
          });

          // Create post functionality
          document.getElementById('createPostInput').addEventListener('click', () => {
              openCreatePostModal();
          });

          document.getElementById('mobileCreatePost').addEventListener('click', (e) => {
              e.preventDefault();
              openCreatePostModal();
          });

          document.getElementById('closeCreatePostModal').addEventListener('click', () => {
              document.getElementById('create-post-modal').classList.add('hidden');
          });

          document.getElementById('cancelCreatePost').addEventListener('click', () => {
              document.getElementById('create-post-modal').classList.add('hidden');
          });

          // Post visibility change
          document.getElementById('postVisibility').addEventListener('change', function() {
              const communityContainer = document.getElementById('postCommunityContainer');
              if (this.value === 'community') {
                  communityContainer.style.display = 'block';
                  populateUserCommunities('postCommunity');
              } else {
                  communityContainer.style.display = 'none';
              }
          });

          // Create post form submission
          document.getElementById('createPostForm').addEventListener('submit', function(e) {
              e.preventDefault();
              const formData = new FormData(this);
              const postData = Object.fromEntries(formData.entries());
              
              createNewPost(postData);
              this.reset();
              document.getElementById('create-post-modal').classList.add('hidden');
              showNotification('Post created successfully!');
          });

          // Post type buttons
          document.querySelectorAll('[data-post-type]').forEach(btn => {
              btn.addEventListener('click', () => {
                  openCreatePostModal();
              });
          });

          // Sort buttons
          document.querySelectorAll('[data-sort]').forEach(btn => {
              btn.addEventListener('click', function() {
                  // Update active state
                  document.querySelectorAll('[data-sort]').forEach(b => {
                      b.className = 'px-3 py-1.5 bg-gray-800 text-gray-300 rounded-full text-sm font-medium hover:bg-gray-700';
                  });
                  this.className = 'px-3 py-1.5 bg-purple-600 text-white rounded-full text-sm font-medium';
                  
                  currentSort = this.dataset.sort;
                  sortAndDisplayPosts();
              });
          });

          // Feed filter change
          document.getElementById('feedFilter').addEventListener('change', function() {
              currentFeedFilter = this.value;
              filterAndDisplayPosts();
          });

          // Load more posts
          document.getElementById('loadMoreBtn').addEventListener('click', loadMorePosts);

          // Create community
          document.getElementById('createCommunityBtn').addEventListener('click', () => {
              document.getElementById('create-community-modal').classList.remove('hidden');
          });

          document.getElementById('mobileCreateCommunity').addEventListener('click', (e) => {
              e.preventDefault();
              document.getElementById('create-community-modal').classList.remove('hidden');
          });

          document.getElementById('closeCreateCommunityModal').addEventListener('click', () => {
              document.getElementById('create-community-modal').classList.add('hidden');
          });

          document.getElementById('cancelCreateCommunity').addEventListener('click', () => {
              document.getElementById('create-community-modal').classList.add('hidden');
          });

          // Create community form submission
          document.getElementById('createCommunityForm').addEventListener('submit', function(e) {
              e.preventDefault();
              const formData = new FormData(this);
              const communityData = Object.fromEntries(formData.entries());
              
              createNewCommunity(communityData);
              this.reset();
              document.getElementById('create-community-modal').classList.add('hidden');
          });

          // Browse communities
          document.getElementById('browseCommunityBtn').addEventListener('click', () => {
              openBrowseCommunitiesModal();
          });

          document.getElementById('mobileBrowseBtn').addEventListener('click', (e) => {
              e.preventDefault();
              openBrowseCommunitiesModal();
          });

          document.getElementById('closeBrowseCommunitiesModal').addEventListener('click', () => {
              document.getElementById('browse-communities-modal').classList.add('hidden');
          });

          // Browse communities tabs
          document.querySelectorAll('.tab-button').forEach(btn => {
              btn.addEventListener('click', function() {
                  document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                  this.classList.add('active');
                  currentCommunityTab = this.dataset.tab;
                  filterBrowseCommunities();
              });
          });

          // Community search
          document.getElementById('communitySearchInput').addEventListener('input', function() {
              filterBrowseCommunities();
          });

          // Close community detail modal
          document.getElementById('closeCommunityDetailModal').addEventListener('click', () => {
              document.getElementById('community-detail-modal').classList.add('hidden');
          });

          // Join/Leave community button
          document.getElementById('joinLeaveButton').addEventListener('click', function() {
              if (!currentCommunity) return;
              
              const isMember = userMemberships.includes(currentCommunity.id);
              if (isMember) {
                  leaveCommunity(currentCommunity.id);
              } else {
                  joinCommunity(currentCommunity.id);
              }
              
              updateJoinLeaveButton();
              updateCommunityLists();
          });

          // Chat functionality
          const chatToggleBtn = document.getElementById('chat-toggle-btn');
          const chatCloseBtn = document.getElementById('chat-close-btn');
          const chatContainer = document.getElementById('chat-container');
          const chatInput = document.getElementById('chat-input');
          const chatSendBtn = document.getElementById('chat-send-btn');

          chatToggleBtn.addEventListener('click', () => {
              chatContainer.classList.toggle('active');
              chatToggleBtn.classList.toggle('active');
          });

          chatCloseBtn.addEventListener('click', () => {
              chatContainer.classList.remove('active');
              chatToggleBtn.classList.remove('active');
          });

          chatSendBtn.addEventListener('click', sendChatMessage);
          chatInput.addEventListener('keypress', (e) => {
              if (e.key === 'Enter') {
                  sendChatMessage();
              }
          });

          // Search functionality
          const searchInput = document.getElementById('searchInput');
          const searchResults = document.getElementById('searchResults');
          
          searchInput.addEventListener('input', function(e) {
              const query = e.target.value.toLowerCase();
              if (query.length > 1) {
                  const results = communities.filter(c => 
                      c.name.toLowerCase().includes(query) || 
                      c.displayName.toLowerCase().includes(query) ||
                      (c.description && c.description.toLowerCase().includes(query))
                  );
                  
                  if (results.length > 0) {
                      searchResults.innerHTML = results.map(community => `
                          <div class="px-3 py-2 hover:bg-gray-700 cursor-pointer" onclick="viewCommunityDetails('${community.id}')">
                              <div class="flex items-center">
                                  <span class="w-6 h-6 rounded-full ${getCommunityColor(community.name)} flex items-center justify-center text-white text-xs mr-2">
                                      ${community.name.charAt(0)}
                                  </span>
                                  <span>${community.displayName}</span>
                                  <span class="ml-2 badge ${community.type === 'private' ? 'badge-private' : 'badge-public'}">
                                      ${community.type}
                                  </span>
                              </div>
                          </div>
                      `).join('');
                      searchResults.classList.remove('hidden');
                  } else {
                      searchResults.innerHTML = `<div class="px-3 py-2 text-gray-400">No communities found</div>`;
                      searchResults.classList.remove('hidden');
                  }
              } else {
                  searchResults.classList.add('hidden');
              }
          });
          
          // Hide search results when clicking outside
          document.addEventListener('click', function(e) {
              if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                  searchResults.classList.add('hidden');
              }
          });

          // Premium button
          document.getElementById('premiumBtn').addEventListener('click', () => {
              showNotification('Premium features coming soon!');
          });

          // Notification button
          document.getElementById('notificationBtn').addEventListener('click', () => {
              showNotification('No new notifications');
          });
      }

      // Initialize community-related data
      function loadInitialCommunities() {
          // Check if communities exist in localStorage
          const storedCommunities = localStorage.getItem('communities');
          if (storedCommunities) {
              communities = JSON.parse(storedCommunities);
          } else {
              // Create default communities
              communities = [
                  {
                      id: 'c1',
                      name: 'SmileX',
                      displayName: 'SmileX Official',
                      description: 'The official community for SmileX platform updates and announcements.',
                      type: 'public',
                      createdBy: 'system',
                      createdAt: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                      memberCount: 15420,
                      topics: ['news', 'updates', 'announcements']
                  },
                  {
                      id: 'c2',
                      name: 'Gaming',
                      displayName: 'Gaming Zone',
                      description: 'A community for all gamers to share their experiences, tips, and discuss the latest releases.',
                      type: 'public',
                      createdBy: 'system',
                      createdAt: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                      memberCount: 8763,
                      topics: ['games', 'esports', 'console', 'pc']
                  },
                  {
                      id: 'c3',
                      name: 'TechTalks',
                      displayName: 'Tech Talks',
                      description: 'Discuss the latest in technology, programming, and AI developments.',
                      type: 'public',
                      createdBy: 'system',
                      createdAt: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                      memberCount: 6214,
                      topics: ['technology', 'programming', 'ai', 'gadgets']
                  },
                  {
                      id: 'c4',
                      name: 'ArtistsLounge',
                      displayName: 'Artists Lounge',
                      description: 'A private community for artists to share their work and get feedback.',
                      type: 'private',
                      createdBy: 'system',
                      createdAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                      memberCount: 842,
                      topics: ['art', 'drawing', 'design', 'critiques']
                  }
              ];
              
              // Save to localStorage
              localStorage.setItem('communities', JSON.stringify(communities));
          }

          displayRecommendedCommunities();
      }

      function loadUserMemberships() {
          // Check if user memberships exist in localStorage
          const memberships = localStorage.getItem('userMemberships');
          if (memberships) {
              userMemberships = JSON.parse(memberships);
          } else
        {
              // Default memberships for new users
              userMemberships = ['c1']; // Auto-join SmileX official community
              localStorage.setItem('userMemberships', JSON.stringify(userMemberships));
          }
      }

      function loadInitialPosts() {
          posts = [
              {
                  id: 1,
                  title: "WELCOME EVERYONE",
                  content: "Welcome, everyone and those viewing this message to explore and have fun on this page, but remember the rules and regulations",
                  author: "SmileX",
                  community: "SmileX",
                  communityId: "c1",
                  visibility: "general",
                  votes: 5400,
                  comments: 1400,
                  timestamp: new Date(Date.now() - 3600000),
                  type: "text"
              },
              {
                  id: 2,
                  title: "New Gaming Setup Showcase",
                  content: "Check out my latest gaming setup! What do you think?",
                  author: "GamerPro",
                  community: "Gaming",
                  communityId: "c2",
                  visibility: "community",
                  votes: 2700,
                  comments: 423,
                  timestamp: new Date(Date.now() - 7200000),
                  type: "image",
                  imageUrl: "https://source.unsplash.com/800x600/?gaming,setup"
              },
              {
                  id: 3,
                  title: "What programming language should I learn next?",
                  content: "",
                  author: "CodeNewbie",
                  community: "TechTalks",
                  communityId: "c3",
                  visibility: "community",
                  votes: 1850,
                  comments: 234,
                  timestamp: new Date(Date.now() - 10800000),
                  type: "poll",
                  pollOptions: [
                      { text: "Python", votes: 450, percentage: 35 },
                      { text: "JavaScript", votes: 380, percentage: 30 },
                      { text: "Rust", votes: 260, percentage: 20 },
                      { text: "Go", votes: 190, percentage: 15 }
                  ]
              },
              {
                  id: 4,
                  title: "Beautiful sunset photography tips",
                  content: "Here are some tips for capturing amazing sunset photos that I've learned over the years...",
                  author: "PhotoMaster",
                  community: "General",
                  communityId: null,
                  visibility: "general",
                  votes: 1240,
                  comments: 89,
                  timestamp: new Date(Date.now() - 14400000),
                  type: "text"
              }
          ];
          filterAndDisplayPosts();
      }

      function openCreatePostModal() {
          document.getElementById('create-post-modal').classList.remove('hidden');
          populateUserCommunities('postCommunity');
      }

      function populateUserCommunities(selectId) {
          const select = document.getElementById(selectId);
          const userCommunities = communities.filter(c => userMemberships.includes(c.id));
          
          select.innerHTML = '<option value="">Select a community</option>';
          userCommunities.forEach(community => {
              const option = document.createElement('option');
              option.value = community.id;
              option.textContent = community.displayName;
              select.appendChild(option);
          });
      }

      function createNewPost(postData) {
          const newPost = {
              id: posts.length + 1,
              title: postData.title,
              content: postData.content,
              author: currentUser ? currentUser.fullName : "Anonymous",
              visibility: postData.visibility,
              votes: 0,
              comments: 0,
              timestamp: new Date(),
              type: "text"
          };

          if (postData.visibility === 'community' && postData.community) {
              const community = communities.find(c => c.id === postData.community);
              if (community) {
                  newPost.community = community.displayName;
                  newPost.communityId = community.id;
              }
          } else {
              newPost.community = "General";
              newPost.communityId = null;
          }
          
          posts.unshift(newPost);
          filterAndDisplayPosts();
      }

      function createNewCommunity(communityData) {
          const newCommunity = {
              id: 'c' + (communities.length + 1),
              name: communityData.name.replace(/\s+/g, ''),
              displayName: communityData.displayName,
              description: communityData.description,
              type: communityData.type,
              createdBy: currentUser ? currentUser.fullName : "Anonymous",
              createdAt: new Date().toISOString(),
              memberCount: 1,
              topics: communityData.topics ? communityData.topics.split(',').map(t => t.trim()) : []
          };

          communities.push(newCommunity);
          
          // Auto-join the creator to the community
          if (!userMemberships.includes(newCommunity.id)) {
              userMemberships.push(newCommunity.id);
              localStorage.setItem('userMemberships', JSON.stringify(userMemberships));
          }

          // Save communities to localStorage
          localStorage.setItem('communities', JSON.stringify(communities));

          updateCommunityLists();
          showNotification(`Community "${communityData.displayName}" created successfully!`);
      }

      function updateCommunityLists() {
          // Update left sidebar communities list
          const communitiesList = document.getElementById('communitiesList');
          const userCommunities = communities.filter(c => userMemberships.includes(c.id));
          
          communitiesList.innerHTML = userCommunities.map(community => `
              <li>
                  <a href="#" class="flex items-center p-2 rounded-lg hover:bg-gray-800" onclick="viewCommunityDetails('${community.id}')">
                      <span class="w-6 h-6 rounded-full ${getCommunityColor(community.name)} flex items-center justify-center text-white text-xs mr-2">
                          ${community.name.charAt(0)}
                      </span>
                      <span class="flex-1">${community.displayName}</span>
                      ${community.type === 'private' ? '<i class="fas fa-lock text-xs text-gray-400"></i>' : ''}
                  </a>
              </li>
          `).join('');

          // Update recommended communities
          displayRecommendedCommunities();
      }

      function displayRecommendedCommunities() {
          const container = document.getElementById('recommendedCommunities');
          const nonMemberCommunities = communities.filter(c => !userMemberships.includes(c.id) && c.type === 'public').slice(0, 3);
          
          container.innerHTML = nonMemberCommunities.map(community => `
              <div class="bg-gray-800 rounded-lg p-3 community-card cursor-pointer" onclick="viewCommunityDetails('${community.id}')">
                  <div class="flex items-center mb-2">
                      <span class="w-8 h-8 rounded-full ${getCommunityColor(community.name)} flex items-center justify-center text-white text-xs mr-2">
                          ${community.name.charAt(0)}
                      </span>
                      <div class="flex-1">
                          <h4 class="font-medium">${community.displayName}</h4>
                          <p class="text-xs text-gray-400">${formatNumber(community.memberCount)} members</p>
                      </div>
                      <span class="badge ${community.type === 'private' ? 'badge-private' : 'badge-public'}">
                          ${community.type}
                      </span>
                  </div>
                  <p class="text-sm text-gray-300 line-clamp-2">${community.description}</p>
              </div>
          `).join('');
      }

      function openBrowseCommunitiesModal() {
          document.getElementById('browse-communities-modal').classList.remove('hidden');
          filterBrowseCommunities();
      }

      function filterBrowseCommunities() {
          const searchQuery = document.getElementById('communitySearchInput').value.toLowerCase();
          let filteredCommunities = communities;

          // Filter by tab
          if (currentCommunityTab !== 'all') {
              filteredCommunities = filteredCommunities.filter(c => c.type === currentCommunityTab);
          }

          // Filter by search query
          if (searchQuery) {
              filteredCommunities = filteredCommunities.filter(c => 
                  c.name.toLowerCase().includes(searchQuery) ||
                  c.displayName.toLowerCase().includes(searchQuery) ||
                  (c.description && c.description.toLowerCase().includes(searchQuery)) ||
                  (c.topics && c.topics.some(topic => topic.toLowerCase().includes(searchQuery)))
              );
          }

          displayBrowseCommunities(filteredCommunities);
      }

      function displayBrowseCommunities(communitiesToShow) {
          const container = document.getElementById('communitiesBrowseList');
          const noCommunitiesMessage = document.getElementById('noCommunitiesMessage');

          if (communitiesToShow.length === 0) {
              container.innerHTML = '';
              noCommunitiesMessage.classList.remove('hidden');
              return;
          }

          noCommunitiesMessage.classList.add('hidden');
          container.innerHTML = communitiesToShow.map(community => {
              const isMember = userMemberships.includes(community.id);
              return `
                  <div class="bg-gray-800 rounded-lg p-4 community-card">
                      <div class="flex items-start justify-between mb-3">
                          <div class="flex items-center">
                              <span class="w-10 h-10 rounded-full ${getCommunityColor(community.name)} flex items-center justify-center text-white text-sm mr-3">
                                  ${community.name.charAt(0)}
                              </span>
                              <div>
                                  <h3 class="font-medium">${community.displayName}</h3>
                                  <p class="text-sm text-gray-400">${formatNumber(community.memberCount)} members</p>
                              </div>
                          </div>
                          <span class="badge ${community.type === 'private' ? 'badge-private' : 'badge-public'}">
                              ${community.type}
                          </span>
                      </div>
                      
                      <p class="text-sm text-gray-300 mb-3 line-clamp-2">${community.description}</p>
                      
                      ${community.topics && community.topics.length > 0 ? `
                          <div class="flex flex-wrap gap-1 mb-3">
                              ${community.topics.slice(0, 3).map(topic => `
                                  <span class="px-2 py-1 bg-gray-700 rounded-full text-xs">${topic}</span>
                              `).join('')}
                              ${community.topics.length > 3 ? `<span class="text-xs text-gray-400">+${community.topics.length - 3} more</span>` : ''}
                          </div>
                      ` : ''}
                      
                      <div class="flex justify-between items-center">
                          <button onclick="viewCommunityDetails('${community.id}')" class="text-purple-400 hover:text-purple-300 text-sm">
                              View Details
                          </button>
                          <button onclick="${isMember ? `leaveCommunity('${community.id}')` : `joinCommunity('${community.id}')`}" 
                                  class="px-3 py-1 ${isMember ? 'bg-gray-600 hover:bg-gray-700' : 'bg-purple-600 hover:bg-purple-700'} text-white rounded text-sm">
                              ${isMember ? 'Leave' : 'Join'}
                          </button>
                      </div>
                  </div>
              `;
          }).join('');
      }

      function viewCommunityDetails(communityId) {
          const community = communities.find(c => c.id === communityId);
          if (!community) return;

          currentCommunity = community;
          const isMember = userMemberships.includes(communityId);

          // Update community detail modal
          document.getElementById('communityDetailHeader').innerHTML = `
              <button onclick="document.getElementById('community-detail-modal').classList.add('hidden')" 
                      class="absolute top-4 right-4 text-gray-400 hover:text-gray-300">
                  <i class="fas fa-times"></i>
              </button>
              <div class="flex items-center">
                  <span class="w-16 h-16 rounded-full ${getCommunityColor(community.name)} flex items-center justify-center text-white text-2xl mr-4">
                      ${community.name.charAt(0)}
                  </span>
                  <div>
                      <h2 class="text-2xl font-bold">${community.displayName}</h2>
                      <p class="text-gray-400">c/${community.name}</p>
                      <div class="flex items-center mt-2">
                          <span class="badge ${community.type === 'private' ? 'badge-private' : 'badge-public'} mr-2">
                              ${community.type}
                          </span>
                          <span class="text-sm text-gray-400">${formatNumber(community.memberCount)} members</span>
                      </div>
                  </div>
              </div>
          `;

          document.getElementById('communityDetailDescription').textContent = community.description || 'No description available.';
          document.getElementById('communityCreationDate').textContent = new Date(community.createdAt).toLocaleDateString();
          document.getElementById('communityMemberCount').textContent = formatNumber(community.memberCount);
          document.getElementById('communityType').innerHTML = `
              <span class="badge ${community.type === 'private' ? 'badge-private' : 'badge-public'}">
                  ${community.type}
              </span>
          `;

          // Display topics
          const topicsContainer = document.getElementById('communityTopics');
          if (community.topics && community.topics.length > 0) {
              topicsContainer.innerHTML = community.topics.map(topic => `
                  <span class="px-2 py-1 bg-gray-700 rounded-full text-xs">${topic}</span>
              `).join('');
          } else {
              topicsContainer.innerHTML = '<span class="text-gray-400 text-sm">No topics specified</span>';
          }

          // Display community posts
          const communityPosts = posts.filter(p => p.communityId === communityId).slice(0, 3);
          const postsContainer = document.getElementById('communityPosts');
          
          if (communityPosts.length > 0) {
              postsContainer.innerHTML = communityPosts.map(post => `
                  <div class="bg-gray-800 rounded-lg p-3">
                      <h4 class="font-medium mb-1">${post.title}</h4>
                      <p class="text-sm text-gray-400">by ${post.author}  ${getTimeAgo(post.timestamp)}</p>
                      <div class="flex items-center mt-2 text-xs text-gray-400">
                          <span>${formatNumber(post.votes)} votes</span>
                          <span class="mx-2"></span>
                          <span>${formatNumber(post.comments)} comments</span>
                      </div>
                  </div>
              `).join('');
          } else {
              postsContainer.innerHTML = '<p class="text-gray-400">No posts yet in this community.</p>';
          }

          updateJoinLeaveButton();
          document.getElementById('community-detail-modal').classList.remove('hidden');
      }

      function updateJoinLeaveButton() {
          if (!currentCommunity) return;
          
          const button = document.getElementById('joinLeaveButton');
          const isMember = userMemberships.includes(currentCommunity.id);
          
          if (isMember) {
              button.textContent = 'Leave';
              button.className = 'px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700';
          } else {
              button.textContent = 'Join';
              button.className = 'px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700';
          }
      }

      function joinCommunity(communityId) {
          if (!userMemberships.includes(communityId)) {
              userMemberships.push(communityId);
              localStorage.setItem('userMemberships', JSON.stringify(userMemberships));
              
              // Update member count
              const community = communities.find(c => c.id === communityId);
              if (community) {
                  community.memberCount++;
                  localStorage.setItem('communities', JSON.stringify(communities));
              }
              
              updateCommunityLists();
              filterBrowseCommunities();
              showNotification(`Joined ${community ? community.displayName : 'community'} successfully!`);
          }
      }

      function leaveCommunity(communityId) {
          const index = userMemberships.indexOf(communityId);
          if (index > -1) {
              userMemberships.splice(index, 1);
              localStorage.setItem('userMemberships', JSON.stringify(userMemberships));
              
              // Update member count
              const community = communities.find(c => c.id === communityId);
              if (community && community.memberCount > 0) {
                  community.memberCount--;
                  localStorage.setItem('communities', JSON.stringify(communities));
              }
              
              updateCommunityLists();
              filterBrowseCommunities();
              showNotification(`Left ${community ? community.displayName : 'community'}`);
          }
      }

      function filterAndDisplayPosts() {
          let filteredPosts = [...posts];

          // Filter by feed type
          switch (currentFeedFilter) {
              case 'general':
                  filteredPosts = filteredPosts.filter(p => p.visibility === 'general');
                  break;
              case 'mycommunities':
                  filteredPosts = filteredPosts.filter(p => 
                      p.visibility === 'community' && 
                      p.communityId && 
                      userMemberships.includes(p.communityId)
                  );
                  break;
              case 'all':
              default:
                  // Show general posts and community posts from joined communities
                  filteredPosts = filteredPosts.filter(p => 
                      p.visibility === 'general' || 
                      (p.visibility === 'community' && p.communityId && userMemberships.includes(p.communityId))
                  );
                  break;
          }

          displayPosts(filteredPosts);
      }

      function displayPosts(postsToDisplay) {
          const container = document.getElementById('posts-feed');
          container.innerHTML = postsToDisplay.map(post => createPostHTML(post)).join('');
          
          // Attach event listeners to vote buttons
          attachVoteListeners();
      }

      function createPostHTML(post) {
          const timeAgo = getTimeAgo(post.timestamp);
          const communityInitial = post.community ? post.community.charAt(0) : 'G';
          const communityColor = getCommunityColor(post.community || 'General');
          
          let contentHTML = '';
          
          if (post.type === 'image' && post.imageUrl) {
              contentHTML = `
                  <div class="mb-4">
                      <img src="${post.imageUrl}" alt="${post.title}" class="w-full h-auto rounded-lg object-cover max-h-96">
                  </div>
              `;
          } else if (post.type === 'poll' && post.pollOptions) {
              contentHTML = `
                  <div class="mb-4">
                      <div class="space-y-2">
                          ${post.pollOptions.map(option => `
                              <div class="flex items-center justify-between p-3 bg-gray-800 rounded-lg cursor-pointer hover:bg-gray-700" onclick="voteInPoll(${post.id}, '${option.text}')">
                                  <span>${option.text}</span>
                                  <span class="text-sm text-gray-400">${option.percentage}% (${formatNumber(option.votes)} votes)</span>
                              </div>
                          `).join('')}
                      </div>
                      <div class="mt-2 text-xs text-gray-400">
                          ${formatNumber(post.pollOptions.reduce((sum, option) => sum + option.votes, 0))} votes  Vote ended
                      </div>
                  </div>
              `;
          } else if (post.content) {
              contentHTML = `
                  <div class="prose dark:prose-invert max-w-none mb-4">
                      <p>${post.content}</p>
                  </div>
              `;
          }

          return `
              <div class="bg-gray-900 rounded-lg shadow-sm post-card fade-in">
                  <div class="p-4">
                      <div class="flex items-start">
                          <div class="flex flex-col items-center mr-4">
                              <button class="vote-button text-gray-400 hover:text-purple-500" data-post-id="${post.id}" data-vote="up">
                                  <i class="fas fa-arrow-up text-xl"></i>
                              </button>
                              <span class="my-1 font-medium text-gray-300 vote-count">${formatNumber(post.votes)}</span>
                              <button class="vote-button text-gray-400 hover:text-blue-500" data-post-id="${post.id}" data-vote="down">
                                  <i class="fas fa-arrow-down text-xl"></i>
                              </button>
                          </div>

                          <div class="flex-1">
                              <div class="flex items-center text-xs text-gray-400 mb-2">
                                  <span class="w-6 h-6 rounded-full ${communityColor} flex items-center justify-center text-white text-xs mr-2">${communityInitial}</span>
                                  <span class="font-medium cursor-pointer hover:text-purple-400" onclick="${post.communityId ? `viewCommunityDetails('${post.communityId}')` : ''}">${post.community || 'General'}</span>
                                  ${post.visibility === 'community' ? '<i class="fas fa-users text-xs ml-1" title="Community post"></i>' : '<i class="fas fa-globe text-xs ml-1" title="Public post"></i>'}
                                  <span class="mx-1"></span>
                                  <span>Posted by ${post.author}</span>
                                  <span class="mx-1"></span>
                                  <span>${timeAgo}</span>
                              </div>

                              <h3 class="text-xl font-medium mb-2">${post.title}</h3>

                              ${contentHTML}

                              <div class="flex items-center justify-between">
                                  <div class="flex space-x-4">
                                      <button class="flex items-center text-gray-400 hover:text-purple-400" onclick="toggleComments(${post.id})">
                                          <i class="far fa-comment mr-1"></i>
                                          <span>${formatNumber(post.comments)} Comments</span>
                                      </button>
                                      <button class="flex items-center text-gray-400 hover:text-green-500" onclick="sharePost(${post.id})">
                                          <i class="fas fa-share mr-1"></i>
                                          <span>Share</span>
                                      </button>
                                      <button class="flex items-center text-gray-400 hover:text-yellow-500" onclick="savePost(${post.id})">
                                          <i class="far fa-bookmark mr-1"></i>
                                          <span>Save</span>
                                      </button>
                                  </div>
                                  <button class="text-gray-400 hover:text-red-500" onclick="showPostOptions(${post.id})">
                                      <i class="fas fa-ellipsis-h"></i>
                                  </button>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          `;
      }

      function attachVoteListeners() {
          document.querySelectorAll('.vote-button').forEach(button => {
              button.addEventListener('click', function() {
                  const postId = parseInt(this.dataset.postId);
                  const voteType = this.dataset.vote;
                  handleVote(postId, voteType, this);
              });
          });
      }

      function handleVote(postId, voteType, buttonElement) {
          const post = posts.find(p => p.id === postId);
          if (!post) return;

          const voteContainer = buttonElement.closest('.flex.flex-col.items-center');
          const countElement = voteContainer.querySelector('.vote-count');
          const upButton = voteContainer.querySelector('[data-vote="up"]');
          const downButton = voteContainer.querySelector('[data-vote="down"]');

          // Remove existing votes
          const wasUpvoted = upButton.classList.contains('voted-up');
          const wasDownvoted = downButton.classList.contains('voted-down');

          upButton.classList.remove('voted-up');
          downButton.classList.remove('voted-down');

          if (voteType === 'up') {
              if (wasUpvoted) {
                  post.votes--;
              } else {
                  if (wasDownvoted) post.votes += 2;
                  else post.votes++;
                  upButton.classList.add('voted-up');
              }
          } else {
              if (wasDownvoted) {
                  post.votes++;
              } else {
                  if (wasUpvoted) post.votes -= 2;
                  else post.votes--;
                  downButton.classList.add('voted-down');
              }
          }

          countElement.textContent = formatNumber(post.votes);
      }

      function sortAndDisplayPosts() {
          let sortedPosts = [...posts];
          
          switch (currentSort) {
              case 'hot':
                  sortedPosts.sort((a, b) => {
                      const aScore = a.votes + a.comments * 2;
                      const bScore = b.votes + b.comments * 2;
                      return bScore - aScore;
                  });
                  break;
              case 'new':
                  sortedPosts.sort((a, b) => b.timestamp - a.timestamp);
                  break;
              case 'top':
                  sortedPosts.sort((a, b) => b.votes - a.votes);
                  break;
          }
          
          displayPosts(sortedPosts);
      }

      function loadMorePosts() {
          const loadMoreBtn = document.getElementById('loadMoreBtn');
          loadMoreBtn.textContent = 'Loading...';
          loadMoreBtn.disabled = true;

          setTimeout(() => {
              const newPosts = [
                  {
                      id: posts.length + 1,
                      title: "Amazing sunset photography tips",
                      content: "Here are some tips for capturing the perfect sunset photo...",
                      author: "PhotoPro",
                      community: "General",
                      communityId: null,
                      visibility: "general",
                      votes: 1250,
                      comments: 89,
                      timestamp: new Date(Date.now() - 14400000),
                      type: "text"
                  },
                  {
                      id: posts.length + 2,
                      title: "New AI breakthrough in machine learning",
                      content: "Researchers have made significant progress in developing more efficient neural networks...",
                      author: "TechExpert",
                      community: "TechTalks",
                      communityId: "c3",
                      visibility: "community",
                      votes: 3400,
                      comments: 234,
                      timestamp: new Date(Date.now() - 18000000),
                      type: "text"
                  }
              ];

              posts.push(...newPosts);
              filterAndDisplayPosts();

              loadMoreBtn.textContent = 'Load more posts';
              loadMoreBtn.disabled = false;
          }, 1000);
      }

      function sendChatMessage() {
          const input = document.getElementById('chat-input');
          const message = input.value.trim();
          
          if (message) {
              addChatMessage(currentUser ? currentUser.fullName : 'You', message);
              input.value = '';
              
              // Simulate bot response
              setTimeout(() => {
                  const responses = [
                      "Thanks for your message! How can I help you?",
                      "I'll look into that for you.",
                      "Our support team will get back to you shortly.",
                      "That's a great question! Let me check...",
                      "I'm here to help with any questions you have.",
                      "Is there anything specific you'd like to know about SmileX?",
                      "I appreciate you reaching out to us!"
                  ];
                  const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                  addChatMessage('Support Agent', randomResponse);
              }, 1000 + Math.random() * 2000);
          }
      }

      function addChatMessage(user, text) {
          const messagesContainer = document.getElementById('chat-messages');
          const messageDiv = document.createElement('div');
          messageDiv.className = 'message';
          
          messageDiv.innerHTML = `
              <div class="message-user">${user}</div>
              <div class="message-text">${text}</div>
              <div class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
          `;
          
          messagesContainer.appendChild(messageDiv);
          messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }

      // Utility functions
      function formatNumber(num) {
          if (num >= 1000000) {
              return (num / 1000000).toFixed(1) + 'M';
          } else if (num >= 1000) {
              return (num / 1000).toFixed(1) + 'k';
          }
          return num.toString();
      }

      function getTimeAgo(timestamp) {
          const now = new Date();
          const diff = now - timestamp;
          const minutes = Math.floor(diff / 60000);
          const hours = Math.floor(diff / 3600000);
          const days = Math.floor(diff / 86400000);

          if (days > 0) return `${days} day${days > 1 ? 's' : ''} ago`;
          if (hours > 0) return `${hours} hour${hours > 1 ? 's' : ''} ago`;
          if (minutes > 0) return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
          return 'Just now';
      }

      function getCommunityColor(community) {
          const colors = {
              'SmileX': 'bg-blue-500',
              'Gaming': 'bg-red-500',
              'TechTalks': 'bg-green-500',
              'ArtistsLounge': 'bg-purple-500',
              'General': 'bg-gray-500'
          };
          return colors[community] || 'bg-gray-500';
      }

      function showNotification(message) {
          const notification = document.createElement('div');
          notification.className = 'notification';
          notification.innerHTML = `
              <i class="fas fa-check-circle mr-2"></i>
              ${message}
          `;
          
          document.body.appendChild(notification);
          
          setTimeout(() => notification.classList.add('show'), 100);
          setTimeout(() => {
              notification.classList.remove('show');
              setTimeout(() => notification.remove(), 300);
          }, 3000);
      }

      // Post interaction functions
      function toggleComments(postId) {
          showNotification('Comments feature coming soon!');
      }

      function sharePost(postId) {
          if (navigator.share) {
              navigator.share({
                  title: 'Check out this post on SmileX',
                  url: window.location.href
              });
          } else {
              navigator.clipboard.writeText(window.location.href);
              showNotification('Link copied to clipboard!');
          }
      }

      function savePost(postId) {
          const savedPosts = JSON.parse(localStorage.getItem('savedPosts') || '[]');
          if (!savedPosts.includes(postId)) {
              savedPosts.push(postId);
              localStorage.setItem('savedPosts', JSON.stringify(savedPosts));
              showNotification('Post saved!');
          } else {
              showNotification('Post already saved!');
          }
      }

      function showPostOptions(postId) {
          showNotification('Post options coming soon!');
      }

      function voteInPoll(postId, option) {
          showNotification(`Voted for: ${option}`);
      }

      // Prevent right-click context menu
      document.addEventListener('contextmenu', e => e.preventDefault());

      // Configure Tailwind
      tailwind.config = {
          theme: {
              extend: {
                  colors: {
                      smile: {
                          50: '#fff1f2',
                          500: '#f43f5e',
                          600: '#e11d48',
                      }
                  }
              }
          }
      };
  </script>
</body>
</html>