<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Story Realm - Infinite Narratives</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="education.css">
    <script src="education.js"></script>
</head>
<body>
    <style>
        body {
            background-color: black;
            font-family: 'Orbitron', sans-serif;
    font-size: 1rem;
    color: rgba(6, 149, 244, 0.87);
        }
        .story-card {
            transition: all 0.3s ease;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .story-card:hover {
            transform: scale(1.03);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        .story-card-img {
            height: 250px;
            object-fit: cover;
        }
        #loadingSpinner {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
      
        }

    </style>

    <div class="container-fluid">
        <!-- Header -->
        <header class="bg-black shadow-sm py-4 mb-4">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1 class="display-5"><sub>smilex</sub>ðŸŒŸ STORY HUB</h1>
                        <p class="lead text-muted" >Discover Endless Narratives</p>
                    </div>
                    <div class="col-md-4">
                        <div class="input-group">
                            <input type="text" id="searchInput" class="form-control" 
                                   placeholder="Search stories...">
                            <button id="searchButton" class="btn btn-primary">
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Story Grid -->
        <div class="container">
            <div class="row" id="storiesContainer"></div>
        </div>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="text-center" style="display:none;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>

        <!-- Story Modal -->
        <div class="modal fade" id="storyModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Story Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    class StoryRealm {
        constructor() {
            this.page = 1;
            this.isLoading = false;
            this.hasMore = true;

            this.initializeElements();
            this.setupEventListeners();
            this.loadInitialStories();
        }

        initializeElements() {
            this.searchInput = document.getElementById('searchInput');
            this.searchButton = document.getElementById('searchButton');
            this.storiesContainer = document.getElementById('storiesContainer');
            this.loadingSpinner = document.getElementById('loadingSpinner');
            this.storyModal = new bootstrap.Modal(document.getElementById('storyModal'));
        }

        setupEventListeners() {
            this.searchButton.addEventListener('click', () => this.searchStories());
            this.searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') this.searchStories();
            });

            window.addEventListener('scroll', this.handleInfiniteScroll.bind(this));
        }

        async loadInitialStories() {
            this.page = 1;
            await this.fetchStories();
        }

        async searchStories() {
            const query = this.searchInput.value.trim();
            this.page = 1;
            this.hasMore = true;
            this.storiesContainer.innerHTML = '';
            await this.fetchStories(query);
        }

        async fetchStories(query = '') {
            if (this.isLoading || !this.hasMore) return;

            this.isLoading = true;
            this.showLoadingSpinner();

            try {
                const stories = await this.fetchStoriesFromAPI(query, this.page);
                
                if (stories.length === 0) {
                    this.hasMore = false;
                } else {
                    this.displayStories(stories);
                    this.page++;
                }
            } catch (error) {
                this.handleError(error);
            } finally {
                this.isLoading = false;
                this.hideLoadingSpinner();
            }
        }

        async fetchStoriesFromAPI(query, page) {
            // Combine multiple APIs for rich story content
            const apis = [
                `https://openlibrary.org/search.json?q=${query || 'fiction'}&page=${page}`,
                `https://gutendex.com/books/?page=${page}&topic=${query || 'fiction'}`
            ];

            const responses = await Promise.all(
                apis.map(url => fetch(url).then(res => res.json()))
            );

            // Merge and transform results
            return responses.flatMap(response => 
                response.docs ? 
                    response.docs.map(this.transformStory) : 
                    response.results?.map(this.transformGutenbergStory) || []
            ).filter(story => story.title && story.coverImage);
        }

        transformStory(story) {
            return {
                title: story.title,
                author: story.author_name?.[0] || 'Unknown Author',
                coverImage: story.cover_i 
                    ? `https://covers.openlibrary.org/b/id/${story.cover_i}-M.jpg`
                    : 'https://via.placeholder.com/250x350.png?text=Story+Cover',
                description: story.first_sentence?.[0] || 'No description available'
            };
        }

        transformGutenbergStory(story) {
            return {
                title: story.title,
                author: story.authors?.[0]?.name || 'Unknown Author',
                coverImage: story.formats['image/jpeg'] || 
                    'https://via.placeholder.com/250x350.png?text=Story+Cover',
                description: 'Classic literature story'
            };
        }

        displayStories(stories) {
            stories.forEach(story => {
                const card = document.createElement('div');
                card.className = 'col-md-3 mb-4';
                card.innerHTML = `
                    <div class="card story-card h-100">
                        <img src="${story.coverImage}" 
                             class="card-img-top story-card-img" 
                             alt="${story.title} cover">
                        <div class="card-body">
                            <h5 class="card-title">${this.truncateText(story.title, 40)}</h5>
                            <p class="card-text text-muted">
                                ${this.truncateText(story.author, 30)}
                            </p>
                        </div>
                    </div>
                `;
                card.addEventListener('click', () => this.showStoryDetails(story));
                this.storiesContainer.appendChild(card);
            });
        }

        showStoryDetails(story) {
            const modalBody = document.querySelector('#storyModal .modal-body');
            modalBody.innerHTML = `
                <div class="row">
                    <div class="col-md-4">
                        <img src="${story.coverImage}" class="img-fluid" alt="${story.title} cover">
                    </div>
                    <div class="col-md-8">
                        <h2>${story.title}</h2>
                        <p><strong>Author:</strong> ${story.author}</p>
                        <p>${story.description}</p>
                    </div>
                </div>
            `;
            this.storyModal.show();
        }

        handleInfiniteScroll() {
            if (this.isLoading || !this.hasMore) return;

            const { scrollTop, scrollHeight, clientHeight } = document.documentElement;
            
            if (scrollTop + clientHeight >= scrollHeight - 100) {
                this.fetchStories(this.searchInput.value.trim());
            }
        }

        truncateText(text, length) {
            return text && text.length > length 
                ? text.substring(0, length) + '...' 
                : text;
        }

        showLoadingSpinner() {
            this.loadingSpinner.style.display = 'block';
        }

        hideLoadingSpinner() {
            this.loadingSpinner.style.display = 'none';
        }

        handleError(error) {
            console.error('Story fetch error:', error);
            this.storiesContainer.innerHTML += `
                <div class="col-12 text-center text-danger">
                    <p>Unable to retrieve stories. Please try again.</p>
                </div>
            `;
        }
    }

    // Initialize on DOM load
    document.addEventListener('DOMContentLoaded', () => new StoryRealm());
    </script>
</body>
</html>
