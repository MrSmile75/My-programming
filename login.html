<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmileX - Advanced Authentication Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üöÄ</text></svg>">
    
    <!-- OAuth 2.0 SDKs -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js" async></script>

    <style>
    :root {
        --primary-color: #ffd700;
        --secondary-color: #6a11cb;
        --accent-color: #2575fc;
        --text-color: #ffffff;
        --bg-color: #000000;
        --card-bg: rgba(10, 10, 20, 0.85);
        --success-color: #00ff9d;
        --error-color: #ff3860;
        --warning-color: #ffdd57;
        --glass-bg: rgba(255, 255, 255, 0.05);
        --border-color: rgba(255, 255, 255, 0.1);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    html {
        scroll-behavior: smooth;
    }

    body {
        font-family: 'Orbitron', sans-serif;
        background: linear-gradient(135deg, #000000, #1a1a2e);
        min-height: 100vh;
        color: var(--text-color);
        overflow-x: hidden;
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
    }

    ::placeholder {
        font-family: 'Orbitron', sans-serif;
    }

    /* Page wrapper */
    .page-wrapper {
        width: 100%;
        max-width: 1200px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
        position: relative;
        z-index: 10;
    }

    /* Main Container */
    .container {
        width: 100%;
        max-width: 900px;
        height: 600px;
        position: relative;
        transform-style: preserve-3d;
        transition: transform 1.2s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        border-radius: 25px;
        box-shadow: 
            0 25px 45px rgba(0, 0, 0, 0.6),
            0 0 50px rgba(255, 215, 0, 0.1),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        border: 1px solid var(--border-color);
        overflow: hidden;
    }

    .login-container, .signup-container {
        position: absolute;
        width: 100%;
        height: 100%;
        background: var(--card-bg);
        border-radius: 25px;
        display: flex;
        transition: all 0.8s ease;
        backface-visibility: hidden;
        backdrop-filter: blur(15px);
        overflow: auto;
    }

    .signup-container {
        transform: rotateY(180deg);
    }

    .container.active .login-container {
        transform: rotateY(-180deg);
    }

    .container.active .signup-container {
        transform: rotateY(0);
    }

    .form-section {
        width: 60%;
        padding: 50px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        position: relative;
        z-index: 2;
        overflow-y: auto;
    }

    .image-section {
        width: 40%;
        background: linear-gradient(135deg, 
            rgba(255, 215, 0, 0.9) 0%, 
            rgba(255, 215, 0, 0.7) 50%, 
            rgba(255, 165, 0, 0.8) 100%);
        border-radius: 0 25px 25px 0;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: var(--bg-color);
        text-align: center;
        position: relative;
        overflow: hidden;
    }

    .signup-container .image-section {
        border-radius: 25px 0 0 25px;
    }

    /* Decorative Elements */
    .decorative-circle {
        position: absolute;
        border-radius: 50%;
        background: linear-gradient(45deg, var(--primary-color), transparent);
        filter: blur(20px);
        opacity: 0.1;
        animation: float 8s ease-in-out infinite;
    }

    .decorative-circle.circle-1 {
        width: 200px;
        height: 200px;
        top: -100px;
        left: -100px;
        animation-delay: 0s;
    }

    .decorative-circle.circle-2 {
        width: 150px;
        height: 150px;
        bottom: -75px;
        right: -75px;
        animation-delay: 2s;
    }

    .decorative-circle.circle-3 {
        width: 100px;
        height: 100px;
        top: 50%;
        right: -50px;
        animation-delay: 4s;
    }

    @keyframes float {
        0%, 100% { transform: translateY(0px) scale(1); }
        50% { transform: translateY(-20px) scale(1.1); }
    }

    /* Form Styling */
    h2 {
        font-family: 'Orbitron', sans-serif;
        font-size: 2.5rem;
        margin-bottom: 30px;
        background: linear-gradient(135deg, var(--primary-color), #ffffff);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        position: relative;
        text-align: center;
    }

    h2::after {
        content: '';
        position: absolute;
        bottom: -15px;
        left: 50%;
        transform: translateX(-50%);
        width: 60px;
        height: 4px;
        background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
        border-radius: 2px;
    }

    .image-section h3 {
        font-family: 'Orbitron', sans-serif;
        font-size: 2rem;
        margin-bottom: 15px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .image-section p {
        margin-bottom: 30px;
        font-size: 1.1rem;
        max-width: 85%;
        line-height: 1.6;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    }

    .form-group {
        margin-bottom: 25px;
        position: relative;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        font-size: 0.95rem;
        color: rgba(255, 255, 255, 0.9);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .form-control {
        width: 100%;
        padding: 15px 20px;
        background: var(--glass-bg);
        border: 2px solid var(--border-color);
        border-radius: 12px;
        color: var(--text-color);
        font-size: 1rem;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
    }

    .form-control:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 
            0 0 0 3px rgba(255, 215, 0, 0.2),
            0 8px 25px rgba(255, 215, 0, 0.1);
        transform: translateY(-2px);
    }

    .form-control::placeholder {
        color: rgba(255, 255, 255, 0.5);
    }

    .form-control.valid {
        border-color: var(--success-color);
        box-shadow: 0 0 0 2px rgba(0, 255, 157, 0.2);
    }

    .form-control.invalid {
        border-color: var(--error-color);
        box-shadow: 0 0 0 2px rgba(255, 56, 96, 0.2);
    }

    /* Password Strength Indicator */
    .password-strength {
        height: 6px;
        background: rgba(255, 255, 255, 0.1);
        margin-top: 10px;
        border-radius: 3px;
        position: relative;
        overflow: hidden;
    }

    .password-strength-meter {
        height: 100%;
        width: 0;
        background: linear-gradient(90deg, var(--error-color), var(--warning-color), var(--success-color));
        transition: width 0.5s ease, background 0.3s ease;
        border-radius: 3px;
        position: relative;
    }

    .password-strength-meter::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }

    .password-feedback {
        font-size: 0.85rem;
        margin-top: 8px;
        min-height: 20px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .strength-indicator {
        display: flex;
        gap: 4px;
        margin-top: 8px;
    }

    .strength-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
    }

    .strength-dot.active {
        background: var(--success-color);
        box-shadow: 0 0 8px rgba(0, 255, 157, 0.5);
    }

    /* Checkbox Styling */
    .checkbox-group {
        display: flex;
        align-items: center;
        margin-bottom: 25px;
        gap: 12px;
    }

    .checkbox-group input[type="checkbox"] {
        width: 18px;
        height: 18px;
        accent-color: var(--primary-color);
        cursor: pointer;
    }

    .checkbox-group label {
        margin: 0;
        cursor: pointer;
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.8);
    }

    /* Button Styling */
    .btn {
        width: 100%;
        padding: 16px;
        border: none;
        border-radius: 12px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        font-family: 'Orbitron', sans-serif;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--primary-color), #e6c200);
        color: var(--bg-color);
        box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
    }

    .btn-primary:hover {
        background: linear-gradient(135deg, #e6c200, var(--primary-color));
        transform: translateY(-3px);
        box-shadow: 0 12px 35px rgba(255, 215, 0, 0.4);
    }

    .btn-primary:active {
        transform: translateY(-1px);
    }

    .btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        transition: 0.6s;
    }

    .btn:hover::before {
        left: 100%;
    }

    .toggle-btn {
        background: transparent;
        border: 2px solid var(--bg-color);
        color: var(--bg-color);
        padding: 14px 35px;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 25px;
        font-family: 'Orbitron', sans-serif;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .toggle-btn:hover {
        background: rgba(0, 0, 0, 0.2);
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    }

    /* Social Login Section */
    .social-login {
        margin-top: 30px;
        text-align: center;
    }

    .social-login p {
        margin-bottom: 20px;
        position: relative;
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.9rem;
    }

    .social-login p::before,
    .social-login p::after {
        content: '';
        position: absolute;
        top: 50%;
        width: 35%;
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    }

    .social-login p::before {
        left: 0;
    }

    .social-login p::after {
        right: 0;
    }

    .social-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
    }

    .social-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 55px;
        height: 55px;
        border-radius: 50%;
        background: var(--glass-bg);
        border: 2px solid var(--border-color);
        transition: all 0.3s ease;
        cursor: pointer;
        backdrop-filter: blur(10px);
        position: relative;
        overflow: hidden;
    }

    .social-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        border-color: var(--primary-color);
    }

    .social-btn:active {
        transform: translateY(-2px);
    }

    .social-btn svg {
        width: 24px;
        height: 24px;
        transition: transform 0.3s ease;
    }

    .social-btn:hover svg {
        transform: scale(1.1);
    }

    /* OAuth Popup Modal */
    .oauth-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 3000;
        backdrop-filter: blur(10px);
    }

    .oauth-modal.show {
        display: flex;
    }

    .oauth-content {
        background: var(--card-bg);
        border-radius: 20px;
        padding: 40px;
        text-align: center;
        max-width: 500px;
        width: 90%;
        border: 1px solid var(--border-color);
        backdrop-filter: blur(20px);
        position: relative;
        animation: modalSlideIn 0.3s ease;
    }

    @keyframes modalSlideIn {
        from {
            transform: translateY(50px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .oauth-close {
        position: absolute;
        top: 15px;
        right: 15px;
        background: none;
        border: none;
        color: var(--primary-color);
        font-size: 24px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .oauth-close:hover {
        transform: scale(1.2);
        color: white;
    }

    .oauth-provider-icon {
        font-size: 4rem;
        margin-bottom: 20px;
    }

    .oauth-title {
        color: var(--primary-color);
        font-size: 1.8rem;
        margin-bottom: 15px;
        font-family: 'Orbitron', sans-serif;
    }

    .oauth-message {
        color: rgba(255, 255, 255, 0.8);
        margin-bottom: 30px;
        line-height: 1.6;
    }

    .oauth-steps {
        text-align: left;
        margin: 20px 0;
        padding: 20px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        border-left: 4px solid var(--primary-color);
    }

    .oauth-steps h4 {
        color: var(--primary-color);
        margin-bottom: 10px;
        font-size: 1rem;
    }

    .oauth-steps ol {
        color: rgba(255, 255, 255, 0.8);
        font-size: 0.9rem;
        line-height: 1.6;
        padding-left: 20px;
    }

    .oauth-steps li {
        margin-bottom: 5px;
    }

    /* Validation Messages */
    .validation-message {
        font-size: 0.8rem;
        margin-top: 6px;
        color: var(--error-color);
        min-height: 18px;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .validation-message.success {
        color: var(--success-color);
    }

    /* Notification System */
    .notification {
        position: fixed;
        top: 30px;
        right: 30px;
        padding: 18px 25px;
        border-radius: 12px;
        color: white;
        font-weight: 500;
        transform: translateX(150%);
        transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        z-index: 1000;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        max-width: 350px;
    }

    .notification.success {
        background: linear-gradient(135deg, var(--success-color), #00cc7a);
    }

    .notification.error {
        background: linear-gradient(135deg, var(--error-color), #cc2e4a);
    }

    .notification.info {
        background: linear-gradient(135deg, var(--accent-color), #1e5bb8);
    }

    .notification.show {
        transform: translateX(0);
    }

    /* Loading Animation */
    .loading {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 15;
        border-radius: 25px;
        justify-content: center;
        align-items: center;
        backdrop-filter: blur(5px);
    }

    .loading.show {
        display: flex;
    }

    .spinner {
        width: 60px;
        height: 60px;
        border: 4px solid rgba(255, 255, 255, 0.1);
        border-top-color: var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        position: relative;
    }

    .spinner::after {
        content: '';
        position: absolute;
        top: 2px;
        left: 2px;
        right: 2px;
        bottom: 2px;
        border: 2px solid transparent;
        border-top-color: rgba(255, 215, 0, 0.5);
        border-radius: 50%;
        animation: spin 2s linear infinite reverse;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* Rate Limit Warning */
    .rate-limit-warning {
        background: linear-gradient(135deg, var(--warning-color), #e6c200);
        color: var(--bg-color);
        padding: 10px 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 0.9rem;
        text-align: center;
        display: none;
    }

    .rate-limit-warning.show {
        display: block;
    }

    /* Email Verification Modal */
    .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        backdrop-filter: blur(5px);
    }

    .modal.show {
        display: flex;
    }

    .modal-content {
        background: var(--card-bg);
        padding: 40px;
        border-radius: 20px;
        text-align: center;
        max-width: 500px;
        width: 90%;
        border: 1px solid var(--border-color);
        backdrop-filter: blur(20px);
    }

    .modal-content h3 {
        color: var(--primary-color);
        margin-bottom: 20px;
        font-size: 1.8rem;
    }

    .modal-content p {
        margin-bottom: 30px;
        line-height: 1.6;
        color: rgba(255, 255, 255, 0.8);
    }

    .modal-content .btn {
        margin-top: 20px;
    }

    /* Progress Indicator */
    .progress-indicator {
        position: fixed;
        bottom: 30px;
        right: 30px;
        background: var(--card-bg);
        border-radius: 15px;
        padding: 15px 20px;
        border: 1px solid var(--border-color);
        backdrop-filter: blur(20px);
        display: none;
        z-index: 1500;
    }

    .progress-indicator.show {
        display: block;
        animation: slideInUp 0.3s ease;
    }

    @keyframes slideInUp {
        from {
            transform: translateY(100%);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .progress-text {
        color: var(--primary-color);
        font-size: 0.9rem;
        font-weight: 600;
        margin-bottom: 5px;
    }

    .progress-bar {
        width: 200px;
        height: 4px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 2px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
        width: 0%;
        transition: width 0.3s ease;
        border-radius: 2px;
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
        .container {
            max-width: 800px;
            height: 550px;
        }
        
        .form-section {
            padding: 40px;
        }
    }

    @media (max-width: 768px) {
        .page-wrapper {
            padding: 10px;
        }
        
        .container {
            width: 95%;
            max-width: 500px;
            height: auto;
            min-height: 650px;
        }

        .login-container, .signup-container {
            flex-direction: column-reverse;
        }

        .form-section, .image-section {
            width: 100%;
        }

        .form-section {
            padding: 30px 25px;
        }

        .image-section {
            height: 180px;
            border-radius: 25px 25px 0 0;
            padding: 20px;
        }

        .signup-container .image-section {
            border-radius: 25px 25px 0 0;
        }

        h2 {
            font-size: 2rem;
        }

        .image-section h3 {
            font-size: 1.5rem;
        }

        .social-buttons {
            gap: 10px;
        }

        .social-btn {
            width: 50px;
            height: 50px;
        }
    }

    @media (max-width: 480px) {
        .form-section {
            padding: 25px 20px;
        }

        h2 {
            font-size: 1.8rem;
        }

        .form-control {
            padding: 12px 16px;
        }

        .btn {
            padding: 14px;
            font-size: 1rem;
        }
    }

    /* Accessibility */
    @media (prefers-reduced-motion: reduce) {
        * {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
    }

    /* Focus styles for accessibility */
    .form-control:focus,
    .btn:focus,
    .social-btn:focus,
    .toggle-btn:focus {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
    }

    /* High contrast mode support */
    @media (prefers-contrast: high) {
        :root {
            --border-color: rgba(255, 255, 255, 0.3);
            --glass-bg: rgba(255, 255, 255, 0.1);
        }
    }

    /* Custom scrollbar */
    .form-section::-webkit-scrollbar {
        width: 8px;
    }

    .form-section::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 10px;
    }

    .form-section::-webkit-scrollbar-thumb {
        background: var(--primary-color);
        border-radius: 10px;
    }

    .form-section::-webkit-scrollbar-thumb:hover {
        background: #e6c200;
    }
</style>

<body>
    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <!-- Progress Indicator -->
    <div class="progress-indicator" id="progressIndicator">
        <div class="progress-text">Saving Progress...</div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
    </div>

    <!-- OAuth Modal -->
    <div class="oauth-modal" id="oauthModal">
        <div class="oauth-content">
            <button class="oauth-close" onclick="closeOAuthModal()">
                <i class="fas fa-times">√ó</i>
            </button>
            
            <div class="oauth-provider-icon" id="oauthIcon">üîê</div>
            <h2 class="oauth-title" id="oauthTitle">Authenticating...</h2>
            <p class="oauth-message" id="oauthMessage">Please wait while we redirect you to the authentication provider.</p>
            
            <div class="oauth-steps">
                <h4>What happens next:</h4>
                <ol>
                    <li>You'll be redirected to the secure login page</li>
                    <li>Enter your credentials or authorize the app</li>
                    <li>We'll verify your email and create your account</li>
                    <li>You'll be redirected back to continue your journey</li>
                </ol>
            </div>
            
            <div class="loading show">
                <div class="spinner"></div>
            </div>
        </div>
    </div>

    <!-- Email Verification Modal -->
    <div class="modal" id="verificationModal">
        <div class="modal-content">
            <h3>üìß Verify Your Email</h3>
            <p>We've sent a verification link to your email address. Please check your inbox and click the link to activate your account.</p>
            <p><strong>Didn't receive the email?</strong> Check your spam folder or click the button below to resend.</p>
            <button class="btn btn-primary" onclick="resendVerificationEmail()">Resend Verification Email</button>
            <button class="btn" style="background: transparent; border: 2px solid var(--primary-color); color: var(--primary-color); margin-top: 10px;" onclick="closeVerificationModal()">Close</button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container" id="authContainer">
        <!-- Login Container -->
        <div class="login-container">
            <div class="form-section">
                <div class="decorative-circle circle-1"></div>
                <div class="decorative-circle circle-2"></div>
                <div class="decorative-circle circle-3"></div>
                
                <!-- Rate Limit Warning -->
                <div class="rate-limit-warning" id="loginRateLimit">
                    Too many login attempts. Please wait before trying again.
                </div>
                
                <h2>Login</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail">Email Address</label>
                        <input 
                            type="email" 
                            placeholder="Enter your email address"
                            class="form-control" 
                            id="loginEmail" 
                            required
                            autocomplete="email"
                        >
                        <div class="validation-message" id="loginEmailError"></div>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input 
                            type="password" 
                            placeholder="Enter your password"
                            class="form-control" 
                            id="loginPassword" 
                            required
                            autocomplete="current-password"
                        >
                        <div class="validation-message" id="loginPasswordError"></div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input 
                            type="checkbox" 
                            id="rememberMe"
                        >
                        <label for="rememberMe">Remember me for 30 days</label>
                    </div>
                    
                    <button 
                        type="submit" 
                        class="btn btn-primary"
                        id="loginButton"
                    >
                        Login
                    </button>

                    <div class="social-login">
                        <p>Or continue with</p>
                        <div class="social-buttons">
                            <button type="button" class="social-btn" id="googleLogin" title="Login with Google">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M21.8055 10.0415H21V10H12V14H17.6515C16.827 16.3285 14.6115 18 12 18C8.6865 18 6 15.3135 6 12C6 8.6865 8.6865 6 12 6C13.5295 6 14.921 6.577 15.9805 7.5195L18.809 4.691C17.023 3.0265 14.634 2 12 2C6.4775 2 2 6.4775 2 12C2 17.5225 6.4775 22 12 22C17.5225 22 22 17.5225 22 12C22 11.3295 21.931 10.675 21.8055 10.0415Z" fill="#FFC107"/>
                                    <path d="M3.15295 7.3455L6.43845 9.755C7.32745 7.554 9.48045 6 12 6C13.5295 6 14.921 6.577 15.9805 7.5195L18.809 4.691C17.023 3.0265 14.634 2 12 2C8.15895 2 4.82795 4.1685 3.15295 7.3455Z" fill="#FF3D00"/>
                                    <path d="M12 22C14.583 22 16.93 21.0115 18.7045 19.404L15.6095 16.785C14.5718 17.5742 13.3038 18.001 12 18C9.39903 18 7.19053 16.3415 6.35853 14.027L3.09753 16.5395C4.75253 19.778 8.11353 22 12 22Z" fill="#4CAF50"/>
                                    <path d="M21.8055 10.0415H21V10H12V14H17.6515C17.2571 15.1082 16.5467 16.0766 15.608 16.7855L15.6095 16.7845L18.7045 19.4035C18.4855 19.6025 22 17 22 12C22 11.3295 21.931 10.675 21.8055 10.0415Z" fill="#1976D2"/>
                                </svg>
                            </button>
                            <button type="button" class="social-btn" id="facebookLogin" title="Login with Facebook">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 2C6.477 2 2 6.477 2 12C2 16.991 5.657 21.128 10.438 21.879V14.89H7.898V12H10.438V9.797C10.438 7.291 11.93 5.907 14.215 5.907C15.309 5.907 16.453 6.102 16.453 6.102V8.562H15.193C13.95 8.562 13.563 9.333 13.563 10.124V12H16.336L15.893 14.89H13.563V21.879C18.343 21.129 22 16.99 22 12C22 6.477 17.523 2 12 2Z" fill="#1877F2"/>
                                </svg>
                            </button>
                            <button type="button" class="social-btn" id="githubLogin" title="Login with GitHub">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 2C6.477 2 2 6.484 2 12.017C2 16.624 5.865 20.426 10.839 21.179C11.339 21.269 11.521 20.956 11.521 20.686C11.521 20.442 11.521 19.853 11.521 19.017C8.021 19.726 7.521 17.5 7.521 17.5C7.021 16.208 6.26 15.896 6.26 15.896C5.26 15.208 6.339 15.208 6.339 15.208C7.417 15.286 7.917 16.312 7.917 16.312C8.917 17.885 10.521 17.364 11.521 17.052C11.625 16.312 11.917 15.791 12.26 15.479C9.26 15.166 6.26 14.208 6.26 10.312C6.26 9.208 6.677 8.312 7.917 7.625C7.792 7.312 7.417 6.208 8.042 4.791C8.042 4.791 9.042 4.479 11.521 6.062C12.417 5.791 13.417 5.666 14.417 5.666C15.417 5.666 16.417 5.791 17.313 6.062C19.792 4.479 20.792 4.791 20.792 4.791C21.417 6.208 21.042 7.312 20.917 7.625C22.157 8.312 22.574 9.208 22.574 10.312C22.574 14.208 19.574 15.166 16.574 15.479C16.917 15.791 17.313 16.416 17.313 17.364V20.686C17.313 20.956 17.495 21.269 17.995 21.179C22.969 20.426 26.834 16.624 26.834 12.017C26.834 6.484 22.357 2 16.834 2H12Z" fill="white"/>
                                </svg>
                            </button>
                            <button type="button" class="social-btn" id="twitterLogin" title="Login with X (Twitter)">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M18.244 2.25H21.552L14.325 10.51L22.827 21.75H16.17L10.956 14.933L4.99 21.75H1.68L9.41 12.915L1.254 2.25H8.08L12.793 8.481L18.244 2.25ZM17.083 19.77H18.916L7.084 4.126H5.117L17.083 19.77Z" fill="white"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </form>
                <div class="loading" id="loginLoading">
                    <div class="spinner"></div>
                </div>
            </div>
            <div class="image-section">
                <div>
                    <h3>Welcome Back, Explorer!</h3>
                    <p>Ready to continue your journey? Login to access your personalized dashboard and explore exciting realms.</p>
                    <button 
                        class="toggle-btn" 
                        onclick="toggleForm()"
                        type="button"
                    >
                        Create New Account
                    </button>
                </div>
            </div>
        </div>

        <!-- Signup Container -->
        <div class="signup-container">
            <div class="image-section">
                <div>
                    <h3>Join the SmileX!</h3>
                    <p>Begin your adventure today. Create your account and unlock access to an infinite exploration of exciting features and experiences.</p>
                    <button 
                        class="toggle-btn" 
                        onclick="toggleForm()"
                        type="button"
                    >
                        I Have an Account
                    </button>
                </div>
            </div>
            <div class="form-section">
                <div class="decorative-circle circle-1"></div>
                <div class="decorative-circle circle-2"></div>
                <div class="decorative-circle circle-3"></div>
                
                <!-- Rate Limit Warning -->
                <div class="rate-limit-warning" id="signupRateLimit">
                    Too many signup attempts. Please wait before trying again.
                </div>
                
                <h2>Create Account</h2>
                <form id="signupForm">
                    <div class="form-group">
                        <label for="signupName">Full Name</label>
                        <input 
                            type="text" 
                            placeholder="Enter your full name"
                            class="form-control" 
                            id="signupName" 
                            required
                            autocomplete="name"
                        >
                        <div class="validation-message" id="signupNameError"></div>
                    </div>
                    <div class="form-group">
                        <label for="signupEmail">Email Address</label>
                        <input 
                            type="email" 
                            placeholder="Enter your email address"
                            class="form-control" 
                            id="signupEmail" 
                            required
                            autocomplete="email"
                        >
                        <div class="validation-message" id="signupEmailError"></div>
                    </div>
                    <div class="form-group">
                        <label for="signupPassword">Password</label>
                        <input 
                            type="password" 
                            placeholder="Create a strong password"
                            class="form-control" 
                            id="signupPassword" 
                            required
                            autocomplete="new-password"
                        >
                        <div class="password-strength">
                            <div class="password-strength-meter" id="passwordStrengthMeter"></div>
                        </div>
                        <div class="strength-indicator" id="strengthIndicator">
                            <div class="strength-dot"></div>
                            <div class="strength-dot"></div>
                            <div class="strength-dot"></div>
                            <div class="strength-dot"></div>
                            <div class="strength-dot"></div>
                        </div>
                        <div class="password-feedback" id="passwordFeedback"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirmPassword">Confirm Password</label>
                        <input 
                            type="password" 
                            placeholder="Confirm your password"
                            class="form-control" 
                            id="confirmPassword" 
                            required
                            autocomplete="new-password"
                        >
                        <div class="validation-message" id="confirmPasswordError"></div>
                    </div>
                    
                    <button 
                        type="submit" 
                        class="btn btn-primary"
                        id="signupButton"
                    >
                        Launch Account
                    </button>
                </form>
                <div class="loading" id="signupLoading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
    </div>
<script>
    // ==================== OAUTH 2.0 CONFIGURATION ====================
const OAUTH_CONFIG = {
    google: {
        clientId: 'YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com',
        redirectUri: window.location.origin + '/auth/google/callback',
        scope: 'openid email profile',
        responseType: 'code'
    },
    facebook: {
        appId: 'YOUR_FACEBOOK_APP_ID',
        redirectUri: window.location.origin + '/auth/facebook/callback',
        scope: 'email,public_profile'
    },
    github: {
        clientId: 'YOUR_GITHUB_CLIENT_ID',
        redirectUri: window.location.origin + '/auth/github/callback',
        scope: 'user:email'
    },
    twitter: {
        clientId: 'YOUR_TWITTER_CLIENT_ID',
        redirectUri: window.location.origin + '/auth/twitter/callback',
        scope: 'tweet.read users.read'
    }
};

// ==================== ENHANCED BACKEND SIMULATION SYSTEM ====================
class AdvancedBackendSimulator {
    constructor() {
        this.initializeDatabase();
        this.setupRateLimiting();
        this.setupProgressTracking();
        this.setupEmailService();
    }
    
    // Initialize local storage as database
    initializeDatabase() {
        if (!localStorage.getItem('users_db')) {
            localStorage.setItem('users_db', JSON.stringify([]));
        }
        if (!localStorage.getItem('sessions_db')) {
            localStorage.setItem('sessions_db', JSON.stringify([]));
        }
        if (!localStorage.getItem('verification_tokens')) {
            localStorage.setItem('verification_tokens', JSON.stringify([]));
        }
        if (!localStorage.getItem('oauth_states')) {
            localStorage.setItem('oauth_states', JSON.stringify([]));
        }
        if (!localStorage.getItem('user_progress')) {
            localStorage.setItem('user_progress', JSON.stringify({}));
        }
    }
    
    // Setup rate limiting
    setupRateLimiting() {
        if (!localStorage.getItem('rate_limits')) {
            localStorage.setItem('rate_limits', JSON.stringify({
                login: { attempts: 0, lastAttempt: 0 },
                signup: { attempts: 0, lastAttempt: 0 },
                oauth: { attempts: 0, lastAttempt: 0 }
            }));
        }
    }
    
    // Setup progress tracking
    setupProgressTracking() {
        this.progressData = {
            currentPage: window.location.pathname,
            formData: {},
            timestamp: Date.now(),
            sessionId: this.getSessionId()
        };
        
        // Auto-save progress every 30 seconds
        setInterval(() => {
            this.saveUserProgress();
        }, 30000);
        
        // Save progress on page unload
        window.addEventListener('beforeunload', () => {
            this.saveUserProgress();
        });
    }
    
    // Setup email service simulation
    setupEmailService() {
        this.emailTemplates = {
            verification: {
                subject: 'Verify Your SmileX Account',
                template: (name, token) => `
                    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; background: linear-gradient(135deg, #000000, #1a1a2e); color: white; border-radius: 15px; overflow: hidden;">
                        <div style="background: linear-gradient(135deg, #ffd700, #e6c200); padding: 30px; text-align: center;">
                            <h1 style="margin: 0; color: black; font-size: 2rem;">üöÄ Welcome to SmileX!</h1>
                        </div>
                        <div style="padding: 40px;">
                            <h2 style="color: #ffd700;">Hello ${name}!</h2>
                            <p style="font-size: 1.1rem; line-height: 1.6; margin-bottom: 30px;">
                                Thank you for joining SmileX! To complete your registration and start your journey, please verify your email address by clicking the button below.
                            </p>
                            <div style="text-align: center; margin: 40px 0;">
                                <a href="${window.location.origin}/verify?token=${token}" 
                                   style="background: linear-gradient(135deg, #ffd700, #e6c200); color: black; padding: 15px 30px; text-decoration: none; border-radius: 8px; font-weight: bold; font-size: 1.1rem; display: inline-block;">
                                    Verify Email Address
                                </a>
                            </div>
                            <p style="color: rgba(255, 255, 255, 0.8); font-size: 0.9rem;">
                                If you didn't create an account with SmileX, you can safely ignore this email.
                            </p>
                            <p style="color: rgba(255, 255, 255, 0.8); font-size: 0.9rem;">
                                This verification link will expire in 24 hours for security reasons.
                            </p>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.1); padding: 20px; text-align: center; font-size: 0.8rem; color: rgba(255, 255, 255, 0.6);">
                            ¬© 2024 SmileX. All rights reserved.
                        </div>
                    </div>
                `
            },
            welcome: {
                subject: 'Welcome to SmileX - Your Journey Begins!',
                template: (name) => `
                    <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; background: linear-gradient(135deg, #000000, #1a1a2e); color: white; border-radius: 15px; overflow: hidden;">
                        <div style="background: linear-gradient(135deg, #ffd700, #e6c200); padding: 30px; text-align: center;">
                            <h1 style="margin: 0; color: black; font-size: 2rem;">üéâ Welcome Aboard!</h1>
                        </div>
                        <div style="padding: 40px;">
                            <h2 style="color: #ffd700;">Hello ${name}!</h2>
                            <p style="font-size: 1.1rem; line-height: 1.6; margin-bottom: 30px;">
                                Your email has been verified successfully! You're now part of the SmileX community and ready to explore all our amazing features.
                            </p>
                            <div style="background: rgba(255, 215, 0, 0.1); border-left: 4px solid #ffd700; padding: 20px; margin: 30px 0; border-radius: 0 8px 8px 0;">
                                <h3 style="color: #ffd700; margin-bottom: 15px;">What's Next?</h3>
                                <ul style="color: rgba(255, 255, 255, 0.9); line-height: 1.8;">
                                    <li>Complete your profile setup</li>
                                    <li>Explore premium features</li>
                                    <li>Connect with the community</li>
                                    <li>Start your first project</li>
                                </ul>
                            </div>
                            <div style="text-align: center; margin: 40px 0;">
                                <a href="${window.location.origin}/dashboard" 
                                   style="background: linear-gradient(135deg, #ffd700, #e6c200); color: black; padding: 15px 30px; text-decoration: none; border-radius: 8px; font-weight: bold; font-size: 1.1rem; display: inline-block;">
                                    Go to Dashboard
                                </a>
                            </div>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.1); padding: 20px; text-align: center; font-size: 0.8rem; color: rgba(255, 255, 255, 0.6);">
                            ¬© 2024 SmileX. All rights reserved.
                        </div>
                    </div>
                `
            }
        };
    }
    
    // Get or create session ID
    getSessionId() {
        let sessionId = sessionStorage.getItem('smileX_sessionId');
        if (!sessionId) {
            sessionId = 'sess_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            sessionStorage.setItem('smileX_sessionId', sessionId);
        }
        return sessionId;
    }
    
    // Save user progress
    saveUserProgress() {
        const progressData = {
            ...this.progressData,
            formData: this.collectFormData(),
            timestamp: Date.now()
        };
        
        const allProgress = JSON.parse(localStorage.getItem('user_progress') || '{}');
        allProgress[this.progressData.sessionId] = progressData;
        localStorage.setItem('user_progress', JSON.stringify(allProgress));
        
        // Show progress indicator
        this.showProgressIndicator();
    }
    
    // Collect form data
    collectFormData() {
        const formData = {};
        
        // Collect login form data
        const loginEmail = document.getElementById('loginEmail');
        const loginPassword = document.getElementById('loginPassword');
        const rememberMe = document.getElementById('rememberMe');
        
        if (loginEmail && loginEmail.value) formData.loginEmail = loginEmail.value;
        if (rememberMe) formData.rememberMe = rememberMe.checked;
        
        // Collect signup form data (excluding password for security)
        const signupName = document.getElementById('signupName');
        const signupEmail = document.getElementById('signupEmail');
        
        if (signupName && signupName.value) formData.signupName = signupName.value;
        if (signupEmail && signupEmail.value) formData.signupEmail = signupEmail.value;
        
        return formData;
    }
    
    // Restore user progress
    restoreUserProgress() {
        const allProgress = JSON.parse(localStorage.getItem('user_progress') || '{}');
        const sessionProgress = allProgress[this.progressData.sessionId];
        
        if (sessionProgress && sessionProgress.formData) {
            const { formData } = sessionProgress;
            
            // Restore form data
            if (formData.loginEmail) {
                const loginEmail = document.getElementById('loginEmail');
                if (loginEmail) loginEmail.value = formData.loginEmail;
            }
            
            if (formData.rememberMe !== undefined) {
                const rememberMe = document.getElementById('rememberMe');
                if (rememberMe) rememberMe.checked = formData.rememberMe;
            }
            
            if (formData.signupName) {
                const signupName = document.getElementById('signupName');
                if (signupName) signupName.value = formData.signupName;
            }
            
            if (formData.signupEmail) {
                const signupEmail = document.getElementById('signupEmail');
                if (signupEmail) signupEmail.value = formData.signupEmail;
            }
        }
    }
    
    // Show progress indicator
    showProgressIndicator() {
        const indicator = document.getElementById('progressIndicator');
        const fill = document.getElementById('progressFill');
        
        indicator.classList.add('show');
        fill.style.width = '100%';
        
        setTimeout(() => {
            indicator.classList.remove('show');
            fill.style.width = '0%';
        }, 2000);
    }
    
    // Check rate limiting
    checkRateLimit(type) {
        const rateLimits = JSON.parse(localStorage.getItem('rate_limits'));
        const now = Date.now();
        const limit = rateLimits[type];
        
        // Reset if more than 15 minutes have passed
        if (now - limit.lastAttempt > 15 * 60 * 1000) {
            limit.attempts = 0;
        }
        
        // Check if rate limited (max 5 attempts per 15 minutes)
        if (limit.attempts >= 5) {
            return false;
        }
        
        return true;
    }
    
    // Update rate limit
    updateRateLimit(type) {
        const rateLimits = JSON.parse(localStorage.getItem('rate_limits'));
        rateLimits[type].attempts++;
        rateLimits[type].lastAttempt = Date.now();
        localStorage.setItem('rate_limits', JSON.stringify(rateLimits));
    }
    
    // Hash password (simplified simulation)
    async hashPassword(password) {
        const encoder = new TextEncoder();
        const data = encoder.encode(password + 'smileX_salt_2024');
        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }
    
    // Verify password
    async verifyPassword(password, hashedPassword) {
        const inputHash = await this.hashPassword(password);
        return inputHash === hashedPassword;
    }
    
    // Check if email exists
    emailExists(email) {
        const users = JSON.parse(localStorage.getItem('users_db'));
        return users.some(user => user.email.toLowerCase() === email.toLowerCase());
    }
    
    // Generate verification token
    generateVerificationToken() {
        return Math.random().toString(36).substring(2) + Date.now().toString(36);
    }
    
    // Generate session token
    generateSessionToken() {
        return 'sess_' + Math.random().toString(36).substring(2) + Date.now().toString(36);
    }
    
    // Generate OAuth state
    generateOAuthState(provider) {
        const state = provider + '_' + Math.random().toString(36).substring(2) + Date.now().toString(36);
        
        // Store state for verification
        const states = JSON.parse(localStorage.getItem('oauth_states'));
        states.push({
            state: state,
            provider: provider,
            created: Date.now(),
            expires: Date.now() + (10 * 60 * 1000) // 10 minutes
        });
        localStorage.setItem('oauth_states', JSON.stringify(states));
        
        return state;
    }
    
    // Verify OAuth state
    verifyOAuthState(state, provider) {
        const states = JSON.parse(localStorage.getItem('oauth_states'));
        const stateData = states.find(s => s.state === state && s.provider === provider);
        
        if (!stateData) return false;
        if (Date.now() > stateData.expires) return false;
        
        // Remove used state
        const updatedStates = states.filter(s => s.state !== state);
        localStorage.setItem('oauth_states', JSON.stringify(updatedStates));
        
        return true;
    }
    
    // Send verification email (enhanced simulation)
    async sendVerificationEmail(email, token, name = 'User') {
        // Simulate email sending delay
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        // Store verification token
        const tokens = JSON.parse(localStorage.getItem('verification_tokens'));
        tokens.push({
            email: email,
            token: token,
            expires: Date.now() + (24 * 60 * 60 * 1000), // 24 hours
            created: Date.now()
        });
        localStorage.setItem('verification_tokens', JSON.stringify(tokens));
        
        // Simulate email content
        const emailContent = this.emailTemplates.verification.template(name, token);
        
        // Log email (in real app, this would send actual email)
        console.log(`üìß Verification email sent to ${email}`);
        console.log(`üìß Subject: ${this.emailTemplates.verification.subject}`);
        console.log(`üîó Verification link: ${window.location.origin}/verify?token=${token}`);
        console.log(`üìÑ Email content: ${emailContent}`);
        
        return true;
    }
    
    // Send welcome email
    async sendWelcomeEmail(email, name) {
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        const emailContent = this.emailTemplates.welcome.template(name);
        
        console.log(`üìß Welcome email sent to ${email}`);
        console.log(`üìß Subject: ${this.emailTemplates.welcome.subject}`);
        console.log(`üìÑ Email content: ${emailContent}`);
        
        return true;
    }
    
    // Register user
    async registerUser(userData) {
        try {
            // Check if email already exists
            if (this.emailExists(userData.email)) {
                throw new Error('Email already registered');
            }
            
            // Hash password
            const hashedPassword = await this.hashPassword(userData.password);
            
            // Generate verification token
            const verificationToken = this.generateVerificationToken();
            
            // Create user object
            const user = {
                id: Date.now().toString(),
                name: userData.name,
                email: userData.email.toLowerCase(),
                password: hashedPassword,
                verified: false,
                verificationToken: verificationToken,
                provider: 'email',
                createdAt: new Date().toISOString(),
                lastLogin: null,
                progress: {}
            };
            
            // Save user to database
            const users = JSON.parse(localStorage.getItem('users_db'));
            users.push(user);
            localStorage.setItem('users_db', JSON.stringify(users));
            
            // Send verification email
            await this.sendVerificationEmail(userData.email, verificationToken, userData.name);
            
            return {
                success: true,
                message: 'Account created successfully! Please check your email to verify your account.',
                userId: user.id
            };
            
        } catch (error) {
            return {
                success: false,
                message: error.message
            };
        }
    }
    
    // Register OAuth user
    async registerOAuthUser(userData) {
        try {
            // Check if email already exists
            const existingUser = this.getUserByEmail(userData.email);
            if (existingUser) {
                // Link OAuth account to existing user
                existingUser.oauthProviders = existingUser.oauthProviders || [];
                if (!existingUser.oauthProviders.includes(userData.provider)) {
                    existingUser.oauthProviders.push(userData.provider);
                }
                existingUser.lastLogin = new Date().toISOString();
                
                const users = JSON.parse(localStorage.getItem('users_db'));
                const userIndex = users.findIndex(u => u.id === existingUser.id);
                users[userIndex] = existingUser;
                localStorage.setItem('users_db', JSON.stringify(users));
                
                return {
                    success: true,
                    message: `OAuth account linked successfully!`,
                    user: existingUser
                };
            }
            
            // Create new OAuth user
            const user = {
                id: Date.now().toString(),
                name: userData.name,
                email: userData.email.toLowerCase(),
                verified: true, // OAuth users are pre-verified
                provider: userData.provider,
                oauthProviders: [userData.provider],
                oauthId: userData.oauthId,
                avatar: userData.avatar || null,
                createdAt: new Date().toISOString(),
                lastLogin: new Date().toISOString(),
                progress: {}
            };
            
            // Save user to database
            const users = JSON.parse(localStorage.getItem('users_db'));
            users.push(user);
            localStorage.setItem('users_db', JSON.stringify(users));
            
            // Send welcome email
            await this.sendWelcomeEmail(userData.email, userData.name);
            
            return {
                success: true,
                message: `Welcome to SmileX, ${userData.name}!`,
                user: user
            };
            
        } catch (error) {
            return {
                success: false,
                message: error.message
            };
        }
    }
    
    // Get user by email
    getUserByEmail(email) {
        const users = JSON.parse(localStorage.getItem('users_db'));
        return users.find(u => u.email.toLowerCase() === email.toLowerCase());
    }
    
    // Login user
    async loginUser(credentials) {
        try {
            const user = this.getUserByEmail(credentials.email);
            
            if (!user) {
                throw new Error('Invalid email or password');
            }
            
            // Check if email is verified
            if (!user.verified) {
                throw new Error('Please verify your email address before logging in');
            }
            
            // Verify password (skip for OAuth users)
            if (user.provider === 'email') {
                const passwordValid = await this.verifyPassword(credentials.password, user.password);
                if (!passwordValid) {
                    throw new Error('Invalid email or password');
                }
            }
            
            // Generate session token
            const sessionToken = this.generateSessionToken();
            
            // Create session
            const sessions = JSON.parse(localStorage.getItem('sessions_db'));
            const session = {
                token: sessionToken,
                userId: user.id,
                email: user.email,
                name: user.name,
                provider: user.provider,
                createdAt: Date.now(),
                expiresAt: Date.now() + (credentials.rememberMe ? 30 * 24 * 60 * 60 * 1000 : 24 * 60 * 60 * 1000)
            };
            sessions.push(session);
            localStorage.setItem('sessions_db', JSON.stringify(sessions));
            
            // Update last login
            user.lastLogin = new Date().toISOString();
            const users = JSON.parse(localStorage.getItem('users_db'));
            const userIndex = users.findIndex(u => u.id === user.id);
            users[userIndex] = user;
            localStorage.setItem('users_db', JSON.stringify(users));
            
            // Set session cookie
            document.cookie = `sessionToken=${sessionToken}; path=/; ${credentials.rememberMe ? 'max-age=' + (30 * 24 * 60 * 60) : 'session'}; secure; samesite=strict`;
            
            return {
                success: true,
                message: `Welcome back, ${user.name}!`,
                user: {
                    id: user.id,
                    name: user.name,
                    email: user.email,
                    provider: user.provider
                },
                sessionToken: sessionToken
            };
            
        } catch (error) {
            return {
                success: false,
                message: error.message
            };
        }
    }
    
    // Verify email token
    verifyEmailToken(token) {
        const tokens = JSON.parse(localStorage.getItem('verification_tokens'));
        const tokenData = tokens.find(t => t.token === token);
        
        if (!tokenData) {
            return { success: false, message: 'Invalid verification token' };
        }
        
        if (Date.now() > tokenData.expires) {
            return { success: false, message: 'Verification token has expired' };
        }
        
        // Mark user as verified
        const users = JSON.parse(localStorage.getItem('users_db'));
        const user = users.find(u => u.email.toLowerCase() === tokenData.email.toLowerCase());
        
        if (user) {
            user.verified = true;
            user.verificationToken = null;
            localStorage.setItem('users_db', JSON.stringify(users));
            
            // Remove used token
            const updatedTokens = tokens.filter(t => t.token !== token);
            localStorage.setItem('verification_tokens', JSON.stringify(updatedTokens));
            
            // Send welcome email
            this.sendWelcomeEmail(user.email, user.name);
            
            return { success: true, message: 'Email verified successfully!' };
        }
        
        return { success: false, message: 'User not found' };
    }
    
    // Resend verification email
    async resendVerificationEmail(email) {
        const user = this.getUserByEmail(email);
        
        if (!user) {
            return { success: false, message: 'User not found' };
        }
        
        if (user.verified) {
            return { success: false, message: 'Email is already verified' };
        }
        
        // Generate new token
        const newToken = this.generateVerificationToken();
        user.verificationToken = newToken;
        
        const users = JSON.parse(localStorage.getItem('users_db'));
        const userIndex = users.findIndex(u => u.id === user.id);
        users[userIndex] = user;
        localStorage.setItem('users_db', JSON.stringify(users));
        
        // Send new verification email
        await this.sendVerificationEmail(email, newToken, user.name);
        
        return { success: true, message: 'Verification email sent successfully!' };
    }
}

// ==================== OAUTH 2.0 INTEGRATION SYSTEM ====================
class OAuth2Integration {
    constructor(backend, notification) {
        this.backend = backend;
        this.notification = notification;
        this.currentProvider = null;
        this.setupOAuthProviders();
    }
    
    setupOAuthProviders() {
        // Initialize Google OAuth
        this.initializeGoogleOAuth();
        
        // Initialize Facebook OAuth
        this.initializeFacebookOAuth();
        
        // Setup event listeners
        this.setupEventListeners();
    }
    
    initializeGoogleOAuth() {
        // Google OAuth initialization
        if (typeof google !== 'undefined') {
            google.accounts.id.initialize({
                client_id: OAUTH_CONFIG.google.clientId,
                callback: (response) => this.handleGoogleCallback(response),
                auto_select: false,
                cancel_on_tap_outside: true
            });
        }
    }
    
    initializeFacebookOAuth() {
        // Facebook OAuth initialization
        if (typeof FB !== 'undefined') {
            window.fbAsyncInit = () => {
                FB.init({
                    appId: OAUTH_CONFIG.facebook.appId,
                    cookie: true,
                    xfbml: true,
                    version: 'v18.0'
                });
            };
        }
    }
    
    setupEventListeners() {
        // Google login
        document.getElementById('googleLogin').addEventListener('click', () => {
            this.initiateGoogleOAuth();
        });
        
        // Facebook login
        document.getElementById('facebookLogin').addEventListener('click', () => {
            this.initiateFacebookOAuth();
        });
        
        // GitHub login
        document.getElementById('githubLogin').addEventListener('click', () => {
            this.initiateGitHubOAuth();
        });
        
        // Twitter/X login
        document.getElementById('twitterLogin').addEventListener('click', () => {
            this.initiateTwitterOAuth();
        });
    }
    
    // Show OAuth modal
    showOAuthModal(provider, icon, title, message) {
        this.currentProvider = provider;
        
        document.getElementById('oauthIcon').textContent = icon;
        document.getElementById('oauthTitle').textContent = title;
        document.getElementById('oauthMessage').textContent = message;
        document.getElementById('oauthModal').classList.add('show');
    }
    
    // Close OAuth modal
    closeOAuthModal() {
        document.getElementById('oauthModal').classList.remove('show');
        this.currentProvider = null;
    }
    
    // Google OAuth
    async initiateGoogleOAuth() {
        if (!this.backend.checkRateLimit('oauth')) {
            this.notification.show('Too many OAuth attempts. Please wait 15 minutes.', 'error');
            return;
        }
        
        this.backend.updateRateLimit('oauth');
        
        this.showOAuthModal('google', 'üîç', 'Connecting to Google', 'Redirecting to Google for secure authentication...');
        
        try {
            // Simulate Google OAuth flow
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            if (typeof google !== 'undefined' && google.accounts) {
                // Use Google Identity Services
                google.accounts.id.prompt((notification) => {
                    if (notification.isNotDisplayed() || notification.isSkippedMoment()) {
                        // Fallback to popup
                        this.openGooglePopup();
                    }
                });
            } else {
                // Fallback simulation
                this.simulateGoogleOAuth();
            }
        } catch (error) {
            this.closeOAuthModal();
            this.notification.show('Google authentication failed. Please try again.', 'error');
        }
    }
    
    openGooglePopup() {
        const state = this.backend.generateOAuthState('google');
        const authUrl = `https://accounts.google.com/oauth2/v2/auth?` +
            `client_id=${OAUTH_CONFIG.google.clientId}&` +
            `redirect_uri=${encodeURIComponent(OAUTH_CONFIG.google.redirectUri)}&` +
            `scope=${encodeURIComponent(OAUTH_CONFIG.google.scope)}&` +
            `response_type=${OAUTH_CONFIG.google.responseType}&` +
            `state=${state}`;
        
        const popup = window.open(authUrl, 'google-oauth', 'width=500,height=600,scrollbars=yes,resizable=yes');
        
        // Monitor popup
        const checkClosed = setInterval(() => {
            if (popup.closed) {
                clearInterval(checkClosed);
                this.closeOAuthModal();
            }
        }, 1000);
        
        // Listen for OAuth callback
        window.addEventListener('message', (event) => {
            if (event.origin !== window.location.origin) return;
            
            if (event.data.type === 'oauth-callback' && event.data.provider === 'google') {
                clearInterval(checkClosed);
                popup.close();
                this.handleGoogleOAuthCallback(event.data);
            }
        });
    }
    
    async simulateGoogleOAuth() {
        // Simulate successful Google OAuth
        await new Promise(resolve => setTimeout(resolve, 3000));
        
        const mockGoogleUser = {
            id: 'google_' + Date.now(),
            name: 'Google User',
            email: 'user@gmail.com',
            picture: 'https://via.placeholder.com/150',
            provider: 'google'
        };
        
        await this.processOAuthUser(mockGoogleUser);
    }
    
    handleGoogleCallback(response) {
        // Decode JWT token
        try {
            const payload = JSON.parse(atob(response.credential.split('.')[1]));
            const userData = {
                id: payload.sub,
                name: payload.name,
                email: payload.email,
                picture: payload.picture,
                provider: 'google'
            };
            
            this.processOAuthUser(userData);
        } catch (error) {
            this.closeOAuthModal();
            this.notification.show('Failed to process Google authentication.', 'error');
        }
    }
    
    // Facebook OAuth
    async initiateFacebookOAuth() {
        if (!this.backend.checkRateLimit('oauth')) {
            this.notification.show('Too many OAuth attempts. Please wait 15 minutes.', 'error');
            return;
        }
        
        this.backend.updateRateLimit('oauth');
        
        this.showOAuthModal('facebook', 'üìò', 'Connecting to Facebook', 'Redirecting to Facebook for secure authentication...');
        
        try {
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            if (typeof FB !== 'undefined') {
                FB.login((response) => {
                    if (response.authResponse) {
                        this.handleFacebookCallback(response.authResponse);
                    } else {
                        this.closeOAuthModal();
                        this.notification.show('Facebook authentication cancelled.', 'info');
                    }
                }, { scope: OAUTH_CONFIG.facebook.scope });
            } else {
                // Fallback simulation
                this.simulateFacebookOAuth();
            }
        } catch (error) {
            this.closeOAuthModal();
            this.notification.show('Facebook authentication failed. Please try again.', 'error');
        }
    }
    
    async simulateFacebookOAuth() {
        await new Promise(resolve => setTimeout(resolve, 3000));
        
        const mockFacebookUser = {
            id: 'facebook_' + Date.now(),
            name: 'Facebook User',
            email: 'user@facebook.com',
            picture: 'https://via.placeholder.com/150',
            provider: 'facebook'
        };
        
        await this.processOAuthUser(mockFacebookUser);
    }
    
    handleFacebookCallback(authResponse) {
        FB.api('/me', { fields: 'name,email,picture' }, (response) => {
            if (response && !response.error) {
                const userData = {
                    id: response.id,
                    name: response.name,
                    email: response.email,
                    picture: response.picture?.data?.url,
                    provider: 'facebook'
                };
                
                this.processOAuthUser(userData);
            } else {
                this.closeOAuthModal();
                this.notification.show('Failed to get Facebook user data.', 'error');
            }
        });
    }
    
    // GitHub OAuth
    async initiateGitHubOAuth() {
        if (!this.backend.checkRateLimit('oauth')) {
            this.notification.show('Too many OAuth attempts. Please wait 15 minutes.', 'error');
            return;
        }
        
        this.backend.updateRateLimit('oauth');
        
        this.showOAuthModal('github', 'üêô', 'Connecting to GitHub', 'Redirecting to GitHub for secure authentication...');
        
        try {
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            const state = this.backend.generateOAuthState('github');
            const authUrl = `https://github.com/login/oauth/authorize?` +
                `client_id=${OAUTH_CONFIG.github.clientId}&` +
                `redirect_uri=${encodeURIComponent(OAUTH_CONFIG.github.redirectUri)}&` +
                `scope=${encodeURIComponent(OAUTH_CONFIG.github.scope)}&` +
                `state=${state}`;
            
            const popup = window.open(authUrl, 'github-oauth', 'width=500,height=600,scrollbars=yes,resizable=yes');
            
            // Monitor popup
            const checkClosed = setInterval(() => {
                if (popup.closed) {
                    clearInterval(checkClosed);
                    this.closeOAuthModal();
                }
            }, 1000);
            
            // Listen for OAuth callback
            window.addEventListener('message', (event) => {
                if (event.origin !== window.location.origin) return;
                
                if (event.data.type === 'oauth-callback' && event.data.provider === 'github') {
                    clearInterval(checkClosed);
                    popup.close();
                    this.handleGitHubOAuthCallback(event.data);
                }
            });
            
            // Fallback simulation after 5 seconds
            setTimeout(() => {
                if (!popup.closed) {
                    popup.close();
                    clearInterval(checkClosed);
                    this.simulateGitHubOAuth();
                }
            }, 5000);
            
        } catch (error) {
            this.closeOAuthModal();
            this.notification.show('GitHub authentication failed. Please try again.', 'error');
        }
    }
    
    async simulateGitHubOAuth() {
        await new Promise(resolve => setTimeout(resolve, 3000));
        
        const mockGitHubUser = {
            id: 'github_' + Date.now(),
            name: 'GitHub User',
            email: 'user@github.com',
            avatar_url: 'https://via.placeholder.com/150',
            provider: 'github'
        };
        
        await this.processOAuthUser(mockGitHubUser);
    }
    
    handleGitHubOAuthCallback(data) {
        if (data.success && data.user) {
            this.processOAuthUser({
                id: data.user.id,
                name: data.user.name || data.user.login,
                email: data.user.email,
                avatar_url: data.user.avatar_url,
                provider: 'github'
            });
        } else {
            this.closeOAuthModal();
            this.notification.show('GitHub authentication failed.', 'error');
        }
    }
    
    // Twitter/X OAuth
    async initiateTwitterOAuth() {
        if (!this.backend.checkRateLimit('oauth')) {
            this.notification.show('Too many OAuth attempts. Please wait 15 minutes.', 'error');
            return;
        }
        
        this.backend.updateRateLimit('oauth');
        
        this.showOAuthModal('twitter', 'üê¶', 'Connecting to X (Twitter)', 'Redirecting to X for secure authentication...');
        
        try {
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            const state = this.backend.generateOAuthState('twitter');
            const authUrl = `https://twitter.com/i/oauth2/authorize?` +
                `response_type=code&` +
                `client_id=${OAUTH_CONFIG.twitter.clientId}&` +
                `redirect_uri=${encodeURIComponent(OAUTH_CONFIG.twitter.redirectUri)}&` +
                `scope=${encodeURIComponent(OAUTH_CONFIG.twitter.scope)}&` +
                `state=${state}&` +
                `code_challenge=challenge&` +
                `code_challenge_method=plain`;
            
            const popup = window.open(authUrl, 'twitter-oauth', 'width=500,height=600,scrollbars=yes,resizable=yes');
            
            // Monitor popup
            const checkClosed = setInterval(() => {
                if (popup.closed) {
                    clearInterval(checkClosed);
                    this.closeOAuthModal();
                }
            }, 1000);
            
            // Listen for OAuth callback
            window.addEventListener('message', (event) => {
                if (event.origin !== window.location.origin) return;
                
                if (event.data.type === 'oauth-callback' && event.data.provider === 'twitter') {
                    clearInterval(checkClosed);
                    popup.close();
                    this.handleTwitterOAuthCallback(event.data);
                }
            });
            
            // Fallback simulation after 5 seconds
            setTimeout(() => {
                if (!popup.closed) {
                    popup.close();
                    clearInterval(checkClosed);
                    this.simulateTwitterOAuth();
                }
            }, 5000);
            
        } catch (error) {
            this.closeOAuthModal();
            this.notification.show('X (Twitter) authentication failed. Please try again.', 'error');
        }
    }
    
    async simulateTwitterOAuth() {
        await new Promise(resolve => setTimeout(resolve, 3000));
        
        const mockTwitterUser = {
            id: 'twitter_' + Date.now(),
            name: 'X User',
            email: 'user@twitter.com',
            profile_image_url: 'https://via.placeholder.com/150',
            provider: 'twitter'
        };
        
        await this.processOAuthUser(mockTwitterUser);
    }
    
    handleTwitterOAuthCallback(data) {
        if (data.success && data.user) {
            this.processOAuthUser({
                id: data.user.id,
                name: data.user.name,
                email: data.user.email,
                profile_image_url: data.user.profile_image_url,
                provider: 'twitter'
            });
        } else {
            this.closeOAuthModal();
            this.notification.show('X (Twitter) authentication failed.', 'error');
        }
    }
    
    // Process OAuth user
    async processOAuthUser(userData) {
        try {
            // Normalize user data
            const normalizedUser = {
                oauthId: userData.id,
                name: userData.name,
                email: userData.email,
                avatar: userData.picture || userData.avatar_url || userData.profile_image_url,
                provider: userData.provider
            };
            
            // Register or login OAuth user
            const result = await this.backend.registerOAuthUser(normalizedUser);
            
            if (result.success) {
                this.closeOAuthModal();
                this.notification.show(result.message, 'success');
                
                // Create session
                const sessionResult = await this.backend.loginUser({
                    email: normalizedUser.email,
                    rememberMe: true
                });
                
                if (sessionResult.success) {
                    // Redirect to dashboard or previous page
                    setTimeout(() => {
                        this.redirectAfterLogin();
                    }, 2000);
                }
            } else {
                this.closeOAuthModal();
                this.notification.show(result.message, 'error');
            }
            
        } catch (error) {
            this.closeOAuthModal();
            this.notification.show('OAuth authentication failed. Please try again.', 'error');
        }
    }
    
    // Redirect after successful login
    redirectAfterLogin() {
        // Check for return URL in session storage
        const returnUrl = sessionStorage.getItem('smileX_returnUrl');
        
        if (returnUrl && returnUrl !== window.location.pathname) {
            sessionStorage.removeItem('smileX_returnUrl');
            window.location.href = returnUrl;
        } else {
            // Default redirect to dashboard
            this.showDashboard();
        }
    }
    
    // Show dashboard
    showDashboard() {
        const sessions = JSON.parse(localStorage.getItem('sessions_db') || '[]');
        const cookies = document.cookie.split(';');
        let sessionToken = null;
        
        for (let cookie of cookies) {
            const [name, value] = cookie.trim().split('=');
            if (name === 'sessionToken') {
                sessionToken = value;
                break;
            }
        }
        
        if (sessionToken) {
            const session = sessions.find(s => s.token === sessionToken);
            if (session) {
                this.renderDashboard(session);
            }
        }
    }
    
    // Render dashboard
    renderDashboard(session) {
        const dashboardHTML = `
            <div style="
                min-height: 100vh;
                background: linear-gradient(135deg, #000000, #1a1a2e);
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
                font-family: 'Orbitron', sans-serif;
            ">
                <div style="
                    background: rgba(10, 10, 20, 0.85);
                    backdrop-filter: blur(20px);
                    border-radius: 25px;
                    padding: 50px;
                    text-align: center;
                    max-width: 800px;
                    width: 100%;
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    box-shadow: 0 25px 45px rgba(0, 0, 0, 0.6);
                ">
                    <div style="font-size: 4rem; margin-bottom: 20px;">üöÄ</div>
                    <h1 style="
                        color: #ffd700;
                        font-size: 2.5rem;
                        margin-bottom: 20px;
                        background: linear-gradient(135deg, #ffd700, #ffffff);
                        -webkit-background-clip: text;
                        background-clip: text;
                        color: transparent;
                    ">Welcome to SmileX Dashboard!</h1>
                    <p style="color: rgba(255, 255, 255, 0.8); font-size: 1.2rem; margin-bottom: 10px;">
                        Hello, <span style="color: #ffd700; font-weight: bold;">${session.name}</span>!
                    </p>
                    <p style="color: rgba(255, 255, 255, 0.6); margin-bottom: 30px;">
                        Email: ${session.email} | Provider: ${session.provider || 'Email'}
                    </p>
                    <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 40px;">
                        You have successfully logged in to your account. Your journey begins here!
                    </p>
                    
                    <div style="
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                        gap: 20px;
                        margin: 40px 0;
                    ">
                        <div style="
                            background: rgba(255, 255, 255, 0.05);
                            border-radius: 15px;
                            padding: 25px;
                            border: 1px solid rgba(255, 255, 255, 0.1);
                            transition: all 0.3s ease;
                        " onmouseover="this.style.background='rgba(255, 255, 255, 0.1)'; this.style.transform='translateY(-5px)'"
                           onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'; this.style.transform='translateY(0)'">
                            <div style="font-size: 3rem; margin-bottom: 15px;">üìä</div>
                            <h3 style="color: white; margin-bottom: 10px; font-size: 1.2rem;">Analytics</h3>
                            <p style="color: rgba(255, 255, 255, 0.6); font-size: 0.9rem;">View your performance metrics</p>
                        </div>
                        
                        <div style="
                            background: rgba(255, 255, 255, 0.05);
                            border-radius: 15px;
                            padding: 25px;
                            border: 1px solid rgba(255, 255, 255, 0.1);
                            transition: all 0.3s ease;
                        " onmouseover="this.style.background='rgba(255, 255, 255, 0.1)'; this.style.transform='translateY(-5px)'"
                           onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'; this.style.transform='translateY(0)'">
                            <div style="font-size: 3rem; margin-bottom: 15px;">‚öôÔ∏è</div>
                            <h3 style="color: white; margin-bottom: 10px; font-size: 1.2rem;">Settings</h3>
                            <p style="color: rgba(255, 255, 255, 0.6); font-size: 0.9rem;">Customize your experience</p>
                        </div>
                        
                        <div style="
                            background: rgba(255, 255, 255, 0.05);
                            border-radius: 15px;
                            padding: 25px;
                            border: 1px solid rgba(255, 255, 255, 0.1);
                            transition: all 0.3s ease;
                        " onmouseover="this.style.background='rgba(255, 255, 255, 0.1)'; this.style.transform='translateY(-5px)'"
                           onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'; this.style.transform='translateY(0)'">
                            <div style="font-size: 3rem; margin-bottom: 15px;">üéØ</div>
                            <h3 style="color: white; margin-bottom: 10px; font-size: 1.2rem;">Goals</h3>
                            <p style="color: rgba(255, 255, 255, 0.6); font-size: 0.9rem;">Track your objectives</p>
                        </div>
                        
                        <div style="
                            background: rgba(255, 255, 255, 0.05);
                            border-radius: 15px;
                            padding: 25px;
                            border: 1px solid rgba(255, 255, 255, 0.1);
                            transition: all 0.3s ease;
                        " onmouseover="this.style.background='rgba(255, 255, 255, 0.1)'; this.style.transform='translateY(-5px)'"
                           onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'; this.style.transform='translateY(0)'">
                            <div style="font-size: 3rem; margin-bottom: 15px;">üí¨</div>
                            <h3 style="color: white; margin-bottom: 10px; font-size: 1.2rem;">Messages</h3>
                            <p style="color: rgba(255, 255, 255, 0.6); font-size: 0.9rem;">Communicate with your team</p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 40px;">
                        <button onclick="logout()" style="
                            background: linear-gradient(135deg, #ffd700, #e6c200);
                            color: #000000;
                            border: none;
                            padding: 15px 30px;
                            border-radius: 12px;
                            font-size: 1.1rem;
                            font-weight: 600;
                            cursor: pointer;
                            font-family: 'Orbitron', sans-serif;
                            text-transform: uppercase;
                            letter-spacing: 1px;
                            transition: all 0.3s ease;
                            margin-right: 15px;
                        " onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 12px 35px rgba(255, 215, 0, 0.4)'"
                           onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 25px rgba(255, 215, 0, 0.3)'">
                            Logout
                        </button>
                        
                        <button onclick="goToSubscription()" style="
                            background: transparent;
                            color: #ffd700;
                            border: 2px solid #ffd700;
                            padding: 15px 30px;
                            border-radius: 12px;
                            font-size: 1.1rem;
                            font-weight: 600;
                            cursor: pointer;
                            font-family: 'Orbitron', sans-serif;
                            text-transform: uppercase;
                            letter-spacing: 1px;
                            transition: all 0.3s ease;
                        " onmouseover="this.style.background='rgba(255, 215, 0, 0.1)'; this.style.transform='translateY(-3px)'"
                           onmouseout="this.style.background='transparent'; this.style.transform='translateY(0)'">
                            Premium Plans
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        // Replace page content
        document.body.innerHTML = dashboardHTML;
        
        // Add functions to global scope
        window.logout = () => {
            // Clear session
            const sessions = JSON.parse(localStorage.getItem('sessions_db') || '[]');
            const updatedSessions = sessions.filter(s => s.token !== session.token);
            localStorage.setItem('sessions_db', JSON.stringify(updatedSessions));
            
            document.cookie = 'sessionToken=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
            
            // Show logout notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 30px;
                right: 30px;
                background: linear-gradient(135deg, #00ff9d, #00cc7a);
                color: white;
                padding: 18px 25px;
                border-radius: 12px;
                font-weight: 500;
                z-index: 1000;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.1);
                font-family: 'Orbitron', sans-serif;
            `;
            notification.textContent = 'Logged out successfully!';
            document.body.appendChild(notification);
            
            // Reload page to return to login
            setTimeout(() => {
                window.location.reload();
            }, 2000);
        };
        
        window.goToSubscription = () => {
            // Store current page as return URL
            sessionStorage.setItem('smileX_returnUrl', '/dashboard');
            
            // Navigate to subscription page (you would replace this with actual URL)
            window.location.href = '/subscription';
        };
    }
}

// ==================== ENHANCED FORM VALIDATION ====================
class AdvancedFormValidator {
    constructor() {
        this.passwordStrengthMeter = document.getElementById('passwordStrengthMeter');
        this.passwordFeedback = document.getElementById('passwordFeedback');
        this.strengthIndicator = document.getElementById('strengthIndicator');
        
        this.setupEventListeners();
    }
    
    setupEventListeners() {
        // Real-time validation
        const loginEmail = document.getElementById('loginEmail');
        const loginPassword = document.getElementById('loginPassword');
        const signupName = document.getElementById('signupName');
        const signupEmail = document.getElementById('signupEmail');
        const signupPassword = document.getElementById('signupPassword');
        const confirmPassword = document.getElementById('confirmPassword');
        
        // Login form
        loginEmail.addEventListener('input', () => this.validateEmailRealTime(loginEmail, 'loginEmailError'));
        loginEmail.addEventListener('blur', () => this.validateEmail(loginEmail, 'loginEmailError'));
        loginPassword.addEventListener('blur', () => this.validateRequired(loginPassword, 'loginPasswordError', 'Password is required'));
        
        // Signup form
        signupName.addEventListener('input', () => this.validateNameRealTime(signupName, 'signupNameError'));
        signupName.addEventListener('blur', () => this.validateName(signupName, 'signupNameError'));
        signupEmail.addEventListener('input', () => this.validateEmailRealTime(signupEmail, 'signupEmailError'));
        signupEmail.addEventListener('blur', () => this.validateEmail(signupEmail, 'signupEmailError'));
        signupPassword.addEventListener('input', () => this.checkPasswordStrength(signupPassword.value));
        confirmPassword.addEventListener('input', () => this.validatePasswordMatchRealTime(signupPassword.value, confirmPassword.value));
        confirmPassword.addEventListener('blur', () => this.validatePasswordMatch(signupPassword.value, confirmPassword.value));
    }
    
    validateEmailRealTime(input, errorId) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (input.value && !emailRegex.test(input.value)) {
            this.setInvalid(input, document.getElementById(errorId), '');
        } else if (input.value && emailRegex.test(input.value)) {
            this.setValid(input, document.getElementById(errorId));
        } else {
            this.clearValidation(input, document.getElementById(errorId));
        }
    }
    
    validateNameRealTime(input, errorId) {
        if (input.value && input.value.trim().length < 2) {
            this.setInvalid(input, document.getElementById(errorId), '');
        } else if (input.value && input.value.trim().length >= 2) {
            this.setValid(input, document.getElementById(errorId));
        } else {
            this.clearValidation(input, document.getElementById(errorId));
        }
    }
    
    validatePasswordMatchRealTime(password, confirmPassword) {
        const input = document.getElementById('confirmPassword');
        const errorElement = document.getElementById('confirmPasswordError');
        
        if (confirmPassword && password !== confirmPassword) {
            this.setInvalid(input, errorElement, '');
        } else if (confirmPassword && password === confirmPassword) {
            this.setValid(input, errorElement);
        } else {
            this.clearValidation(input, errorElement);
        }
    }
    
    validateEmail(input, errorId) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        const errorElement = document.getElementById(errorId);
        
        if (!input.value) {
            this.setInvalid(input, errorElement, 'Email address is required');
            return false;
        } else if (!emailRegex.test(input.value)) {
            this.setInvalid(input, errorElement, 'Please enter a valid email address');
            return false;
        } else {
            this.setValid(input, errorElement);
            return true;
        }
    }
    
    validateName(input, errorId) {
        const errorElement = document.getElementById(errorId);
        
        if (!input.value.trim()) {
            this.setInvalid(input, errorElement, 'Full name is required');
            return false;
        } else if (input.value.trim().length < 2) {
            this.setInvalid(input, errorElement, 'Name must be at least 2 characters');
            return false;
        } else {
            this.setValid(input, errorElement);
            return true;
        }
    }
    
    validateRequired(input, errorId, message) {
        const errorElement = document.getElementById(errorId);
        
        if (!input.value.trim()) {
            this.setInvalid(input, errorElement, message);
            return false;
        } else {
            this.setValid(input, errorElement);
            return true;
        }
    }
    
    validatePasswordMatch(password, confirmPassword) {
        const errorElement = document.getElementById('confirmPasswordError');
        const input = document.getElementById('confirmPassword');
        
        if (!confirmPassword) {
            this.setInvalid(input, errorElement, 'Please confirm your password');
            return false;
        } else if (password !== confirmPassword) {
            this.setInvalid(input, errorElement, 'Passwords do not match');
            return false;
        } else {
            this.setValid(input, errorElement);
            return true;
        }
    }
    
    checkPasswordStrength(password) {
        const criteria = [
            { regex: /.{8,}/, message: '8+ characters' },
            { regex: /[A-Z]/, message: 'uppercase letter' },
            { regex: /[a-z]/, message: 'lowercase letter' },
            { regex: /[0-9]/, message: 'number' },
            { regex: /[^A-Za-z0-9]/, message: 'special character' }
        ];
        
        let strength = 0;
        let passedCriteria = 0;
        let missingCriteria = [];
        
        criteria.forEach((criterion, index) => {
            const dot = this.strengthIndicator.children[index];
            if (criterion.regex.test(password)) {
                strength += 20;
                passedCriteria++;
                dot.classList.add('active');
            } else {
                missingCriteria.push(criterion.message);
                dot.classList.remove('active');
            }
        });
        
        // Update strength meter
        this.passwordStrengthMeter.style.width = `${strength}%`;
        
        // Update feedback
        let feedbackText = '';
        let feedbackColor = '';
        
        if (!password) {
            feedbackText = '';
            feedbackColor = '';
        } else if (strength <= 40) {
            feedbackText = `Weak password - Add ${missingCriteria.join(', ')}`;
            feedbackColor = 'var(--error-color)';
            this.passwordStrengthMeter.style.background = 'var(--error-color)';
        } else if (strength <= 80) {
            feedbackText = `Good password - Add ${missingCriteria.join(', ')}`;
            feedbackColor = 'var(--warning-color)';
            this.passwordStrengthMeter.style.background = 'var(--warning-color)';
        } else {
            feedbackText = 'Strong password ‚úì';
            feedbackColor = 'var(--success-color)';
            this.passwordStrengthMeter.style.background = 'var(--success-color)';
        }
        
        this.passwordFeedback.textContent = feedbackText;
        this.passwordFeedback.style.color = feedbackColor;
        
        return strength === 100;
    }
    
    setValid(input, errorElement) {
        input.classList.remove('invalid');
        input.classList.add('valid');
        errorElement.textContent = '';
        errorElement.classList.remove('error');
        errorElement.classList.add('success');
    }
    
    setInvalid(input, errorElement, message) {
        input.classList.remove('valid');
        input.classList.add('invalid');
        errorElement.textContent = message;
        errorElement.classList.remove('success');
        errorElement.classList.add('error');
    }
    
    clearValidation(input, errorElement) {
        input.classList.remove('valid', 'invalid');
        errorElement.textContent = '';
        errorElement.classList.remove('success', 'error');
    }
    
    validateLoginForm() {
        const email = document.getElementById('loginEmail');
        const password = document.getElementById('loginPassword');
        
        const isEmailValid = this.validateEmail(email, 'loginEmailError');
        const isPasswordValid = this.validateRequired(password, 'loginPasswordError', 'Password is required');
        
        return isEmailValid && isPasswordValid;
    }
    
    validateSignupForm() {
        const name = document.getElementById('signupName');
        const email = document.getElementById('signupEmail');
        const password = document.getElementById('signupPassword');
        const confirmPassword = document.getElementById('confirmPassword');
        
        const isNameValid = this.validateName(name, 'signupNameError');
        const isEmailValid = this.validateEmail(email, 'signupEmailError');
        const isPasswordStrong = this.checkPasswordStrength(password.value);
        const isPasswordMatch = this.validatePasswordMatch(password.value, confirmPassword.value);
        
        return isNameValid && isEmailValid && isPasswordStrong && isPasswordMatch;
    }
}

// ==================== ENHANCED NOTIFICATION SYSTEM ====================
class AdvancedNotificationSystem {
    constructor() {
        this.notification = document.getElementById('notification');
        this.timeout = null;
        this.queue = [];
        this.isShowing = false;
    }
    
    show(message, type = 'success', duration = 4000) {
        const notification = { message, type, duration };
        
        if (this.isShowing) {
            this.queue.push(notification);
            return;
        }
        
        this.displayNotification(notification);
    }
    
    displayNotification({ message, type, duration }) {
        this.isShowing = true;
        
        // Clear any existing timeout
        if (this.timeout) {
            clearTimeout(this.timeout);
        }
        
        // Set message and type
        this.notification.textContent = message;
        this.notification.className = `notification ${type}`;
        
        // Show notification
        setTimeout(() => {
            this.notification.classList.add('show');
        }, 100);
        
        // Hide after duration
        this.timeout = setTimeout(() => {
            this.notification.classList.remove('show');
            this.isShowing = false;
            
            // Show next notification in queue
            if (this.queue.length > 0) {
                const nextNotification = this.queue.shift();
                setTimeout(() => {
                    this.displayNotification(nextNotification);
                }, 300);
            }
        }, duration);
    }
    
    clear() {
        this.queue = [];
        this.notification.classList.remove('show');
        this.isShowing = false;
        if (this.timeout) {
            clearTimeout(this.timeout);
        }
    }
}

// ==================== MAIN APPLICATION CONTROLLER ====================
class AuthenticationApp {
    constructor() {
        this.backend = new AdvancedBackendSimulator();
        this.validator = new AdvancedFormValidator();
        this.notification = new AdvancedNotificationSystem();
        this.oauth = new OAuth2Integration(this.backend, this.notification);
        
        this.isSignup = false;
        this.currentUserEmail = '';
        
        this.setupEventListeners();
        this.checkExistingSession();
        this.setupReturnUrlTracking();
    }
    
    setupEventListeners() {
        // Form submissions
        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.handleLogin();
        });
        
        document.getElementById('signupForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.handleSignup();
        });
        
        // Check for URL parameters (email verification)
        this.checkUrlParameters();
        
        // Auto-save form data
        this.setupAutoSave();
    }
    
    setupReturnUrlTracking() {
        // Store the current page as return URL if coming from another page
        const referrer = document.referrer;
        if (referrer && !referrer.includes('/login') && !referrer.includes('/signup')) {
            sessionStorage.setItem('smileX_returnUrl', referrer);
        }
    }
    
    setupAutoSave() {
        // Auto-save form data every 10 seconds
        setInterval(() => {
            this.backend.saveUserProgress();
        }, 10000);
        
        // Restore saved progress on page load
        setTimeout(() => {
            this.backend.restoreUserProgress();
        }, 500);
    }
    
    checkUrlParameters() {
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');
        
        if (token) {
            this.handleEmailVerification(token);
        }
    }
    
    checkExistingSession() {
        // Check if user is already logged in
        const sessions = JSON.parse(localStorage.getItem('sessions_db') || '[]');
        const cookies = document.cookie.split(';');
        let sessionToken = null;
        
        for (let cookie of cookies) {
            const [name, value] = cookie.trim().split('=');
            if (name === 'sessionToken') {
                sessionToken = value;
                break;
            }
        }
        
        if (sessionToken) {
            const session = sessions.find(s => s.token === sessionToken && s.expiresAt > Date.now());
            if (session) {
                this.notification.show(`Welcome back, ${session.name}!`, 'success');
                setTimeout(() => {
                    this.oauth.renderDashboard(session);
                }, 2000);
            }
        }
    }
    
    async handleLogin() {
        // Check rate limiting
        if (!this.backend.checkRateLimit('login')) {
            document.getElementById('loginRateLimit').classList.add('show');
            this.notification.show('Too many login attempts. Please wait 15 minutes.', 'error');
            return;
        }
        
        // Validate form
        if (!this.validator.validateLoginForm()) {
            this.notification.show('Please fix the errors in the form', 'error');
            return;
        }
        
        // Show loading
        this.showLoading('login', true);
        
        // Update rate limit
        this.backend.updateRateLimit('login');
        
        // Get form data
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        const rememberMe = document.getElementById('rememberMe').checked;
        
        try {
            // Attempt login
            const result = await this.backend.loginUser({
                email: email,
                password: password,
                rememberMe: rememberMe
            });
            
            if (result.success) {
                this.notification.show(result.message, 'success');
                
                // Redirect to dashboard or return URL after delay
                setTimeout(() => {
                    this.oauth.redirectAfterLogin();
                }, 2000);
            } else {
                this.notification.show(result.message, 'error');
                
                // Show specific error for unverified email
                if (result.message.includes('verify your email')) {
                    this.currentUserEmail = email;
                    setTimeout(() => {
                        this.showVerificationModal();
                    }, 2000);
                }
            }
        } catch (error) {
            this.notification.show('An unexpected error occurred. Please try again.', 'error');
        } finally {
            this.showLoading('login', false);
        }
    }
    
    async handleSignup() {
        // Check rate limiting
        if (!this.backend.checkRateLimit('signup')) {
            document.getElementById('signupRateLimit').classList.add('show');
            this.notification.show('Too many signup attempts. Please wait 15 minutes.', 'error');
            return;
        }
        
        // Validate form
        if (!this.validator.validateSignupForm()) {
            this.notification.show('Please fix the errors in the form', 'error');
            return;
        }
        
        // Show loading
        this.showLoading('signup', true);
        
        // Update rate limit
        this.backend.updateRateLimit('signup');
        
        // Get form data
        const name = document.getElementById('signupName').value;
        const email = document.getElementById('signupEmail').value;
        const password = document.getElementById('signupPassword').value;
        
        try {
            // Attempt registration
            const result = await this.backend.registerUser({
                name: name,
                email: email,
                password: password
            });
            
            if (result.success) {
                this.notification.show(result.message, 'success', 6000);
                this.currentUserEmail = email;
                
                // Show verification modal
                setTimeout(() => {
                    this.showVerificationModal();
                }, 2000);
                
                // Switch to login form after delay
                setTimeout(() => {
                    this.toggleForm();
                    // Pre-fill email in login form
                    document.getElementById('loginEmail').value = email;
                }, 4000);
            } else {
                this.notification.show(result.message, 'error');
            }
        } catch (error) {
            this.notification.show('An unexpected error occurred. Please try again.', 'error');
        } finally {
            this.showLoading('signup', false);
        }
    }
    
    handleEmailVerification(token) {
        const result = this.backend.verifyEmailToken(token);
        
        if (result.success) {
            this.notification.show(result.message, 'success', 6000);
            
            // Remove token from URL
            const url = new URL(window.location);
            url.searchParams.delete('token');
            window.history.replaceState({}, document.title, url);
            
            // Switch to login form
            if (this.isSignup) {
                setTimeout(() => {
                    this.toggleForm();
                }, 2000);
            }
        } else {
            this.notification.show(result.message, 'error');
        }
    }
    
    showVerificationModal() {
        document.getElementById('verificationModal').classList.add('show');
    }
    
    closeVerificationModal() {
        document.getElementById('verificationModal').classList.remove('show');
    }
    
    async resendVerificationEmail() {
        if (!this.currentUserEmail) {
            this.notification.show('No email address found. Please try signing up again.', 'error');
            return;
        }
        
        const result = await this.backend.resendVerificationEmail(this.currentUserEmail);
        
        if (result.success) {
            this.notification.show(result.message, 'success');
        } else {
            this.notification.show(result.message, 'error');
        }
    }
    
    showLoading(type, show) {
        const loadingElement = document.getElementById(`${type}Loading`);
        const buttonElement = document.getElementById(`${type}Button`);
        
        if (show) {
            loadingElement.classList.add('show');
            buttonElement.disabled = true;
            buttonElement.textContent = type === 'login' ? 'Logging in...' : 'Creating Account...';
        } else {
            loadingElement.classList.remove('show');
            buttonElement.disabled = false;
            buttonElement.textContent = type === 'login' ? 'Login' : 'Launch Account';
        }
    }
    
    toggleForm() {
        const container = document.getElementById('authContainer');
        this.isSignup = !this.isSignup;
        
        if (this.isSignup) {
            container.classList.add('active');
        } else {
            container.classList.remove('active');
        }
        
        // Clear form validation states
        setTimeout(() => {
            document.querySelectorAll('.form-control').forEach(input => {
                input.classList.remove('valid', 'invalid');
            });
            document.querySelectorAll('.validation-message').forEach(msg => {
                msg.textContent = '';
                msg.classList.remove('success', 'error');
            });
        }, 400);
    }
}

// ==================== GLOBAL FUNCTIONS ====================
function toggleForm() {
    if (window.authApp) {
        window.authApp.toggleForm();
    }
}

function closeVerificationModal() {
    if (window.authApp) {
        window.authApp.closeVerificationModal();
    }
}

function resendVerificationEmail() {
    if (window.authApp) {
        window.authApp.resendVerificationEmail();
    }
}

function closeOAuthModal() {
    if (window.authApp && window.authApp.oauth) {
        window.authApp.oauth.closeOAuthModal();
    }
}

// ==================== INITIALIZE APPLICATION ====================
document.addEventListener('DOMContentLoaded', function() {
    // Initialize the authentication application
    window.authApp = new AuthenticationApp();
    
    // Add some demo data for testing
    const demoUser = {
        name: 'Demo User',
        email: 'demo@example.com',
        password: 'Demo123!@#'
    };
    
    // Check if demo user exists, if not create one
    const users = JSON.parse(localStorage.getItem('users_db') || '[]');
    if (!users.some(u => u.email === demoUser.email)) {
        window.authApp.backend.registerUser(demoUser).then(result => {
            if (result.success) {
                // Auto-verify demo user
                const users = JSON.parse(localStorage.getItem('users_db'));
                const user = users.find(u => u.email === demoUser.email);
                if (user) {
                    user.verified = true;
                    localStorage.setItem('users_db', JSON.stringify(users));
                }
                
                console.log('Demo user created and verified:');
                console.log('Email: demo@example.com');
                console.log('Password: Demo123!@#');
            }
        });
    }
    
    // Add keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Alt + L to focus login email
        if (e.altKey && e.key === 'l') {
            e.preventDefault();
            document.getElementById('loginEmail').focus();
        }
        
        // Alt + S to switch to signup
        if (e.altKey && e.key === 's') {
            e.preventDefault();
            if (!window.authApp.isSignup) {
                window.authApp.toggleForm();
            }
            setTimeout(() => {
                document.getElementById('signupName').focus();
            }, 500);
        }
        
        // Escape to close modals
        if (e.key === 'Escape') {
            window.authApp.closeVerificationModal();
            if (window.authApp.oauth) {
                window.authApp.oauth.closeOAuthModal();
            }
        }
    });
    
    // Add accessibility improvements
    document.querySelectorAll('.form-control').forEach(input => {
        input.addEventListener('focus', function() {
            this.parentElement.classList.add('focused');
        });
        
        input.addEventListener('blur', function() {
            this.parentElement.classList.remove('focused');
        });
    });
    
    // Add loading states for better UX
    document.querySelectorAll('.btn').forEach(button => {
        button.addEventListener('click', function() {
            if (!this.disabled) {
                this.classList.add('clicked');
                setTimeout(() => {
                    this.classList.remove('clicked');
                }, 200);
            }
        });
    });
    
    // Console welcome message
    console.log(`
    üöÄ SmileX Advanced Authentication System Loaded!
    
    Demo Credentials:
    üìß Email: demo@example.com
    üîë Password: Demo123!@#
    
    Features:
    ‚úÖ User Registration with Email Verification
    ‚úÖ Secure Login with Password Hashing
    ‚úÖ Real OAuth 2.0 Integration (Google, Facebook, GitHub, X)
    ‚úÖ Rate Limiting Protection
    ‚úÖ Password Strength Validation
    ‚úÖ Session Management with Progress Tracking
    ‚úÖ Real-time Form Validation
    ‚úÖ Email Verification with HTML Templates
    ‚úÖ Return URL Tracking
    ‚úÖ Auto-save User Progress
    ‚úÖ Responsive Design
    ‚úÖ Accessibility Features
    
    OAuth Providers:
    üîç Google OAuth 2.0 with popup authentication
    üìò Facebook Login API integration
    üêô GitHub OAuth with user data fetching
    üê¶ X (Twitter) OAuth 2.0 implementation
    
    Keyboard Shortcuts:
    Alt + L: Focus Login Email
    Alt + S: Switch to Signup
    Escape: Close Modals
    
    Progress Tracking:
    üìä Auto-saves form data every 10 seconds
    üíæ Restores progress on page reload
    üîÑ Tracks user journey across pages
    `);
});

// ==================== SERVICE WORKER REGISTRATION ====================
if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
        // Register service worker for offline functionality
        navigator.serviceWorker.register('/sw.js').then(function(registration) {
            console.log('ServiceWorker registration successful');
        }, function(err) {
            console.log('ServiceWorker registration failed: ', err);
        });
    });
}

// ==================== ERROR HANDLING ====================
window.addEventListener('error', function(e) {
    console.error('Global error:', e.error);
    
    if (window.authApp && window.authApp.notification) {
        window.authApp.notification.show('An unexpected error occurred. Please refresh the page.', 'error');
    }
});

window.addEventListener('unhandledrejection', function(e) {
    console.error('Unhandled promise rejection:', e.reason);
    
    if (window.authApp && window.authApp.notification) {
        window.authApp.notification.show('A network error occurred. Please check your connection.', 'error');
    }
});

// ==================== OAUTH CALLBACK HANDLERS ====================
// These would be used in your OAuth callback pages

// Google OAuth callback handler
function handleGoogleOAuthCallback() {
    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get('code');
    const state = urlParams.get('state');
    
    if (code && state) {
        // Send message to parent window
        window.opener.postMessage({
            type: 'oauth-callback',
            provider: 'google',
            success: true,
            code: code,
            state: state
        }, window.location.origin);
        
        window.close();
    }
}

// GitHub OAuth callback handler
function handleGitHubOAuthCallback() {
    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get('code');
    const state = urlParams.get('state');
    
    if (code && state) {
        // In a real implementation, you would exchange the code for an access token
        // and fetch user data from GitHub API
        
        // Simulate user data
        const mockUser = {
            id: 'github_user_123',
            login: 'githubuser',
            name: 'GitHub User',
            email: 'user@github.com',
            avatar_url: 'https://via.placeholder.com/150'
        };
        
        // Send message to parent window
        window.opener.postMessage({
            type: 'oauth-callback',
            provider: 'github',
            success: true,
            user: mockUser,
            state: state
        }, window.location.origin);
        
        window.close();
    }
}

// Twitter OAuth callback handler
function handleTwitterOAuthCallback() {
    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get('code');
    const state = urlParams.get('state');
    
    if (code && state) {
        // Simulate user data
        const mockUser = {
            id: 'twitter_user_123',
            name: 'X User',
            username: 'xuser',
            email: 'user@twitter.com',
            profile_image_url: 'https://via.placeholder.com/150'
        };
        
        // Send message to parent window
        window.opener.postMessage({
            type: 'oauth-callback',
            provider: 'twitter',
            success: true,
            user: mockUser,
            state: state
        }, window.location.origin);
        
        window.close();
    }
}
</script>
</body>
</html>