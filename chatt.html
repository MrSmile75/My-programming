<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmileX - Advanced Social Platform</title>
    <meta name="description" content="SmileX - A modern social platform for connecting communities and sharing experiences">
    <meta name="keywords" content="social media, communities, chat, posts, networking">
    
    <!-- Fonts and Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* Color Variables */
            --primary-color: #6a11cb;
            --secondary-color: #2575fc;
            --accent-color: #00b4db;
            --background-color: #000000;
            --surface-color: #1a1a1a;
            --surface-secondary: #2a2a2a;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --text-muted: #666666;
            --border-color: #404040;
            --success-color: #10b981;
            --error-color: #ef4444;
            --warning-color: #f59e0b;
            --premium-gold: #ffd700;
            --premium-gradient: linear-gradient(45deg, #ffd700, #ffed4e, #ffd700);
            --online-color: #22c55e;
            --away-color: #f59e0b;
            --busy-color: #ef4444;
            
            /* Spacing Variables */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
            
            /* Typography Variables */
            --font-primary: 'Orbitron', sans-serif;
            --font-secondary: 'Poppins', sans-serif;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 2rem;
            
            /* Border Radius Variables */
            --radius-sm: 0.25rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-full: 9999px;
            
            /* Shadow Variables */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            
            /* Transition Variables */
            --transition-fast: 0.15s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            background: var(--background-color);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Accessibility Improvements */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus Styles for Accessibility */
        *:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        button:focus,
        input:focus,
        select:focus,
        textarea:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* Skip Link for Screen Readers */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--primary-color);
            color: white;
            padding: 8px;
            text-decoration: none;
            border-radius: var(--radius-md);
            z-index: 10000;
        }

        .skip-link:focus {
            top: 6px;
        }

        /* Preloader Styles */
        .preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: var(--transition-slow);
        }

        .preloader-logo {
            font-size: var(--font-size-3xl);
            margin-bottom: var(--spacing-md);
            animation: bounce 2s infinite;
        }

        .preloader-text {
            font-size: var(--font-size-2xl);
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient 3s ease infinite;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-top: var(--spacing-xl);
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-30px); }
            60% { transform: translateY(-15px); }
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Premium Animations */
        @keyframes disco {
            0% { color: #ff0000; text-shadow: 0 0 10px #ff0000; }
            16% { color: #ff8000; text-shadow: 0 0 10px #ff8000; }
            33% { color: #ffff00; text-shadow: 0 0 10px #ffff00; }
            50% { color: #00ff00; text-shadow: 0 0 10px #00ff00; }
            66% { color: #0080ff; text-shadow: 0 0 10px #0080ff; }
            83% { color: #8000ff; text-shadow: 0 0 10px #8000ff; }
            100% { color: #ff0080; text-shadow: 0 0 10px #ff0080; }
        }

        @keyframes premium-glow {
            0%, 100% { box-shadow: 0 0 20px var(--premium-gold); }
            50% { box-shadow: 0 0 40px var(--premium-gold), 0 0 60px var(--premium-gold); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        @keyframes glow {
            from { text-shadow: 0 0 5px var(--warning-color); }
            to { text-shadow: 0 0 20px var(--warning-color), 0 0 30px var(--warning-color); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes typing {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }

        /* Premium Styles */
        .premium-user {
            position: relative;
        }

        .premium-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: var(--premium-gradient);
            color: #000;
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            font-size: 10px;
            font-weight: bold;
            animation: premium-glow 2s ease-in-out infinite;
        }

        .disco-text {
            animation: disco 2s linear infinite;
            font-weight: bold;
        }

        .premium-emoji {
            font-size: 1.2em;
            animation: float 2s ease-in-out infinite;
        }

        /* Online Status Indicators */
        .status-indicator {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid var(--surface-color);
        }

        .status-online { background: var(--online-color); }
        .status-away { background: var(--away-color); }
        .status-busy { background: var(--error-color); }
        .status-offline { background: var(--text-muted); }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
            color: var(--text-muted);
            font-size: var(--font-size-xs);
            font-style: italic;
        }

        .typing-dots {
            display: flex;
            gap: 2px;
        }

        .typing-dot {
            width: 4px;
            height: 4px;
            background: var(--text-muted);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        /* Modal Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-normal);
        }

        .overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Onboarding Modal */
        .onboarding-container {
            background: var(--surface-color);
            padding: var(--spacing-xl);
            border-radius: var(--radius-xl);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            transform: scale(0.9);
            transition: var(--transition-normal);
        }

        .overlay.active .onboarding-container {
            transform: scale(1);
        }

        .onboarding-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
        }

        .onboarding-header h2 {
            font-size: var(--font-size-2xl);
            margin-bottom: var(--spacing-sm);
            color: var(--primary-color);
        }

        /* Profile Picture Upload */
        .profile-upload-section {
            text-align: center;
            margin-bottom: var(--spacing-lg);
        }

        .profile-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto var(--spacing-md);
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: var(--font-size-3xl);
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .profile-preview:hover {
            transform: scale(1.05);
        }

        .profile-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .profile-upload-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: var(--transition-fast);
            border-radius: 50%;
        }

        .profile-preview:hover .profile-upload-overlay {
            opacity: 1;
        }

        .profile-upload-buttons {
            display: flex;
            gap: var(--spacing-sm);
            justify-content: center;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: var(--spacing-md);
        }

        .form-label {
            display: block;
            margin-bottom: var(--spacing-xs);
            font-weight: 500;
            color: var(--text-secondary);
        }

        .form-control, .form-select {
            width: 100%;
            padding: 12px;
            background: var(--surface-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: var(--font-size-sm);
            transition: var(--transition-fast);
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(106, 17, 203, 0.2);
        }

        .form-control::placeholder {
            color: var(--text-muted);
        }

        .name-validation {
            margin-top: var(--spacing-xs);
            font-size: var(--font-size-xs);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .name-available {
            color: var(--success-color);
        }

        .name-taken {
            color: var(--error-color);
        }

        /* Consent Section */
        .consent-section {
            margin: var(--spacing-lg) 0;
            padding: var(--spacing-md);
            background: var(--surface-secondary);
            border-radius: var(--radius-md);
        }

        .consent-item {
            display: flex;
            align-items: center;
            margin: var(--spacing-sm) 0;
        }

        .consent-item input[type="checkbox"] {
            margin-right: var(--spacing-sm);
            width: 16px;
            height: 16px;
        }

        .consent-item label {
            cursor: pointer;
            user-select: none;
        }

        /* Button Styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-fast);
            text-decoration: none;
            gap: var(--spacing-xs);
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #5a0fb8;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--surface-secondary);
            color: var(--text-secondary);
        }

        .btn-secondary:hover {
            background: var(--border-color);
            color: var(--text-primary);
        }

        .btn-premium {
            background: var(--premium-gradient);
            color: #000;
            font-weight: bold;
            animation: premium-glow 2s ease-in-out infinite;
        }

        .btn:disabled {
            background: var(--border-color);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Navigation */
        nav {
            background: var(--background-color);
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 50;
            border-bottom: 1px solid var(--border-color);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-md);
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 64px;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: var(--font-size-xl);
            font-weight: bold;
            color: var(--primary-color);
            text-decoration: none;
        }

        .logo i {
            margin-right: var(--spacing-sm);
            font-size: var(--font-size-2xl);
        }

        .nav-search {
            position: relative;
            display: none;
        }

        @media (min-width: 768px) {
            .nav-search {
                display: block;
            }
        }

        .nav-search input {
            width: 300px;
            padding: 8px 12px 8px 40px;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            color: var(--text-primary);
            font-size: var(--font-size-sm);
        }

        .nav-search i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            max-height: 400px;
            overflow-y: auto;
            z-index: 100;
            margin-top: 4px;
        }

        .search-result-item {
            padding: var(--spacing-sm) var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .search-result-item:hover {
            background: var(--surface-secondary);
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-type {
            font-size: var(--font-size-xs);
            color: var(--text-muted);
            text-transform: uppercase;
            font-weight: bold;
        }

        .search-result-title {
            font-weight: 500;
            margin: var(--spacing-xs) 0;
        }

        .search-result-description {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .nav-button {
            padding: var(--spacing-sm);
            background: var(--surface-color);
            border: none;
            border-radius: 50%;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition-fast);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .nav-button:hover {
            background: var(--surface-secondary);
            color: var(--primary-color);
        }

        .notification-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background: var(--error-color);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: var(--font-size-sm);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .user-avatar.premium {
            border: 2px solid var(--premium-gold);
            animation: premium-glow 2s ease-in-out infinite;
        }

        /* Main Layout */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--spacing-lg) var(--spacing-md);
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-lg);
        }

        @media (min-width: 1024px) {
            .main-container {
                grid-template-columns: 250px 1fr 250px;
            }
        }

        /* Sidebar */
        .sidebar {
            background: var(--surface-color);
            border-radius: var(--radius-xl);
            padding: var(--spacing-lg);
            height: fit-content;
            position: sticky;
            top: 80px;
            display: none;
        }

        @media (min-width: 1024px) {
            .sidebar {
                display: block;
            }
        }

        .sidebar h3 {
            font-size: var(--font-size-lg);
            margin-bottom: var(--spacing-md);
            color: var(--primary-color);
        }

        .sidebar ul {
            list-style: none;
        }

        .sidebar li {
            margin-bottom: var(--spacing-sm);
        }

        .sidebar a {
            display: flex;
            align-items: center;
            padding: var(--spacing-sm);
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: var(--radius-md);
            transition: var(--transition-fast);
        }

        .sidebar a:hover {
            background: var(--surface-secondary);
            color: var(--primary-color);
        }

        /* Community Icons */
        .community-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: var(--spacing-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: var(--font-size-xs);
            font-weight: bold;
        }

        /* Main Feed */
        .main-feed {
            min-height: 100vh;
        }

        /* Create Post Card */
        .create-post-card {
            background: var(--surface-color);
            border-radius: var(--radius-xl);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-md);
        }

        .create-post-input {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        .create-post-input input {
            flex: 1;
            padding: 12px 16px;
            background: var(--surface-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            color: var(--text-primary);
            cursor: pointer;
        }

        .post-type-buttons {
            display: flex;
            gap: var(--spacing-sm);
        }

        .post-type-button {
            flex: 1;
            padding: var(--spacing-sm) var(--spacing-md);
            background: transparent;
            color: var(--text-secondary);
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            font-size: var(--font-size-sm);
        }

        .post-type-button:hover {
            background: var(--surface-secondary);
            color: var(--primary-color);
        }

        /* Sort Buttons */
        .sort-buttons {
            background: var(--surface-color);
            border-radius: var(--radius-xl);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            display: flex;
            gap: var(--spacing-sm);
            overflow-x: auto;
        }

        .sort-button {
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-full);
            border: none;
            font-size: var(--font-size-sm);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-fast);
            white-space: nowrap;
        }

        .sort-button.active {
            background: var(--primary-color);
            color: white;
        }

        .sort-button:not(.active) {
            background: var(--surface-secondary);
            color: var(--text-secondary);
        }

        .sort-button:not(.active):hover {
            background: var(--border-color);
        }

        /* Post Cards */
        .post-card {
            background: var(--surface-color);
            border-radius: var(--radius-xl);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-md);
            transition: var(--transition-normal);
            animation: fadeIn 0.5s ease;
            cursor: pointer;
        }

        .post-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .post-content {
            padding: var(--spacing-lg);
            display: flex;
            gap: var(--spacing-md);
        }

        /* Vote Section */
        .vote-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .vote-button {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: var(--font-size-lg);
            cursor: pointer;
            padding: var(--spacing-xs);
            border-radius: var(--radius-sm);
            transition: var(--transition-fast);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .vote-button:hover {
            background: var(--surface-secondary);
        }

        .vote-button.voted-up {
            color: var(--primary-color);
        }

        .vote-button.voted-down {
            color: var(--secondary-color);
        }

        .vote-count {
            font-weight: bold;
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }

        /* Post Main Content */
        .post-main {
            flex: 1;
        }

        .post-meta {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-size: var(--font-size-xs);
            color: var(--text-muted);
            margin-bottom: var(--spacing-sm);
        }

        .post-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            margin-bottom: var(--spacing-md);
            color: var(--text-primary);
            line-height: 1.4;
        }

        .post-text {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-md);
            line-height: 1.6;
        }

        .post-image, .post-video {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
            cursor: pointer;
        }

        .media-grid {
            display: grid;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }

        .media-grid.single {
            grid-template-columns: 1fr;
        }

        .media-grid.double {
            grid-template-columns: 1fr 1fr;
        }

        .media-grid.multiple {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }

        /* Post Actions */
        .post-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .post-action-buttons {
            display: flex;
            gap: var(--spacing-md);
        }

        .post-action-button {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: var(--font-size-sm);
            cursor: pointer;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .post-action-button:hover {
            background: var(--surface-secondary);
            color: var(--primary-color);
        }

        /* Comments Section */
        .comments-section {
            border-top: 1px solid var(--border-color);
            padding: var(--spacing-md) var(--spacing-lg);
            display: none;
        }

        .comments-section.active {
            display: block;
        }

        .comment-input {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
            align-items: center;
        }

        .comment-input input {
            flex: 1;
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--surface-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            color: var(--text-primary);
        }

        .emoji-picker-btn {
            background: var(--surface-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: var(--spacing-sm);
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .emoji-picker-btn:hover {
            background: var(--border-color);
            color: var(--primary-color);
        }

        .emoji-picker {
            position: absolute;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            display: none;
            grid-template-columns: repeat(8, 1fr);
            gap: var(--spacing-xs);
            z-index: 100;
            max-width: 300px;
        }

        .emoji-picker.active {
            display: grid;
        }

        .emoji-item {
            padding: var(--spacing-xs);
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: var(--transition-fast);
            text-align: center;
        }

        .emoji-item:hover {
            background: var(--surface-secondary);
        }

        .comment {
            background: var(--surface-secondary);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-sm);
            position: relative;
        }

        .comment.reply {
            margin-left: var(--spacing-xl);
            border-left: 2px solid var(--primary-color);
        }

        .comment-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-xs);
        }

        .comment-author {
            font-weight: bold;
            color: var(--primary-color);
            font-size: var(--font-size-xs);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .comment-time {
            font-size: 11px;
            color: var(--text-muted);
        }

        .comment-text {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            margin-bottom: var(--spacing-xs);
        }

        .comment-actions {
            display: flex;
            gap: var(--spacing-md);
            font-size: 11px;
        }

        .comment-action {
            color: var(--text-muted);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .comment-action:hover {
            color: var(--primary-color);
        }

        /* Precise Timestamp */
        .precise-timestamp {
            font-size: 10px;
            color: var(--text-muted);
            font-family: monospace;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-normal);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--surface-color);
            border-radius: var(--radius-xl);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
        }

        .modal-header {
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: var(--font-size-xl);
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: var(--font-size-lg);
            cursor: pointer;
            padding: var(--spacing-xs);
            border-radius: var(--radius-sm);
            transition: var(--transition-fast);
        }

        .modal-close:hover {
            color: var(--text-primary);
            background: var(--surface-secondary);
        }

        .modal-body {
            padding: var(--spacing-lg);
        }

        .modal-footer {
            padding: var(--spacing-lg);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-sm);
        }

        /* Image/Video Upload Area */
        .media-upload-area {
            border: 2px dashed var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-xl);
            text-align: center;
            margin: var(--spacing-md) 0;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .media-upload-area:hover,
        .media-upload-area.dragover {
            border-color: var(--primary-color);
            background: rgba(106, 17, 203, 0.1);
        }

        .media-preview {
            max-width: 100%;
            max-height: 300px;
            border-radius: var(--radius-md);
            margin: var(--spacing-md) 0;
        }

        .media-preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--spacing-sm);
            margin: var(--spacing-md) 0;
        }

        .media-preview-item {
            position: relative;
            border-radius: var(--radius-md);
            overflow: hidden;
        }

        .media-preview-item img,
        .media-preview-item video {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .media-remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Enhanced Chat Styles */
        .chat-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border: none;
            color: white;
            font-size: var(--font-size-xl);
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: var(--transition-fast);
            z-index: 100;
        }

        .chat-toggle:hover {
            transform: scale(1.1);
        }

        .chat-container {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 350px;
            height: 500px;
            background: var(--surface-color);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            display: flex;
            flex-direction: column;
            transform: translateY(100%);
            opacity: 0;
            transition: var(--transition-normal);
            z-index: 99;
            border: 1px solid var(--border-color);
        }

        .chat-container.active {
            transform: translateY(0);
            opacity: 1;
        }

        .chat-header {
            padding: var(--spacing-md);
            background: var(--primary-color);
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header h3 {
            color: white;
            font-size: var(--font-size-base);
        }

        .chat-close {
            background: none;
            border: none;
            color: white;
            font-size: var(--font-size-lg);
            cursor: pointer;
            padding: var(--spacing-xs);
            border-radius: var(--radius-sm);
            transition: var(--transition-fast);
        }

        .chat-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .chat-messages {
            flex: 1;
            padding: var(--spacing-md);
            overflow-y: auto;
        }

        .message {
            margin-bottom: var(--spacing-md);
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--surface-secondary);
            border-radius: var(--radius-md);
        }

        .message.user {
            background: var(--primary-color);
            margin-left: var(--spacing-lg);
        }

        .message.agent {
            background: var(--surface-secondary);
            margin-right: var(--spacing-lg);
        }

        .message-user {
            font-weight: bold;
            color: var(--primary-color);
            font-size: var(--font-size-xs);
            margin-bottom: var(--spacing-xs);
        }

        .message.user .message-user {
            color: white;
        }

        .message-text {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            margin-bottom: var(--spacing-xs);
        }

        .message.user .message-text {
            color: white;
        }

        .message-time {
            font-size: 11px;
            color: var(--text-muted);
        }

        .message.user .message-time {
            color: rgba(255, 255, 255, 0.7);
        }

        .chat-input-container {
            padding: var(--spacing-md);
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: var(--spacing-sm);
        }

        .chat-input {
            flex: 1;
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--surface-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            color: var(--text-primary);
        }

        .chat-send {
            background: var(--primary-color);
            border: none;
            color: white;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .chat-send:hover {
            background: #5a0fb8;
        }

        /* Direct Messages Panel */
        .dm-panel {
            position: fixed;
            top: 64px;
            right: -400px;
            width: 400px;
            height: calc(100vh - 64px);
            background: var(--surface-color);
            border-left: 1px solid var(--border-color);
            transition: var(--transition-normal);
            z-index: 90;
            display: flex;
            flex-direction: column;
        }

        .dm-panel.active {
            right: 0;
        }

        .dm-header {
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dm-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
        }

        .dm-tab {
            flex: 1;
            padding: var(--spacing-md);
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .dm-tab.active {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
        }

        .dm-content {
            flex: 1;
            overflow-y: auto;
        }

        .dm-list {
            padding: var(--spacing-md);
        }

        .dm-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            margin-bottom: var(--spacing-sm);
        }

        .dm-item:hover {
            background: var(--surface-secondary);
        }

        .dm-item.active {
            background: var(--primary-color);
            color: white;
        }

        .dm-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            position: relative;
        }

        .dm-info {
            flex: 1;
        }

        .dm-name {
            font-weight: 500;
            margin-bottom: 2px;
        }

        .dm-preview {
            font-size: var(--font-size-xs);
            color: var(--text-muted);
        }

        .dm-time {
            font-size: var(--font-size-xs);
            color: var(--text-muted);
        }

        .unread-badge {
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Group Chat Styles */
        .group-chat-item {
            border-left: 3px solid var(--accent-color);
        }

        .group-members {
            display: flex;
            margin-top: var(--spacing-xs);
        }

        .group-member-avatar {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--secondary-color);
            margin-right: -5px;
            border: 2px solid var(--surface-color);
        }

        /* Chat Channel Styles */
        .channel-list {
            padding: var(--spacing-md);
        }

        .channel-category {
            font-size: var(--font-size-xs);
            color: var(--text-muted);
            text-transform: uppercase;
            font-weight: bold;
            margin: var(--spacing-lg) 0 var(--spacing-sm) 0;
        }

        .channel-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            margin-bottom: var(--spacing-xs);
        }

        .channel-item:hover {
            background: var(--surface-secondary);
        }

        .channel-item.active {
            background: var(--primary-color);
            color: white;
        }

        .channel-icon {
            font-size: var(--font-size-sm);
            color: var(--text-muted);
        }

        .channel-name {
            flex: 1;
            font-size: var(--font-size-sm);
        }

        .channel-count {
            font-size: var(--font-size-xs);
            color: var(--text-muted);
        }

        /* Mobile Navigation */
        .mobile-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--surface-color);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 64px;
            z-index: 50;
        }

        @media (min-width: 1024px) {
            .mobile-nav {
                display: none;
            }
        }

        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            text-decoration: none;
            transition: var(--transition-fast);
            padding: var(--spacing-sm);
            border-radius: var(--radius-md);
        }

        .mobile-nav-item.active,
        .mobile-nav-item:hover {
            color: var(--primary-color);
        }

        .mobile-nav-item i {
            font-size: var(--font-size-lg);
            margin-bottom: var(--spacing-xs);
        }

        .mobile-nav-item span {
            font-size: 10px;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary-color);
            color: white;
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            transform: translateX(100%);
            opacity: 0;
            transition: var(--transition-normal);
            z-index: 1001;
        }

        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        /* Poll Styles */
        .poll-container {
            background: var(--surface-secondary);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
        }

        .poll-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-sm) var(--spacing-md);
            margin-bottom: var(--spacing-sm);
            background: var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            position: relative;
            overflow: hidden;
        }

        .poll-option:hover {
            background: #505050;
        }

        .poll-option.voted {
            cursor: default;
        }

        .poll-option-bar {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            opacity: 0.3;
            transition: width 0.5s ease;
        }

        .poll-option-text,
        .poll-option-percentage {
            position: relative;
            z-index: 1;
        }

        .poll-option-percentage {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
        }

        .poll-stats {
            margin-top: var(--spacing-sm);
            font-size: 11px;
            color: var(--text-muted);
            text-align: center;
        }

        /* Community Colors */
        .bg-blue-500 { background-color: #3b82f6; }
        .bg-red-500 { background-color: #ef4444; }
        .bg-green-500 { background-color: var(--success-color); }
        .bg-purple-500 { background-color: var(--primary-color); }
        .bg-gray-500 { background-color: #6b7280; }
        .bg-yellow-500 { background-color: var(--warning-color); }
        .bg-pink-500 { background-color: #ec4899; }
        .bg-indigo-500 { background-color: #6366f1; }

        /* Live Features */
        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            color: var(--error-color);
            font-size: var(--font-size-xs);
            font-weight: bold;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: var(--error-color);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        /* Premium Features */
        .premium-section {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border-radius: var(--radius-xl);
            padding: var(--spacing-lg);
            margin-top: var(--spacing-xl);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .premium-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 3s infinite;
        }

        .premium-content {
            position: relative;
            z-index: 1;
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .loading {
            opacity: 0.5;
            pointer-events: none;
        }

        .text-center {
            text-align: center;
        }

        .mb-4 {
            margin-bottom: var(--spacing-md);
        }

        .mt-4 {
            margin-top: var(--spacing-md);
        }

        /* Feature Badges */
        .feature-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 6px;
            background: var(--primary-color);
            color: white;
            border-radius: var(--radius-sm);
            font-size: 10px;
            font-weight: bold;
        }

        .trending-indicator {
            color: var(--warning-color);
            animation: glow 2s ease-in-out infinite alternate;
        }

        /* Real-time Activity Indicator */
        .activity-indicator {
            position: fixed;
            top: 80px;
            right: 20px;
            background: var(--success-color);
            color: white;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
            font-weight: bold;
            z-index: 100;
            animation: fadeIn 0.3s ease;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-container {
                padding: var(--spacing-md) var(--spacing-sm);
                padding-bottom: 80px;
            }
            
            .post-content {
                padding: var(--spacing-md);
            }
            
            .chat-container {
                width: calc(100vw - 40px);
                right: 20px;
                left: 20px;
            }

            .modal-content {
                width: 95%;
                margin: var(--spacing-md);
            }

            .dm-panel {
                width: 100vw;
                right: -100vw;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--surface-color);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }

        /* High Contrast Mode Support */
        @media (prefers-contrast: high) {
            :root {
                --text-primary: #ffffff;
                --text-secondary: #ffffff;
                --background-color: #000000;
                --surface-color: #000000;
                --border-color: #ffffff;
            }
        }

        /* Reduced Motion Support */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <!-- Skip Link for Screen Readers -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Preloader -->
    <div id="preloader" class="preloader" role="status" aria-label="Loading SmileX">
        <div class="preloader-logo" aria-hidden="true">
            <i class="fas fa-smile-beam"></i>
        </div>
        <div class="preloader-text">SmileX</div>
        <div class="loading-spinner"></div>
        <span class="sr-only">Loading application...</span>
    </div>

    <!-- Real-time Activity Indicator -->
    <div id="activityIndicator" class="activity-indicator hidden">
        <i class="fas fa-circle live-dot"></i>
        <span id="activityText">Live Activity</span>
    </div>

    <!-- Onboarding Modal -->
    <div class="overlay" id="onboardingOverlay" role="dialog" aria-labelledby="onboarding-title" aria-modal="true">
        <div class="onboarding-container">
            <header class="onboarding-header">
                <h2 id="onboarding-title">
                    <i class="fas fa-user-circle" aria-hidden="true"></i> 
                    Welcome to SmileX
                </h2>
                <p>Complete your profile to join our community</p>
            </header>

            <form id="registrationForm" novalidate>
                <!-- Profile Picture Upload Section -->
                <div class="profile-upload-section">
                    <div class="profile-preview" id="profilePreview">
                        <span id="profileInitial">?</span>
                        <div class="profile-upload-overlay">
                            <i class="fas fa-camera"></i>
                        </div>
                    </div>
                    <div class="profile-upload-buttons">
                        <button type="button" class="btn btn-secondary" onclick="openFileUpload()">
                            <i class="fas fa-upload"></i> Upload
                        </button>
                    </div>
                    <input type="file" id="profileImageInput" accept="image/*" style="display: none;">
                </div>

                <div class="form-group">
                    <label for="fullName" class="form-label">
                        <i class="fas fa-user" aria-hidden="true"></i> Full Name
                    </label>
                    <input type="text" 
                           id="fullName" 
                           name="fullName" 
                           class="form-control" 
                           placeholder="Enter your full name" 
                           required>
                    <div id="nameValidation" class="name-validation" style="display: none;"></div>
                </div>

                <div class="form-group">
                    <label for="email" class="form-label">
                        <i class="fas fa-envelope" aria-hidden="true"></i> Email Address
                    </label>
                    <input type="email" 
                           id="email" 
                           name="email" 
                           class="form-control" 
                           placeholder="your.email@example.com" 
                           required>
                </div>

                <div style="display: flex; gap: 15px;">
                    <div class="form-group" style="flex: 1;">
                        <label for="gender" class="form-label">
                            <i class="fas fa-venus-mars" aria-hidden="true"></i> Gender
                        </label>
                        <select id="gender" name="gender" class="form-select" required>
                            <option value="">Select Gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                            <option value="prefer-not-to-say">Prefer not to say</option>
                        </select>
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label for="country" class="form-label">
                            <i class="fas fa-globe" aria-hidden="true"></i> Country
                        </label>
                        <select id="country" name="country" class="form-select" required>
                            <option value="">Select Country</option>
                            <option value="US">United States</option>
                            <option value="UK">United Kingdom</option>
                            <option value="CA">Canada</option>
                            <option value="AU">Australia</option>
                            <option value="DE">Germany</option>
                            <option value="FR">France</option>
                            <option value="JP">Japan</option>
                            <option value="IN">India</option>
                            <option value="BR">Brazil</option>
                            <option value="NG">Nigeria</option>
                            <option value="ZA">South Africa</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <fieldset class="consent-section">
                    <legend>
                        <h4><i class="fas fa-shield-alt" aria-hidden="true"></i> Platform Consent</h4>
                    </legend>
                    <div class="consent-item">
                        <input type="checkbox" id="ageConsent" name="ageConsent" required>
                        <label for="ageConsent">I am 13 years or older</label>
                    </div>
                    <div class="consent-item">
                        <input type="checkbox" id="termsConsent" name="termsConsent" required>
                        <label for="termsConsent">I agree to the Terms of Service</label>
                    </div>
                    <div class="consent-item">
                        <input type="checkbox" id="privacyConsent" name="privacyConsent" required>
                        <label for="privacyConsent">I consent to privacy policy</label>
                    </div>
                </fieldset>

                <button type="submit" id="submitBtn" class="btn btn-primary" disabled style="width: 100%;">
                    <i class="fas fa-paper-plane" aria-hidden="true"></i> Join SmileX
                </button>
            </form>
        </div>
    </div>

    <!-- Main Navigation -->
    <nav role="navigation" aria-label="Main navigation">
        <div class="nav-container">
            <a href="#" class="logo" aria-label="SmileX Home">
                <i class="fas fa-smile-beam" aria-hidden="true"></i>
                <span>SmileX</span>
            </a>

            <div class="nav-search" role="search">
                <label for="searchInput" class="sr-only">Search Everything</label>
                <input type="text" 
                       id="searchInput" 
                       placeholder="Search posts, communities, users...">
                <i class="fas fa-search" aria-hidden="true"></i>
                <div id="searchResults" class="search-results hidden" role="listbox" aria-label="Search results"></div>
            </div>

            <div class="nav-actions">
                <button class="nav-button" 
                        id="themeToggle" 
                        aria-label="Toggle dark mode"
                        title="Toggle Theme">
                    <i class="fas fa-moon" aria-hidden="true"></i>
                </button>
                <button class="nav-button" 
                        id="dmToggle" 
                        aria-label="Toggle direct messages"
                        title="Direct Messages">
                    <i class="fas fa-envelope" aria-hidden="true"></i>
                    <span class="notification-badge" id="dmBadge" style="display: none;">0</span>
                </button>
                <button class="nav-button" 
                        id="notificationBtn" 
                        aria-label="View notifications"
                        title="Notifications">
                    <i class="fas fa-bell" aria-hidden="true"></i>
                    <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                </button>
                <div class="user-avatar" 
                     id="userAvatar" 
                     role="img" 
                     aria-label="User avatar">
                    <span id="userInitial">U</span>
                    <div class="status-indicator status-online"></div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Direct Messages Panel -->
    <div id="dmPanel" class="dm-panel">
        <div class="dm-header">
            <h3><i class="fas fa-envelope"></i> Messages</h3>
            <button id="closeDmPanel" class="modal-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="dm-tabs">
            <button class="dm-tab active" data-tab="dms">
                <i class="fas fa-user"></i> Direct Messages
            </button>
            <button class="dm-tab" data-tab="groups">
                <i class="fas fa-users"></i> Groups
            </button>
            <button class="dm-tab" data-tab="channels">
                <i class="fas fa-hashtag"></i> Channels
            </button>
        </div>

        <div class="dm-content">
            <!-- Direct Messages Tab -->
            <div id="dmsTab" class="dm-list">
                <div class="dm-item active">
                    <div class="dm-avatar">
                        A
                        <div class="status-indicator status-online"></div>
                    </div>
                    <div class="dm-info">
                        <div class="dm-name">Alex Johnson</div>
                        <div class="dm-preview">Hey! How's the new feature coming along?</div>
                    </div>
                    <div style="text-align: right;">
                        <div class="dm-time">2m</div>
                        <div class="unread-badge">2</div>
                    </div>
                </div>

                <div class="dm-item">
                    <div class="dm-avatar">
                        S
                        <div class="status-indicator status-away"></div>
                    </div>
                    <div class="dm-info">
                        <div class="dm-name">Sarah Chen</div>
                        <div class="dm-preview">Thanks for the help with the design!</div>
                    </div>
                    <div class="dm-time">1h</div>
                </div>

                <div class="dm-item">
                    <div class="dm-avatar">
                        M
                        <div class="status-indicator status-offline"></div>
                    </div>
                    <div class="dm-info">
                        <div class="dm-name">Mike Rodriguez</div>
                        <div class="dm-preview">Let's schedule that meeting for tomorrow</div>
                    </div>
                    <div class="dm-time">3h</div>
                </div>
            </div>

            <!-- Group Chats Tab -->
            <div id="groupsTab" class="dm-list hidden">
                <div class="dm-item group-chat-item">
                    <div class="dm-avatar">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="dm-info">
                        <div class="dm-name">Design Team</div>
                        <div class="dm-preview">Sarah: The mockups are ready for review</div>
                        <div class="group-members">
                            <div class="group-member-avatar"></div>
                            <div class="group-member-avatar"></div>
                            <div class="group-member-avatar"></div>
                            <span style="font-size: 10px; color: var(--text-muted);">+5 more</span>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div class="dm-time">15m</div>
                        <div class="unread-badge">5</div>
                    </div>
                </div>

                <div class="dm-item group-chat-item">
                    <div class="dm-avatar">
                        <i class="fas fa-code"></i>
                    </div>
                    <div class="dm-info">
                        <div class="dm-name">Dev Squad</div>
                        <div class="dm-preview">Alex: Bug fix deployed to staging</div>
                        <div class="group-members">
                            <div class="group-member-avatar"></div>
                            <div class="group-member-avatar"></div>
                            <div class="group-member-avatar"></div>
                        </div>
                    </div>
                    <div class="dm-time">1h</div>
                </div>
            </div>

            <!-- Chat Channels Tab -->
            <div id="channelsTab" class="channel-list hidden">
                <div class="channel-category">SmileX Official</div>
                
                <div class="channel-item active">
                    <div class="channel-icon">
                        <i class="fas fa-hashtag"></i>
                    </div>
                    <div class="channel-name">general</div>
                    <div class="channel-count">1.2k</div>
                </div>

                <div class="channel-item">
                    <div class="channel-icon">
                        <i class="fas fa-bullhorn"></i>
                    </div>
                    <div class="channel-name">announcements</div>
                    <div class="channel-count">847</div>
                </div>

                <div class="channel-item">
                    <div class="channel-icon">
                        <i class="fas fa-question-circle"></i>
                    </div>
                    <div class="channel-name">help-support</div>
                    <div class="channel-count">234</div>
                </div>

                <div class="channel-category">Communities</div>

                <div class="channel-item">
                    <div class="channel-icon">
                        <i class="fas fa-gamepad"></i>
                    </div>
                    <div class="channel-name">gaming</div>
                    <div class="channel-count">567</div>
                </div>

                <div class="channel-item">
                    <div class="channel-icon">
                        <i class="fas fa-palette"></i>
                    </div>
                    <div class="channel-name">design</div>
                    <div class="channel-count">123</div>
                </div>

                <div class="channel-item">
                    <div class="channel-icon">
                        <i class="fas fa-music"></i>
                    </div>
                    <div class="channel-name">music</div>
                    <div class="channel-count">89</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main id="main-content" class="main-container">
        <!-- Left Sidebar -->
        <aside class="sidebar" role="complementary" aria-label="Community navigation">
            <section>
                <h3><i class="fas fa-users" aria-hidden="true"></i> My Communities</h3>
                <ul id="communitiesList" role="list">
                    <li>
                        <a href="#" style="display: flex; align-items: center;">
                            <div class="community-icon bg-purple-500">S</div>
                            <div>
                                <div style="font-weight: 500;">SmileX Official</div>
                                <div style="font-size: 11px; color: var(--text-muted);">127k members</div>
                            </div>
                        </a>
                    </li>
                    <li>
                        <a href="#" style="display: flex; align-items: center;">
                            <div class="community-icon bg-blue-500">G</div>
                            <div>
                                <div style="font-weight: 500;">General</div>
                                <div style="font-size: 11px; color: var(--text-muted);">45k members</div>
                            </div>
                        </a>
                    </li>
                    <li>
                        <a href="#" style="display: flex; align-items: center;">
                            <div class="community-icon bg-green-500">T</div>
                            <div>
                                <div style="font-weight: 500;">Tech Talk</div>
                                <div style="font-size: 11px; color: var(--text-muted);">23k members</div>
                            </div>
                        </a>
                    </li>
                </ul>
                <button id="createCommunityBtn" 
                        class="btn btn-primary" 
                        style="width: 100%; margin-top: var(--spacing-md);">
                    <i class="fas fa-plus" aria-hidden="true"></i> Create Community
                </button>
            </section>

            <section style="margin-top: var(--spacing-xl);">
                <h3><i class="fas fa-compass" aria-hidden="true"></i> Explore</h3>
                <button id="browseCommunityBtn" class="btn btn-secondary" style="width: 100%;">
                    <i class="fas fa-globe" aria-hidden="true"></i> Browse Communities
                </button>
            </section>

            <!-- Online Friends -->
            <section style="margin-top: var(--spacing-xl);">
                <h3><i class="fas fa-user-friends" aria-hidden="true"></i> Online Friends</h3>
                <div style="display: flex; flex-direction: column; gap: var(--spacing-sm);">
                    <div style="display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-xs);">
                        <div class="user-avatar" style="width: 24px; height: 24px; font-size: 10px;">
                            A
                            <div class="status-indicator status-online"></div>
                        </div>
                        <span style="font-size: var(--font-size-sm);">Alex Johnson</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-xs);">
                        <div class="user-avatar" style="width: 24px; height: 24px; font-size: 10px;">
                            S
                            <div class="status-indicator status-away"></div>
                        </div>
                        <span style="font-size: var(--font-size-sm);">Sarah Chen</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-xs);">
                        <div class="user-avatar" style="width: 24px; height: 24px; font-size: 10px;">
                            M
                            <div class="status-indicator status-busy"></div>
                        </div>
                        <span style="font-size: var(--font-size-sm);">Mike Rodriguez</span>
                    </div>
                </div>
            </section>
        </aside>

        <!-- Main Feed -->
        <main class="main-feed" role="main" aria-label="Posts feed">
            <!-- Create Post Card -->
            <section class="create-post-card" aria-label="Create new post">
                <div class="create-post-input">
                    <div class="user-avatar" role="img" aria-label="Your avatar">
                        <span id="createPostUserInitial">U</span>
                        <div class="status-indicator status-online"></div>
                    </div>
                    <button id="createPostInput" 
                            class="form-control" 
                            style="text-align: left; cursor: pointer; border: none;"
                            aria-label="Create a new post">
                        What's on your mind?
                    </button>
                </div>
                <div class="post-type-buttons" role="group" aria-label="Post type options">
                    <button class="post-type-button" 
                            data-post-type="image" 
                            aria-label="Create image post">
                        <i class="far fa-image" aria-hidden="true"></i> Image
                    </button>
                    <button class="post-type-button" 
                            data-post-type="video" 
                            aria-label="Create video post">
                        <i class="fas fa-video" aria-hidden="true"></i> Video
                    </button>
                    <button class="post-type-button" 
                            data-post-type="text" 
                            aria-label="Create text post">
                        <i class="far fa-file-alt" aria-hidden="true"></i> Text
                    </button>
                    <button class="post-type-button" 
                            data-post-type="poll" 
                            aria-label="Create poll">
                        <i class="fas fa-poll" aria-hidden="true"></i> Poll
                    </button>
                </div>
            </section>

            <!-- Post Sorting -->
            <section class="sort-buttons" role="group" aria-label="Sort posts">
                <button class="sort-button active" 
                        data-sort="hot" 
                        aria-pressed="true">
                    <i class="fas fa-bolt" aria-hidden="true"></i> Hot
                </button>
                <button class="sort-button" 
                        data-sort="new" 
                        aria-pressed="false">
                    <i class="fas fa-certificate" aria-hidden="true"></i> New
                </button>
                <button class="sort-button" 
                        data-sort="top" 
                        aria-pressed="false">
                    <i class="fas fa-arrow-trend-up" aria-hidden="true"></i> Top
                </button>
                <button class="sort-button" 
                        data-sort="trending" 
                        aria-pressed="false">
                    <i class="fas fa-fire trending-indicator" aria-hidden="true"></i> Trending
                </button>
                <button class="sort-button" 
                        data-sort="live" 
                        aria-pressed="false">
                    <i class="fas fa-circle live-dot" aria-hidden="true"></i> Live
                </button>
            </section>

            <!-- Posts Feed -->
            <section id="posts-feed" role="feed" aria-label="Social media posts">
                <!-- Sample Post -->
                <article class="post-card" role="article">
                    <div class="post-content">
                        <div class="vote-section" role="group" aria-label="Vote on post">
                            <button class="vote-button" aria-label="Upvote post">
                                <i class="fas fa-chevron-up"></i>
                            </button>
                            <div class="vote-count" aria-label="Vote count">1.2k</div>
                            <button class="vote-button" aria-label="Downvote post">
                                <i class="fas fa-chevron-down"></i>
                            </button>
                        </div>
                        
                        <div class="post-main">
                            <div class="post-meta">
                                <span class="community-icon bg-purple-500">S</span>
                                <span>SmileX Official</span>
                                <span>•</span>
                                <span>Posted by SmileX Team <span class="premium-badge"><i class="fas fa-crown"></i> Premium</span></span>
                                <span>•</span>
                                <time>2 hours ago</time>
                                <span class="live-indicator"><div class="live-dot"></div>LIVE</span>
                            </div>
                            
                            <h2 class="post-title">🎉 Welcome to SmileX - The Future of Social Media! 🎉</h2>
                            
                            <div class="post-text">
                                Welcome to SmileX, the most advanced social media platform ever created! 
                                Explore amazing features like live polls, stories, premium content, 
                                real-time chat, community management, direct messages, group chats, 
                                chat channels, and so much more. This is the future of social networking!
                                <br><br>
                                🔥 <strong>New Features:</strong><br>
                                • Direct Messages with real-time delivery<br>
                                • Group Chats for team collaboration<br>
                                • Community Chat Channels<br>
                                • Live activity indicators<br>
                                • Enhanced real-time notifications
                            </div>
                            
                            <div class="post-actions">
                                <div class="post-action-buttons">
                                    <button class="post-action-button" aria-label="View comments">
                                        <i class="far fa-comment"></i>
                                        <span>247 Comments</span>
                                    </button>
                                    <button class="post-action-button" aria-label="Share post">
                                        <i class="fas fa-share"></i>
                                        <span>Share</span>
                                    </button>
                                    <button class="post-action-button" aria-label="Save post">
                                        <i class="far fa-bookmark"></i>
                                        <span>Save</span>
                                    </button>
                                    <button class="post-action-button" aria-label="Send direct message">
                                        <i class="fas fa-envelope"></i>
                                        <span>DM</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </article>

                <!-- Sample Poll Post -->
                <article class="post-card" role="article">
                    <div class="post-content">
                        <div class="vote-section" role="group" aria-label="Vote on post">
                            <button class="vote-button" aria-label="Upvote post">
                                <i class="fas fa-chevron-up"></i>
                            </button>
                            <div class="vote-count" aria-label="Vote count">567</div>
                            <button class="vote-button" aria-label="Downvote post">
                                <i class="fas fa-chevron-down"></i>
                            </button>
                        </div>
                        
                        <div class="post-main">
                            <div class="post-meta">
                                <span class="community-icon bg-blue-500">G</span>
                                <span>General</span>
                                <span>•</span>
                                <span>Posted by PollMaster</span>
                                <span>•</span>
                                <time>4 hours ago</time>
                                <span class="live-indicator"><div class="live-dot"></div>LIVE POLL</span>
                            </div>
                            
                            <h2 class="post-title">🔥 What's your favorite SmileX feature?</h2>
                            
                            <div class="poll-container">
                                <div class="poll-option" onclick="votePoll(this, 0)">
                                    <div class="poll-option-bar" style="width: 35%"></div>
                                    <span class="poll-option-text">Live Polls & Real-time Updates</span>
                                    <span class="poll-option-percentage">35%</span>
                                </div>
                                <div class="poll-option" onclick="votePoll(this, 1)">
                                    <div class="poll-option-bar" style="width: 28%"></div>
                                    <span class="poll-option-text">Direct Messages & Group Chats</span>
                                    <span class="poll-option-percentage">28%</span>
                                </div>
                                <div class="poll-option" onclick="votePoll(this, 2)">
                                    <div class="poll-option-bar" style="width: 22%"></div>
                                    <span class="poll-option-text">Community Chat Channels</span>
                                    <span class="poll-option-percentage">22%</span>
                                </div>
                                <div class="poll-option" onclick="votePoll(this, 3)">
                                    <div class="poll-option-bar" style="width: 15%"></div>
                                    <span class="poll-option-text">Premium Features</span>
                                    <span class="poll-option-percentage">15%</span>
                                </div>
                                <div class="poll-stats">
                                    1,247 votes • Active <span class="live-indicator"><div class="live-dot"></div>LIVE</span>
                                </div>
                            </div>
                            
                            <div class="post-actions">
                                <div class="post-action-buttons">
                                    <button class="post-action-button" aria-label="View comments">
                                        <i class="far fa-comment"></i>
                                        <span>89 Comments</span>
                                    </button>
                                    <button class="post-action-button" aria-label="Share post">
                                        <i class="fas fa-share"></i>
                                        <span>Share</span>
                                    </button>
                                    <button class="post-action-button" aria-label="Save post">
                                        <i class="far fa-bookmark"></i>
                                        <span>Save</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </article>

                <!-- Live Chat Channel Post -->
                <article class="post-card" role="article">
                    <div class="post-content">
                        <div class="vote-section" role="group" aria-label="Vote on post">
                            <button class="vote-button" aria-label="Upvote post">
                                <i class="fas fa-chevron-up"></i>
                            </button>
                            <div class="vote-count" aria-label="Vote count">234</div>
                            <button class="vote-button" aria-label="Downvote post">
                                <i class="fas fa-chevron-down"></i>
                            </button>
                        </div>
                        
                        <div class="post-main">
                            <div class="post-meta">
                                <span class="community-icon bg-green-500">T</span>
                                <span>Tech Talk</span>
                                <span>•</span>
                                <span>Posted by TechGuru</span>
                                <span>•</span>
                                <time>1 hour ago</time>
                                <span class="live-indicator"><div class="live-dot"></div>LIVE CHAT</span>
                            </div>
                            
                            <h2 class="post-title">💬 Join our live discussion about AI and the future!</h2>
                            
                            <div class="post-text">
                                We're having an amazing live discussion in the #tech-talk channel about 
                                artificial intelligence and its impact on society. Join us now for 
                                real-time conversations with experts and enthusiasts!
                            </div>

                            <!-- Live Chat Preview -->
                            <div style="background: var(--surface-secondary); border-radius: var(--radius-md); padding: var(--spacing-md); margin: var(--spacing-md) 0;">
                                <div style="display: flex; align-items: center; gap: var(--spacing-sm); margin-bottom: var(--spacing-sm);">
                                    <i class="fas fa-hashtag" style="color: var(--primary-color);"></i>
                                    <strong>tech-talk</strong>
                                    <span style="color: var(--success-color); font-size: var(--font-size-xs);">
                                        <i class="fas fa-circle" style="font-size: 6px;"></i> 47 online
                                    </span>
                                </div>
                                
                                <div style="font-size: var(--font-size-sm); color: var(--text-secondary);">
                                    <div style="margin-bottom: var(--spacing-xs);">
                                        <strong style="color: var(--primary-color);">AIExpert:</strong> 
                                        The latest developments in machine learning are fascinating!
                                    </div>
                                    <div style="margin-bottom: var(--spacing-xs);">
                                        <strong style="color: var(--secondary-color);">CodeMaster:</strong> 
                                        Agreed! The potential applications are endless.
                                    </div>
                                    <div class="typing-indicator">
                                        <strong>TechGuru</strong> is typing
                                        <div class="typing-dots">
                                            <div class="typing-dot"></div>
                                            <div class="typing-dot"></div>
                                            <div class="typing-dot"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="post-actions">
                                <div class="post-action-buttons">
                                    <button class="post-action-button" onclick="joinChannel('tech-talk')" style="background: var(--primary-color); color: white;">
                                        <i class="fas fa-comments"></i>
                                        <span>Join Live Chat</span>
                                    </button>
                                    <button class="post-action-button" aria-label="Share post">
                                        <i class="fas fa-share"></i>
                                        <span>Share</span>
                                    </button>
                                    <button class="post-action-button" aria-label="Save post">
                                        <i class="far fa-bookmark"></i>
                                        <span>Save</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </article>
            </section>

            <!-- Load More Button -->
            <div class="text-center">
                <button id="loadMoreBtn" class="btn btn-secondary">
                    <i class="fas fa-sync-alt"></i> Load more posts
                </button>
            </div>
        </main>

        <!-- Right Sidebar -->
        <aside class="sidebar" role="complementary" aria-label="Discover and premium">
            <!-- Live Stats -->
            <section style="background: var(--surface-secondary); border-radius: var(--radius-xl); padding: var(--spacing-lg);">
                <h4 style="display: flex; align-items: center; gap: var(--spacing-sm); margin-bottom: var(--spacing-md);">
                    <i class="fas fa-chart-line" aria-hidden="true"></i>
                    Live Stats
                    <span class="live-indicator"><div class="live-dot"></div></span>
                </h4>
                <div style="display: flex; flex-direction: column; gap: var(--spacing-sm); font-size: var(--font-size-sm);">
                    <div style="display: flex; justify-content: space-between;">
                        <span>Online Users:</span>
                        <span id="onlineUsers" style="color: var(--success-color); font-weight: bold;">127,543</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Active Chats:</span>
                        <span id="activeChats" style="color: var(--primary-color); font-weight: bold;">2,847</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Live Polls:</span>
                        <span id="activePolls" style="color: var(--accent-color); font-weight: bold;">1,247</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Posts Today:</span>
                        <span id="postsToday" style="color: var(--warning-color); font-weight: bold;">45,678</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Communities:</span>
                        <span id="totalCommunities" style="color: var(--secondary-color); font-weight: bold;">8,934</span>
                    </div>
                </div>
            </section>

            <!-- Trending Channels -->
            <section style="background: var(--surface-secondary); border-radius: var(--radius-xl); padding: var(--spacing-lg); margin-top: var(--spacing-lg);">
                <h4 style="display: flex; align-items: center; gap: var(--spacing-sm); margin-bottom: var(--spacing-md);">
                    <i class="fas fa-fire trending-indicator" aria-hidden="true"></i>
                    Trending Channels
                </h4>
                <div style="display: flex; flex-direction: column; gap: var(--spacing-sm);">
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: var(--spacing-sm); background: var(--surface-color); border-radius: var(--radius-md); cursor: pointer;" onclick="joinChannel('general')">
                        <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                            <i class="fas fa-hashtag" style="color: var(--primary-color);"></i>
                            <span style="font-weight: 500;">general</span>
                        </div>
                        <span style="color: var(--success-color); font-size: var(--font-size-xs);">1.2k online</span>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: var(--spacing-sm); background: var(--surface-color); border-radius: var(--radius-md); cursor: pointer;" onclick="joinChannel('gaming')">
                        <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                            <i class="fas fa-gamepad" style="color: var(--secondary-color);"></i>
                            <span style="font-weight: 500;">gaming</span>
                        </div>
                        <span style="color: var(--success-color); font-size: var(--font-size-xs);">567 online</span>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: var(--spacing-sm); background: var(--surface-color); border-radius: var(--radius-md); cursor: pointer;" onclick="joinChannel('tech-talk')">
                        <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                            <i class="fas fa-code" style="color: var(--accent-color);"></i>
                            <span style="font-weight: 500;">tech-talk</span>
                        </div>
                        <span style="color: var(--success-color); font-size: var(--font-size-xs);">234 online</span>
                    </div>
                </div>
            </section>

            <!-- Premium Section -->
            <section class="premium-section">
                <div class="premium-content">
                    <div style="display: flex; align-items: center; margin-bottom: var(--spacing-sm);">
                        <i class="fas fa-crown" style="margin-right: var(--spacing-sm); color: var(--premium-gold);" aria-hidden="true"></i>
                        <h4>SmileX Premium</h4>
                        <span class="premium-badge" style="margin-left: var(--spacing-sm);">
                            <i class="fas fa-star"></i> VIP
                        </span>
                    </div>
                    <p style="font-size: var(--font-size-sm); margin-bottom: var(--spacing-md);">
                        Unlock exclusive features: <span class="disco-text">Disco Text</span>, 
                        <span class="premium-emoji">🎉</span> Premium Emojis, 
                        Priority DMs, Group Chat creation, Custom channels, 
                        Ad-free experience, and more!
                    </p>
                    <button id="premiumBtn" class="btn btn-premium" style="width: 100%;">
                        <i class="fas fa-crown"></i> UPGRADE TO PREMIUM
                    </button>
                </div>
            </section>
        </aside>
    </main>

    <!-- Create Post Modal -->
    <div id="create-post-modal" class="modal" role="dialog" aria-labelledby="create-post-title" aria-modal="true">
        <div class="modal-content">
            <header class="modal-header">
                <h3 id="create-post-title">Create a post</h3>
                <button id="closeCreatePostModal" 
                        class="modal-close" 
                        aria-label="Close create post modal">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </header>

            <div class="modal-body">
                <form id="createPostForm" novalidate>
                    <div class="form-group">
                        <label for="postCommunity" class="form-label">Community</label>
                        <select id="postCommunity" name="community" class="form-select" required>
                            <option value="general">General</option>
                            <option value="smilex-official">SmileX Official</option>
                            <option value="tech-talk">Tech Talk</option>
                            <option value="gaming">Gaming</option>
                            <option value="design">Design</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="postType" class="form-label">Post type</label>
                        <select id="postType" name="postType" class="form-select" required>
                            <option value="text">Text Post</option>
                            <option value="image">Image Post</option>
                            <option value="video">Video Post</option>
                            <option value="poll">Poll</option>
                            <option value="live-chat">Live Chat Event</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="postTitle" class="form-label">Title</label>
                        <input type="text" 
                               id="postTitle" 
                               name="title" 
                               placeholder="Title" 
                               class="form-control" 
                               required>
                    </div>

                    <div class="form-group" id="contentContainer">
                        <label for="postContent" class="form-label">Content</label>
                        <textarea id="postContent" 
                                  name="content" 
                                  placeholder="What are your thoughts?" 
                                  rows="6" 
                                  class="form-control"></textarea>
                    </div>

                    <!-- Poll Options Container -->
                    <div class="form-group hidden" id="pollOptionsContainer">
                        <label class="form-label">Poll Options</label>
                        <div id="pollOptions">
                            <input type="text" 
                                   class="form-control poll-option-input" 
                                   placeholder="Option 1" 
                                   style="margin-bottom: var(--spacing-sm);">
                            <input type="text" 
                                   class="form-control poll-option-input" 
                                   placeholder="Option 2" 
                                   style="margin-bottom: var(--spacing-sm);">
                        </div>
                        <button type="button" 
                                id="addPollOption" 
                                class="btn btn-secondary" 
                                style="margin-top: var(--spacing-sm);">
                            <i class="fas fa-plus" aria-hidden="true"></i> Add Option
                        </button>
                    </div>

                    <!-- Live Chat Event Container -->
                    <div class="form-group hidden" id="liveChatContainer">
                        <label for="chatChannel" class="form-label">Chat Channel</label>
                        <input type="text" 
                               id="chatChannel" 
                               name="chatChannel" 
                               placeholder="Enter channel name (e.g., tech-discussion)" 
                               class="form-control">
                        <div style="margin-top: var(--spacing-sm); font-size: var(--font-size-xs); color: var(--text-muted);">
                            This will create a live chat event that others can join in real-time.
                        </div>
                    </div>

                    <div class="form-group" id="mediaUploadContainer">
                        <label class="form-label">Media Upload</label>
                        <div class="media-upload-area" 
                             id="mediaUploadArea" 
                             role="button" 
                             tabindex="0" 
                             aria-label="Click or drag media files here to upload">
                            <i class="fas fa-cloud-upload-alt" 
                               style="font-size: var(--font-size-2xl); color: var(--text-muted); margin-bottom: var(--spacing-sm);" 
                               aria-hidden="true"></i>
                            <p>Click or drag images/videos here to upload</p>
                            <p style="font-size: var(--font-size-xs); color: var(--text-muted);">
                                Supports: JPG, PNG, GIF, MP4, WebM (Max 50MB)
                            </p>
                            <input type="file" 
                                   id="mediaInput" 
                                   accept="image/*,video/*" 
                                   multiple 
                                   style="display: none;" 
                                   aria-label="Select media files to upload">
                        </div>
                        <div id="mediaPreviewContainer" class="media-preview-container" role="list" aria-label="Selected media files"></div>
                    </div>
                </form>
            </div>

            <footer class="modal-footer">
                <button type="button" id="cancelCreatePost" class="btn btn-secondary">Cancel</button>
                <button type="submit" form="createPostForm" class="btn btn-primary">
                    <i class="fas fa-paper-plane"></i> Post
                </button>
            </footer>
        </div>
    </div>

    <!-- Create Community Modal -->
    <div id="create-community-modal" class="modal" role="dialog" aria-labelledby="create-community-title" aria-modal="true">
        <div class="modal-content">
            <header class="modal-header">
                <h3 id="create-community-title">Create a Community</h3>
                <button id="closeCreateCommunityModal" 
                        class="modal-close" 
                        aria-label="Close create community modal">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </header>

            <div class="modal-body">
                <form id="createCommunityForm" novalidate>
                    <div class="form-group">
                        <label for="communityName" class="form-label">Community Name</label>
                        <input type="text" 
                               id="communityName" 
                               name="name" 
                               placeholder="Enter community name" 
                               class="form-control" 
                               required>
                    </div>

                    <div class="form-group">
                        <label for="communityDescription" class="form-label">Description</label>
                        <textarea id="communityDescription" 
                                  name="description" 
                                  placeholder="What's your community about?" 
                                  rows="4" 
                                  class="form-control"></textarea>
                    </div>

                    <fieldset class="form-group">
                        <legend class="form-label">Community Type</legend>
                        <div style="display: flex; gap: var(--spacing-md); margin-top: var(--spacing-sm);">
                            <div style="display: flex; align-items: center;">
                                <input type="radio" 
                                       id="typePublic" 
                                       name="type" 
                                       value="public" 
                                       checked 
                                       style="margin-right: var(--spacing-sm);">
                                <label for="typePublic">Public</label>
                            </div>
                            <div style="display: flex; align-items: center;">
                                <input type="radio" 
                                       id="typePrivate" 
                                       name="type" 
                                       value="private" 
                                       style="margin-right: var(--spacing-sm);">
                                <label for="typePrivate">Private</label>
                            </div>
                        </div>
                    </fieldset>

                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="enableChatChannels" name="enableChatChannels" style="margin-right: var(--spacing-sm);">
                            Enable Chat Channels
                        </label>
                        <div style="font-size: var(--font-size-xs); color: var(--text-muted); margin-top: var(--spacing-xs);">
                            Allow real-time chat channels within this community
                        </div>
                    </div>
                </form>
            </div>

            <footer class="modal-footer">
                <button type="button" id="cancelCreateCommunity" class="btn btn-secondary">Cancel</button>
                <button type="submit" form="createCommunityForm" class="btn btn-primary">
                    <i class="fas fa-users"></i> Create Community
                </button>
            </footer>
        </div>
    </div>

    <!-- Enhanced Chat Container -->
    <div id="chat-container" class="chat-container" role="dialog" aria-labelledby="chat-title">
        <header class="chat-header">
            <h3 id="chat-title">
                <i class="fas fa-hashtag"></i> 
                <span id="currentChannelName">general</span>
                <span class="live-indicator"><div class="live-dot"></div></span>
            </h3>
            <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                <span style="font-size: var(--font-size-xs); color: rgba(255,255,255,0.7);">
                    <i class="fas fa-users"></i> <span id="channelUserCount">47</span> online
                </span>
                <button id="chat-close-btn" 
                        class="chat-close" 
                        aria-label="Close chat">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
        </header>
        <div class="chat-messages" 
             id="chat-messages" 
             role="log" 
             aria-live="polite" 
             aria-label="Chat messages">
            <div class="message agent">
                <div class="message-user">
                    <i class="fas fa-robot"></i> SmileX Bot
                </div>
                <div class="message-text">Welcome to #general! This is a live chat channel where you can talk with other community members in real-time.</div>
                <div class="message-time">Just now</div>
            </div>
            <div class="message">
                <div class="message-user">TechGuru</div>
                <div class="message-text">Hey everyone! Loving the new chat features! 🚀</div>
                <div class="message-time">2m ago</div>
            </div>
            <div class="message">
                <div class="message-user">DesignPro</div>
                <div class="message-text">The real-time updates are so smooth!</div>
                <div class="message-time">1m ago</div>
            </div>
        </div>
        <div class="chat-input-container">
            <label for="chat-input" class="sr-only">Type your message</label>
            <input type="text" 
                   id="chat-input" 
                   class="chat-input" 
                   placeholder="Type your message...">
            <button id="emoji-btn" 
                    class="emoji-picker-btn" 
                    aria-label="Add emoji">
                <i class="far fa-smile"></i>
            </button>
            <button id="chat-send-btn" 
                    class="chat-send" 
                    aria-label="Send message">
                <i class="fas fa-paper-plane" aria-hidden="true"></i>
            </button>
        </div>
    </div>

    <!-- Live Chat Toggle Button -->
    <button id="chat-toggle-btn" 
            class="chat-toggle" 
            aria-label="Toggle live chat" 
            title="Live Chat Channels">
        <i class="fas fa-comments" aria-hidden="true"></i>
        <span class="notification-badge" id="chatBadge" style="display: none;">0</span>
    </button>

    <!-- Mobile Navigation -->
    <nav class="mobile-nav" role="navigation" aria-label="Mobile navigation">
        <a href="#" class="mobile-nav-item active" aria-current="page">
            <i class="fas fa-home" aria-hidden="true"></i>
            <span>Home</span>
        </a>
        <a href="#" class="mobile-nav-item" id="mobileBrowseBtn">
            <i class="fas fa-compass" aria-hidden="true"></i>
            <span>Explore</span>
        </a>
        <a href="#" class="mobile-nav-item" id="mobileCreatePost">
            <i class="fas fa-plus-circle" aria-hidden="true"></i>
            <span>Create</span>
        </a>
        <a href="#" class="mobile-nav-item" id="mobileDmToggle">
            <i class="fas fa-envelope" aria-hidden="true"></i>
            <span>Messages</span>
            <span class="notification-badge" id="mobileDmBadge" style="display: none;">0</span>
        </a>
        <a href="#" class="mobile-nav-item" id="mobileChatToggle">
            <i class="fas fa-comments" aria-hidden="true"></i>
            <span>Chat</span>
        </a>
    </nav>
    <script>
                // SmileX Advanced Social Platform - Complete JavaScript Implementation with Real-time Features
        
        // Global Configuration
        const CONFIG = {
            MAX_FILE_SIZE: 50 * 1024 * 1024, // 50MB
            SUPPORTED_IMAGE_TYPES: ['image/jpeg', 'image/png', 'image/gif', 'image/webp'],
            SUPPORTED_VIDEO_TYPES: ['video/mp4', 'video/webm', 'video/ogg'],
            MAX_POLL_OPTIONS: 6,
            MAX_POST_LENGTH: 10000,
            PREMIUM_EMOJIS: ['✨', '💎', '👑', '🌟', '🔥', '💫', '🎭', '🎪', '🎨', '🎯'],
            CHAT_UPDATE_INTERVAL: 1000, // 1 second
            ACTIVITY_UPDATE_INTERVAL: 5000, // 5 seconds
            MAX_CHAT_MESSAGES: 100
        };

        // Global State
        let currentUser = null;
        let posts = [];
        let communities = [];
        let directMessages = [];
        let groupChats = [];
        let chatChannels = [];
        let isLiveMode = true;
        let currentChannel = 'general';
        let onlineUsers = new Set();
        let typingUsers = new Set();

        // Real-time Database Simulation
        class RealtimeDatabase {
            constructor() {
                this.data = {
                    posts: [],
                    users: [],
                    messages: [],
                    channels: [],
                    communities: [],
                    activities: []
                };
                this.subscribers = {};
                this.isConnected = true;
                this.startHeartbeat();
            }

            // Subscribe to real-time updates
            subscribe(collection, callback) {
                if (!this.subscribers[collection]) {
                    this.subscribers[collection] = [];
                }
                this.subscribers[collection].push(callback);
            }

            // Unsubscribe from updates
            unsubscribe(collection, callback) {
                if (this.subscribers[collection]) {
                    this.subscribers[collection] = this.subscribers[collection].filter(cb => cb !== callback);
                }
            }

            // Add data to collection
            add(collection, data) {
                const item = {
                    ...data,
                    id: this.generateId(),
                    timestamp: new Date().toISOString(),
                    userId: currentUser?.userId || 'anonymous'
                };
                
                this.data[collection].push(item);
                this.notifySubscribers(collection, 'add', item);
                return item;
            }

            // Update data in collection
            update(collection, id, updates) {
                const index = this.data[collection].findIndex(item => item.id === id);
                if (index !== -1) {
                    this.data[collection][index] = { ...this.data[collection][index], ...updates };
                    this.notifySubscribers(collection, 'update', this.data[collection][index]);
                    return this.data[collection][index];
                }
                return null;
            }

            // Get data from collection
            get(collection, filter = null) {
                let result = this.data[collection];
                if (filter) {
                    result = result.filter(filter);
                }
                return result;
            }

            // Delete data from collection
            delete(collection, id) {
                const index = this.data[collection].findIndex(item => item.id === id);
                if (index !== -1) {
                    const deleted = this.data[collection].splice(index, 1)[0];
                    this.notifySubscribers(collection, 'delete', deleted);
                    return deleted;
                }
                return null;
            }

            // Notify subscribers of changes
            notifySubscribers(collection, action, data) {
                if (this.subscribers[collection]) {
                    this.subscribers[collection].forEach(callback => {
                        try {
                            callback({ action, data, collection });
                        } catch (error) {
                            console.error('Subscriber callback error:', error);
                        }
                    });
                }
            }

            // Generate unique ID
            generateId() {
                return Date.now().toString() + '_' + Math.random().toString(36).substr(2, 9);
            }

            // Simulate connection heartbeat
            startHeartbeat() {
                setInterval(() => {
                    if (this.isConnected) {
                        this.simulateActivity();
                    }
                }, CONFIG.ACTIVITY_UPDATE_INTERVAL);
            }

            // Simulate real-time activity
            simulateActivity() {
                // Simulate new messages
                if (Math.random() < 0.3) {
                    this.simulateMessage();
                }

                // Simulate user status changes
                if (Math.random() < 0.2) {
                    this.simulateUserStatusChange();
                }

                // Update live stats
                this.updateLiveStats();
            }

            simulateMessage() {
                const channels = ['general', 'tech-talk', 'gaming', 'design'];
                const users = ['TechGuru', 'DesignPro', 'GameMaster', 'CodeNinja', 'AIExpert'];
                const messages = [
                    'Great discussion everyone!',
                    'I totally agree with that point',
                    'Has anyone tried the new feature?',
                    'This is really interesting!',
                    'Thanks for sharing that resource',
                    'Looking forward to the next update',
                    'The community is growing so fast!',
                    'Love the real-time features'
                ];

                const message = {
                    channel: channels[Math.floor(Math.random() * channels.length)],
                    user: users[Math.floor(Math.random() * users.length)],
                    text: messages[Math.floor(Math.random() * messages.length)],
                    timestamp: new Date()
                };

                this.add('messages', message);
            }

            simulateUserStatusChange() {
                const statuses = ['online', 'away', 'busy', 'offline'];
                const users = Array.from(onlineUsers);
                if (users.length > 0) {
                    const user = users[Math.floor(Math.random() * users.length)];
                    const status = statuses[Math.floor(Math.random() * statuses.length)];
                    
                    this.notifySubscribers('userStatus', 'update', { user, status });
                }
            }

            updateLiveStats() {
                const stats = {
                    onlineUsers: Math.floor(Math.random() * 10000) + 120000,
                    activeChats: Math.floor(Math.random() * 1000) + 2000,
                    activePolls: Math.floor(Math.random() * 500) + 1000,
                    postsToday: Math.floor(Math.random() * 10000) + 40000,
                    totalCommunities: Math.floor(Math.random() * 1000) + 8000
                };

                this.notifySubscribers('stats', 'update', stats);
            }
        }

        // Initialize real-time database
        const realtimeDB = new RealtimeDatabase();

        // Utility Functions
        const utils = {
            formatNumber(num) {
                if (num >= 1000000) {
                    return (num / 1000000).toFixed(1) + 'M';
                } else if (num >= 1000) {
                    return (num / 1000).toFixed(1) + 'k';
                }
                return num.toString();
            },

            getTimeAgo(date) {
                const now = new Date();
                const diffInSeconds = Math.floor((now - date) / 1000);
                
                if (diffInSeconds < 60) {
                    return 'Just now';
                } else if (diffInSeconds < 3600) {
                    const minutes = Math.floor(diffInSeconds / 60);
                    return `${minutes}m ago`;
                } else if (diffInSeconds < 86400) {
                    const hours = Math.floor(diffInSeconds / 3600);
                    return `${hours}h ago`;
                } else {
                    const days = Math.floor(diffInSeconds / 86400);
                    return `${days}d ago`;
                }
            },

            generateId() {
                return Date.now().toString() + '_' + Math.random().toString(36).substr(2, 9);
            },

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = 'notification';
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 1rem 1.5rem;
                    border-radius: 8px;
                    color: white;
                    font-weight: 500;
                    z-index: 1001;
                    transform: translateX(100%);
                    opacity: 0;
                    transition: all 0.3s ease;
                    max-width: 300px;
                    word-wrap: break-word;
                `;
                
                // Set background color based on type
                switch (type) {
                    case 'success':
                        notification.style.background = '#10b981';
                        break;
                    case 'error':
                        notification.style.background = '#ef4444';
                        break;
                    case 'warning':
                        notification.style.background = '#f59e0b';
                        break;
                    default:
                        notification.style.background = '#6366f1';
                }
                
                notification.textContent = message;
                document.body.appendChild(notification);
                
                // Trigger animation
                setTimeout(() => {
                    notification.style.transform = 'translateX(0)';
                    notification.style.opacity = '1';
                }, 100);
                
                // Auto remove after 3 seconds
                setTimeout(() => {
                    notification.style.transform = 'translateX(100%)';
                    notification.style.opacity = '0';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            },

            showActivityIndicator(text) {
                const indicator = document.getElementById('activityIndicator');
                const textElement = document.getElementById('activityText');
                
                if (indicator && textElement) {
                    textElement.textContent = text;
                    indicator.classList.remove('hidden');
                    
                    setTimeout(() => {
                        indicator.classList.add('hidden');
                    }, 3000);
                }
            }
        };

        // Enhanced Chat System
        class EnhancedChatSystem {
            constructor() {
                this.isOpen = false;
                this.currentChannel = 'general';
                this.messages = new Map();
                this.typingTimeout = null;
                this.lastMessageTime = new Date();
                
                // Initialize with some sample messages
                this.initializeSampleMessages();
                
                // Subscribe to real-time message updates
                realtimeDB.subscribe('messages', this.handleMessageUpdate.bind(this));
            }

            initializeSampleMessages() {
                const sampleMessages = [
                    {
                        channel: 'general',
                        user: 'SmileX Bot',
                        text: 'Welcome to #general! This is a live chat channel.',
                        timestamp: new Date(Date.now() - 300000),
                        type: 'system'
                    },
                    {
                        channel: 'general',
                        user: 'TechGuru',
                        text: 'Hey everyone! Loving the new chat features! 🚀',
                        timestamp: new Date(Date.now() - 120000)
                    },
                    {
                        channel: 'general',
                        user: 'DesignPro',
                        text: 'The real-time updates are so smooth!',
                        timestamp: new Date(Date.now() - 60000)
                    }
                ];

                sampleMessages.forEach(msg => {
                    if (!this.messages.has(msg.channel)) {
                        this.messages.set(msg.channel, []);
                    }
                    this.messages.get(msg.channel).push(msg);
                });
            }

            handleMessageUpdate(update) {
                if (update.action === 'add' && update.data.channel) {
                    const { channel, user, text, timestamp } = update.data;
                    
                    if (!this.messages.has(channel)) {
                        this.messages.set(channel, []);
                    }
                    
                    const channelMessages = this.messages.get(channel);
                    channelMessages.push({ channel, user, text, timestamp: new Date(timestamp) });
                    
                    // Keep only last 100 messages
                    if (channelMessages.length > CONFIG.MAX_CHAT_MESSAGES) {
                        channelMessages.shift();
                    }
                    
                    // Update UI if this is the current channel
                    if (channel === this.currentChannel) {
                        this.renderMessages();
                    }
                    
                    // Show notification if chat is closed or different channel
                    if (!this.isOpen || channel !== this.currentChannel) {
                        this.updateChatBadge();
                        utils.showActivityIndicator(`New message in #${channel}`);
                    }
                }
            }

            toggle() {
                this.isOpen = !this.isOpen;
                const container = document.getElementById('chat-container');
                
                if (this.isOpen) {
                    container.classList.add('active');
                    this.renderMessages();
                    this.clearChatBadge();
                } else {
                    container.classList.remove('active');
                }
            }

            switchChannel(channelName) {
                this.currentChannel = channelName;
                const channelNameElement = document.getElementById('currentChannelName');
                if (channelNameElement) {
                    channelNameElement.textContent = channelName;
                }
                this.renderMessages();
                this.updateChannelUserCount();
            }

            sendMessage(text) {
                if (!text.trim()) return;

                const message = {
                    channel: this.currentChannel,
                    user: currentUser?.fullName || 'Anonymous',
                    text: text.trim(),
                    timestamp: new Date()
                };

                // Add to real-time database
                realtimeDB.add('messages', message);

                // Clear input
                const input = document.getElementById('chat-input');
                if (input) input.value = '';

                // Stop typing indicator
                this.stopTyping();
            }

            renderMessages() {
                const container = document.getElementById('chat-messages');
                if (!container) return;

                const channelMessages = this.messages.get(this.currentChannel) || [];
                
                container.innerHTML = channelMessages.map(message => `
                    <div class="message ${message.type === 'system' ? 'agent' : ''}">
                        <div class="message-user">
                            ${message.type === 'system' ? '<i class="fas fa-robot"></i> ' : ''}${message.user}
                        </div>
                        <div class="message-text">${message.text}</div>
                        <div class="message-time">${utils.getTimeAgo(message.timestamp)}</div>
                    </div>
                `).join('');

                // Scroll to bottom
                container.scrollTop = container.scrollHeight;
            }

            startTyping() {
                if (this.typingTimeout) {
                    clearTimeout(this.typingTimeout);
                }

                // Add user to typing set
                typingUsers.add(currentUser?.fullName || 'Anonymous');
                
                // Auto-stop typing after 3 seconds
                this.typingTimeout = setTimeout(() => {
                    this.stopTyping();
                }, 3000);
            }

            stopTyping() {
                if (this.typingTimeout) {
                    clearTimeout(this.typingTimeout);
                    this.typingTimeout = null;
                }

                // Remove user from typing set
                typingUsers.delete(currentUser?.fullName || 'Anonymous');
            }

            updateChatBadge() {
                const badge = document.getElementById('chatBadge');
                const mobileBadge = document.getElementById('mobileChatBadge');
                
                // Simple notification count simulation
                const count = Math.floor(Math.random() * 5) + 1;
                
                [badge, mobileBadge].forEach(element => {
                    if (element) {
                        element.textContent = count;
                        element.style.display = 'flex';
                    }
                });
            }

            clearChatBadge() {
                const badge = document.getElementById('chatBadge');
                const mobileBadge = document.getElementById('mobileChatBadge');
                
                [badge, mobileBadge].forEach(element => {
                    if (element) {
                        element.style.display = 'none';
                    }
                });
            }

            updateChannelUserCount() {
                const countElement = document.getElementById('channelUserCount');
                if (countElement) {
                    const count = Math.floor(Math.random() * 100) + 20;
                    countElement.textContent = count;
                }
            }
        }

        // Direct Messages System
        class DirectMessagesSystem {
            constructor() {
                this.isOpen = false;
                this.currentTab = 'dms';
                this.conversations = new Map();
                this.initializeSampleConversations();
                
                // Subscribe to real-time DM updates
                realtimeDB.subscribe('directMessages', this.handleDMUpdate.bind(this));
            }

            initializeSampleConversations() {
                const sampleDMs = [
                    {
                        id: 'dm_1',
                        participants: ['Alex Johnson'],
                        lastMessage: 'Hey! How\'s the new feature coming along?',
                        timestamp: new Date(Date.now() - 120000),
                        unread: 2,
                        status: 'online'
                    },
                    {
                        id: 'dm_2',
                        participants: ['Sarah Chen'],
                        lastMessage: 'Thanks for the help with the design!',
                        timestamp: new Date(Date.now() - 3600000),
                        unread: 0,
                        status: 'away'
                    },
                    {
                        id: 'dm_3',
                        participants: ['Mike Rodriguez'],
                        lastMessage: 'Let\'s schedule that meeting for tomorrow',
                        timestamp: new Date(Date.now() - 10800000),
                        unread: 0,
                        status: 'offline'
                    }
                ];

                sampleDMs.forEach(dm => {
                    this.conversations.set(dm.id, dm);
                });
            }

            toggle() {
                this.isOpen = !this.isOpen;
                const panel = document.getElementById('dmPanel');
                
                if (this.isOpen) {
                    panel.classList.add('active');
                    this.renderCurrentTab();
                    this.clearDMBadge();
                } else {
                    panel.classList.remove('active');
                }
            }

            switchTab(tabName) {
                this.currentTab = tabName;
                
                // Update tab buttons
                document.querySelectorAll('.dm-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
                
                // Show/hide tab content
                document.querySelectorAll('.dm-list, .channel-list').forEach(content => {
                    content.classList.add('hidden');
                });
                
                this.renderCurrentTab();
            }

            renderCurrentTab() {
                switch (this.currentTab) {
                    case 'dms':
                        this.renderDirectMessages();
                        break;
                    case 'groups':
                        this.renderGroupChats();
                        break;
                    case 'channels':
                        this.renderChannels();
                        break;
                }
            }

            renderDirectMessages() {
                const container = document.getElementById('dmsTab');
                if (container) {
                    container.classList.remove('hidden');
                    // DM rendering is already in HTML, could be made dynamic here
                }
            }

            renderGroupChats() {
                const container = document.getElementById('groupsTab');
                if (container) {
                    container.classList.remove('hidden');
                    // Group chat rendering is already in HTML, could be made dynamic here
                }
            }

            renderChannels() {
                const container = document.getElementById('channelsTab');
                if (container) {
                    container.classList.remove('hidden');
                    // Channel rendering is already in HTML, could be made dynamic here
                }
            }

            handleDMUpdate(update) {
                if (update.action === 'add') {
                    // Handle new direct message
                    this.updateDMBadge();
                    
                    if (!this.isOpen) {
                        utils.showActivityIndicator('New direct message');
                    }
                }
            }

            updateDMBadge() {
                const badge = document.getElementById('dmBadge');
                const mobileBadge = document.getElementById('mobileDmBadge');
                
                // Calculate total unread messages
                let totalUnread = 0;
                this.conversations.forEach(conv => {
                    totalUnread += conv.unread || 0;
                });
                
                [badge, mobileBadge].forEach(element => {
                    if (element && totalUnread > 0) {
                        element.textContent = totalUnread;
                        element.style.display = 'flex';
                    }
                });
            }

            clearDMBadge() {
                const badge = document.getElementById('dmBadge');
                const mobileBadge = document.getElementById('mobileDmBadge');
                
                [badge, mobileBadge].forEach(element => {
                    if (element) {
                        element.style.display = 'none';
                    }
                });
            }

            sendDirectMessage(recipientId, message) {
                const dm = {
                    recipientId,
                    senderId: currentUser?.userId || 'anonymous',
                    message,
                    timestamp: new Date()
                };

                realtimeDB.add('directMessages', dm);
                utils.showNotification('Message sent!', 'success');
            }
        }

        // Initialize systems
        const chatSystem = new EnhancedChatSystem();
        const dmSystem = new DirectMessagesSystem();

        // Modal Functions
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        // Profile Management
        function openFileUpload() {
            document.getElementById('profileImageInput').click();
        }

        function handleProfileImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const preview = document.getElementById('profilePreview');
                    preview.innerHTML = `
                        <img src="${e.target.result}" alt="Profile picture">
                        <div class="profile-upload-overlay">
                            <i class="fas fa-camera"></i>
                        </div>
                    `;
                    utils.showNotification('Profile picture updated!', 'success');
                };
                reader.readAsDataURL(file);
            }
        }

        // Form Validation
        function updateSubmitButtonState() {
            const form = document.getElementById('registrationForm');
            const submitBtn = document.getElementById('submitBtn');
            
            if (!form || !submitBtn) return;
            
            const requiredFields = form.querySelectorAll('[required]');
            const allValid = Array.from(requiredFields).every(field => {
                if (field.type === 'checkbox') {
                    return field.checked;
                }
                return field.value.trim() !== '';
            });
            
            submitBtn.disabled = !allValid;
        }

        // Registration Handler
        function handleRegistrationSubmit(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const userData = {
                fullName: formData.get('fullName'),
                email: formData.get('email'),
                gender: formData.get('gender'),
                country: formData.get('country'),
                userId: utils.generateId(),
                createdAt: new Date().toISOString(),
                status: 'online'
            };

            currentUser = userData;
            localStorage.setItem('smilex_user', JSON.stringify(userData));

            // Add user to online users
            onlineUsers.add(userData.fullName);

            // Update UI
            updateUserInterface(userData);
            hideModal('onboardingOverlay');
            
            utils.showNotification(`Welcome to SmileX, ${userData.fullName}!`, 'success');
            utils.showActivityIndicator('User joined the platform');
        }

        // Post Creation
        function handleCreatePostSubmit(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const postData = {
                id: utils.generateId(),
                title: formData.get('title'),
                content: formData.get('content') || "",
                author: currentUser ? currentUser.fullName : "Anonymous",
                authorId: currentUser ? currentUser.userId : "anonymous",
                timestamp: new Date(),
                type: formData.get('postType'),
                community: formData.get('community') || 'general',
                votes: Math.floor(Math.random() * 100),
                comments: Math.floor(Math.random() * 50),
                isLive: formData.get('postType') === 'live-chat'
            };

            // Add to real-time database
            realtimeDB.add('posts', postData);
            
            posts.unshift(postData);
            hideModal('create-post-modal');
            event.target.reset();
            
            utils.showNotification('Post created successfully!', 'success');
            utils.showActivityIndicator('New post published');
            
            // If it's a live chat event, create a channel
            if (postData.type === 'live-chat') {
                const channelName = formData.get('chatChannel') || 'new-discussion';
                utils.showNotification(`Live chat "${channelName}" is now active!`, 'info');
            }
        }

        // Community Creation
        function handleCreateCommunitySubmit(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const communityData = {
                id: utils.generateId(),
                name: formData.get('name'),
                description: formData.get('description'),
                type: formData.get('type'),
                enableChatChannels: formData.get('enableChatChannels') === 'on',
                createdBy: currentUser ? currentUser.fullName : "Anonymous",
                memberCount: 1,
                createdAt: new Date()
            };

            // Add to real-time database
            realtimeDB.add('communities', communityData);
            
            communities.push(communityData);
            hideModal('create-community-modal');
            event.target.reset();
            
            utils.showNotification(`Community "${communityData.name}" created successfully!`, 'success');
            utils.showActivityIndicator('New community created');
            updateCommunitiesDisplay();
        }

        // Post Type Handler
        function handlePostTypeChange(event) {
            const postType = event.target.value;
            const contentContainer = document.getElementById('contentContainer');
            const pollContainer = document.getElementById('pollOptionsContainer');
            const mediaContainer = document.getElementById('mediaUploadContainer');
            const liveChatContainer = document.getElementById('liveChatContainer');

            // Reset visibility
            contentContainer.classList.remove('hidden');
            pollContainer.classList.add('hidden');
            mediaContainer.classList.remove('hidden');
            liveChatContainer.classList.add('hidden');

            if (postType === 'poll') {
                pollContainer.classList.remove('hidden');
                mediaContainer.classList.add('hidden');
            } else if (postType === 'live-chat') {
                liveChatContainer.classList.remove('hidden');
                mediaContainer.classList.add('hidden');
            }
        }

        // Add Poll Option
        function addPollOption() {
            const container = document.getElementById('pollOptions');
            const currentOptions = container.querySelectorAll('.poll-option-input').length;
            
            if (currentOptions >= CONFIG.MAX_POLL_OPTIONS) {
                utils.showNotification(`Maximum ${CONFIG.MAX_POLL_OPTIONS} options allowed`, 'warning');
                return;
            }
            
            const newOption = document.createElement('input');
            newOption.type = 'text';
            newOption.className = 'form-control poll-option-input';
            newOption.placeholder = `Option ${currentOptions + 1}`;
            newOption.style.marginBottom = 'var(--spacing-sm)';
            
            container.appendChild(newOption);
            newOption.focus();
        }

        // Poll Voting
        function votePoll(element, optionIndex) {
            if (element.classList.contains('voted')) return;
            
            // Mark as voted
            element.classList.add('voted');
            
            // Simulate vote update
            const percentageElement = element.querySelector('.poll-option-percentage');
            const currentPercentage = parseInt(percentageElement.textContent);
            const newPercentage = Math.min(currentPercentage + Math.floor(Math.random() * 5) + 1, 100);
            
            percentageElement.textContent = newPercentage + '%';
            element.querySelector('.poll-option-bar').style.width = newPercentage + '%';
            
            utils.showNotification('Vote recorded!', 'success');
            utils.showActivityIndicator('Poll vote submitted');
        }

        // Join Channel Function
        function joinChannel(channelName) {
            chatSystem.switchChannel(channelName);
            chatSystem.toggle();
            utils.showNotification(`Joined #${channelName}`, 'success');
        }

        // Media Upload Handler
        function handleMediaUpload() {
            const mediaUploadArea = document.getElementById('mediaUploadArea');
            const mediaInput = document.getElementById('mediaInput');
            
            if (mediaUploadArea && mediaInput) {
                mediaUploadArea.addEventListener('click', () => mediaInput.click());
                
                mediaUploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    mediaUploadArea.classList.add('dragover');
                });
                
                mediaUploadArea.addEventListener('dragleave', () => {
                    mediaUploadArea.classList.remove('dragover');
                });
                
                mediaUploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    mediaUploadArea.classList.remove('dragover');
                    const files = Array.from(e.dataTransfer.files);
                    handleFiles(files);
                });
                
                mediaInput.addEventListener('change', (e) => {
                    const files = Array.from(e.target.files);
                    handleFiles(files);
                });
            }
        }

        function handleFiles(files) {
            const container = document.getElementById('mediaPreviewContainer');
            
            files.forEach(file => {
                if (file.size > CONFIG.MAX_FILE_SIZE) {
                    utils.showNotification(`File ${file.name} is too large`, 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    const preview = document.createElement('div');
                    preview.className = 'media-preview-item';
                    
                    if (file.type.startsWith('image/')) {
                        preview.innerHTML = `
                            <img src="${e.target.result}" alt="Preview">
                            <button class="media-remove-btn" onclick="removeMedia(this)">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                    } else if (file.type.startsWith('video/')) {
                        preview.innerHTML = `
                            <video src="${e.target.result}" muted></video>
                            <button class="media-remove-btn" onclick="removeMedia(this)">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                    }
                    
                    container.appendChild(preview);
                };
                reader.readAsDataURL(file);
            });
        }

        function removeMedia(button) {
            button.parentElement.remove();
        }

        // Theme Management
        function toggleTheme() {
            const root = document.documentElement;
            const themeToggle = document.getElementById('themeToggle');
            const currentTheme = localStorage.getItem('smilex_theme') || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            if (newTheme === 'light') {
                root.style.setProperty('--background-color', '#ffffff');
                root.style.setProperty('--surface-color', '#f8f9fa');
                root.style.setProperty('--surface-secondary', '#e9ecef');
                root.style.setProperty('--text-primary', '#212529');
                root.style.setProperty('--text-secondary', '#495057');
                root.style.setProperty('--text-muted', '#6c757d');
                root.style.setProperty('--border-color', '#dee2e6');
                
                if (themeToggle) {
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                }
            } else {
                root.style.setProperty('--background-color', '#000000');
                root.style.setProperty('--surface-color', '#1a1a1a');
                root.style.setProperty('--surface-secondary', '#2a2a2a');
                root.style.setProperty('--text-primary', '#ffffff');
                root.style.setProperty('--text-secondary', '#cccccc');
                root.style.setProperty('--text-muted', '#666666');
                root.style.setProperty('--border-color', '#404040');
                
                if (themeToggle) {
                    themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                }
            }
            
            localStorage.setItem('smilex_theme', newTheme);
            utils.showNotification(`Switched to ${newTheme} mode`, 'info');
        }

        // Update User Interface
        function updateUserInterface(userData) {
            const userInitials = userData.fullName.charAt(0).toUpperCase();
            
            document.querySelectorAll('#userInitial, #createPostUserInitial').forEach(element => {
                element.textContent = userInitials;
            });

            // Update user status
            document.querySelectorAll('.status-indicator').forEach(indicator => {
                if (indicator.closest('#userAvatar') || indicator.closest('#createPostUserInitial')) {
                    indicator.className = 'status-indicator status-online';
                }
            });
        }

        // Update Communities Display
        function updateCommunitiesDisplay() {
            const list = document.getElementById('communitiesList');
            if (!list) return;

            if (communities.length === 0) {
                list.innerHTML = '<li style="color: var(--text-muted); font-size: var(--font-size-sm); padding: var(--spacing-sm);">No communities yet</li>';
            } else {
                list.innerHTML = communities.map(community => `
                    <li>
                        <a href="#" style="display: flex; align-items: center;">
                            <div class="community-icon bg-purple-500">
                                ${community.name.charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <div style="font-weight: 500;">${community.name}</div>
                                <div style="font-size: 11px; color: var(--text-muted);">${utils.formatNumber(community.memberCount)} members</div>
                            </div>
                        </a>
                    </li>
                `).join('');
            }
        }

        // Live Stats Update
        function updateLiveStats() {
            // Subscribe to stats updates
            realtimeDB.subscribe('stats', (update) => {
                if (update.action === 'update') {
                    const stats = update.data;
                    Object.keys(stats).forEach(key => {
                        const element = document.getElementById(key);
                        if (element) {
                            element.textContent = utils.formatNumber(stats[key]);
                        }
                    });
                }
            });
        }

        // Search Functionality
        function handleSearch(query) {
            if (!query.trim()) return;

            const results = [
                {
                    type: 'user',
                    title: 'Alex Johnson',
                    description: 'Active user • Online now'
                },
                {
                    type: 'community',
                    title: 'Tech Talk',
                    description: '23k members • Technology discussions'
                },
                {
                    type: 'post',
                    title: 'Welcome to SmileX',
                    description: 'Posted 2 hours ago in SmileX Official'
                }
            ];

            const searchResults = document.getElementById('searchResults');
            if (searchResults) {
                searchResults.innerHTML = results.map(result => `
                    <div class="search-result-item">
                        <div class="search-result-type">${result.type}</div>
                        <div class="search-result-title">${result.title}</div>
                        <div class="search-result-description">${result.description}</div>
                    </div>
                `).join('');
                searchResults.classList.remove('hidden');
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Hide preloader
            setTimeout(() => {
                const preloader = document.getElementById('preloader');
                if (preloader) {
                    preloader.style.opacity = '0';
                    setTimeout(() => {
                        preloader.style.display = 'none';
                    }, 500);
                }
            }, 2000);

            // Check for existing user
            const existingUser = localStorage.getItem('smilex_user');
            if (existingUser) {
                try {
                    currentUser = JSON.parse(existingUser);
                    updateUserInterface(currentUser);
                    onlineUsers.add(currentUser.fullName);
                } catch (error) {
                    console.error('Error loading user data:', error);
                }
            } else {
                // Show onboarding for new users
                setTimeout(() => {
                    showModal('onboardingOverlay');
                }, 2500);
            }

            // Form event listeners
            const registrationForm = document.getElementById('registrationForm');
            if (registrationForm) {
                registrationForm.addEventListener('submit', handleRegistrationSubmit);
                
                registrationForm.querySelectorAll('input, select').forEach(input => {
                    input.addEventListener('input', updateSubmitButtonState);
                    input.addEventListener('change', updateSubmitButtonState);
                });
            }

            const createPostForm = document.getElementById('createPostForm');
            if (createPostForm) {
                createPostForm.addEventListener('submit', handleCreatePostSubmit);
            }

            const createCommunityForm = document.getElementById('createCommunityForm');
            if (createCommunityForm) {
                createCommunityForm.addEventListener('submit', handleCreateCommunitySubmit);
            }

            // Profile image upload
            const profileImageInput = document.getElementById('profileImageInput');
            if (profileImageInput) {
                profileImageInput.addEventListener('change', handleProfileImageUpload);
            }

            // Post type change handler
            const postTypeSelect = document.getElementById('postType');
            if (postTypeSelect) {
                postTypeSelect.addEventListener('change', handlePostTypeChange);
            }

            // Add poll option button
            const addPollOptionBtn = document.getElementById('addPollOption');
            if (addPollOptionBtn) {
                addPollOptionBtn.addEventListener('click', addPollOption);
            }

            // Navigation handlers
            document.getElementById('createPostInput')?.addEventListener('click', () => {
                showModal('create-post-modal');
            });

            document.querySelectorAll('.post-type-button').forEach(button => {
                button.addEventListener('click', () => {
                    const postType = button.dataset.postType;
                    showModal('create-post-modal');
                    
                    setTimeout(() => {
                        const postTypeSelect = document.getElementById('postType');
                        if (postTypeSelect) {
                            postTypeSelect.value = postType;
                            handlePostTypeChange({ target: { value: postType } });
                        }
                    }, 100);
                });
            });

            document.getElementById('createCommunityBtn')?.addEventListener('click', () => {
                showModal('create-community-modal');
            });

            // Mobile navigation
            document.getElementById('mobileCreatePost')?.addEventListener('click', (e) => {
                e.preventDefault();
                showModal('create-post-modal');
            });

            document.getElementById('mobileCreateCommunity')?.addEventListener('click', (e) => {
                e.preventDefault();
                showModal('create-community-modal');
            });

            // Theme toggle
            document.getElementById('themeToggle')?.addEventListener('click', toggleTheme);

            // Direct Messages
            document.getElementById('dmToggle')?.addEventListener('click', () => {
                dmSystem.toggle();
            });

            document.getElementById('mobileDmToggle')?.addEventListener('click', (e) => {
                e.preventDefault();
                dmSystem.toggle();
            });

            document.getElementById('closeDmPanel')?.addEventListener('click', () => {
                dmSystem.toggle();
            });

            // DM Tab switching
            document.querySelectorAll('.dm-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.dataset.tab;
                    dmSystem.switchTab(tabName);
                });
            });

            // Enhanced Chat system
            document.getElementById('chat-toggle-btn')?.addEventListener('click', () => {
                chatSystem.toggle();
            });

            document.getElementById('mobileChatToggle')?.addEventListener('click', (e) => {
                e.preventDefault();
                chatSystem.toggle();
            });

            document.getElementById('chat-close-btn')?.addEventListener('click', () => {
                chatSystem.toggle();
            });

            document.getElementById('chat-send-btn')?.addEventListener('click', () => {
                const input = document.getElementById('chat-input');
                if (input) {
                    chatSystem.sendMessage(input.value);
                }
            });

            document.getElementById('chat-input')?.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    chatSystem.sendMessage(e.target.value);
                } else {
                    chatSystem.startTyping();
                }
            });

            // Search functionality
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                let searchTimeout;
                searchInput.addEventListener('input', (e) => {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        if (e.target.value.trim()) {
                            handleSearch(e.target.value);
                        } else {
                            document.getElementById('searchResults')?.classList.add('hidden');
                        }
                    }, 300);
                });

                // Hide search results when clicking outside
                document.addEventListener('click', (e) => {
                    if (!searchInput.contains(e.target)) {
                        document.getElementById('searchResults')?.classList.add('hidden');
                    }
                });
            }

            // Modal close handlers
            document.querySelectorAll('.modal-close, .overlay').forEach(element => {
                element.addEventListener('click', (e) => {
                    if (e.target === element) {
                        const modal = element.closest('.modal, .overlay');
                        if (modal) {
                            modal.classList.remove('active');
                            document.body.style.overflow = '';
                        }
                    }
                });
            });

            // Sort buttons
            document.querySelectorAll('.sort-button[data-sort]').forEach(button => {
                button.addEventListener('click', () => {
                    // Update active state
                    document.querySelectorAll('.sort-button[data-sort]').forEach(btn => {
                        btn.classList.remove('active');
                        btn.setAttribute('aria-pressed', 'false');
                    });
                    
                    button.classList.add('active');
                    button.setAttribute('aria-pressed', 'true');
                    
                    const sortType = button.dataset.sort;
                    utils.showNotification(`Sorted by ${button.textContent.trim()}`, 'info');
                    
                    if (sortType === 'live') {
                        utils.showActivityIndicator('Showing live content');
                    }
                });
            });

            // Keyboard navigation
            document.addEventListener('keydown', (e) => {
                // Escape key closes modals
                if (e.key === 'Escape') {
                    const activeModal = document.querySelector('.modal.active, .overlay.active');
                    if (activeModal) {
                        activeModal.classList.remove('active');
                        document.body.style.overflow = '';
                    }
                    
                    // Close DM panel
                    if (dmSystem.isOpen) {
                        dmSystem.toggle();
                    }
                    
                    // Close chat
                    if (chatSystem.isOpen) {
                        chatSystem.toggle();
                    }
                }
                
                // Ctrl/Cmd + K for search
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                    e.preventDefault();
                    const searchInput = document.getElementById('searchInput');
                    if (searchInput) {
                        searchInput.focus();
                    }
                }

                // Ctrl/Cmd + M for messages
                if ((e.ctrlKey || e.metaKey) && e.key === 'm') {
                    e.preventDefault();
                    dmSystem.toggle();
                }

                // Ctrl/Cmd + Shift + C for chat
                if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'C') {
                    e.preventDefault();
                    chatSystem.toggle();
                }
            });

            // Initialize media upload
            handleMediaUpload();

            // Start live stats updates
            updateLiveStats();

            // Load theme
            const savedTheme = localStorage.getItem('smilex_theme');
            if (savedTheme === 'light') {
                toggleTheme();
            }

            // Initialize notification badges
            setTimeout(() => {
                dmSystem.updateDMBadge();
                chatSystem.updateChatBadge();
            }, 5000);

            console.log('🎉 SmileX Advanced Platform Initialized Successfully!');
            console.log('🚀 Real-time features active');
            console.log('💬 Chat system ready');
            console.log('📱 Direct messages enabled');
            console.log('🌐 Live database connected');
        });

        // Global error handler
        window.addEventListener('error', (e) => {
            console.error('SmileX Error:', e.error);
            utils.showNotification('Something went wrong. Please try again.', 'error');
        });

        // Online/offline status
        window.addEventListener('online', () => {
            realtimeDB.isConnected = true;
            utils.showNotification('Connection restored!', 'success');
            utils.showActivityIndicator('Back online');
        });

        window.addEventListener('offline', () => {
            realtimeDB.isConnected = false;
            utils.showNotification('You are offline. Some features may not work.', 'warning');
        });

        // Visibility change handler
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // User switched away from tab
                if (currentUser) {
                    currentUser.status = 'away';
                }
            } else {
                // User returned to tab
                if (currentUser) {
                    currentUser.status = 'online';
                }
                // Clear notifications when user returns
                dmSystem.clearDMBadge();
                chatSystem.clearChatBadge();
            }
        });

        // Beforeunload handler
        window.addEventListener('beforeunload', () => {
            if (currentUser) {
                currentUser.status = 'offline';
                onlineUsers.delete(currentUser.fullName);
            }
        });
    </script>
</body>
</html>