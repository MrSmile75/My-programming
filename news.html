<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live News Hub with YouTube Integration</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
</head>

<style>
    :root {
        --primary-color: #3498db;
        --secondary-color: #2ecc71;
        --breaking-color: #e74c3c;
        --text-primary: #2c3e50;
        --background-color: #0a0a0a;
        --card-bg: #1a1a1a;
        --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --success-color: #27ae60;
        --warning-color: #f39c12;
        --error-color: #e74c3c;
        --preview-bg: #2c2c2c;
        --cache-color: #9b59b6;
        --video-bg: #1e1e1e;
        --modal-bg: rgba(0, 0, 0, 0.95);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Orbitron', sans-serif;
        background: var(--background-color);
        color: white;
        overflow-x: hidden;
    }

    /* Navigation Styles */
    .navbar-custom {
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        backdrop-filter: blur(10px);
        border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        position: sticky;
        top: 0;
        z-index: 1000;
    }

    .navbar-brand {
        font-family: 'Orbitron', sans-serif;
        font-weight: 700;
        color: white !important;
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
    }

    .live-indicator {
        background: var(--breaking-color);
        color: white;
        padding: 4px 8px;
        border-radius: 10px;
        font-size: 0.7rem;
        font-weight: 600;
        animation: pulse 2s infinite;
        margin-left: 10px;
    }

    /* Cache Status */
    .cache-status {
        position: fixed;
        top: 80px;
        right: 20px;
        background: rgba(155, 89, 182, 0.9);
        padding: 10px 15px;
        border-radius: 20px;
        border: 1px solid var(--cache-color);
        backdrop-filter: blur(10px);
        z-index: 1000;
        font-size: 0.9rem;
    }

    .cache-indicator {
        display: inline-block;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        margin-right: 8px;
        background: var(--success-color);
        animation: pulse 2s infinite;
    }

    /* Breaking News Bar */
    .news-headline-bar {
        background: linear-gradient(90deg, var(--breaking-color), #c0392b);
        padding: 12px 0;
        position: relative;
        overflow: hidden;
        border-bottom: 3px solid rgba(255, 255, 255, 0.2);
    }

    .breaking-indicator {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        padding: 8px 16px;
        border-radius: 25px;
        font-weight: 700;
        text-transform: uppercase;
        font-size: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
        animation: pulse 1.5s infinite;
    }

    .live-dot {
        width: 8px;
        height: 8px;
        background: white;
        border-radius: 50%;
        animation: blink 1s infinite;
    }

    @keyframes blink {
        0%, 50% { opacity: 1; }
        51%, 100% { opacity: 0.3; }
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }

    .headline-ticker {
        flex: 1;
        overflow: hidden;
        margin: 0 20px;
    }

    .headline-content {
        display: flex;
        animation: scroll 60s linear infinite;
        white-space: nowrap;
    }

    .headline-item {
        margin-right: 50px;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
    }

    .headline-item:hover {
        color: #ffd700;
        transform: scale(1.05);
    }

    @keyframes scroll {
        0% { transform: translateX(100%); }
        100% { transform: translateX(-100%); }
    }

    /* News Cards */
    .news-card {
        background: var(--card-bg);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        transition: all 0.4s ease;
        overflow: hidden;
        position: relative;
        height: 100%;
    }

    .news-card.cached {
        border-left: 4px solid var(--cache-color);
    }

    .news-card:hover {
        transform: translateY(-5px) scale(1.01);
        box-shadow: 0 15px 30px rgba(52, 152, 219, 0.3);
        border-color: var(--primary-color);
    }

    .news-card-img {
        height: 200px;
        object-fit: cover;
        transition: transform 0.4s ease;
    }

    .news-card:hover .news-card-img {
        transform: scale(1.05);
    }

    .card-body {
        padding: 20px;
    }

    .card-title {
        font-weight: 600;
        margin-bottom: 15px;
        color: white;
        line-height: 1.4;
    }

    .card-text {
        color: rgba(255, 255, 255, 0.8);
        margin-bottom: 20px;
        line-height: 1.6;
    }

    .cache-indicator-card {
        position: absolute;
        top: 10px;
        right: 10px;
        background: var(--cache-color);
        color: white;
        padding: 5px 8px;
        border-radius: 10px;
        font-size: 0.7rem;
        font-weight: 600;
    }

    /* CENTERED MODAL OVERLAYS */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: var(--modal-bg);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        backdrop-filter: blur(10px);
        animation: fadeIn 0.3s ease;
    }

    .modal-overlay.active {
        display: flex;
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes slideUp {
        from { 
            opacity: 0; 
            transform: translateY(50px) scale(0.9); 
        }
        to { 
            opacity: 1; 
            transform: translateY(0) scale(1); 
        }
    }

    /* CENTERED VIDEO PLAYER */
    .video-modal-content {
        background: var(--video-bg);
        border-radius: 20px;
        padding: 30px;
        max-width: 90vw;
        max-height: 90vh;
        width: 800px;
        border: 2px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.8);
        animation: slideUp 0.4s ease;
        position: relative;
    }

    .video-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .video-modal-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: white;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .modal-close-btn {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .modal-close-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: scale(1.1);
    }

    .video-player-centered {
        width: 100%;
        height: 400px;
        border-radius: 15px;
        border: none;
        margin-bottom: 20px;
    }

    .video-controls-centered {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        margin-top: 15px;
    }

    .video-info-centered {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .video-badge-centered {
        background: var(--breaking-color);
        color: white;
        padding: 6px 12px;
        border-radius: 15px;
        font-size: 0.9rem;
        font-weight: 600;
    }

    .video-error {
        background: rgba(231, 76, 60, 0.1);
        border: 2px solid var(--error-color);
        border-radius: 15px;
        padding: 30px;
        text-align: center;
        color: white;
    }

    .video-error h4 {
        color: var(--error-color);
        margin-bottom: 15px;
    }

    .video-fallback {
        background: rgba(243, 156, 18, 0.1);
        border: 2px solid var(--warning-color);
        border-radius: 15px;
        padding: 20px;
        margin-top: 15px;
    }

    /* CENTERED CONTENT PREVIEW */
    .preview-modal-content {
        background: var(--preview-bg);
        border-radius: 20px;
        padding: 30px;
        max-width: 90vw;
        max-height: 90vh;
        width: 900px;
        border: 2px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.8);
        animation: slideUp 0.4s ease;
        overflow-y: auto;
    }

    .preview-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 20px;
        border-bottom: 2px solid rgba(255, 255, 255, 0.1);
    }

    .preview-modal-title {
        font-size: 1.8rem;
        font-weight: 600;
        color: white;
        line-height: 1.3;
        flex: 1;
        margin-right: 20px;
    }

    .preview-content-centered {
        color: rgba(255, 255, 255, 0.9);
        line-height: 1.8;
        font-size: 1.1rem;
    }

    .preview-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding: 15px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
    }

    .preview-source {
        font-weight: 600;
        color: var(--primary-color);
        font-size: 1.1rem;
    }

    .preview-time {
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.9rem;
    }

    .full-article-content-centered {
        background: rgba(255, 255, 255, 0.05);
        padding: 25px;
        border-radius: 15px;
        margin: 20px 0;
        border-left: 4px solid var(--primary-color);
    }

    /* CENTERED OPTIONS MENU */
    .options-modal-content {
        background: var(--card-bg);
        border-radius: 20px;
        padding: 30px;
        max-width: 500px;
        width: 90vw;
        border: 2px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.8);
        animation: slideUp 0.4s ease;
    }

    .options-menu-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px 20px;
        margin: 10px 0;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 1px solid transparent;
    }

    .options-menu-item:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: var(--primary-color);
        transform: translateX(5px);
    }

    .options-menu-icon {
        font-size: 1.5rem;
        color: var(--primary-color);
        width: 30px;
        text-align: center;
    }

    .options-menu-text {
        flex: 1;
    }

    .options-menu-title {
        font-weight: 600;
        margin-bottom: 5px;
    }

    .options-menu-desc {
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.7);
    }

    /* Action Buttons */
    .action-buttons {
        display: flex;
        gap: 10px;
        margin-top: 15px;
        flex-wrap: wrap;
    }

    .btn-preview, .btn-watch, .btn-read, .btn-options {
        border: none;
        color: white;
        padding: 10px 15px;
        border-radius: 25px;
        font-weight: 600;
        transition: all 0.3s ease;
        flex: 1;
        min-width: 100px;
        font-size: 0.9rem;
        cursor: pointer;
    }

    .btn-preview {
        background: linear-gradient(45deg, var(--primary-color), #5dade2);
    }

    .btn-preview:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(52, 152, 219, 0.4);
    }

    .btn-watch {
        background: linear-gradient(45deg, var(--success-color), #2ecc71);
    }

    .btn-watch:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(39, 174, 96, 0.4);
    }

    .btn-read {
        background: linear-gradient(45deg, var(--warning-color), #e67e22);
    }

    .btn-read:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(243, 156, 18, 0.4);
    }

    .btn-options {
        background: linear-gradient(45deg, var(--cache-color), #8e44ad);
    }

    .btn-options:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(155, 89, 182, 0.4);
    }

    /* Modal Action Buttons */
    .modal-actions {
        display: flex;
        gap: 15px;
        margin-top: 25px;
        padding-top: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        justify-content: center;
        flex-wrap: wrap;
    }

    .modal-btn {
        padding: 12px 25px;
        border-radius: 25px;
        font-weight: 600;
        transition: all 0.3s ease;
        cursor: pointer;
        border: none;
        min-width: 120px;
    }

    .modal-btn-primary {
        background: linear-gradient(45deg, var(--primary-color), #5dade2);
        color: white;
    }

    .modal-btn-secondary {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .modal-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    }

    /* Source Info */
    .source-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding: 10px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
    }

    .source-name {
        font-weight: 600;
        color: var(--primary-color);
    }

    .publish-time {
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.7);
    }

    /* Loading States */
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        backdrop-filter: blur(5px);
    }

    .loading-spinner {
        width: 60px;
        height: 60px;
        border: 4px solid rgba(255, 255, 255, 0.1);
        border-left: 4px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .content-loading {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        color: rgba(255, 255, 255, 0.7);
    }

    /* Error Messages */
    .error-container {
        background: linear-gradient(45deg, var(--error-color), #c0392b);
        color: white;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
        text-align: center;
        border: 2px solid rgba(255, 255, 255, 0.2);
    }

    .retry-btn {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 10px 20px;
        border-radius: 25px;
        margin-top: 15px;
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .retry-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
    }

    /* Search Styles */
    .search-container {
        position: relative;
    }

    .search-input {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 25px;
        padding: 10px 20px;
        color: white;
        backdrop-filter: blur(10px);
    }

    .search-input::placeholder {
        color: rgba(255, 255, 255, 0.7);
    }

    .search-input:focus {
        background: rgba(255, 255, 255, 0.15);
        border-color: var(--primary-color);
        box-shadow: 0 0 20px rgba(52, 152, 219, 0.3);
        outline: none;
    }

    /* Notification System */
    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 25px;
        border-radius: 10px;
        color: white;
        font-weight: 600;
        z-index: 3000;
        min-width: 300px;
        animation: slideIn 0.3s ease;
    }

    .notification.success { background: linear-gradient(45deg, var(--success-color), #2ecc71); }
    .notification.warning { background: linear-gradient(45deg, var(--warning-color), #e67e22); }
    .notification.error { background: linear-gradient(45deg, var(--error-color), #c0392b); }
    .notification.info { background: linear-gradient(45deg, var(--primary-color), #3498db); }

    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }

    /* Cache Management */
    .cache-controls {
        background: rgba(155, 89, 182, 0.1);
        border: 1px solid var(--cache-color);
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 20px;
    }

    .cache-stats {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .clear-cache-btn {
        background: var(--cache-color);
        border: none;
        color: white;
        padding: 8px 15px;
        border-radius: 15px;
        font-size: 0.9rem;
        transition: all 0.3s ease;
    }

    .clear-cache-btn:hover {
        background: #8e44ad;
        transform: translateY(-2px);
    }

    /* Category Buttons */
    .category-btn {
        transition: all 0.3s ease;
        border-radius: 25px;
        font-weight: 500;
    }

    .category-btn.active {
        background: linear-gradient(45deg, var(--primary-color), #5dade2);
        border-color: var(--primary-color);
        transform: scale(1.05);
    }

    .category-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .news-headline-bar {
            flex-direction: column;
            gap: 10px;
            padding: 15px;
        }

        .headline-ticker {
            margin: 0;
        }

        .action-buttons {
            flex-direction: column;
        }

        .cache-status {
            position: relative;
            top: auto;
            right: auto;
            margin: 10px auto;
            width: fit-content;
        }

        .video-modal-content,
        .preview-modal-content,
        .options-modal-content {
            width: 95vw;
            max-height: 95vh;
            padding: 20px;
        }

        .video-player-centered {
            height: 250px;
        }

        .modal-actions {
            flex-direction: column;
        }

        .modal-btn {
            width: 100%;
        }
    }
</style>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-custom">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-globe2 me-2"></i>Live News Hub
                <span class="live-indicator">
                    <i class="bi bi-broadcast"></i> LIVE
                </span>
            </a>
            
            <div class="ms-auto d-flex align-items-center">
                <div class="search-container">
                    <input 
                        type="text" 
                        id="searchInput" 
                        class="form-control search-input" 
                        placeholder="Search live news..."
                    >
                </div>
            </div>
        </div>
    </nav>

    <!-- Cache Status -->
    <div id="cacheStatus" class="cache-status">
        <span class="cache-indicator"></span>
        <span id="cacheText">Cache: Ready</span>
    </div>

    <!-- Breaking News Bar -->
    <div class="news-headline-bar">
        <div class="container d-flex align-items-center">
            <div class="breaking-indicator">
                <div class="live-dot"></div>
                <span>BREAKING</span>
            </div>
            
            <div class="headline-ticker">
                <div class="headline-content" id="headlineContent">
                    <span class="headline-item">Loading latest breaking news...</span>
                </div>
            </div>
            
            <div class="d-flex align-items-center">
                <button id="refreshHeadlines" class="btn btn-link text-white">
                    <i class="bi bi-arrow-clockwise"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mt-4">
        <!-- Cache Management -->
        <div class="cache-controls">
            <div class="cache-stats">
                <div>
                    <i class="bi bi-database me-2" style="color: var(--cache-color);"></i>
                    <span>Cache Status: <span id="cacheStatsText">0 articles cached</span></span>
                </div>
                <button class="clear-cache-btn" onclick="newsHub.clearCache()">
                    <i class="bi bi-trash me-1"></i>Clear Cache
                </button>
            </div>
            <small class="text-muted">
                <i class="bi bi-info-circle me-1"></i>
                Cached articles reduce errors and load faster. Live news updates every 5 minutes.
            </small>
        </div>

        <!-- Category Filters -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex flex-wrap gap-2 justify-content-center">
                    <button class="btn btn-outline-primary category-btn active" data-category="general">
                        <i class="bi bi-newspaper me-1"></i>General
                    </button>
                    <button class="btn btn-outline-primary category-btn" data-category="business">
                        <i class="bi bi-briefcase me-1"></i>Business
                    </button>
                    <button class="btn btn-outline-primary category-btn" data-category="technology">
                        <i class="bi bi-cpu me-1"></i>Technology
                    </button>
                    <button class="btn btn-outline-primary category-btn" data-category="sports">
                        <i class="bi bi-trophy me-1"></i>Sports
                    </button>
                    <button class="btn btn-outline-primary category-btn" data-category="entertainment">
                        <i class="bi bi-film me-1"></i>Entertainment
                    </button>
                    <button class="btn btn-outline-primary category-btn" data-category="health">
                        <i class="bi bi-heart-pulse me-1"></i>Health
                    </button>
                    <button class="btn btn-outline-primary category-btn" data-category="science">
                        <i class="bi bi-book me-1"></i>Science
                    </button>
                </div>
            </div>
        </div>

        <!-- News Container -->
        <div id="newsContainer" class="row g-4">
            <!-- News articles will be loaded here -->
        </div>

        <!-- Error Container -->
        <div id="errorContainer"></div>

        <!-- Load More Button -->
        <div class="text-center mt-4">
            <button id="loadMoreBtn" class="btn btn-primary btn-lg" style="display: none;">
                <i class="bi bi-plus-circle me-2"></i>Load More News
            </button>
        </div>
    </div>

    <!-- CENTERED MODAL OVERLAYS -->
    
    <!-- Video Modal -->
    <div id="videoModal" class="modal-overlay">
        <div class="video-modal-content">
            <div class="video-modal-header">
                <div class="video-modal-title">
                    <i class="bi bi-play-circle"></i>
                    <span id="videoModalTitle">Video Player</span>
                </div>
                <button class="modal-close-btn" onclick="newsHub.closeVideoModal()">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div id="videoPlayerContainer">
                <!-- Video player will be inserted here -->
            </div>
            <div class="video-controls-centered">
                <div class="video-info-centered">
                    <span class="video-badge-centered" id="videoBadge">Live Video</span>
                    <span id="videoDescription">Loading video content...</span>
                </div>
                <div>
                    <button class="modal-btn modal-btn-secondary me-2" onclick="newsHub.toggleFullscreen()">
                        <i class="bi bi-fullscreen me-1"></i>Fullscreen
                    </button>
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-primary" onclick="newsHub.openVideoSource()">
                    <i class="bi bi-box-arrow-up-right me-1"></i>Open Source
                </button>
                <button class="modal-btn modal-btn-secondary" onclick="newsHub.shareVideo()">
                    <i class="bi bi-share me-1"></i>Share Video
                </button>
                <button class="modal-btn modal-btn-secondary" onclick="newsHub.closeVideoModal()">
                    <i class="bi bi-x-circle me-1"></i>Close
                </button>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div id="previewModal" class="modal-overlay">
        <div class="preview-modal-content">
            <div class="preview-modal-header">
                <h3 class="preview-modal-title" id="previewModalTitle">Article Preview</h3>
                <button class="modal-close-btn" onclick="newsHub.closePreviewModal()">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="preview-meta">
                <div>
                    <div class="preview-source" id="previewSource">Source</div>
                    <div class="preview-time" id="previewTime">Time</div>
                </div>
                <div>
                    <span class="badge bg-primary" id="previewCategory">Category</span>
                </div>
            </div>
            <div class="preview-content-centered" id="previewContent">
                <div class="content-loading">
                    <div class="spinner-border spinner-border-sm text-primary me-2"></div>
                    <span>Loading preview...</span>
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-primary" onclick="newsHub.readFullFromPreview()">
                    <i class="bi bi-book me-1"></i>Read Full Article
                </button>
                <button class="modal-btn modal-btn-secondary" onclick="newsHub.shareFromPreview()">
                    <i class="bi bi-share me-1"></i>Share Article
                </button>
                <button class="modal-btn modal-btn-secondary" onclick="newsHub.closePreviewModal()">
                    <i class="bi bi-x-circle me-1"></i>Close
                </button>
            </div>
        </div>
    </div>

    <!-- Options Modal -->
    <div id="optionsModal" class="modal-overlay">
        <div class="options-modal-content">
            <div class="preview-modal-header">
                <h3 class="preview-modal-title">
                    <i class="bi bi-gear me-2"></i>Article Options
                </h3>
                <button class="modal-close-btn" onclick="newsHub.closeOptionsModal()">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div id="optionsMenuContent">
                <div class="options-menu-item" onclick="newsHub.readFullArticleFromOptions()">
                    <i class="bi bi-globe options-menu-icon"></i>
                    <div class="options-menu-text">
                        <div class="options-menu-title">Read Full Article</div>
                        <div class="options-menu-desc">Open complete article in web browser</div>
                    </div>
                </div>
                <div class="options-menu-item" onclick="newsHub.readFromSourceFromOptions()">
                    <i class="bi bi-box-arrow-up-right options-menu-icon"></i>
                    <div class="options-menu-text">
                        <div class="options-menu-title">Read from Source</div>
                        <div class="options-menu-desc">Visit original publisher website</div>
                    </div>
                </div>
                <div class="options-menu-item" onclick="newsHub.showFullContentFromOptions()">
                    <i class="bi bi-file-text options-menu-icon"></i>
                    <div class="options-menu-text">
                        <div class="options-menu-title">Show Full Content</div>
                        <div class="options-menu-desc">Display complete article text</div>
                    </div>
                </div>
                <div class="options-menu-item" onclick="newsHub.saveArticleFromOptions()">
                    <i class="bi bi-bookmark options-menu-icon"></i>
                    <div class="options-menu-text">
                        <div class="options-menu-title">Save Article</div>
                        <div class="options-menu-desc">Bookmark for later reading</div>
                    </div>
                </div>
                <div class="options-menu-item" onclick="newsHub.shareFromOptions()">
                    <i class="bi bi-share options-menu-icon"></i>
                    <div class="options-menu-text">
                        <div class="options-menu-title">Share Article</div>
                        <div class="options-menu-desc">Share via social media or copy link</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="text-center">
            <div class="loading-spinner mb-3"></div>
            <h4>Loading Live News...</h4>
            <p>Fetching latest content from News...</p>
        </div>
    </div>

    <script>
class LiveNewsHub {
    constructor() {
        this.initializeProperties();
        this.setupEventListeners();
        this.initializeCache();
        this.loadInitialNews();
        this.setupAutoRefresh();
        this.currentArticleData = null; // Store current article data for modals
    }

    initializeProperties() {
        // NewsAPI configuration
        this.baseUrl = 'https://newsapi.org/v2';
        this.apiKey = 'dcb071f269784ec280990d91a82ecc23'; // Your NewsAPI key
        
        // YouTube API configuration
        this.youtubeApiKey = 'dcb071f269784ec280990d91a82ecc23'; // Replace with your YouTube API key
        
        this.currentCategory = 'general';
        this.currentPage = 1;
        this.isLoading = false;
        this.searchTerm = '';

        // Cache configuration
        this.cacheExpiry = 5 * 60 * 1000; // 5 minutes for live news
        this.maxCacheSize = 50;

        this.initializeDOMElements();
    }

    initializeDOMElements() {
        this.newsContainer = document.getElementById('newsContainer');
        this.searchInput = document.getElementById('searchInput');
        this.loadingOverlay = document.getElementById('loadingOverlay');
        this.errorContainer = document.getElementById('errorContainer');
        this.loadMoreBtn = document.getElementById('loadMoreBtn');
        this.headlineContent = document.getElementById('headlineContent');
        this.refreshHeadlines = document.getElementById('refreshHeadlines');
        this.categoryButtons = document.querySelectorAll('.category-btn');

        // Cache elements
        this.cacheStatus = document.getElementById('cacheStatus');
        this.cacheText = document.getElementById('cacheText');
        this.cacheStatsText = document.getElementById('cacheStatsText');

        // Modal elements
        this.videoModal = document.getElementById('videoModal');
        this.previewModal = document.getElementById('previewModal');
        this.optionsModal = document.getElementById('optionsModal');
    }

    // YouTube API Integration
    async validateYouTubeVideo(videoId) {
        try {
            const response = await fetch(
                `https://www.googleapis.com/youtube/v3/videos?part=status&id=${videoId}&key=${this.youtubeApiKey}`
            );
            
            if (!response.ok) {
                throw new Error('YouTube API request failed');
            }
            
            const data = await response.json();
            
            if (data.items && data.items.length > 0) {
                const video = data.items[0];
                return video.status.embeddable && video.status.privacyStatus === "public";
            }
            
            return false;
        } catch (error) {
            console.error('YouTube API validation error:', error);
            return false;
        }
    }

    extractYouTubeId(url) {
        const regex = /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/;
        const match = url.match(regex);
        return match ? match[1] : null;
    }

    async createYouTubeEmbed(videoId, containerId) {
        const container = document.getElementById(containerId);
        
        try {
            // Validate video before embedding
            const isValid = await this.validateYouTubeVideo(videoId);
            
            if (isValid) {
                // ✅ Show the video
                container.innerHTML = `
                    <iframe width="100%" height="400"
                            src="https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&controls=1&modestbranding=1&rel=0"
                            frameborder="0" 
                            allowfullscreen
                            allow="autoplay; encrypted-media">
                    </iframe>
                `;
                return true;
            } else {
                // ❌ Fallback if not embeddable
                container.innerHTML = `
                    <div class="video-error-container">
                        <div class="video-error-content">
                            <i class="bi bi-exclamation-triangle" style="font-size: 3rem; color: #e74c3c; margin-bottom: 1rem;"></i>
                            <h3>Video Not Available</h3>
                            <p>This video is not available to embed or may be private.</p>
                            <button class="modal-btn modal-btn-primary" onclick="window.open('https://youtube.com/watch?v=${videoId}', '_blank')">
                                <i class="bi bi-youtube me-1"></i>Watch on YouTube
                            </button>
                        </div>
                    </div>
                `;
                return false;
            }
        } catch (error) {
            // ❌ Error fallback
            container.innerHTML = `
                <div class="video-error-container">
                    <div class="video-error-content">
                        <i class="bi bi-wifi-off" style="font-size: 3rem; color: #e74c3c; margin-bottom: 1rem;"></i>
                        <h3>Failed to Load Video</h3>
                        <p>Please check your connection and try again later.</p>
                        <button class="modal-btn modal-btn-primary" onclick="newsHub.retryVideoLoad('${videoId}', '${containerId}')">
                            <i class="bi bi-arrow-clockwise me-1"></i>Retry
                        </button>
                    </div>
                </div>
            `;
            return false;
        }
    }

    async retryVideoLoad(videoId, containerId) {
        const container = document.getElementById(containerId);
        container.innerHTML = `
            <div class="content-loading">
                <div class="spinner-border spinner-border-sm text-primary me-2"></div>
                <span>Retrying video load...</span>
            </div>
        `;
        
        await this.createYouTubeEmbed(videoId, containerId);
    }

    // Cache Management
    initializeCache() {
        if (!localStorage.getItem('live_news_cache')) {
            localStorage.setItem('live_news_cache', JSON.stringify({}));
        }
        this.updateCacheStatus();
    }

    getCacheKey(endpoint, params) {
        return `${endpoint}_${JSON.stringify(params)}`;
    }

    getCachedData(cacheKey) {
        try {
            const cache = JSON.parse(localStorage.getItem('live_news_cache') || '{}');
            const cached = cache[cacheKey];
            
            if (cached && (Date.now() - cached.timestamp) < this.cacheExpiry) {
                return cached.data;
            }
            return null;
        } catch (error) {
            console.error('Cache read error:', error);
            return null;
        }
    }

    setCachedData(cacheKey, data) {
        try {
            const cache = JSON.parse(localStorage.getItem('live_news_cache') || '{}');
            
            // Remove old entries if cache is too large
            const keys = Object.keys(cache);
            if (keys.length >= this.maxCacheSize) {
                const oldestKey = keys.reduce((oldest, key) => 
                    cache[key].timestamp < cache[oldest].timestamp ? key : oldest
                );
                delete cache[oldestKey];
            }

            cache[cacheKey] = {
                data: data,
                timestamp: Date.now()
            };

            localStorage.setItem('live_news_cache', JSON.stringify(cache));
            this.updateCacheStatus();
        } catch (error) {
            console.error('Cache write error:', error);
        }
    }

    clearCache() {
        localStorage.setItem('live_news_cache', JSON.stringify({}));
        this.updateCacheStatus();
        this.showNotification('Cache cleared - Fresh news will be loaded', 'success');
        this.loadCategoryNews();
    }

    updateCacheStatus() {
        try {
            const cache = JSON.parse(localStorage.getItem('live_news_cache') || '{}');
            const count = Object.keys(cache).length;
            this.cacheStatsText.textContent = `${count} articles cached`;
            this.cacheText.textContent = `Cache: ${count} items`;
        } catch (error) {
            this.cacheStatsText.textContent = 'Cache error';
            this.cacheText.textContent = 'Cache: Error';
        }
    }

    setupEventListeners() {
        // Search functionality
        this.searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') this.performSearch();
        });

        // Category filters
        this.categoryButtons.forEach(btn => {
            btn.addEventListener('click', () => this.selectCategory(btn));
        });

        // Headlines refresh
        this.refreshHeadlines.addEventListener('click', () => this.loadBreakingNews());

        // Load more button
        this.loadMoreBtn.addEventListener('click', () => this.loadMoreNews());

        // Modal close on background click
        [this.videoModal, this.previewModal, this.optionsModal].forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    this.closeAllModals();
                }
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                this.closeAllModals();
            }
        });
    }

    // Auto-refresh for live news
    setupAutoRefresh() {
        // Refresh breaking news every 2 minutes
        setInterval(() => {
            this.loadBreakingNews();
        }, 2 * 60 * 1000);

        // Refresh main news every 5 minutes
        setInterval(() => {
            if (!this.isLoading) {
                this.showNotification('Refreshing live news...', 'info');
                this.currentPage = 1;
                this.loadCategoryNews();
            }
        }, 5 * 60 * 1000);
    }

    // News Loading Functions
    async loadInitialNews() {
        await this.loadBreakingNews();
        await this.loadCategoryNews();
    }

    async loadBreakingNews() {
        try {
            const headlines = await this.fetchNews('top-headlines', { 
                category: 'general', 
                pageSize: 10,
                country: 'us'
            });
            this.displayBreakingNews(headlines);
        } catch (error) {
            console.error('Breaking news error:', error);
            this.displayBreakingNewsError(error.message);
        }
    }

    async loadCategoryNews() {
        if (this.isLoading) return;

        this.isLoading = true;
        this.showLoading();

        try {
            const params = {
                category: this.currentCategory,
                pageSize: 20,
                page: this.currentPage,
                country: 'us'
            };

            if (this.searchTerm) {
                params.q = this.searchTerm;
                delete params.category;
                delete params.country;
            }

            const articles = await this.fetchNews(this.searchTerm ? 'everything' : 'top-headlines', params);

            if (this.currentPage === 1) {
                this.newsContainer.innerHTML = '';
            }

            this.displayNews(articles);
            this.loadMoreBtn.style.display = articles && articles.length >= 20 ? 'block' : 'none';

        } catch (error) {
            console.error('News loading error:', error);
            this.showError(error.message);
        } finally {
            this.isLoading = false;
            this.hideLoading();
        }
    }

    async fetchNews(endpoint, params) {
        const cacheKey = this.getCacheKey(endpoint, params);
        
        // Try cache first for non-breaking news
        if (endpoint !== 'top-headlines' || params.pageSize !== 10) {
            const cachedData = this.getCachedData(cacheKey);
            if (cachedData) {
                this.showNotification('Loaded from cache', 'info');
                return cachedData;
            }
        }

        try {
            const url = new URL(`${this.baseUrl}/${endpoint}`);
            Object.keys(params).forEach(key => url.searchParams.append(key, params[key]));
            url.searchParams.append('apiKey', this.apiKey);

            const response = await fetch(url);
            
            if (!response.ok) {
                if (response.status === 429) {
                    throw new Error('API rate limit exceeded. Please try again later.');
                } else if (response.status === 401) {
                    throw new Error('Invalid API key. Please check your NewsAPI configuration.');
                } else {
                    throw new Error(`API Error: ${response.status} - ${response.statusText}`);
                }
            }

            const data = await response.json();
            const articles = data.articles || [];
            
            // Cache the results
            this.setCachedData(cacheKey, articles);
            
            if (articles.length > 0) {
                this.showNotification(`Loaded ${articles.length} live articles`, 'success');
            }
            
            return articles;

        } catch (error) {
            console.error('API fetch error:', error);
            
            // Try to return cached data even if expired
            const cache = JSON.parse(localStorage.getItem('live_news_cache') || '{}');
            const cached = cache[cacheKey];
            if (cached) {
                this.showNotification('Using cached data (API unavailable)', 'warning');
                return cached.data;
            }
            
            throw error;
        }
    }

    displayBreakingNews(articles) {
        if (!articles || articles.length === 0) {
            this.headlineContent.innerHTML = '<span class="headline-item">No breaking news available</span>';
            return;
        }

        const headlines = articles.map(article => 
            `<span class="headline-item" data-url="${article.url}">${article.title}</span>`
        ).join('');

        this.headlineContent.innerHTML = headlines;

        this.headlineContent.querySelectorAll('.headline-item').forEach(item => {
            item.addEventListener('click', () => {
                if (item.dataset.url) {
                    window.open(item.dataset.url, '_blank');
                }
            });
        });
    }

    displayBreakingNewsError(message) {
        this.headlineContent.innerHTML = `<span class="headline-item">Breaking news unavailable: ${message}</span>`;
    }

    displayNews(articles) {
        if (!articles || articles.length === 0) {
            if (this.currentPage === 1) {
                this.showError('No news articles found. Try a different category or search term.');
            }
            return;
        }

        articles.forEach((article, index) => {
            if (article.title && article.title !== '[Removed]') {
                const newsCard = this.createNewsCard(article, index);
                this.newsContainer.appendChild(newsCard);
            }
        });

        this.clearError();
    }

    createNewsCard(article, index) {
        const cardElement = document.createElement('div');
        cardElement.className = 'col-lg-4 col-md-6 col-sm-12';

        const timeAgo = this.getTimeAgo(new Date(article.publishedAt));
        const defaultImage = "https://images.unsplash.com/photo-1504711434969-e33886168f5c?w=400&h=200&fit=crop";
        const isCached = this.getCachedData(this.getCacheKey('article', { url: article.url })) !== null;
        const videoInfo = this.detectVideoContent(article);

        cardElement.innerHTML = `
            <div class="card news-card h-100 ${isCached ? 'cached' : ''}" 
                 data-url="${article.url}" 
                 data-title="${this.escapeHtml(article.title)}"
                 data-description="${this.escapeHtml(article.description || '')}"
                 data-content="${this.escapeHtml(article.content || '')}"
                 data-source="${this.escapeHtml(article.source.name)}"
                 data-published="${article.publishedAt}"
                 data-has-video="${videoInfo.hasVideo}"
                 data-video-id="${videoInfo.videoId || ''}"
                 data-video-type="${videoInfo.videoType || ''}">
                ${isCached ? '<div class="cache-indicator-card"><i class="bi bi-database"></i></div>' : ''}
                ${videoInfo.hasVideo ? '<div class="cache-indicator-card" style="background: var(--breaking-color); top: 40px;"><i class="bi bi-play-circle"></i></div>' : ''}
                <img 
                    src="${article.urlToImage || defaultImage}" 
                    class="card-img-top news-card-img" 
                    alt="${article.title}"
                    onerror="this.src='${defaultImage}'"
                >
                <div class="card-body d-flex flex-column">
                    <div class="source-info">
                        <div class="d-flex align-items-center">
                            <span class="source-name">${article.source.name}</span>
                            ${isCached ? '<i class="bi bi-database text-muted ms-2" title="Cached"></i>' : ''}
                            ${videoInfo.hasVideo ? '<i class="bi bi-play-circle text-danger ms-2" title="Video Available"></i>' : ''}
                        </div>
                        <span class="publish-time">${timeAgo}</span>
                    </div>
                    
                    <h5 class="card-title">${this.truncateText(article.title, 80)}</h5>
                    <p class="card-text flex-grow-1">${this.truncateText(article.description || 'No description available', 120)}</p>
                    
                    <div class="mt-auto">
                        <div class="action-buttons">
                            <button class="btn-preview" onclick="newsHub.openPreviewModal(this)">
                                <i class="bi bi-eye me-1"></i>Preview
                            </button>
                            ${videoInfo.hasVideo ? `
                                <button class="btn-watch" onclick="newsHub.openVideoModal(this)">
                                    <i class="bi bi-play-circle me-1"></i>Video
                                </button>
                            ` : ''}
                            <button class="btn-read" onclick="newsHub.readFullArticle('${article.url}')">
                                <i class="bi bi-book me-1"></i>Read
                            </button>
                            <button class="btn-options" onclick="newsHub.openOptionsModal(this)">
                                <i class="bi bi-three-dots me-1"></i>Options
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;

        return cardElement;
    }

    detectVideoContent(article) {
        // Enhanced video detection with YouTube integration
        const content = `${article.title} ${article.description} ${article.content || ''}`.toLowerCase();
        const videoKeywords = ['video', 'watch', 'youtube', 'vimeo', 'mp4', 'webm'];
        
        // Check for YouTube links in content or URL
        const youtubeId = this.extractYouTubeId(article.url) || this.extractYouTubeId(content);
        if (youtubeId) {
            return { 
                hasVideo: true, 
                videoId: youtubeId, 
                videoType: 'youtube' 
            };
        }
        
        // Check for video keywords
        const hasVideoKeywords = videoKeywords.some(keyword => content.includes(keyword));
        
        // Check if image URL suggests video content
        const hasVideoImage = article.urlToImage && (
            article.urlToImage.includes('video') || 
            article.urlToImage.includes('youtube') ||
            article.urlToImage.includes('thumbnail')
        );
        
        // Simulate video availability for demo (remove in production)
        const simulatedVideo = Math.random() > 0.7;
        
        if (hasVideoKeywords || hasVideoImage || simulatedVideo) {
            // Generate sample video content for demo
            const videoTypes = ['youtube', 'vimeo', 'direct'];
            const randomType = videoTypes[Math.floor(Math.random() * videoTypes.length)];
            
            let videoId = null;
            if (randomType === 'youtube') {
                // Sample YouTube video IDs for demo
                const sampleVideoIds = ['dQw4w9WgXcQ', 'jNQXAC9IVRw', 'M7lc1UVf-VE'];
                videoId = sampleVideoIds[Math.floor(Math.random() * sampleVideoIds.length)];
            }
            
            return {
                hasVideo: true,
                videoId: videoId,
                videoType: randomType
            };
        }
        
        return { hasVideo: false };
    }

    // ENHANCED VIDEO MODAL FUNCTIONS

    async openVideoModal(button) {
        const card = button.closest('.news-card');
        this.currentArticleData = this.getArticleDataFromCard(card);
        
        await this.showVideoModal();
    }

    async showVideoModal() {
        const { title, url, source, hasVideo, videoId, videoType } = this.currentArticleData;
        
        document.getElementById('videoModalTitle').textContent = this.truncateText(title, 60);
        document.getElementById('videoBadge').textContent = hasVideo ? 'Live Video' : 'Related Video';
        document.getElementById('videoDescription').textContent = `From ${source}`;
        
        this.videoModal.classList.add('active');
        document.body.style.overflow = 'hidden';
        
        // Show loading state
        document.getElementById('videoPlayerContainer').innerHTML = `
            <div class="content-loading" style="height: 400px; display: flex; align-items: center; justify-content: center;">
                <div class="spinner-border spinner-border-sm text-primary me-2"></div>
                <span>Loading video content...</span>
            </div>
        `;
        
        // Load video content based on type
        await this.loadVideoContent(videoId, videoType);
    }

    async loadVideoContent(videoId, videoType) {
        const container = document.getElementById('videoPlayerContainer');
        
        try {
            if (videoType === 'youtube' && videoId) {
                // Use YouTube API validation and embedding
                const success = await this.createYouTubeEmbed(videoId, 'videoPlayerContainer');
                if (!success) {
                    this.showNotification('YouTube video could not be loaded', 'warning');
                }
            } else if (videoType === 'vimeo') {
                // Vimeo embed
                container.innerHTML = `
                    <iframe 
                        class="video-player-centered" 
                        src="https://player.vimeo.com/video/148751763?autoplay=1&muted=1" 
                        frameborder="0" 
                        allowfullscreen>
                    </iframe>
                `;
            } else if (videoType === 'direct') {
                // Direct video
                container.innerHTML = `
                    <video class="video-player-centered" controls autoplay muted preload="metadata">
                        <source src="https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4" type="video/mp4">
                        <track src="/path/to/captions.vtt" kind="subtitles" srclang="en" label="English">
                        Your browser does not support the video tag.
                    </video>
                `;
            } else {
                // Fallback content
                container.innerHTML = `
                    <div class="video-error-container">
                        <div class="video-error-content">
                            <i class="bi bi-film" style="font-size: 3rem; color: #3498db; margin-bottom: 1rem;"></i>
                            <h3>Video Content Available</h3>
                            <p>This article contains video content available at the source.</p>
                            <button class="modal-btn modal-btn-primary" onclick="window.open('${this.currentArticleData.url}', '_blank')">
                                <i class="bi bi-box-arrow-up-right me-1"></i>Watch at Source
                            </button>
                        </div>
                    </div>
                `;
            }
        } catch (error) {
            console.error('Video loading error:', error);
            container.innerHTML = `
                <div class="video-error-container">
                    <div class="video-error-content">
                        <i class="bi bi-exclamation-triangle" style="font-size: 3rem; color: #e74c3c; margin-bottom: 1rem;"></i>
                        <h3>Video Loading Failed</h3>
                        <p>Unable to load video content. Please try again later.</p>
                        <button class="modal-btn modal-btn-secondary" onclick="newsHub.loadVideoContent('${videoId}', '${videoType}')">
                            <i class="bi bi-arrow-clockwise me-1"></i>Retry
                        </button>
                    </div>
                </div>
            `;
        }
    }

    openPreviewModal(button) {
        const card = button.closest('.news-card');
        this.currentArticleData = this.getArticleDataFromCard(card);
        
        this.showPreviewModal();
    }

    async showPreviewModal() {
        const { title, description, content, source, publishedAt, url } = this.currentArticleData;
        
        document.getElementById('previewModalTitle').textContent = title;
        document.getElementById('previewSource').textContent = source;
        document.getElementById('previewTime').textContent = this.getTimeAgo(new Date(publishedAt));
        document.getElementById('previewCategory').textContent = this.currentCategory.toUpperCase();
        
        this.previewModal.classList.add('active');
        document.body.style.overflow = 'hidden';
        
        // Show loading state
        document.getElementById('previewContent').innerHTML = `
            <div class="content-loading">
                <div class="spinner-border spinner-border-sm text-primary me-2"></div>
                <span>Loading preview...</span>
            </div>
        `;
        
        // Simulate content loading
        setTimeout(() => {
            this.displayPreviewContent(description, content);
        }, 1000);
    }

    displayPreviewContent(description, content) {
        const summary = this.generateSummary(description, content);
        const readingTime = Math.ceil((content || description || '').length / 1000) + ' min';
        const hasVideo = this.currentArticleData.hasVideo;

        const previewHTML = `
            <div class="mb-4">
                <h6><i class="bi bi-file-text me-2"></i>Article Summary</h6>
                <p style="font-size: 1.1rem; line-height: 1.8;">${summary}</p>
            </div>
            
            ${content && content !== 'null' ? `
                <div class="full-article-content-centered">
                    <h6><i class="bi bi-file-text me-2"></i>Full Article Content</h6>
                    <p>${this.truncateText(content, 800)}</p>
                    ${content.length > 800 ? '<p><em>...content continues in full article</em></p>' : ''}
                </div>
            ` : ''}
            
            ${hasVideo ? `
                <div class="mt-4 p-3" style="background: rgba(231, 76, 60, 0.1); border-radius: 10px; border-left: 4px solid var(--breaking-color);">
                    <h6><i class="bi bi-play-circle me-2"></i>Video Content Available</h6>
                    <p class="mb-0">This article includes video content. Click the Video button to watch.</p>
                </div>
            ` : ''}
            
            <div class="mt-4 p-3" style="background: rgba(255, 255, 255, 0.05); border-radius: 10px;">
                <div class="d-flex justify-content-between align-items-center">
                    <small class="text-muted">
                        <i class="bi bi-clock me-1"></i>Estimated reading time: ${readingTime}
                    </small>
                    <small class="text-muted">
                        <i class="bi bi-eye me-1"></i>Live preview
                    </small>
                </div>
            </div>
        `;

        document.getElementById('previewContent').innerHTML = previewHTML;
    }

    openOptionsModal(button) {
        const card = button.closest('.news-card');
        this.currentArticleData = this.getArticleDataFromCard(card);
        
        this.optionsModal.classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    // Modal utility functions
    getArticleDataFromCard(card) {
        return {
            url: card.dataset.url,
            title: card.dataset.title,
            description: card.dataset.description,
            content: card.dataset.content,
            source: card.dataset.source,
            publishedAt: card.dataset.published,
            hasVideo: card.dataset.hasVideo === 'true',
            videoId: card.dataset.videoId,
            videoType: card.dataset.videoType
        };
    }

    closeVideoModal() {
        this.videoModal.classList.remove('active');
        document.body.style.overflow = 'auto';
        
        // Stop any playing videos
        const videoContainer = document.getElementById('videoPlayerContainer');
        videoContainer.innerHTML = '';
    }

    closePreviewModal() {
        this.previewModal.classList.remove('active');
        document.body.style.overflow = 'auto';
    }

    closeOptionsModal() {
        this.optionsModal.classList.remove('active');
        document.body.style.overflow = 'auto';
    }

    closeAllModals() {
        this.closeVideoModal();
        this.closePreviewModal();
        this.closeOptionsModal();
    }

    // Modal action functions
    toggleFullscreen() {
        const videoPlayer = document.querySelector('.video-player-centered, iframe, video');
        if (videoPlayer) {
            if (videoPlayer.requestFullscreen) {
                videoPlayer.requestFullscreen();
            } else if (videoPlayer.webkitRequestFullscreen) {
                videoPlayer.webkitRequestFullscreen();
            } else if (videoPlayer.msRequestFullscreen) {
                videoPlayer.msRequestFullscreen();
            }
        }
    }

    openVideoSource() {
        if (this.currentArticleData) {
            window.open(this.currentArticleData.url, '_blank');
        }
    }

    shareVideo() {
        if (this.currentArticleData) {
            this.shareArticle(this.currentArticleData.url, this.currentArticleData.title);
        }
    }

    readFullFromPreview() {
        if (this.currentArticleData) {
            window.open(this.currentArticleData.url, '_blank');
        }
    }

    shareFromPreview() {
        if (this.currentArticleData) {
            this.shareArticle(this.currentArticleData.url, this.currentArticleData.title);
        }
    }

    // Options modal functions
    readFullArticleFromOptions() {
        if (this.currentArticleData) {
            window.open(this.currentArticleData.url, '_blank');
            this.closeOptionsModal();
        }
    }

    readFromSourceFromOptions() {
        if (this.currentArticleData) {
            window.open(this.currentArticleData.url, '_blank');
            this.closeOptionsModal();
            this.showNotification('Opening article from original source', 'info');
        }
    }

    showFullContentFromOptions() {
        if (this.currentArticleData) {
            const { title, content, url } = this.currentArticleData;
            
            if (!content || content === 'null' || content === '') {
                this.showNotification('Full content not available - try reading from source', 'warning');
                return;
            }

            this.closeOptionsModal();
            this.displayFullContentModal(title, content, url);
        }
    }

    saveArticleFromOptions() {
        if (this.currentArticleData) {
            // Save to localStorage
            const savedArticles = JSON.parse(localStorage.getItem('saved_articles') || '[]');
            const articleToSave = {
                ...this.currentArticleData,
                savedAt: Date.now()
            };
            
            // Check if already saved
            const isAlreadySaved = savedArticles.some(article => article.url === articleToSave.url);
            
            if (!isAlreadySaved) {
                savedArticles.push(articleToSave);
                localStorage.setItem('saved_articles', JSON.stringify(savedArticles));
                this.showNotification('Article saved successfully', 'success');
            } else {
                this.showNotification('Article already saved', 'warning');
            }
            
            this.closeOptionsModal();
        }
    }

    shareFromOptions() {
        if (this.currentArticleData) {
            this.shareArticle(this.currentArticleData.url, this.currentArticleData.title);
            this.closeOptionsModal();
        }
    }

    displayFullContentModal(title, content, url) {
        const modal = document.createElement('div');
        modal.className = 'modal-overlay active';
        modal.style.zIndex = '10000';
        
        modal.innerHTML = `
            <div class="preview-modal-content" style="max-width: 900px;">
                <div class="preview-modal-header">
                    <h3 class="preview-modal-title">
                        <i class="bi bi-file-text me-2"></i>Full Article Content
                    </h3>
                    <button class="modal-close-btn" onclick="this.closest('.modal-overlay').remove(); document.body.style.overflow = 'auto';">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
                <div class="preview-content-centered">
                    <h4 class="mb-4">${title}</h4>
                    <div style="line-height: 1.8; color: rgba(255,255,255,0.9); font-size: 1.1rem;">
                        ${content.replace(/\n/g, '<br>')}
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="modal-btn modal-btn-primary" onclick="window.open('${url}', '_blank')">
                        <i class="bi bi-box-arrow-up-right me-1"></i>Read Original
                    </button>
                    <button class="modal-btn modal-btn-secondary" onclick="newsHub.shareArticle('${url}', '${title.replace(/'/g, "\\'")}')">
                        <i class="bi bi-share me-1"></i>Share Article
                    </button>
                    <button class="modal-btn modal-btn-secondary" onclick="this.closest('.modal-overlay').remove(); document.body.style.overflow = 'auto';">
                        <i class="bi bi-x-circle me-1"></i>Close
                    </button>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        document.body.style.overflow = 'hidden';
        
        // Close on background click
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.remove();
                document.body.style.overflow = 'auto';
            }
        });
    }

    generateSummary(description, content) {
        const text = content || description || 'No content available for this article.';
        
        if (text.length <= 300) return text;
        
        // Try to find a good breaking point
        const sentences = text.split('. ');
        let summary = '';
        
        for (let sentence of sentences) {
            if ((summary + sentence).length > 300) break;
            summary += sentence + '. ';
        }
        
        return summary || text.substring(0, 300) + '...';
    }

    shareArticle(url, title) {
        if (navigator.share) {
            navigator.share({
                title: title,
                url: url
            }).then(() => {
                this.showNotification('Article shared successfully', 'success');
            }).catch(() => {
                this.fallbackShare(url, title);
            });
        } else {
            this.fallbackShare(url, title);
        }
    }

    fallbackShare(url, title) {
        // Copy to clipboard
        navigator.clipboard.writeText(`${title} - ${url}`).then(() => {
            this.showNotification('Article link copied to clipboard', 'success');
        }).catch(() => {
            this.showNotification('Unable to share article', 'error');
        });
    }

    // Search and Category Functions
    performSearch() {
        const query = this.searchInput.value.trim();
        if (query) {
            this.searchTerm = query;
            this.currentPage = 1;
            this.loadCategoryNews();
            this.showNotification(`Searching live news for: ${query}`, 'info');
        }
    }

    selectCategory(button) {
        this.categoryButtons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        
        this.currentCategory = button.dataset.category;
        this.currentPage = 1;
        this.searchTerm = '';
        this.searchInput.value = '';
        
        this.loadCategoryNews();
        this.showNotification(`Loading live ${this.currentCategory} news`, 'info');
    }

    loadMoreNews() {
        this.currentPage++;
        this.loadCategoryNews();
    }

    readFullArticle(url) {
        window.open(url, '_blank');
        this.showNotification('Opening full article', 'info');
    }

    // UI Helper Functions
    showLoading() {
        this.loadingOverlay.style.display = 'flex';
    }

    hideLoading() {
        this.loadingOverlay.style.display = 'none';
    }

    showError(message) {
        this.errorContainer.innerHTML = `
            <div class="error-container">
                <i class="bi bi-exclamation-triangle me-2" style="font-size: 2rem;"></i>
                <h5>Unable to Load Live News</h5>
                <p>${message}</p>
                <button class="retry-btn" onclick="newsHub.retryLastAction()">
                    <i class="bi bi-arrow-clockwise me-2"></i>Try Again
                </button>
            </div>
        `;
    }

    clearError() {
        this.errorContainer.innerHTML = '';
    }

    retryLastAction() {
        this.clearError();
        this.loadCategoryNews();
    }

    showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
            <i class="bi bi-${this.getNotificationIcon(type)} me-2"></i>
            ${message}
        `;

        document.body.appendChild(notification);

        setTimeout(() => {
            notification.style.animation = 'slideIn 0.3s ease reverse';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    getNotificationIcon(type) {
        const icons = {
            success: 'check-circle',
            warning: 'exclamation-triangle',
            error: 'x-circle',
            info: 'info-circle'
        };
        return icons[type] || 'info-circle';
    }

    // Utility Functions
    escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    truncateText(text, maxLength) {
        if (!text) return '';
        return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
    }

    getTimeAgo(date) {
        const now = new Date();
        const diffMs = now - date;
        const diffMins = Math.floor(diffMs / 60000);
        const diffHours = Math.floor(diffMins / 60);
        const diffDays = Math.floor(diffHours / 24);

        if (diffMins < 1) return 'Just now';
        if (diffMins < 60) return `${diffMins}m ago`;
        if (diffHours < 24) return `${diffHours}h ago`;
        return `${diffDays}d ago`;
    }
}

// Initialize the Live News Hub
let newsHub;
document.addEventListener('DOMContentLoaded', () => {
    newsHub = new LiveNewsHub();
});

// Security measures
document.addEventListener("keydown", function(e) {
    // F12, Ctrl+Shift+I, and Ctrl+U
    if ((e.key === 'F12') || 
        (e.ctrlKey && (e.key === 'u' || e.key === 'U')) || 
        (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'i'))) {
        e.preventDefault();
    }
});

// Detect DevTools opening (using resize event)
let devtoolsOpen = false;
setInterval(function() {
    const width = window.outerWidth - window.innerWidth > 100;
    const height = window.outerHeight - window.innerHeight > 100;
    if ((width || height) && !devtoolsOpen) {
        devtoolsOpen = true;
    }
    if (!(width || height) && devtoolsOpen) {
        devtoolsOpen = false;
    }
}, 1000);
</script>
</body>
</html>