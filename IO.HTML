<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmileX - Advanced Social Platform</title>
    <meta name="description" content="SmileX - A modern social platform for connecting communities and sharing experiences">
    <meta name="keywords" content="social media, communities, chat, posts, networking">
    
    <!-- Fonts and Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* Color Variables */
            --primary-color: #6a11cb;
            --secondary-color: #2575fc;
            --accent-color: #00b4db;
            --background-color: #000000;
            --surface-color: #1a1a1a;
            --surface-secondary: #2a2a2a;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --text-muted: #666666;
            --border-color: #404040;
            --success-color: #10b981;
            --error-color: #ef4444;
            --warning-color: #f59e0b;
            --premium-gold: #ffd700;
            --premium-gradient: linear-gradient(45deg, #ffd700, #ffed4e, #ffd700);
            
            /* Spacing Variables */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
            
            /* Typography Variables */
            --font-primary: 'Orbitron', sans-serif;
            --font-secondary: 'Poppins', sans-serif;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 2rem;
            
            /* Border Radius Variables */
            --radius-sm: 0.25rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-full: 9999px;
            
            /* Shadow Variables */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            
            /* Transition Variables */
            --transition-fast: 0.15s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            background: var(--background-color);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Accessibility Improvements */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus Styles for Accessibility */
        *:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        button:focus,
        input:focus,
        select:focus,
        textarea:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* Skip Link for Screen Readers */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--primary-color);
            color: white;
            padding: 8px;
            text-decoration: none;
            border-radius: var(--radius-md);
            z-index: 10000;
        }

        .skip-link:focus {
            top: 6px;
        }

        /* Preloader Styles */
        .preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: var(--transition-slow);
        }

        .preloader-logo {
            font-size: var(--font-size-3xl);
            margin-bottom: var(--spacing-md);
            animation: bounce 2s infinite;
        }

        .preloader-text {
            font-size: var(--font-size-2xl);
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient 3s ease infinite;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-top: var(--spacing-xl);
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-30px); }
            60% { transform: translateY(-15px); }
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Premium Animations */
        @keyframes disco {
            0% { color: #ff0000; text-shadow: 0 0 10px #ff0000; }
            16% { color: #ff8000; text-shadow: 0 0 10px #ff8000; }
            33% { color: #ffff00; text-shadow: 0 0 10px #ffff00; }
            50% { color: #00ff00; text-shadow: 0 0 10px #00ff00; }
            66% { color: #0080ff; text-shadow: 0 0 10px #0080ff; }
            83% { color: #8000ff; text-shadow: 0 0 10px #8000ff; }
            100% { color: #ff0080; text-shadow: 0 0 10px #ff0080; }
        }

        @keyframes premium-glow {
            0%, 100% { box-shadow: 0 0 20px var(--premium-gold); }
            50% { box-shadow: 0 0 40px var(--premium-gold), 0 0 60px var(--premium-gold); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        /* Premium Styles */
        .premium-user {
            position: relative;
        }

        .premium-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: var(--premium-gradient);
            color: #000;
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            font-size: 10px;
            font-weight: bold;
            animation: premium-glow 2s ease-in-out infinite;
        }

        .disco-text {
            animation: disco 2s linear infinite;
            font-weight: bold;
        }

        .premium-emoji {
            font-size: 1.2em;
            animation: float 2s ease-in-out infinite;
        }

        /* Modal Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-normal);
        }

        .overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Onboarding Modal */
        .onboarding-container {
            background: var(--surface-color);
            padding: var(--spacing-xl);
            border-radius: var(--radius-xl);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            transform: scale(0.9);
            transition: var(--transition-normal);
        }

        .overlay.active .onboarding-container {
            transform: scale(1);
        }

        .onboarding-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
        }

        .onboarding-header h2 {
            font-size: var(--font-size-2xl);
            margin-bottom: var(--spacing-sm);
            color: var(--primary-color);
        }

        /* Profile Picture Upload */
        .profile-upload-section {
            text-align: center;
            margin-bottom: var(--spacing-lg);
        }

        .profile-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto var(--spacing-md);
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: var(--font-size-3xl);
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .profile-preview:hover {
            transform: scale(1.05);
        }

        .profile-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .profile-upload-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: var(--transition-fast);
            border-radius: 50%;
        }

        .profile-preview:hover .profile-upload-overlay {
            opacity: 1;
        }

        .profile-upload-buttons {
            display: flex;
            gap: var(--spacing-sm);
            justify-content: center;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: var(--spacing-md);
        }

        .form-label {
            display: block;
            margin-bottom: var(--spacing-xs);
            font-weight: 500;
            color: var(--text-secondary);
        }

        .form-control, .form-select {
            width: 100%;
            padding: 12px;
            background: var(--surface-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: var(--font-size-sm);
            transition: var(--transition-fast);
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(106, 17, 203, 0.2);
        }

        .form-control::placeholder {
            color: var(--text-muted);
        }

        .name-validation {
            margin-top: var(--spacing-xs);
            font-size: var(--font-size-xs);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .name-available {
            color: var(--success-color);
        }

        .name-taken {
            color: var(--error-color);
        }

        /* Consent Section */
        .consent-section {
            margin: var(--spacing-lg) 0;
            padding: var(--spacing-md);
            background: var(--surface-secondary);
            border-radius: var(--radius-md);
        }

        .consent-item {
            display: flex;
            align-items: center;
            margin: var(--spacing-sm) 0;
        }

        .consent-item input[type="checkbox"] {
            margin-right: var(--spacing-sm);
            width: 16px;
            height: 16px;
        }

        .consent-item label {
            cursor: pointer;
            user-select: none;
        }

        /* Button Styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-fast);
            text-decoration: none;
            gap: var(--spacing-xs);
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #5a0fb8;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--surface-secondary);
            color: var(--text-secondary);
        }

        .btn-secondary:hover {
            background: var(--border-color);
            color: var(--text-primary);
        }

        .btn-premium {
            background: var(--premium-gradient);
            color: #000;
            font-weight: bold;
            animation: premium-glow 2s ease-in-out infinite;
        }

        .btn:disabled {
            background: var(--border-color);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Navigation */
        nav {
            background: var(--background-color);
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 50;
            border-bottom: 1px solid var(--border-color);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-md);
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 64px;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: var(--font-size-xl);
            font-weight: bold;
            color: var(--primary-color);
            text-decoration: none;
        }

        .logo i {
            margin-right: var(--spacing-sm);
            font-size: var(--font-size-2xl);
        }

        .nav-search {
            position: relative;
            display: none;
        }

        @media (min-width: 768px) {
            .nav-search {
                display: block;
            }
        }

        .nav-search input {
            width: 300px;
            padding: 8px 12px 8px 40px;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            color: var(--text-primary);
            font-size: var(--font-size-sm);
        }

        .nav-search i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            max-height: 400px;
            overflow-y: auto;
            z-index: 100;
            margin-top: 4px;
        }

        .search-result-item {
            padding: var(--spacing-sm) var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .search-result-item:hover {
            background: var(--surface-secondary);
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-type {
            font-size: var(--font-size-xs);
            color: var(--text-muted);
            text-transform: uppercase;
            font-weight: bold;
        }

        .search-result-title {
            font-weight: 500;
            margin: var(--spacing-xs) 0;
        }

        .search-result-description {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .nav-button {
            padding: var(--spacing-sm);
            background: var(--surface-color);
            border: none;
            border-radius: 50%;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition-fast);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-button:hover {
            background: var(--surface-secondary);
            color: var(--primary-color);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: var(--font-size-sm);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .user-avatar.premium {
            border: 2px solid var(--premium-gold);
            animation: premium-glow 2s ease-in-out infinite;
        }

        /* Main Layout */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--spacing-lg) var(--spacing-md);
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-lg);
        }

        @media (min-width: 1024px) {
            .main-container {
                grid-template-columns: 250px 1fr 250px;
            }
        }

        /* Sidebar */
        .sidebar {
            background: var(--surface-color);
            border-radius: var(--radius-xl);
            padding: var(--spacing-lg);
            height: fit-content;
            position: sticky;
            top: 80px;
            display: none;
        }

        @media (min-width: 1024px) {
            .sidebar {
                display: block;
            }
        }

        .sidebar h3 {
            font-size: var(--font-size-lg);
            margin-bottom: var(--spacing-md);
            color: var(--primary-color);
        }

        .sidebar ul {
            list-style: none;
        }

        .sidebar li {
            margin-bottom: var(--spacing-sm);
        }

        .sidebar a {
            display: flex;
            align-items: center;
            padding: var(--spacing-sm);
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: var(--radius-md);
            transition: var(--transition-fast);
        }

        .sidebar a:hover {
            background: var(--surface-secondary);
            color: var(--primary-color);
        }

        /* Community Icons */
        .community-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: var(--spacing-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: var(--font-size-xs);
            font-weight: bold;
        }

        /* Main Feed */
        .main-feed {
            min-height: 100vh;
        }

        /* Create Post Card */
        .create-post-card {
            background: var(--surface-color);
            border-radius: var(--radius-xl);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-md);
        }

        .create-post-input {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        .create-post-input input {
            flex: 1;
            padding: 12px 16px;
            background: var(--surface-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            color: var(--text-primary);
            cursor: pointer;
        }

        .post-type-buttons {
            display: flex;
            gap: var(--spacing-sm);
        }

        .post-type-button {
            flex: 1;
            padding: var(--spacing-sm) var(--spacing-md);
            background: transparent;
            color: var(--text-secondary);
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            font-size: var(--font-size-sm);
        }

        .post-type-button:hover {
            background: var(--surface-secondary);
            color: var(--primary-color);
        }

        /* Sort Buttons */
        .sort-buttons {
            background: var(--surface-color);
            border-radius: var(--radius-xl);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            display: flex;
            gap: var(--spacing-sm);
            overflow-x: auto;
        }

        .sort-button {
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-full);
            border: none;
            font-size: var(--font-size-sm);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-fast);
            white-space: nowrap;
        }

        .sort-button.active {
            background: var(--primary-color);
            color: white;
        }

        .sort-button:not(.active) {
            background: var(--surface-secondary);
            color: var(--text-secondary);
        }

        .sort-button:not(.active):hover {
            background: var(--border-color);
        }

        /* Post Cards */
        .post-card {
            background: var(--surface-color);
            border-radius: var(--radius-xl);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-md);
            transition: var(--transition-normal);
            animation: fadeIn 0.5s ease;
            cursor: pointer;
        }

        .post-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .post-content {
            padding: var(--spacing-lg);
            display: flex;
            gap: var(--spacing-md);
        }

        /* Vote Section */
        .vote-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .vote-button {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: var(--font-size-lg);
            cursor: pointer;
            padding: var(--spacing-xs);
            border-radius: var(--radius-sm);
            transition: var(--transition-fast);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .vote-button:hover {
            background: var(--surface-secondary);
        }

        .vote-button.voted-up {
            color: var(--primary-color);
        }

        .vote-button.voted-down {
            color: var(--secondary-color);
        }

        .vote-count {
            font-weight: bold;
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }

        /* Post Main Content */
        .post-main {
            flex: 1;
        }

        .post-meta {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-size: var(--font-size-xs);
            color: var(--text-muted);
            margin-bottom: var(--spacing-sm);
        }

        .post-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            margin-bottom: var(--spacing-md);
            color: var(--text-primary);
            line-height: 1.4;
        }

        .post-text {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-md);
            line-height: 1.6;
        }

        .post-image, .post-video {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
            cursor: pointer;
        }

        .media-grid {
            display: grid;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }

        .media-grid.single {
            grid-template-columns: 1fr;
        }

        .media-grid.double {
            grid-template-columns: 1fr 1fr;
        }

        .media-grid.multiple {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }

        /* Post Actions */
        .post-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .post-action-buttons {
            display: flex;
            gap: var(--spacing-md);
        }

        .post-action-button {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: var(--font-size-sm);
            cursor: pointer;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .post-action-button:hover {
            background: var(--surface-secondary);
            color: var(--primary-color);
        }

        /* Comments Section */
        .comments-section {
            border-top: 1px solid var(--border-color);
            padding: var(--spacing-md) var(--spacing-lg);
            display: none;
        }

        .comments-section.active {
            display: block;
        }

        .comment-input {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
            align-items: center;
        }

        .comment-input input {
            flex: 1;
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--surface-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            color: var(--text-primary);
        }

        .emoji-picker-btn {
            background: var(--surface-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: var(--spacing-sm);
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .emoji-picker-btn:hover {
            background: var(--border-color);
            color: var(--primary-color);
        }

        .emoji-picker {
            position: absolute;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            display: none;
            grid-template-columns: repeat(8, 1fr);
            gap: var(--spacing-xs);
            z-index: 100;
            max-width: 300px;
        }

        .emoji-picker.active {
            display: grid;
        }

        .emoji-item {
            padding: var(--spacing-xs);
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: var(--transition-fast);
            text-align: center;
        }

        .emoji-item:hover {
            background: var(--surface-secondary);
        }

        .comment {
            background: var(--surface-secondary);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-sm);
            position: relative;
        }

        .comment.reply {
            margin-left: var(--spacing-xl);
            border-left: 2px solid var(--primary-color);
        }

        .comment-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-xs);
        }

        .comment-author {
            font-weight: bold;
            color: var(--primary-color);
            font-size: var(--font-size-xs);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .comment-time {
            font-size: 11px;
            color: var(--text-muted);
        }

        .comment-text {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            margin-bottom: var(--spacing-xs);
        }

        .comment-actions {
            display: flex;
            gap: var(--spacing-md);
            font-size: 11px;
        }

        .comment-action {
            color: var(--text-muted);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .comment-action:hover {
            color: var(--primary-color);
        }

        /* Precise Timestamp */
        .precise-timestamp {
            font-size: 10px;
            color: var(--text-muted);
            font-family: monospace;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-normal);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--surface-color);
            border-radius: var(--radius-xl);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
        }

        .modal-header {
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: var(--font-size-xl);
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: var(--font-size-lg);
            cursor: pointer;
            padding: var(--spacing-xs);
            border-radius: var(--radius-sm);
            transition: var(--transition-fast);
        }

        .modal-close:hover {
            color: var(--text-primary);
            background: var(--surface-secondary);
        }

        .modal-body {
            padding: var(--spacing-lg);
        }

        .modal-footer {
            padding: var(--spacing-lg);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-sm);
        }

        /* Image/Video Upload Area */
        .media-upload-area {
            border: 2px dashed var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-xl);
            text-align: center;
            margin: var(--spacing-md) 0;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .media-upload-area:hover,
        .media-upload-area.dragover {
            border-color: var(--primary-color);
            background: rgba(106, 17, 203, 0.1);
        }

        .media-preview {
            max-width: 100%;
            max-height: 300px;
            border-radius: var(--radius-md);
            margin: var(--spacing-md) 0;
        }

        .media-preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--spacing-sm);
            margin: var(--spacing-md) 0;
        }

        .media-preview-item {
            position: relative;
            border-radius: var(--radius-md);
            overflow: hidden;
        }

        .media-preview-item img,
        .media-preview-item video {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .media-remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Chat Styles */
        .chat-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border: none;
            color: white;
            font-size: var(--font-size-xl);
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: var(--transition-fast);
            z-index: 100;
        }

        .chat-toggle:hover {
            transform: scale(1.1);
        }

        .chat-container {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 350px;
            height: 500px;
            background: var(--surface-color);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            display: flex;
            flex-direction: column;
            transform: translateY(100%);
            opacity: 0;
            transition: var(--transition-normal);
            z-index: 99;
            border: 1px solid var(--border-color);
        }

        .chat-container.active {
            transform: translateY(0);
            opacity: 1;
        }

        .chat-header {
            padding: var(--spacing-md);
            background: var(--primary-color);
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header h3 {
            color: white;
            font-size: var(--font-size-base);
        }

        .chat-close {
            background: none;
            border: none;
            color: white;
            font-size: var(--font-size-lg);
            cursor: pointer;
            padding: var(--spacing-xs);
            border-radius: var(--radius-sm);
            transition: var(--transition-fast);
        }

        .chat-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .chat-messages {
            flex: 1;
            padding: var(--spacing-md);
            overflow-y: auto;
        }

        .message {
            margin-bottom: var(--spacing-md);
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--surface-secondary);
            border-radius: var(--radius-md);
        }

        .message.user {
            background: var(--primary-color);
            margin-left: var(--spacing-lg);
        }

        .message.agent {
            background: var(--surface-secondary);
            margin-right: var(--spacing-lg);
        }

        .message-user {
            font-weight: bold;
            color: var(--primary-color);
            font-size: var(--font-size-xs);
            margin-bottom: var(--spacing-xs);
        }

        .message.user .message-user {
            color: white;
        }

        .message-text {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            margin-bottom: var(--spacing-xs);
        }

        .message.user .message-text {
            color: white;
        }

        .message-time {
            font-size: 11px;
            color: var(--text-muted);
        }

        .message.user .message-time {
            color: rgba(255, 255, 255, 0.7);
        }

        .chat-input-container {
            padding: var(--spacing-md);
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: var(--spacing-sm);
        }

        .chat-input {
            flex: 1;
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--surface-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            color: var(--text-primary);
        }

        .chat-send {
            background: var(--primary-color);
            border: none;
            color: white;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .chat-send:hover {
            background: #5a0fb8;
        }

        /* Mobile Navigation */
        .mobile-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--surface-color);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 64px;
            z-index: 50;
        }

        @media (min-width: 1024px) {
            .mobile-nav {
                display: none;
            }
        }

        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            text-decoration: none;
            transition: var(--transition-fast);
            padding: var(--spacing-sm);
            border-radius: var(--radius-md);
        }

        .mobile-nav-item.active,
        .mobile-nav-item:hover {
            color: var(--primary-color);
        }

        .mobile-nav-item i {
            font-size: var(--font-size-lg);
            margin-bottom: var(--spacing-xs);
        }

        .mobile-nav-item span {
            font-size: 10px;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary-color);
            color: white;
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            transform: translateX(100%);
            opacity: 0;
            transition: var(--transition-normal);
            z-index: 1001;
        }

        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        /* Poll Styles */
        .poll-container {
            background: var(--surface-secondary);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
        }

        .poll-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-sm) var(--spacing-md);
            margin-bottom: var(--spacing-sm);
            background: var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            position: relative;
            overflow: hidden;
        }

        .poll-option:hover {
            background: #505050;
        }

        .poll-option.voted {
            cursor: default;
        }

        .poll-option-bar {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            opacity: 0.3;
            transition: width 0.5s ease;
        }

        .poll-option-text,
        .poll-option-percentage {
            position: relative;
            z-index: 1;
        }

        .poll-option-percentage {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
        }

        .poll-stats {
            margin-top: var(--spacing-sm);
            font-size: 11px;
            color: var(--text-muted);
            text-align: center;
        }

        /* Community Colors */
        .bg-blue-500 { background-color: #3b82f6; }
        .bg-red-500 { background-color: #ef4444; }
        .bg-green-500 { background-color: var(--success-color); }
        .bg-purple-500 { background-color: var(--primary-color); }
        .bg-gray-500 { background-color: #6b7280; }
        .bg-yellow-500 { background-color: var(--warning-color); }
        .bg-pink-500 { background-color: #ec4899; }
        .bg-indigo-500 { background-color: #6366f1; }

        /* Live Features */
        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            color: var(--error-color);
            font-size: var(--font-size-xs);
            font-weight: bold;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: var(--error-color);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Premium Features */
        .premium-section {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border-radius: var(--radius-xl);
            padding: var(--spacing-lg);
            margin-top: var(--spacing-xl);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .premium-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .premium-content {
            position: relative;
            z-index: 1;
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .loading {
            opacity: 0.5;
            pointer-events: none;
        }

        .text-center {
            text-align: center;
        }

        .mb-4 {
            margin-bottom: var(--spacing-md);
        }

        .mt-4 {
            margin-top: var(--spacing-md);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-container {
                padding: var(--spacing-md) var(--spacing-sm);
                padding-bottom: 80px;
            }
            
            .post-content {
                padding: var(--spacing-md);
            }
            
            .chat-container {
                width: calc(100vw - 40px);
                right: 20px;
                left: 20px;
            }

            .modal-content {
                width: 95%;
                margin: var(--spacing-md);
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--surface-color);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }

        /* High Contrast Mode Support */
        @media (prefers-contrast: high) {
            :root {
                --text-primary: #ffffff;
                --text-secondary: #ffffff;
                --background-color: #000000;
                --surface-color: #000000;
                --border-color: #ffffff;
            }
        }

        /* Reduced Motion Support */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Video Player Controls */
        .video-container {
            position: relative;
            display: inline-block;
        }

        .video-controls {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: var(--radius-md);
            padding: var(--spacing-sm);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .video-container:hover .video-controls {
            opacity: 1;
        }

        .play-pause-btn {
            background: none;
            border: none;
            color: white;
            font-size: var(--font-size-lg);
            cursor: pointer;
        }

        .progress-bar {
            flex: 1;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary-color);
            width: 0%;
            transition: width 0.1s ease;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .volume-slider {
            width: 60px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            outline: none;
            cursor: pointer;
        }

        /* Real-time Updates */
        .update-indicator {
            position: fixed;
            top: 80px;
            right: 20px;
            background: var(--success-color);
            color: white;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .update-indicator.show {
            transform: translateX(0);
            opacity: 1;
        }

        /* Advanced Features */
        .feature-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 6px;
            background: var(--primary-color);
            color: white;
            border-radius: var(--radius-sm);
            font-size: 10px;
            font-weight: bold;
        }

        .trending-indicator {
            color: var(--warning-color);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 0 0 5px var(--warning-color); }
            to { text-shadow: 0 0 20px var(--warning-color), 0 0 30px var(--warning-color); }
        }

        /* Camera Modal */
        .camera-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .camera-container {
            position: relative;
            background: var(--surface-color);
            border-radius: var(--radius-xl);
            padding: var(--spacing-lg);
            max-width: 500px;
            width: 90%;
        }

        .camera-video {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: var(--radius-md);
            background: #000;
        }

        .camera-controls {
            display: flex;
            justify-content: center;
            gap: var(--spacing-md);
            margin-top: var(--spacing-md);
        }

        .camera-btn {
            padding: var(--spacing-md);
            border-radius: 50%;
            border: none;
            cursor: pointer;
            transition: var(--transition-fast);
            font-size: var(--font-size-lg);
        }

        .capture-btn {
            background: var(--error-color);
            color: white;
            width: 60px;
            height: 60px;
        }

        .capture-btn:hover {
            background: #dc2626;
            transform: scale(1.1);
        }

        .cancel-camera-btn {
            background: var(--surface-secondary);
            color: var(--text-secondary);
            width: 50px;
            height: 50px;
        }

        .cancel-camera-btn:hover {
            background: var(--border-color);
            color: var(--text-primary);
        }
    </style>
</head>
<body>
    <!-- Skip Link for Screen Readers -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Preloader -->
    <div id="preloader" class="preloader" role="status" aria-label="Loading SmileX">
        <div class="preloader-logo" aria-hidden="true">
            <i class="fas fa-smile-beam"></i>
        </div>
        <div class="preloader-text">SmileX</div>
        <div class="loading-spinner"></div>
        <span class="sr-only">Loading application...</span>
    </div>

    <!-- Onboarding Modal -->
    <div class="overlay" id="onboardingOverlay" role="dialog" aria-labelledby="onboarding-title" aria-modal="true">
        <div class="onboarding-container">
            <header class="onboarding-header">
                <h2 id="onboarding-title">
                    <i class="fas fa-user-circle" aria-hidden="true"></i> 
                    Welcome to SmileX
                </h2>
                <p>Complete your profile to join our community</p>
            </header>

            <form id="registrationForm" novalidate>
                <!-- Profile Picture Upload Section -->
                <div class="profile-upload-section">
                    <div class="profile-preview" id="profilePreview" onclick="showProfileUploadOptions()">
                        <span id="profileInitial">?</span>
                        <div class="profile-upload-overlay">
                            <i class="fas fa-camera"></i>
                        </div>
                    </div>
                    <div class="profile-upload-buttons">
                        <button type="button" class="btn btn-secondary" onclick="openCamera()">
                            <i class="fas fa-camera"></i> Camera
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="openFileUpload()">
                            <i class="fas fa-upload"></i> Upload
                        </button>
                    </div>
                    <input type="file" id="profileImageInput" accept="image/*" style="display: none;" onchange="handleProfileImageUpload(event)">
                </div>

                <div class="form-group">
                    <label for="fullName" class="form-label">
                        <i class="fas fa-user" aria-hidden="true"></i> Full Name
                    </label>
                    <input type="text" 
                           id="fullName" 
                           name="fullName" 
                           class="form-control" 
                           placeholder="Enter your full name" 
                           required 
                           oninput="checkNameAvailability(this.value)"
                           aria-describedby="fullName-error">
                    <div id="nameValidation" class="name-validation" style="display: none;"></div>
                    <div id="fullName-error" class="sr-only" role="alert"></div>
                </div>

                <div class="form-group">
                    <label for="email" class="form-label">
                        <i class="fas fa-envelope" aria-hidden="true"></i> Email Address
                    </label>
                    <input type="email" 
                           id="email" 
                           name="email" 
                           class="form-control" 
                           placeholder="your.email@example.com" 
                           required 
                           aria-describedby="email-error">
                    <div id="email-error" class="sr-only" role="alert"></div>
                </div>

                <div style="display: flex; gap: 15px;">
                    <div class="form-group" style="flex: 1;">
                        <label for="gender" class="form-label">
                            <i class="fas fa-venus-mars" aria-hidden="true"></i> Gender
                        </label>
                        <select id="gender" name="gender" class="form-select" required>
                            <option value="">Select Gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                            <option value="prefer-not-to-say">Prefer not to say</option>
                        </select>
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label for="country" class="form-label">
                            <i class="fas fa-globe" aria-hidden="true"></i> Country
                        </label>
                        <select id="country" name="country" class="form-select" required>
                            <option value="">Select Country</option>
                            <option value="US">United States</option>
                            <option value="UK">United Kingdom</option>
                            <option value="CA">Canada</option>
                            <option value="AU">Australia</option>
                            <option value="DE">Germany</option>
                            <option value="FR">France</option>
                            <option value="JP">Japan</option>
                            <option value="IN">India</option>
                            <option value="BR">Brazil</option>
                            <option value="NG">Nigeria</option>
                            <option value="ZA">South Africa</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <fieldset class="consent-section">
                    <legend>
                        <h4><i class="fas fa-shield-alt" aria-hidden="true"></i> Platform Consent</h4>
                    </legend>
                    <div class="consent-item">
                        <input type="checkbox" id="ageConsent" name="ageConsent" required>
                        <label for="ageConsent">I am 13 years or older</label>
                    </div>
                    <div class="consent-item">
                        <input type="checkbox" id="termsConsent" name="termsConsent" required>
                        <label for="termsConsent">I agree to the Terms of Service</label>
                    </div>
                    <div class="consent-item">
                        <input type="checkbox" id="privacyConsent" name="privacyConsent" required>
                        <label for="privacyConsent">I consent to privacy policy</label>
                    </div>
                </fieldset>

                <button type="submit" id="submitBtn" class="btn btn-primary" disabled style="width: 100%;">
                    <i class="fas fa-paper-plane" aria-hidden="true"></i> Join SmileX
                </button>
            </form>
        </div>
    </div>

    <!-- Camera Modal -->
    <div id="cameraModal" class="camera-modal hidden">
        <div class="camera-container">
            <video id="cameraVideo" class="camera-video" autoplay muted></video>
            <canvas id="cameraCanvas" style="display: none;"></canvas>
            <div class="camera-controls">
                <button class="camera-btn cancel-camera-btn" onclick="closeCamera()">
                    <i class="fas fa-times"></i>
                </button>
                <button class="camera-btn capture-btn" onclick="capturePhoto()">
                    <i class="fas fa-camera"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Navigation -->
    <nav role="navigation" aria-label="Main navigation">
        <div class="nav-container">
            <a href="#" class="logo" aria-label="SmileX Home">
                <i class="fas fa-smile-beam" aria-hidden="true"></i>
                <span>SmileX</span>
            </a>

            <div class="nav-search" role="search">
                <label for="searchInput" class="sr-only">Search Everything</label>
                <input type="text" 
                       id="searchInput" 
                       placeholder="Search posts, communities, users..." 
                       aria-describedby="search-results"
                       oninput="performGlobalSearch(this.value)">
                <i class="fas fa-search" aria-hidden="true"></i>
                <div id="searchResults" class="search-results hidden" role="listbox" aria-label="Search results"></div>
            </div>

            <div class="nav-actions">
                <button class="nav-button" 
                        id="notificationBtn" 
                        aria-label="View notifications"
                        title="Notifications">
                    <i class="fas fa-bell" aria-hidden="true"></i>
                </button>
                <div class="user-avatar" 
                     id="userAvatar" 
                     role="img" 
                     aria-label="User avatar"
                     onclick="toggleUserMenu()">
                    <span id="userInitial">U</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="main-content" class="main-container">
        <!-- Left Sidebar -->
        <aside class="sidebar" role="complementary" aria-label="Community navigation">
            <section>
                <h3><i class="fas fa-users" aria-hidden="true"></i> My Communities</h3>
                
                <div class="my-communities-tabs" role="tablist">
                    <button class="sort-button active" 
                            role="tab" 
                            aria-selected="true" 
                            aria-controls="createdCommunitiesList" 
                            data-tab="created">
                        Created
                    </button>
                    <button class="sort-button" 
                            role="tab" 
                            aria-selected="false" 
                            aria-controls="joinedCommunitiesList" 
                            data-tab="joined">
                        Joined
                    </button>
                </div>
                
                <div id="createdCommunitiesList" 
                     class="communities-tab-content" 
                     role="tabpanel" 
                     aria-labelledby="created-tab">
                    <ul id="createdCommunitiesUL" role="list"></ul>
                </div>
                
                <div id="joinedCommunitiesList" 
                     class="communities-tab-content hidden" 
                     role="tabpanel" 
                     aria-labelledby="joined-tab">
                    <ul id="joinedCommunitiesUL" role="list"></ul>
                </div>
                
                <button id="createCommunityBtn" 
                        class="btn btn-primary" 
                        style="width: 100%; margin-top: var(--spacing-md);">
                    <i class="fas fa-plus" aria-hidden="true"></i> Create Community
                </button>
            </section>

            <section style="margin-top: var(--spacing-xl);">
                <h3><i class="fas fa-compass" aria-hidden="true"></i> Explore</h3>
                <button id="browseCommunityBtn" class="btn btn-secondary" style="width: 100%;">
                    <i class="fas fa-globe" aria-hidden="true"></i> Browse Communities
                </button>
            </section>
        </aside>

        <!-- Main Feed -->
        <main class="main-feed" role="main" aria-label="Posts feed">
            <!-- Create Post Card -->
            <section class="create-post-card" aria-label="Create new post">
                <div class="create-post-input">
                    <div class="user-avatar" role="img" aria-label="Your avatar">
                        <span id="createPostUserInitial">U</span>
                    </div>
                    <button id="createPostInput" 
                            class="form-control" 
                            style="text-align: left; cursor: pointer; border: none;"
                            aria-label="Create a new post">
                        What's on your mind?
                    </button>
                </div>
                <div class="post-type-buttons" role="group" aria-label="Post type options">
                    <button class="post-type-button" 
                            data-post-type="image" 
                            aria-label="Create image post">
                        <i class="far fa-image" aria-hidden="true"></i> Image
                    </button>
                    <button class="post-type-button" 
                            data-post-type="video" 
                            aria-label="Create video post">
                        <i class="fas fa-video" aria-hidden="true"></i> Video
                    </button>
                    <button class="post-type-button" 
                            data-post-type="text" 
                            aria-label="Create text post">
                        <i class="far fa-file-alt" aria-hidden="true"></i> Text
                    </button>
                    <button class="post-type-button" 
                            data-post-type="poll" 
                            aria-label="Create poll">
                        <i class="fas fa-poll" aria-hidden="true"></i> Poll
                    </button>
                </div>
            </section>

            <!-- Post Sorting -->
            <section class="sort-buttons" role="group" aria-label="Sort posts">
                <button class="sort-button active" 
                        data-sort="hot" 
                        aria-pressed="true">
                    <i class="fas fa-bolt" aria-hidden="true"></i> Hot
                </button>
                <button class="sort-button" 
                        data-sort="new" 
                        aria-pressed="false">
                    <i class="fas fa-certificate" aria-hidden="true"></i> New
                </button>
                <button class="sort-button" 
                        data-sort="top" 
                        aria-pressed="false">
                    <i class="fas fa-arrow-trend-up" aria-hidden="true"></i> Top
                </button>
                <button class="sort-button" 
                        data-sort="trending" 
                        aria-pressed="false">
                    <i class="fas fa-fire trending-indicator" aria-hidden="true"></i> Trending
                </button>
            </section>

            <!-- Feed Filter -->
            <section class="create-post-card">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                        <label for="feedFilter">Viewing:</label>
                        <select id="feedFilter" class="form-select" style="width: auto; margin: 0;">
                            <option value="all">All Posts</option>
                            <option value="general">General Feed</option>
                            <option value="mycommunities">My Communities</option>
                        </select>
                    </div>
                    <div class="live-indicator">
                        <div class="live-dot"></div>
                        LIVE
                    </div>
                </div>
            </section>

            <!-- Posts Feed -->
            <section id="posts-feed" role="feed" aria-label="Social media posts"></section>

            <!-- Load More Button -->
            <div class="text-center">
                <button id="loadMoreBtn" class="btn btn-secondary">Load more posts</button>
            </div>
        </main>

        <!-- Right Sidebar -->
        <aside class="sidebar" role="complementary" aria-label="Discover and premium">
            <section>
                <h3><i class="fas fa-compass" aria-hidden="true"></i> Discover</h3>
                <div id="recommendedCommunities" role="list" aria-label="Recommended communities"></div>
            </section>

            <!-- Live Stats -->
            <section style="background: var(--surface-secondary); border-radius: var(--radius-xl); padding: var(--spacing-lg); margin-top: var(--spacing-xl);">
                <h4 style="display: flex; align-items: center; gap: var(--spacing-sm); margin-bottom: var(--spacing-md);">
                    <i class="fas fa-chart-line" aria-hidden="true"></i>
                    Live Stats
                </h4>
                <div style="display: flex; flex-direction: column; gap: var(--spacing-sm); font-size: var(--font-size-sm);">
                    <div style="display: flex; justify-content: space-between;">
                        <span>Online Users:</span>
                        <span id="onlineUsers" style="color: var(--success-color); font-weight: bold;">127,543</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Active Polls:</span>
                        <span id="activePolls" style="color: var(--primary-color); font-weight: bold;">1,247</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Posts Today:</span>
                        <span id="postsToday" style="color: var(--warning-color); font-weight: bold;">45,678</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Communities:</span>
                        <span id="totalCommunities" style="color: var(--accent-color); font-weight: bold;">8,934</span>
                    </div>
                </div>
            </section>

            <!-- Premium Section -->
            <section class="premium-section">
                <div class="premium-content">
                    <div style="display: flex; align-items: center; margin-bottom: var(--spacing-sm);">
                        <i class="fas fa-crown" style="margin-right: var(--spacing-sm); color: var(--premium-gold);" aria-hidden="true"></i>
                        <h4>SmileX Premium</h4>
                        <span class="premium-badge" style="margin-left: var(--spacing-sm);">
                            <i class="fas fa-star"></i> VIP
                        </span>
                    </div>
                    <p style="font-size: var(--font-size-sm); margin-bottom: var(--spacing-md);">
                        Unlock exclusive features: <span class="disco-text">Disco Text</span>, 
                        <span class="premium-emoji"></span> Premium Emojis, 
                        Ad-free experience, and more!
                    </p>
                    <button id="premiumBtn" class="btn btn-premium" style="width: 100%;">
                        <i class="fas fa-crown"></i> UPGRADE TO PREMIUM
                    </button>
                </div>
            </section>
        </aside>
    </main>

    <!-- Create Post Modal -->
    <div id="create-post-modal" class="modal" role="dialog" aria-labelledby="create-post-title" aria-modal="true">
        <div class="modal-content">
            <header class="modal-header">
                <h3 id="create-post-title">Create a post</h3>
                <button id="closeCreatePostModal" 
                        class="modal-close" 
                        aria-label="Close create post modal">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </header>

            <div class="modal-body">
                <form id="createPostForm" novalidate>
                    <div class="form-group">
                        <label for="postType" class="form-label">Post type</label>
                        <select id="postType" name="postType" class="form-select" required>
                            <option value="text">Text Post</option>
                            <option value="image">Image Post</option>
                            <option value="video">Video Post</option>
                            <option value="poll">Poll</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="postVisibility" class="form-label">Post visibility</label>
                        <select id="postVisibility" name="visibility" class="form-select" required>
                            <option value="general">General (visible to everyone)</option>
                            <option value="community">Community (visible to members)</option>
                        </select>
                    </div>

                    <div class="form-group hidden" id="postCommunityContainer">
                        <label for="postCommunity" class="form-label">Choose a community</label>
                        <select id="postCommunity" name="community" class="form-select">
                            <option value="">Select a community</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="postTitle" class="form-label">Title</label>
                        <input type="text" 
                               id="postTitle" 
                               name="title" 
                               placeholder="Title" 
                               class="form-control" 
                               required>
                    </div>

                    <div class="form-group" id="contentContainer">
                        <label for="postContent" class="form-label">Content</label>
                        <textarea id="postContent" 
                                  name="content" 
                                  placeholder="What are your thoughts?" 
                                  rows="6" 
                                  class="form-control"></textarea>
                    </div>

                    <!-- Poll Options Container -->
                    <div class="form-group hidden" id="pollOptionsContainer">
                        <label class="form-label">Poll Options</label>
                        <div id="pollOptions">
                            <input type="text" 
                                   class="form-control poll-option-input" 
                                   placeholder="Option 1" 
                                   style="margin-bottom: var(--spacing-sm);">
                            <input type="text" 
                                   class="form-control poll-option-input" 
                                   placeholder="Option 2" 
                                   style="margin-bottom: var(--spacing-sm);">
                        </div>
                        <button type="button" 
                                id="addPollOption" 
                                class="btn btn-secondary" 
                                style="margin-top: var(--spacing-sm);">
                            <i class="fas fa-plus" aria-hidden="true"></i> Add Option
                        </button>
                    </div>

                    <div class="form-group" id="mediaUploadContainer">
                        <label class="form-label">Media Upload</label>
                        <div class="media-upload-area" 
                             id="mediaUploadArea" 
                             role="button" 
                             tabindex="0" 
                             aria-label="Click or drag media files here to upload">
                            <i class="fas fa-cloud-upload-alt" 
                               style="font-size: var(--font-size-2xl); color: var(--text-muted); margin-bottom: var(--spacing-sm);" 
                               aria-hidden="true"></i>
                            <p>Click or drag images/videos here to upload</p>
                            <p style="font-size: var(--font-size-xs); color: var(--text-muted);">
                                Supports: JPG, PNG, GIF, MP4, WebM (Max 50MB)
                            </p>
                            <input type="file" 
                                   id="mediaInput" 
                                   accept="image/*,video/*" 
                                   multiple 
                                   style="display: none;" 
                                   aria-label="Select media files to upload">
                        </div>
                        <div id="mediaPreviewContainer" class="media-preview-container" role="list" aria-label="Selected media files"></div>
                    </div>
                </form>
            </div>

            <footer class="modal-footer">
                <button type="button" id="cancelCreatePost" class="btn btn-secondary">Cancel</button>
                <button type="submit" form="createPostForm" class="btn btn-primary">Post</button>
            </footer>
        </div>
    </div>

    <!-- Create Community Modal -->
    <div id="create-community-modal" class="modal" role="dialog" aria-labelledby="create-community-title" aria-modal="true">
        <div class="modal-content">
            <header class="modal-header">
                <h3 id="create-community-title">Create a Community</h3>
                <button id="closeCreateCommunityModal" 
                        class="modal-close" 
                        aria-label="Close create community modal">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </header>

            <div class="modal-body">
                <form id="createCommunityForm" novalidate>
                    <div class="form-group">
                        <label for="communityName" class="form-label">Community Name</label>
                        <input type="text" 
                               id="communityName" 
                               name="name" 
                               placeholder="Enter community name" 
                               class="form-control" 
                               required 
                               oninput="validateCommunityName(this.value)"
                               aria-describedby="community-name-help">
                        <div id="communityNameValidation" class="name-validation" style="display: none;"></div>
                        <p id="community-name-help" style="font-size: var(--font-size-xs); color: var(--text-muted); margin-top: var(--spacing-xs);">
                            Community names can't contain spaces or words related to "smile/smilex". Use 3-21 characters.
                        </p>
                    </div>

                    <div class="form-group">
                        <label for="communityDisplayName" class="form-label">Display Name</label>
                        <input type="text" 
                               id="communityDisplayName" 
                               name="displayName" 
                               placeholder="Enter display name" 
                               class="form-control" 
                               required>
                    </div>

                    <div class="form-group">
                        <label for="communityDescription" class="form-label">Description</label>
                        <textarea id="communityDescription" 
                                  name="description" 
                                  placeholder="What's your community about?" 
                                  rows="4" 
                                  class="form-control"></textarea>
                    </div>

                    <fieldset class="form-group">
                        <legend class="form-label">Community Type</legend>
                        <div style="display: flex; gap: var(--spacing-md); margin-top: var(--spacing-sm);">
                            <div style="display: flex; align-items: center;">
                                <input type="radio" 
                                       id="typePublic" 
                                       name="type" 
                                       value="public" 
                                       checked 
                                       style="margin-right: var(--spacing-sm);">
                                <label for="typePublic">Public</label>
                            </div>
                            <div style="display: flex; align-items: center;">
                                <input type="radio" 
                                       id="typePrivate" 
                                       name="type" 
                                       value="private" 
                                       style="margin-right: var(--spacing-sm);">
                                <label for="typePrivate">Private</label>
                            </div>
                        </div>
                        <p style="font-size: var(--font-size-xs); color: var(--text-muted); margin-top: var(--spacing-xs);">
                            Private communities require members to be approved by moderators.
                        </p>
                    </fieldset>

                    <div class="form-group">
                        <label for="communityTopics" class="form-label">Community Topics (optional)</label>
                        <input type="text" 
                               id="communityTopics" 
                               name="topics" 
                               placeholder="Enter topics separated by commas" 
                               class="form-control">
                    </div>
                </form>
            </div>

            <footer class="modal-footer">
                <button type="button" id="cancelCreateCommunity" class="btn btn-secondary">Cancel</button>
                <button type="submit" form="createCommunityForm" class="btn btn-primary">Create Community</button>
            </footer>
        </div>
    </div>

    <!-- Browse Communities Modal -->
    <div id="browse-communities-modal" class="modal" role="dialog" aria-labelledby="browse-communities-title" aria-modal="true">
        <div class="modal-content" style="max-width: 800px;">
            <header class="modal-header">
                <h3 id="browse-communities-title">Browse Communities</h3>
                <button id="closeBrowseCommunitiesModal" 
                        class="modal-close" 
                        aria-label="Close browse communities modal">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </header>

            <div style="padding: var(--spacing-md); border-bottom: 1px solid var(--border-color);">
                <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                    <div style="position: relative; flex: 1;">
                        <label for="communitySearchInput" class="sr-only">Search for communities</label>
                        <input type="text" 
                               id="communitySearchInput" 
                               placeholder="Search for communities..." 
                               class="form-control" 
                               style="padding-left: 40px;"
                               oninput="searchCommunities(this.value)">
                        <i class="fas fa-search" 
                           style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted);" 
                           aria-hidden="true"></i>
                    </div>
                    <div style="display: flex; gap: var(--spacing-sm);" role="tablist">
                        <button class="sort-button active" 
                                data-tab="all" 
                                role="tab" 
                                aria-selected="true"
                                onclick="filterCommunities('all')">All</button>
                        <button class="sort-button" 
                                data-tab="public" 
                                role="tab" 
                                aria-selected="false"
                                onclick="filterCommunities('public')">Public</button>
                        <button class="sort-button" 
                                data-tab="private" 
                                role="tab" 
                                aria-selected="false"
                                onclick="filterCommunities('private')">Private</button>
                    </div>
                </div>
            </div>

            <div class="modal-body">
                <div id="communitiesBrowseList" 
                     style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--spacing-md);" 
                     role="list" 
                     aria-label="Available communities"></div>
                <div id="noCommunitiesMessage" class="text-center hidden">
                    <i class="fas fa-users" 
                       style="font-size: var(--font-size-3xl); color: var(--text-muted); margin-bottom: var(--spacing-md);" 
                       aria-hidden="true"></i>
                    <p style="color: var(--text-muted);">No communities found</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Community Detail Modal -->
    <div id="community-detail-modal" class="modal" role="dialog" aria-labelledby="community-detail-title" aria-modal="true">
        <div class="modal-content" style="max-width: 700px;">
            <div id="communityDetailHeader" class="modal-header" style="position: relative;"></div>

            <div class="modal-body">
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: var(--spacing-xl);">
                    <div>
                        <h3 style="margin-bottom: var(--spacing-md);">About this Community</h3>
                        <div id="communityDetailDescription" 
                             style="color: var(--text-secondary); margin-bottom: var(--spacing-xl);"></div>
                        
                        <h3 style="margin-bottom: var(--spacing-md);">Recent Posts</h3>
                        <div id="communityPosts" role="list" aria-label="Recent community posts"></div>
                    </div>
                    <div>
                        <div style="background: var(--surface-secondary); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-md);">
                            <h4 style="margin-bottom: var(--spacing-md);">Community Info</h4>
                            <div style="display: flex; flex-direction: column; gap: var(--spacing-sm); font-size: var(--font-size-sm);">
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: var(--text-muted);">Created by</span>
                                    <span id="communityCreator"></span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: var(--text-muted);">Created</span>
                                    <span id="communityCreationDate"></span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: var(--text-muted);">Members</span>
                                    <span id="communityMemberCount"></span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: var(--text-muted);">Type</span>
                                    <span id="communityType"></span>
                                </div>
                            </div>
                        </div>

                        <div style="background: var(--surface-secondary); padding: var(--spacing-md); border-radius: var(--radius-md);">
                            <h4 style="margin-bottom: var(--spacing-md);">Topics</h4>
                            <div id="communityTopics" role="list" aria-label="Community topics"></div>
                        </div>
                    </div>
                </div>
            </div>

            <footer class="modal-footer">
                <button id="closeCommunityDetailModal" class="btn btn-secondary">Close</button>
                <button id="joinLeaveButton" class="btn btn-primary">Join</button>
                <button id="deleteCommunityButton" class="btn hidden" style="background: var(--error-color);">Delete Community</button>
            </footer>
        </div>
    </div>

    <!-- Post Detail Modal -->
    <div id="post-detail-modal" class="modal" role="dialog" aria-labelledby="post-detail-title" aria-modal="true">
        <div class="modal-content" style="max-width: 800px;">
            <div id="postDetailContent"></div>
        </div>
    </div>

    <!-- Media Viewer Modal -->
    <div id="media-viewer-modal" class="modal" role="dialog" aria-labelledby="media-viewer-title" aria-modal="true">
        <div class="modal-content" style="max-width: 90vw; max-height: 90vh; padding: 0; background: transparent; box-shadow: none;">
            <div style="position: relative; display: flex; align-items: center; justify-content: center; height: 90vh;">
                <button id="closeMediaViewer" 
                        style="position: absolute; top: 20px; right: 20px; background: rgba(0,0,0,0.7); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 18px; z-index: 10;">
                    <i class="fas fa-times"></i>
                </button>
                <div id="mediaViewerContent" style="max-width: 100%; max-height: 100%;"></div>
            </div>
        </div>
    </div>

    <!-- Emoji Picker -->
    <div id="emojiPicker" class="emoji-picker">
        <div class="emoji-item" onclick="insertEmoji('')"></div>
        <div class="emoji-item" onclick="insertEmoji('')"></div>
        <div class="emoji-item" onclick="insertEmoji('')"></div>
        <div class="emoji-item" onclick="insertEmoji('')"></div>
        <div class="emoji-item" onclick="insertEmoji('')"></div>
        <div class="emoji-item" onclick="insertEmoji('')"></div>
        <div class="emoji-item" onclick="insertEmoji('')"></div>
        <div class="emoji-item" onclick="insertEmoji('')"></div>
        <div class="emoji-item" onclick="insertEmoji('')"></div>
        <div class="emoji-item" onclick="insertEmoji('')"></div>
        <div class="emoji-item" onclick="insertEmoji('')"></div>
        <div class="emoji-item" onclick="insertEmoji('')"></div>
        <div class="emoji-item" onclick="insertEmoji('')"></div>
        <div class="emoji-item" onclick="insertEmoji('')"></div>
        <div class="emoji-item" onclick="insertEmoji('')"></div>
        <div class="emoji-item" onclick="insertEmoji('')"></div>
    </div>

    <!-- Live Chat Toggle Button -->
    <button id="chat-toggle-btn" 
            class="chat-toggle" 
            aria-label="Toggle live chat" 
            title="Live Chat Support">
        <i class="fas fa-comment-dots" aria-hidden="true"></i>
    </button>

    <!-- Live Chat Container -->
    <div id="chat-container" class="chat-container" role="dialog" aria-labelledby="chat-title">
        <header class="chat-header">
            <h3 id="chat-title">Live Chat Support</h3>
            <button id="chat-close-btn" 
                    class="chat-close" 
                    aria-label="Close chat">
                <i class="fas fa-times" aria-hidden="true"></i>
            </button>
        </header>
        <div class="chat-messages" 
             id="chat-messages" 
             role="log" 
             aria-live="polite" 
             aria-label="Chat messages">
            <div class="message agent">
                <div class="message-user">Support Agent</div>
                <div class="message-text">Hello! How can we help you today?</div>
                <div class="message-time">Just now</div>
            </div>
        </div>
        <div class="chat-input-container">
            <label for="chat-input" class="sr-only">Type your message</label>
            <input type="text" 
                   id="chat-input" 
                   class="chat-input" 
                   placeholder="Type your message..." 
                   aria-describedby="chat-send-btn">
            <button id="chat-send-btn" 
                    class="chat-send" 
                    aria-label="Send message">
                <i class="fas fa-paper-plane" aria-hidden="true"></i>
            </button>
        </div>
    </div>

    <!-- Mobile Navigation -->
    <nav class="mobile-nav" role="navigation" aria-label="Mobile navigation">
        <a href="#" class="mobile-nav-item active" aria-current="page">
            <i class="fas fa-home" aria-hidden="true"></i>
            <span>Home</span>
        </a>
        <a href="#" class="mobile-nav-item" id="mobileBrowseBtn">
            <i class="fas fa-compass" aria-hidden="true"></i>
            <span>Explore</span>
        </a>
        <a href="#" class="mobile-nav-item" id="mobileCreatePost">
            <i class="fas fa-plus-circle" aria-hidden="true"></i>
            <span>Create</span>
        </a>
        <a href="#" class="mobile-nav-item">
            <i class="fas fa-bell" aria-hidden="true"></i>
            <span>Notifications</span>
        </a>
        <a href="#" class="mobile-nav-item" id="mobileCreateCommunity">
            <i class="fas fa-users" aria-hidden="true"></i>
            <span>Community</span>
        </a>
    </nav>

    <!-- Update Indicator -->
    <div id="update-indicator" class="update-indicator">
        <i class="fas fa-sync-alt" aria-hidden="true"></i>
        New content available
    </div>

    <!-- Notification Container -->
    <div id="notification-container" 
         role="status" 
         aria-live="polite" 
         aria-atomic="true" 
         style="position: fixed; top: 20px; right: 20px; z-index: 1001;"></div>

    <script>
        // Advanced Social Media Platform - Complete Implementation
        
        // Global Configuration
        const CONFIG = {
            MAX_FILE_SIZE: 50 * 1024 * 1024, // 50MB
            SUPPORTED_IMAGE_TYPES: ['image/jpeg', 'image/png', 'image/gif', 'image/webp'],
            SUPPORTED_VIDEO_TYPES: ['video/mp4', 'video/webm', 'video/ogg'],
            AUTO_SAVE_INTERVAL: 30000, // 30 seconds
            LIVE_UPDATE_INTERVAL: 5000, // 5 seconds
            MAX_POLL_OPTIONS: 6,
            MAX_POST_LENGTH: 10000,
            MAX_COMMENT_LENGTH: 1000,
            PREMIUM_EMOJIS: ['', '', '', '', '', '', '', '', '', ''],
            RESTRICTED_NAMES: ['smile', 'smilex', 'smiles', 'smiling', 'admin', 'moderator', 'system']
        };

        // Global State Management
        class StateManager {
            constructor() {
                this.state = {
                    currentUser: null,
                    posts: [],
                    communities: [],
                    userMemberships: [],
                    userCreatedCommunities: [],
                    livePolls: [],
                    uploadedMedia: [],
                    currentSort: 'hot',
                    currentFeedFilter: 'all',
                    currentCommunityTab: 'all',
                    currentCommunity: null,
                    onlineUsers: 127543,
                    activePolls: 1247,
                    postsToday: 45678,
                    totalCommunities: 8934,
                    isLiveMode: true,
                    registeredUsers: [],
                    activityLog: [],
                    searchIndex: {},
                    premiumUsers: [],
                    currentEmojiTarget: null
                };
                
                this.subscribers = [];
                this.loadFromStorage();
                this.buildSearchIndex();
            }

            subscribe(callback) {
                this.subscribers.push(callback);
            }

            setState(updates) {
                this.state = { ...this.state, ...updates };
                this.saveToStorage();
                this.notifySubscribers();
                this.logActivity(updates);
            }

            getState() {
                return { ...this.state };
            }

            notifySubscribers() {
                this.subscribers.forEach(callback => callback(this.state));
            }

            logActivity(updates) {
                const activity = {
                    timestamp: new Date(),
                    type: 'state_update',
                    data: updates,
                    userId: this.state.currentUser ? this.state.currentUser.userId : 'anonymous'
                };
                
                this.state.activityLog.push(activity);
                
                // Keep only last 1000 activities
                if (this.state.activityLog.length > 1000) {
                    this.state.activityLog = this.state.activityLog.slice(-1000);
                }
            }

            buildSearchIndex() {
                this.state.searchIndex = {
                    posts: {},
                    communities: {},
                    users: {}
                };

                // Index posts
                this.state.posts.forEach(post => {
                    const searchText = `${post.title} ${post.content} ${post.author}`.toLowerCase();
                    const words = searchText.split(/\s+/);
                    words.forEach(word => {
                        if (word.length > 2) {
                            if (!this.state.searchIndex.posts[word]) {
                                this.state.searchIndex.posts[word] = [];
                            }
                            this.state.searchIndex.posts[word].push(post.id);
                        }
                    });
                });

                // Index communities
                this.state.communities.forEach(community => {
                    const searchText = `${community.name} ${community.displayName} ${community.description}`.toLowerCase();
                    const words = searchText.split(/\s+/);
                    words.forEach(word => {
                        if (word.length > 2) {
                            if (!this.state.searchIndex.communities[word]) {
                                this.state.searchIndex.communities[word] = [];
                            }
                            this.state.searchIndex.communities[word].push(community.id);
                        }
                    });
                });
            }

            loadFromStorage() {
                try {
                    const stored = localStorage.getItem('smileXState');
                    if (stored) {
                        const parsedState = JSON.parse(stored);
                        // Convert timestamp strings back to Date objects
                        if (parsedState.posts) {
                            parsedState.posts = parsedState.posts.map(post => ({
                                ...post,
                                timestamp: new Date(post.timestamp)
                            }));
                        }
                        if (parsedState.activityLog) {
                            parsedState.activityLog = parsedState.activityLog.map(activity => ({
                                ...activity,
                                timestamp: new Date(activity.timestamp)
                            }));
                        }
                        this.state = { ...this.state, ...parsedState };
                    }
                } catch (error) {
                    console.error('Error loading state from storage:', error);
                }
            }

            saveToStorage() {
                try {
                    localStorage.setItem('smileXState', JSON.stringify(this.state));
                } catch (error) {
                    console.error('Error saving state to storage:', error);
                }
            }
        }

        // Initialize State Manager
        const stateManager = new StateManager();

        // Utility Functions
        const utils = {
            formatNumber(num) {
                if (num >= 1000000) {
                    return (num / 1000000).toFixed(1) + 'M';
                } else if (num >= 1000) {
                    return (num / 1000).toFixed(1) + 'k';
                }
                return num.toString();
            },

            getPreciseTimeAgo(date) {
                const now = new Date();
                const diffInSeconds = Math.floor((now - date) / 1000);
                
                if (diffInSeconds < 60) {
                    return `${diffInSeconds}s ago`;
                } else if (diffInSeconds < 3600) {
                    const minutes = Math.floor(diffInSeconds / 60);
                    const seconds = diffInSeconds % 60;
                    return `${minutes}m ${seconds}s ago`;
                } else if (diffInSeconds < 86400) {
                    const hours = Math.floor(diffInSeconds / 3600);
                    const minutes = Math.floor((diffInSeconds % 3600) / 60);
                    return `${hours}h ${minutes}m ago`;
                } else {
                    const days = Math.floor(diffInSeconds / 86400);
                    const hours = Math.floor((diffInSeconds % 86400) / 3600);
                    return `${days}d ${hours}h ago`;
                }
            },

            getTimeAgo(date) {
                const now = new Date();
                const diffInSeconds = Math.floor((now - date) / 1000);
                
                if (diffInSeconds < 60) {
                    return 'Just now';
                } else if (diffInSeconds < 3600) {
                    const minutes = Math.floor(diffInSeconds / 60);
                    return `${minutes} minute${minutes !== 1 ? 's' : ''} ago`;
                } else if (diffInSeconds < 86400) {
                    const hours = Math.floor(diffInSeconds / 3600);
                    return `${hours} hour${hours !== 1 ? 's' : ''} ago`;
                } else if (diffInSeconds < 2592000) {
                    const days = Math.floor(diffInSeconds / 86400);
                    return `${days} day${days !== 1 ? 's' : ''} ago`;
                } else if (diffInSeconds < 31536000) {
                    const months = Math.floor(diffInSeconds / 2592000);
                    return `${months} month${months !== 1 ? 's' : ''} ago`;
                } else {
                    const years = Math.floor(diffInSeconds / 31536000);
                    return `${years} year${years !== 1 ? 's' : ''} ago`;
                }
            },

            getCommunityColor(name) {
                const colors = [
                    'bg-blue-500', 'bg-red-500', 'bg-green-500', 'bg-purple-500',
                    'bg-gray-500', 'bg-yellow-500', 'bg-pink-500', 'bg-indigo-500'
                ];
                
                let hash = 0;
                for (let i = 0; i < name.length; i++) {
                    hash = name.charCodeAt(i) + ((hash << 5) - hash);
                }
                
                return colors[Math.abs(hash) % colors.length];
            },

            generateId() {
                return Date.now().toString() + '_' + Math.random().toString(36).substr(2, 9);
            },

            validateFile(file) {
                if (file.size > CONFIG.MAX_FILE_SIZE) {
                    throw new Error(`File size must be less than ${CONFIG.MAX_FILE_SIZE / (1024 * 1024)}MB`);
                }

                const isImage = CONFIG.SUPPORTED_IMAGE_TYPES.includes(file.type);
                const isVideo = CONFIG.SUPPORTED_VIDEO_TYPES.includes(file.type);

                if (!isImage && !isVideo) {
                    throw new Error('Unsupported file type. Please use JPG, PNG, GIF, MP4, or WebM files.');
                }

                return { isImage, isVideo };
            },

            createMediaPreview(file, onRemove) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const { isImage, isVideo } = utils.validateFile(file);
                        const mediaUrl = e.target.result;
                        
                        const previewItem = document.createElement('div');
                        previewItem.className = 'media-preview-item';
                        
                        if (isImage) {
                            previewItem.innerHTML = `
                                <img src="${mediaUrl}" alt="Preview of ${file.name}" loading="lazy">
                                <button class="media-remove-btn" onclick="removeMedia('${file.name}')" aria-label="Remove ${file.name}">
                                    <i class="fas fa-times"></i>
                                </button>
                            `;
                        } else if (isVideo) {
                            previewItem.innerHTML = `
                                <video src="${mediaUrl}" muted>
                                    <source src="${mediaUrl}" type="${file.type}">
                                    Your browser does not support the video tag.
                                </video>
                                <button class="media-remove-btn" onclick="removeMedia('${file.name}')" aria-label="Remove ${file.name}">
                                    <i class="fas fa-times"></i>
                                </button>
                            `;
                        }
                        
                        resolve({
                            element: previewItem,
                            file: file,
                            url: mediaUrl,
                            type: isImage ? 'image' : 'video'
                        });
                    };
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            },

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = 'notification';
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 1rem 1.5rem;
                    border-radius: 8px;
                    color: white;
                    font-weight: 500;
                    z-index: 1001;
                    transform: translateX(100%);
                    opacity: 0;
                    transition: all 0.3s ease;
                    max-width: 300px;
                    word-wrap: break-word;
                `;
                
                // Set background color based on type
                switch (type) {
                    case 'success':
                        notification.style.background = '#10b981';
                        break;
                    case 'error':
                        notification.style.background = '#ef4444';
                        break;
                    case 'warning':
                        notification.style.background = '#f59e0b';
                        break;
                    default:
                        notification.style.background = '#6366f1';
                }
                
                notification.textContent = message;
                document.body.appendChild(notification);
                
                // Trigger animation
                setTimeout(() => {
                    notification.style.transform = 'translateX(0)';
                    notification.style.opacity = '1';
                }, 100);
                
                // Auto remove after 3 seconds
                setTimeout(() => {
                    notification.style.transform = 'translateX(100%)';
                    notification.style.opacity = '0';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            },

            calculateHotScore(post) {
                const hoursOld = (Date.now() - post.timestamp.getTime()) / (1000 * 60 * 60);
                const score = post.votes / Math.pow(hoursOld + 2, 1.8);
                return score;
            },

            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },

            isNameRestricted(name) {
                const lowerName = name.toLowerCase();
                return CONFIG.RESTRICTED_NAMES.some(restricted => 
                    lowerName.includes(restricted)
                );
            },

            isNameTaken(name) {
                const state = stateManager.getState();
                return state.registeredUsers.some(user => 
                    user.fullName.toLowerCase() === name.toLowerCase()
                ) || state.communities.some(community => 
                    community.name.toLowerCase() === name.toLowerCase() ||
                    community.displayName.toLowerCase() === name.toLowerCase()
                );
            },

            generateUniqueNameSuggestions(baseName) {
                const suggestions = [];
                for (let i = 1; i <= 5; i++) {
                    const suggestion = `${baseName}${Math.floor(Math.random() * 1000) + i}`;
                    if (!this.isNameTaken(suggestion)) {
                        suggestions.push(suggestion);
                    }
                }
                return suggestions;
            },

            isPremiumUser(userId) {
                const state = stateManager.getState();
                return state.premiumUsers.includes(userId);
            }
        };

        // Profile Picture Management
        class ProfileManager {
            constructor() {
                this.currentStream = null;
            }

            async openCamera() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        video: { width: 640, height: 480 },
                        audio: false 
                    });
                    
                    this.currentStream = stream;
                    const video = document.getElementById('cameraVideo');
                    video.srcObject = stream;
                    
                    document.getElementById('cameraModal').classList.remove('hidden');
                } catch (error) {
                    utils.showNotification('Camera access denied or not available', 'error');
                }
            }

            closeCamera() {
                if (this.currentStream) {
                    this.currentStream.getTracks().forEach(track => track.stop());
                    this.currentStream = null;
                }
                document.getElementById('cameraModal').classList.add('hidden');
            }

            capturePhoto() {
                const video = document.getElementById('cameraVideo');
                const canvas = document.getElementById('cameraCanvas');
                const context = canvas.getContext('2d');
                
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                context.drawImage(video, 0, 0);
                
                const dataURL = canvas.toDataURL('image/jpeg', 0.8);
                this.setProfileImage(dataURL);
                this.closeCamera();
            }

            handleFileUpload(file) {
                if (!file) return;
                
                try {
                    utils.validateFile(file);
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.setProfileImage(e.target.result);
                    };
                    reader.readAsDataURL(file);
                } catch (error) {
                    utils.showNotification(error.message, 'error');
                }
            }

            setProfileImage(imageDataURL) {
                const preview = document.getElementById('profilePreview');
                const initial = document.getElementById('profileInitial');
                
                preview.innerHTML = `
                    <img src="${imageDataURL}" alt="Profile picture">
                    <div class="profile-upload-overlay">
                        <i class="fas fa-camera"></i>
                    </div>
                `;
                
                // Store in user data
                const state = stateManager.getState();
                if (state.currentUser) {
                    state.currentUser.profileImage = imageDataURL;
                    stateManager.setState({ currentUser: state.currentUser });
                    localStorage.setItem('smilex_user', JSON.stringify(state.currentUser));
                }
                
                utils.showNotification('Profile picture updated!', 'success');
            }
        }

        // Initialize Profile Manager
        const profileManager = new ProfileManager();

        // Name Validation System
        class NameValidator {
            checkAvailability(name) {
                if (!name || name.length < 3) {
                    return { 
                        available: false, 
                        message: 'Name must be at least 3 characters long',
                        type: 'error'
                    };
                }

                if (utils.isNameRestricted(name)) {
                    return {
                        available: false,
                        message: 'This name contains restricted words',
                        type: 'error',
                        suggestions: utils.generateUniqueNameSuggestions(name.replace(/smile|smilex/gi, ''))
                    };
                }

                if (utils.isNameTaken(name)) {
                    return {
                        available: false,
                        message: 'This name is already taken',
                        type: 'error',
                        suggestions: utils.generateUniqueNameSuggestions(name)
                    };
                }

                return {
                    available: true,
                    message: 'Name is available!',
                    type: 'success'
                };
            }

            displayValidation(elementId, result) {
                const validationDiv = document.getElementById(elementId);
                if (!validationDiv) return;

                validationDiv.style.display = 'flex';
                validationDiv.className = `name-validation ${result.available ? 'name-available' : 'name-taken'}`;
                
                let html = `
                    <i class="fas fa-${result.available ? 'check' : 'times'}"></i>
                    <span>${result.message}</span>
                `;

                if (result.suggestions && result.suggestions.length > 0) {
                    html += `
                        <div style="margin-top: 0.5rem; font-size: 11px;">
                            Suggestions: ${result.suggestions.map(suggestion => 
                                `<span style="background: var(--primary-color); color: white; padding: 2px 6px; border-radius: 4px; margin-right: 4px; cursor: pointer;" onclick="applySuggestion('${suggestion}')">${suggestion}</span>`
                            ).join('')}
                        </div>
                    `;
                }

                validationDiv.innerHTML = html;
            }
        }

        // Initialize Name Validator
        const nameValidator = new NameValidator();

        // Advanced Search System
        class SearchSystem {
            constructor() {
                this.searchResults = [];
                this.currentQuery = '';
            }

            performSearch(query) {
                if (!query || query.length < 2) {
                    this.hideSearchResults();
                    return;
                }

                this.currentQuery = query.toLowerCase();
                const state = stateManager.getState();
                const results = [];

                // Search posts
                const postResults = this.searchPosts(query, state);
                results.push(...postResults);

                // Search communities
                const communityResults = this.searchCommunities(query, state);
                results.push(...communityResults);

                // Search users
                const userResults = this.searchUsers(query, state);
                results.push(...userResults);

                this.displaySearchResults(results);
            }

            searchPosts(query, state) {
                const results = [];
                const queryWords = query.toLowerCase().split(/\s+/);
                
                state.posts.forEach(post => {
                    let relevanceScore = 0;
                    const searchText = `${post.title} ${post.content} ${post.author}`.toLowerCase();
                    
                    queryWords.forEach(word => {
                        if (searchText.includes(word)) {
                            relevanceScore += post.title.toLowerCase().includes(word) ? 3 : 1;
                            relevanceScore += post.votes * 0.01; // Boost popular posts
                        }
                    });

                    if (relevanceScore > 0) {
                        results.push({
                            type: 'post',
                            id: post.id,
                            title: post.title,
                            description: post.content.substring(0, 100) + '...',
                            author: post.author,
                            community: post.community,
                            relevance: relevanceScore,
                            data: post
                        });
                    }
                });

                return results.sort((a, b) => b.relevance - a.relevance).slice(0, 5);
            }

            searchCommunities(query, state) {
                const results = [];
                const queryWords = query.toLowerCase().split(/\s+/);
                
                state.communities.forEach(community => {
                    let relevanceScore = 0;
                    const searchText = `${community.name} ${community.displayName} ${community.description}`.toLowerCase();
                    
                    queryWords.forEach(word => {
                        if (searchText.includes(word)) {
                            relevanceScore += community.name.toLowerCase().includes(word) ? 3 : 1;
                            relevanceScore += community.memberCount * 0.001; // Boost popular communities
                        }
                    });

                    if (relevanceScore > 0) {
                        results.push({
                            type: 'community',
                            id: community.id,
                            title: community.displayName,
                            description: community.description || 'No description available',
                            memberCount: community.memberCount,
                            relevance: relevanceScore,
                            data: community
                        });
                    }
                });

                return results.sort((a, b) => b.relevance - a.relevance).slice(0, 3);
            }

            searchUsers(query, state) {
                const results = [];
                const queryLower = query.toLowerCase();
                
                state.registeredUsers.forEach(user => {
                    if (user.fullName.toLowerCase().includes(queryLower)) {
                        results.push({
                            type: 'user',
                            id: user.userId,
                            title: user.fullName,
                            description: `User since ${new Date(user.createdAt).toLocaleDateString()}`,
                            relevance: user.fullName.toLowerCase().indexOf(queryLower) === 0 ? 2 : 1,
                            data: user
                        });
                    }
                });

                return results.sort((a, b) => b.relevance - a.relevance).slice(0, 3);
            }

            displaySearchResults(results) {
                const container = document.getElementById('searchResults');
                if (!container) return;

                if (results.length === 0) {
                    container.innerHTML = '<div class="search-result-item">No results found</div>';
                } else {
                    container.innerHTML = results.map(result => `
                        <div class="search-result-item" onclick="navigateToResult('${result.type}', '${result.id}')">
                            <div class="search-result-type">${result.type}</div>
                            <div class="search-result-title">${this.highlightQuery(result.title)}</div>
                            <div class="search-result-description">${this.highlightQuery(result.description)}</div>
                            ${result.type === 'community' ? `<div style="font-size: 10px; color: #666;">${utils.formatNumber(result.memberCount)} members</div>` : ''}
                        </div>
                    `).join('');
                }

                container.classList.remove('hidden');
            }

            highlightQuery(text) {
                if (!this.currentQuery) return text;
                
                const regex = new RegExp(`(${this.currentQuery})`, 'gi');
                return text.replace(regex, '<mark style="background: var(--primary-color); color: white; padding: 1px 2px; border-radius: 2px;">$1</mark>');
            }

            hideSearchResults() {
                const container = document.getElementById('searchResults');
                if (container) {
                    container.classList.add('hidden');
                }
            }
        }

        // Initialize Search System
        const searchSystem = new SearchSystem();

        // Media Management
        class MediaManager {
            constructor() {
                this.uploadedMedia = [];
            }

            async handleFiles(files) {
                const validFiles = [];
                const errors = [];

                for (const file of files) {
                    try {
                        utils.validateFile(file);
                        validFiles.push(file);
                    } catch (error) {
                        errors.push(`${file.name}: ${error.message}`);
                    }
                }

                if (errors.length > 0) {
                    utils.showNotification(`Some files were rejected: ${errors.join(', ')}`, 'warning');
                }

                const previews = await Promise.all(
                    validFiles.map(file => utils.createMediaPreview(file, this.removeMedia.bind(this)))
                );

                this.uploadedMedia.push(...previews);
                this.updatePreviewContainer();
                
                return previews;
            }

            removeMedia(fileName) {
                this.uploadedMedia = this.uploadedMedia.filter(media => media.file.name !== fileName);
                this.updatePreviewContainer();
            }

            updatePreviewContainer() {
                const container = document.getElementById('mediaPreviewContainer');
                if (!container) return;

                container.innerHTML = '';
                this.uploadedMedia.forEach(media => {
                    container.appendChild(media.element);
                });
            }

            clearAll() {
                this.uploadedMedia = [];
                this.updatePreviewContainer();
            }

            getMediaData() {
                return this.uploadedMedia.map(media => ({
                    url: media.url,
                    type: media.type,
                    name: media.file.name
                }));
            }
        }

      
        // Advanced Comments System
        class CommentsSystem {
            constructor() {
                this.currentEmojiTarget = null;
            }

            addComment(postId, commentText, inputElement, parentCommentId = null) {
                if (!commentText.trim()) return;

                const state = stateManager.getState();
                const post = state.posts.find(p => p.id === postId);
                
                if (!post) return;

                const newComment = {
                    id: utils.generateId(),
                    author: state.currentUser ? state.currentUser.fullName : "Anonymous",
                    authorId: state.currentUser ? state.currentUser.userId : "anonymous",
                    text: commentText.trim(),
                    timestamp: new Date(),
                    votes: 0,
                    parentId: parentCommentId,
                    replies: [],
                    isPremium: utils.isPremiumUser(state.currentUser ? state.currentUser.userId : null)
                };

                if (!post.commentsData) {
                    post.commentsData = [];
                }
                
                if (parentCommentId) {
                    // Find parent comment and add reply
                    const parentComment = post.commentsData.find(c => c.id === parentCommentId);
                    if (parentComment) {
                        if (!parentComment.replies) parentComment.replies = [];
                        parentComment.replies.push(newComment);
                    }
                } else {
                    post.commentsData.push(newComment);
                }
                
                post.comments++;

                stateManager.setState({ posts: state.posts });
                
                if (inputElement) {
                    inputElement.value = '';
                }
                
                this.renderComments(postId, post.commentsData);
                utils.showNotification('Comment added!', 'success');
                
                return newComment;
            }

            renderComments(postId, comments) {
                const container = document.getElementById(`comments-list-${postId}`);
                if (!container) return;

                if (!comments || comments.length === 0) {
                    container.innerHTML = '<p style="color: #666; text-align: center; padding: 1rem;">No comments yet. Be the first to comment!</p>';
                    return;
                }

                container.innerHTML = comments.map(comment => this.renderComment(comment, postId)).join('');
            }

            renderComment(comment, postId, isReply = false) {
                const state = stateManager.getState();
                const timeAgo = utils.getPreciseTimeAgo(comment.timestamp);
                const premiumBadge = comment.isPremium ? '<span class="premium-badge"><i class="fas fa-crown"></i> Premium</span>' : '';
                
                let html = `
                    <div class="comment ${isReply ? 'reply' : ''}" data-comment-id="${comment.id}">
                        <div class="comment-header">
                            <div class="comment-author">
                                ${comment.author} ${premiumBadge}
                            </div>
                            <div class="comment-time precise-timestamp">${timeAgo}</div>
                        </div>
                        <div class="comment-text">${this.formatCommentText(comment.text, comment.isPremium)}</div>
                        <div class="comment-actions">
                            <span class="comment-action" onclick="likeComment('${comment.id}')">
                                <i class="fas fa-heart"></i> ${comment.votes || 0}
                            </span>
                            <span class="comment-action" onclick="showReplyInput('${comment.id}', '${postId}')">
                                <i class="fas fa-reply"></i> Reply
                            </span>
                            <span class="comment-action" onclick="showEmojiPicker(event, 'comment-${comment.id}')">
                                <i class="fas fa-smile"></i> React
                            </span>
                        </div>
                        <div id="reply-input-${comment.id}" class="comment-input" style="display: none; margin-top: 0.5rem;">
                            <input type="text" placeholder="Write a reply..." onkeypress="if(event.key==='Enter') addReply('${postId}', '${comment.id}', this.value, this)">
                            <button onclick="addReply('${postId}', '${comment.id}', this.previousElementSibling.value, this.previousElementSibling)" class="btn btn-primary" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">Reply</button>
                        </div>
                `;

                // Add replies
                if (comment.replies && comment.replies.length > 0) {
                    html += '<div class="replies">';
                    comment.replies.forEach(reply => {
                        html += this.renderComment(reply, postId, true);
                    });
                    html += '</div>';
                }

                html += '</div>';
                return html;
            }

            formatCommentText(text, isPremium) {
                if (isPremium) {
                    // Apply premium formatting
                    text = text.replace(/\*\*(.*?)\*\*/g, '<span class="disco-text">$1</span>');
                    
                    // Replace premium emojis
                    CONFIG.PREMIUM_EMOJIS.forEach(emoji => {
                        text = text.replace(new RegExp(emoji, 'g'), `<span class="premium-emoji">${emoji}</span>`);
                    });
                }
                
                return text;
            }

            showEmojiPicker(event, targetId) {
                event.stopPropagation();
                const picker = document.getElementById('emojiPicker');
                const rect = event.target.getBoundingClientRect();
                
                picker.style.position = 'absolute';
                picker.style.top = `${rect.bottom + 5}px`;
                picker.style.left = `${rect.left}px`;
                picker.classList.add('active');
                
                this.currentEmojiTarget = targetId;
                
                // Close picker when clicking outside
                setTimeout(() => {
                    document.addEventListener('click', this.closeEmojiPicker.bind(this), { once: true });
                }, 100);
            }

            closeEmojiPicker() {
                const picker = document.getElementById('emojiPicker');
                picker.classList.remove('active');
                this.currentEmojiTarget = null;
            }

            insertEmoji(emoji) {
                if (this.currentEmojiTarget) {
                    if (this.currentEmojiTarget.startsWith('comment-')) {
                        // Add emoji reaction to comment
                        const commentId = this.currentEmojiTarget.replace('comment-', '');
                        this.addEmojiReaction(commentId, emoji);
                    } else {
                        // Insert emoji into input field
                        const input = document.querySelector(`#${this.currentEmojiTarget} input, #${this.currentEmojiTarget}`);
                        if (input) {
                            input.value += emoji;
                            input.focus();
                        }
                    }
                }
                this.closeEmojiPicker();
            }

            addEmojiReaction(commentId, emoji) {
                // Implementation for emoji reactions
                utils.showNotification(`Reacted with ${emoji}!`, 'success');
            }
        }

        // Initialize Comments System
        const commentsSystem = new CommentsSystem();

        // Post Management
        class PostManager {
            constructor() {
                this.posts = stateManager.getState().posts;
            }

            async createPost(postData) {
                const state = stateManager.getState();
                const mediaData = mediaManager.getMediaData();

                // Handle poll creation
                if (postData.postType === 'poll') {
                    return this.createPoll(postData);
                }

                const newPost = {
                    id: utils.generateId(),
                    title: postData.title,
                    content: postData.content || "",
                    author: state.currentUser ? state.currentUser.fullName : "Anonymous",
                    authorId: state.currentUser ? state.currentUser.userId : "anonymous",
                    visibility: postData.visibility,
                    votes: 0,
                    comments: 0,
                    timestamp: new Date(),
                    type: this.determinePostType(postData.postType, mediaData),
                    media: mediaData,
                    userVotes: [], // Track who voted
                    commentsData: [],
                    isPremium: utils.isPremiumUser(state.currentUser ? state.currentUser.userId : null)
                };

                if (postData.visibility === 'community' && postData.community) {
                    const community = state.communities.find(c => c.id === postData.community);
                    if (community) {
                        newPost.community = community.displayName;
                        newPost.communityId = community.id;
                    }
                } else {
                    newPost.community = "General";
                    newPost.communityId = null;
                }

                const updatedPosts = [newPost, ...state.posts];
                stateManager.setState({ 
                    posts: updatedPosts,
                    postsToday: state.postsToday + 1
                });

                // Log activity
                stateManager.logActivity({
                    type: 'post_created',
                    postId: newPost.id,
                    userId: newPost.authorId,
                    timestamp: new Date()
                });

                mediaManager.clearAll();
                utils.showNotification('Post created successfully!', 'success');
                
                return newPost;
            }

            createPoll(pollData) {
                const state = stateManager.getState();
                const pollOptions = this.extractPollOptions(pollData);

                if (pollOptions.length < 2) {
                    throw new Error('Poll must have at least 2 options');
                }

                const pollId = utils.generateId();
                const newPost = {
                    id: utils.generateId(),
                    title: pollData.title,
                    content: pollData.content || "",
                    author: state.currentUser ? state.currentUser.fullName : "Anonymous",
                    authorId: state.currentUser ? state.currentUser.userId : "anonymous",
                    visibility: pollData.visibility,
                    votes: 0,
                    comments: 0,
                    timestamp: new Date(),
                    type: "poll",
                    media: [],
                    pollOptions: pollOptions,
                    pollId: pollId,
                    pollActive: true,
                    totalVotes: 0,
                    userVotes: [],
                    commentsData: [],
                    isPremium: utils.isPremiumUser(state.currentUser ? state.currentUser.userId : null)
                };

                if (pollData.visibility === 'community' && pollData.community) {
                    const community = state.communities.find(c => c.id === pollData.community);
                    if (community) {
                        newPost.community = community.displayName;
                        newPost.communityId = community.id;
                    }
                } else {
                    newPost.community = "General";
                    newPost.communityId = null;
                }

                // Add to live polls tracking
                const updatedLivePolls = [...state.livePolls, {
                    id: pollId,
                    postId: newPost.id,
                    question: pollData.title,
                    options: pollOptions,
                    active: true,
                    createdBy: state.currentUser ? state.currentUser.userId : "anonymous",
                    totalVotes: 0
                }];

                const updatedPosts = [newPost, ...state.posts];
                stateManager.setState({ 
                    posts: updatedPosts,
                    livePolls: updatedLivePolls,
                    activePolls: state.activePolls + 1,
                    postsToday: state.postsToday + 1
                });

                utils.showNotification('Live poll created successfully!', 'success');
                return newPost;
            }

            extractPollOptions(pollData) {
                const options = [];
                let optionIndex = 1;
                
                // Extract poll options from form data
                while (pollData[`option${optionIndex}`]) {
                    if (pollData[`option${optionIndex}`].trim()) {
                        options.push({
                            text: pollData[`option${optionIndex}`].trim(),
                            votes: 0,
                            percentage: 0,
                            voters: []
                        });
                    }
                    optionIndex++;
                }

                // Also check for poll option inputs in the DOM
                const pollInputs = document.querySelectorAll('.poll-option-input');
                pollInputs.forEach(input => {
                    if (input.value.trim() && !options.find(opt => opt.text === input.value.trim())) {
                        options.push({
                            text: input.value.trim(),
                            votes: 0,
                            percentage: 0,
                            voters: []
                        });
                    }
                });

                return options;
            }

            determinePostType(selectedType, mediaData) {
                if (selectedType === 'poll') return 'poll';
                if (mediaData.length > 0) {
                    const hasVideo = mediaData.some(media => media.type === 'video');
                    return hasVideo ? 'video' : 'image';
                }
                return 'text';
            }

            voteOnPost(postId, direction) {
                const state = stateManager.getState();
                const post = state.posts.find(p => p.id === postId);
                if (!post || !state.currentUser) return;

                const userId = state.currentUser.userId;
                const existingVote = post.userVotes.find(v => v.userId === userId);

                if (existingVote) {
                    // Remove existing vote
                    post.votes -= existingVote.direction === 'up' ? 1 : -1;
                    post.userVotes = post.userVotes.filter(v => v.userId !== userId);
                    
                    // Add new vote if different direction
                    if (existingVote.direction !== direction) {
                        post.votes += direction === 'up' ? 1 : -1;
                        post.userVotes.push({ userId, direction });
                    }
                } else {
                    // Add new vote
                    post.votes += direction === 'up' ? 1 : -1;
                    post.userVotes.push({ userId, direction });
                }

                stateManager.setState({ posts: state.posts });
                this.updatePostVoteDisplay(postId, post.votes);
            }

            voteOnPoll(postId, optionIndex) {
                const state = stateManager.getState();
                const post = state.posts.find(p => p.id === postId);
                
                if (!post || !post.pollOptions || !post.pollActive || !state.currentUser) {
                    utils.showNotification('Unable to vote on this poll', 'error');
                    return;
                }

                const userId = state.currentUser.userId;
                
                // Check if user has already voted
                const hasVoted = post.pollOptions.some(option => 
                    option.voters && option.voters.includes(userId)
                );

                if (hasVoted) {
                    utils.showNotification('You have already voted in this poll', 'warning');
                    return;
                }

                // Add vote
                if (!post.pollOptions[optionIndex].voters) {
                    post.pollOptions[optionIndex].voters = [];
                }
                
                post.pollOptions[optionIndex].voters.push(userId);
                post.pollOptions[optionIndex].votes++;

                // Recalculate percentages
                const totalVotes = post.pollOptions.reduce((sum, option) => sum + option.votes, 0);
                post.pollOptions.forEach(option => {
                    option.percentage = totalVotes > 0 ? Math.round((option.votes / totalVotes) * 100) : 0;
                });

                post.totalVotes = totalVotes;

                // Update live polls tracking
                const livePoll = state.livePolls.find(p => p.postId === postId);
                if (livePoll) {
                    livePoll.options = post.pollOptions;
                    livePoll.totalVotes = totalVotes;
                }

                stateManager.setState({ 
                    posts: state.posts,
                    livePolls: state.livePolls
                });

                utils.showNotification('Vote recorded!', 'success');
                this.renderPosts();
            }

            updatePostVoteDisplay(postId, newVoteCount) {
                const voteCountElement = document.querySelector(`[data-post-id="${postId}"] .vote-count`);
                if (voteCountElement) {
                    voteCountElement.textContent = utils.formatNumber(newVoteCount);
                }
            }

            sortPosts(posts, sortType) {
                switch (sortType) {
                    case 'new':
                        return [...posts].sort((a, b) => b.timestamp - a.timestamp);
                    case 'top':
                        return [...posts].sort((a, b) => b.votes - a.votes);
                    case 'trending':
                        return [...posts].sort((a, b) => {
                            const aScore = this.calculateTrendingScore(a);
                            const bScore = this.calculateTrendingScore(b);
                            return bScore - aScore;
                        });
                    case 'hot':
                    default:
                        return [...posts].sort((a, b) => {
                            const aScore = utils.calculateHotScore(a);
                            const bScore = utils.calculateHotScore(b);
                            return bScore - aScore;
                        });
                }
            }

            calculateTrendingScore(post) {
                const hoursOld = (Date.now() - post.timestamp.getTime()) / (1000 * 60 * 60);
                const engagementScore = post.votes + (post.comments * 2);
                const recencyBonus = Math.max(0, 24 - hoursOld) / 24;
                return engagementScore * (1 + recencyBonus);
            }

            filterPosts(posts, filterType, userMemberships) {
                switch (filterType) {
                    case 'mycommunities':
                        return posts.filter(post => 
                            post.communityId && userMemberships.includes(post.communityId)
                        );
                    case 'general':
                        return posts.filter(post => 
                            post.visibility === 'general' || !post.communityId
                        );
                    case 'all':
                    default:
                        return posts;
                }
            }

            renderPosts() {
                const state = stateManager.getState();
                const filteredPosts = this.filterPosts(state.posts, state.currentFeedFilter, state.userMemberships);
                const sortedPosts = this.sortPosts(filteredPosts, state.currentSort);
                
                this.displayPosts(sortedPosts);
            }

            displayPosts(posts) {
                const container = document.getElementById('posts-feed');
                
                if (posts.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 3rem; color: #666;">
                            <i class="fas fa-comments" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                            <h3>No posts to show</h3>
                            <p>Be the first to create a post in this feed!</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = posts.map(post => this.createPostHTML(post)).join('');
            }

            createPostHTML(post) {
                const state = stateManager.getState();
                const timeAgo = utils.getTimeAgo(post.timestamp);
                const preciseTime = utils.getPreciseTimeAgo(post.timestamp);
                const communityDisplay = post.community && post.community !== 'General' 
                    ? `<a href="#" onclick="viewCommunityDetails('${post.communityId}')" style="color: #8b5cf6; text-decoration: none;">c/${post.community}</a>` 
                    : 'General';

                const premiumBadge = post.isPremium ? '<span class="premium-badge"><i class="fas fa-crown"></i> Premium</span>' : '';

                let contentHTML = '';
                
                if (post.type === 'poll' && post.pollOptions) {
                    contentHTML = this.createPollHTML(post);
                } else {
                    if (post.content) {
                        contentHTML += `<div class="post-text">${this.formatPostContent(post.content, post.isPremium)}</div>`;
                    }
                    
                    if (post.media && post.media.length > 0) {
                        contentHTML += this.createMediaHTML(post.media);
                    }
                }

                // Determine user's vote status
                const userVote = state.currentUser ? 
                    post.userVotes.find(v => v.userId === state.currentUser.userId) : null;

                return `
                    <article class="post-card" role="article" aria-labelledby="post-title-${post.id}" data-post-id="${post.id}" onclick="openPostDetail('${post.id}')">
                        <div class="post-content">
                            <div class="vote-section" role="group" aria-label="Vote on post" onclick="event.stopPropagation()">
                                <button class="vote-button ${userVote?.direction === 'up' ? 'voted-up' : ''}" 
                                        onclick="postManager.voteOnPost('${post.id}', 'up')" 
                                        aria-label="Upvote post"
                                        title="Upvote">
                                    <i class="fas fa-arrow-up" aria-hidden="true"></i>
                                </button>
                                <div class="vote-count" aria-live="polite">${utils.formatNumber(post.votes)}</div>
                                <button class="vote-button ${userVote?.direction === 'down' ? 'voted-down' : ''}" 
                                        onclick="postManager.voteOnPost('${post.id}', 'down')" 
                                        aria-label="Downvote post"
                                        title="Downvote">
                                    <i class="fas fa-arrow-down" aria-hidden="true"></i>
                                </button>
                            </div>
                            
                            <div class="post-main">
                                <div class="post-meta">
                                    <span>${communityDisplay}</span>
                                    <span></span>
                                    <span>Posted by ${post.author} ${premiumBadge}</span>
                                    <span></span>
                                    <time datetime="${post.timestamp.toISOString()}" title="${preciseTime}">${timeAgo}</time>
                                    ${post.type === 'poll' ? '<span> <i class="fas fa-poll" aria-hidden="true"></i> Live Poll</span>' : ''}
                                    ${this.isTrending(post) ? '<span class="feature-badge trending-indicator"> TRENDING</span>' : ''}
                                </div>
                                
                                <h2 class="post-title" id="post-title-${post.id}">${post.title}</h2>
                                
                                ${contentHTML}
                                
                                <div class="post-actions" onclick="event.stopPropagation()">
                                    <div class="post-action-buttons" role="group" aria-label="Post actions">
                                        <button class="post-action-button" 
                                                onclick="toggleComments('${post.id}')" 
                                                aria-expanded="false"
                                                aria-controls="comments-${post.id}">
                                            <i class="far fa-comment" aria-hidden="true"></i>
                                            <span>${utils.formatNumber(post.comments)} Comments</span>
                                        </button>
                                        <button class="post-action-button" 
                                                onclick="sharePost('${post.id}')"
                                                aria-label="Share post">
                                            <i class="fas fa-share" aria-hidden="true"></i>
                                            <span>Share</span>
                                        </button>
                                        <button class="post-action-button" 
                                                onclick="savePost('${post.id}')"
                                                aria-label="Save post">
                                            <i class="far fa-bookmark" aria-hidden="true"></i>
                                            <span>Save</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="comments-section" id="comments-${post.id}" aria-label="Comments for ${post.title}">
                            <div class="comment-input">
                                <input type="text" 
                                       placeholder="Add a comment..." 
                                       onkeypress="if(event.key==='Enter') commentsSystem.addComment('${post.id}', this.value, this)"
                                       aria-label="Add a comment">
                                <button class="emoji-picker-btn" onclick="commentsSystem.showEmojiPicker(event, 'comment-input-${post.id}')" title="Add emoji">
                                    <i class="fas fa-smile"></i>
                                </button>
                                <button onclick="commentsSystem.addComment('${post.id}', this.parentElement.querySelector('input').value, this.parentElement.querySelector('input'))" 
                                        class="btn btn-primary"
                                        aria-label="Post comment">
                                    Post
                                </button>
                            </div>
                            <div id="comments-list-${post.id}" role="list" aria-label="Comments list">
                                ${commentsSystem.renderComments(post.id, post.commentsData || [])}
                            </div>
                        </div>
                    </article>
                `;
            }

            formatPostContent(content, isPremium) {
                if (isPremium) {
                    // Apply premium formatting
                    content = content.replace(/\*\*(.*?)\*\*/g, '<span class="disco-text">$1</span>');
                    
                    // Replace premium emojis
                    CONFIG.PREMIUM_EMOJIS.forEach(emoji => {
                        content = content.replace(new RegExp(emoji, 'g'), `<span class="premium-emoji">${emoji}</span>`);
                    });
                }
                
                return content;
            }

            createMediaHTML(mediaArray) {
                if (!mediaArray || mediaArray.length === 0) return '';

                const gridClass = mediaArray.length === 1 ? 'single' : 
                                 mediaArray.length === 2 ? 'double' : 'multiple';

                return `
                    <div class="media-grid ${gridClass}">
                        ${mediaArray.map(media => {
                            if (media.type === 'image') {
                                return `
                                    <img src="${media.url}" 
                                         alt="Post image" 
                                         class="post-image" 
                                         onclick="openMediaViewer('${media.url}', 'image'); event.stopPropagation();"
                                         loading="lazy">
                                `;
                            } else if (media.type === 'video') {
                                return `
                                    <div class="video-container">
                                        <video class="post-video" 
                                               onclick="openMediaViewer('${media.url}', 'video'); event.stopPropagation();"
                                               preload="metadata">
                                            <source src="${media.url}" type="video/mp4">
                                            Your browser does not support the video tag.
                                        </video>
                                        <div class="video-controls">
                                            <button class="play-pause-btn" onclick="toggleVideoPlayback(this); event.stopPropagation();">
                                                <i class="fas fa-play"></i>
                                            </button>
                                            <div class="progress-bar">
                                                <div class="progress-fill"></div>
                                            </div>
                                            <div class="volume-control">
                                                <i class="fas fa-volume-up"></i>
                                                <input type="range" class="volume-slider" min="0" max="100" value="50">
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }
                            return '';
                        }).join('')}
                    </div>
                `;
            }

            createPollHTML(post) {
                if (!post.pollOptions || !Array.isArray(post.pollOptions)) {
                    return '<div class="post-text">Poll data unavailable</div>';
                }

                const state = stateManager.getState();
                const totalVotes = post.pollOptions.reduce((sum, option) => sum + (option.votes || 0), 0);
                const hasVoted = state.currentUser && post.pollOptions.some(option => 
                    option.voters && option.voters.includes(state.currentUser.userId)
                );

                return `
                    <div class="poll-container" role="group" aria-labelledby="poll-question-${post.id}" onclick="event.stopPropagation()">
                        <div id="poll-question-${post.id}" class="sr-only">${post.title}</div>
                        ${post.pollOptions.map((option, index) => {
                            const percentage = totalVotes > 0 ? Math.round((option.votes / totalVotes) * 100) : 0;
                            const hasUserVoted = state.currentUser && option.voters && option.voters.includes(state.currentUser.userId);
                            
                            return `
                                <div class="poll-option ${hasVoted ? 'voted' : ''}" 
                                     onclick="${hasVoted ? '' : `postManager.voteOnPoll('${post.id}', ${index})`}"
                                     style="cursor: ${hasVoted ? 'default' : 'pointer'}; opacity: ${hasVoted && !hasUserVoted ? '0.7' : '1'};"
                                     role="button"
                                     tabindex="0"
                                     aria-label="Poll option: ${option.text}. ${option.votes} votes, ${percentage}%"
                                     onkeydown="if(event.key==='Enter' && !${hasVoted}) postManager.voteOnPoll('${post.id}', ${index})">
                                    <div class="poll-option-bar" style="width: ${percentage}%"></div>
                                    <span class="poll-option-text">
                                        ${option.text}
                                        ${hasUserVoted ? ' <i class="fas fa-check" style="color: #10b981; margin-left: 0.25rem;" aria-label="You voted for this option"></i>' : ''}
                                    </span>
                                    <span class="poll-option-percentage">${percentage}% (${option.votes})</span>
                                </div>
                            `;
                        }).join('')}
                        <div class="poll-stats">
                            <span>${utils.formatNumber(totalVotes)} total votes</span>
                            ${post.pollExpiresAt ? `<span>  Expires ${utils.getTimeAgo(new Date(post.pollExpiresAt))}</span>` : ''}
                            ${hasVoted ? '<span>  You have voted</span>' : ''}
                            <span class="live-indicator" style="margin-left: 8px;">
                                <div class="live-dot"></div>
                                LIVE
                            </span>
                        </div>
                    </div>
                `;
            }

            isTrending(post) {
                const hoursOld = (Date.now() - post.timestamp.getTime()) / (1000 * 60 * 60);
                const engagementRate = (post.votes + post.comments * 2) / Math.max(hoursOld, 1);
                return engagementRate > 10 && hoursOld < 24;
            }
        }

        // Initialize Post Manager
        const postManager = new PostManager();

        // Community Management
        class CommunityManager {
            constructor() {
                this.communities = stateManager.getState().communities;
            }

            async createCommunity(communityData) {
                const state = stateManager.getState();
                
                // Validate community name
                const communityName = communityData.name.replace(/\s+/g, '').toLowerCase();
                
                if (utils.isNameRestricted(communityName)) {
                    throw new Error('Community name contains restricted words related to "smile/smilex"!');
                }
                
                if (state.communities.find(c => c.name.toLowerCase() === communityName)) {
                    throw new Error('Community name already exists!');
                }

                const newCommunity = {
                    id: utils.generateId(),
                    name: communityName,
                    displayName: communityData.displayName,
                    description: communityData.description,
                    type: communityData.type,
                    createdBy: state.currentUser ? state.currentUser.fullName : "Anonymous",
                    createdByUserId: state.currentUser ? state.currentUser.userId : "anonymous",
                    createdAt: new Date().toISOString(),
                    memberCount: 1,
                    topics: communityData.topics ? communityData.topics.split(',').map(t => t.trim()) : [],
                    members: [state.currentUser ? state.currentUser.userId : "anonymous"]
                };

                const updatedCommunities = [...state.communities, newCommunity];
                const updatedMemberships = [...state.userMemberships, newCommunity.id];
                const updatedCreatedCommunities = [...state.userCreatedCommunities, newCommunity.id];

                stateManager.setState({
                    communities: updatedCommunities,
                    userMemberships: updatedMemberships,
                    userCreatedCommunities: updatedCreatedCommunities,
                    totalCommunities: state.totalCommunities + 1
                });

                // Log activity
                stateManager.logActivity({
                    type: 'community_created',
                    communityId: newCommunity.id,
                    userId: newCommunity.createdByUserId,
                    timestamp: new Date()
                });

                utils.showNotification(`Community "${communityData.displayName}" created successfully!`, 'success');
                return newCommunity;
            }

            joinCommunity(communityId) {
                const state = stateManager.getState();
                
                if (state.userMemberships.includes(communityId)) {
                    utils.showNotification('You are already a member of this community!', 'warning');
                    return;
                }

                const community = state.communities.find(c => c.id === communityId);
                if (!community) return;

                community.memberCount++;
                community.members.push(state.currentUser ? state.currentUser.userId : "anonymous");

                const updatedMemberships = [...state.userMemberships, communityId];

                stateManager.setState({
                    communities: state.communities,
                    userMemberships: updatedMemberships
                });

                utils.showNotification(`Joined ${community.displayName}!`, 'success');
            }

            leaveCommunity(communityId) {
                const state = stateManager.getState();
                
                if (!state.userMemberships.includes(communityId)) {
                    utils.showNotification('You are not a member of this community!', 'warning');
                    return;
                }

                // Don't allow leaving if user is the creator
                if (state.userCreatedCommunities.includes(communityId)) {
                    utils.showNotification('You cannot leave a community you created. Delete it instead.', 'warning');
                    return;
                }

                const community = state.communities.find(c => c.id === communityId);
                if (!community) return;

                community.memberCount = Math.max(0, community.memberCount - 1);
                community.members = community.members.filter(id => id !== (state.currentUser ? state.currentUser.userId : "anonymous"));

                const updatedMemberships = state.userMemberships.filter(id => id !== communityId);

                stateManager.setState({
                    communities: state.communities,
                    userMemberships: updatedMemberships
                });

                utils.showNotification(`Left ${community.displayName}!`, 'success');
            }

            deleteCommunity(communityId) {
                const state = stateManager.getState();
                const community = state.communities.find(c => c.id === communityId);
                
                if (!community) return;

                // Check if user is the creator
                if (community.createdByUserId !== (state.currentUser ? state.currentUser.userId : "anonymous")) {
                    utils.showNotification('You can only delete communities you created!', 'error');
                    return;
                }

                if (!confirm('Are you sure you want to delete this community? This action cannot be undone.')) {
                    return;
                }

                // Remove community and related data
                const updatedCommunities = state.communities.filter(c => c.id !== communityId);
                const updatedPosts = state.posts.filter(p => p.communityId !== communityId);
                const updatedMemberships = state.userMemberships.filter(id => id !== communityId);
                const updatedCreatedCommunities = state.userCreatedCommunities.filter(id => id !== communityId);

                stateManager.setState({
                    communities: updatedCommunities,
                    posts: updatedPosts,
                    userMemberships: updatedMemberships,
                    userCreatedCommunities: updatedCreatedCommunities,
                    totalCommunities: Math.max(0, state.totalCommunities - 1)
                });

                utils.showNotification('Community deleted successfully!', 'success');
            }

            searchCommunities(query) {
                const state = stateManager.getState();
                return state.communities.filter(c => 
                    c.name.toLowerCase().includes(query.toLowerCase()) || 
                    c.displayName.toLowerCase().includes(query.toLowerCase()) ||
                    (c.description && c.description.toLowerCase().includes(query.toLowerCase())) ||
                    (c.topics && c.topics.some(topic => topic.toLowerCase().includes(query.toLowerCase())))
                );
            }

            filterCommunities(communities, filterType) {
                switch (filterType) {
                    case 'public':
                        return communities.filter(c => c.type === 'public');
                    case 'private':
                        return communities.filter(c => c.type === 'private');
                    case 'all':
                    default:
                        return communities;
                }
            }

            updateCommunityLists() {
                const state = stateManager.getState();
                this.updateCreatedCommunities(state);
                this.updateJoinedCommunities(state);
                this.updateRecommendedCommunities(state);
            }

            updateCreatedCommunities(state) {
                const createdCommunitiesUL = document.getElementById('createdCommunitiesUL');
                if (!createdCommunitiesUL) return;

                const createdCommunities = state.communities.filter(c => state.userCreatedCommunities.includes(c.id));
                
                createdCommunitiesUL.innerHTML = createdCommunities.map(community => `
                    <li>
                        <a href="#" onclick="viewCommunityDetails('${community.id}')" style="display: flex; align-items: center; padding: 0.5rem; margin-bottom: 0.25rem; border-radius: 8px; transition: all 0.3s ease; text-decoration: none;">
                            <span class="community-icon ${utils.getCommunityColor(community.name)}" style="margin-right: 0.5rem;">
                                ${community.name.charAt(0)}
                            </span>
                            <span style="flex: 1; font-size: 0.9rem;">${community.displayName}</span>
                            ${community.type === 'private' ? '<i class="fas fa-lock" style="font-size: 10px; color: #666; margin-right: 0.25rem;" title="Private community"></i>' : ''}
                            <i class="fas fa-crown" style="font-size: 10px; color: #ffd700;" title="You created this community"></i>
                        </a>
                    </li>
                `).join('');

                if (createdCommunities.length === 0) {
                    createdCommunitiesUL.innerHTML = '<li style="color: #666; font-size: 0.8rem; padding: 0.5rem;">No communities created yet</li>';
                }
            }

            updateJoinedCommunities(state) {
                const joinedCommunitiesUL = document.getElementById('joinedCommunitiesUL');
                if (!joinedCommunitiesUL) return;

                const joinedCommunities = state.communities.filter(c => 
                    state.userMemberships.includes(c.id) && !state.userCreatedCommunities.includes(c.id)
                );
                
                joinedCommunitiesUL.innerHTML = joinedCommunities.map(community => `
                    <li>
                        <a href="#" onclick="viewCommunityDetails('${community.id}')" style="display: flex; align-items: center; padding: 0.5rem; margin-bottom: 0.25rem; border-radius: 8px; transition: all 0.3s ease; text-decoration: none;">
                            <span class="community-icon ${utils.getCommunityColor(community.name)}" style="margin-right: 0.5rem;">
                                ${community.name.charAt(0)}
                            </span>
                            <span style="flex: 1; font-size: 0.9rem;">${community.displayName}</span>
                            ${community.type === 'private' ? '<i class="fas fa-lock" style="font-size: 10px; color: #666;" title="Private community"></i>' : ''}
                        </a>
                    </li>
                `).join('');

                if (joinedCommunities.length === 0) {
                    joinedCommunitiesUL.innerHTML = '<li style="color: #666; font-size: 0.8rem; padding: 0.5rem;">No communities joined yet</li>';
                }
            }

            updateRecommendedCommunities(state) {
                const recommendedContainer = document.getElementById('recommendedCommunities');
                if (!recommendedContainer) return;

                const nonMemberCommunities = state.communities.filter(c => 
                    !state.userMemberships.includes(c.id) && c.type === 'public'
                ).slice(0, 3);

                recommendedContainer.innerHTML = nonMemberCommunities.map(community => `
                    <div style="background: #2a2a2a; padding: 1rem; border-radius: 12px; margin-bottom: 1rem; cursor: pointer; transition: all 0.3s ease;" 
                         onclick="viewCommunityDetails('${community.id}')"
                         onmouseover="this.style.background='#333'"
                         onmouseout="this.style.background='#2a2a2a'">
                        <div style="display: flex; align-items: center; margin-bottom: 0.5rem;">
                            <span class="community-icon ${utils.getCommunityColor(community.name)}" style="margin-right: 0.5rem; width: 32px; height: 32px; font-size: 14px;">
                                ${community.name.charAt(0)}
                            </span>
                            <div style="flex: 1;">
                                <h4 style="font-size: 0.9rem; margin: 0;">${community.displayName}</h4>
                                <p style="font-size: 0.7rem; color: #999; margin: 0;">${utils.formatNumber(community.memberCount)} members</p>
                            </div>
                            <span style="background: ${community.type === 'private' ? '#ef4444' : '#10b981'}; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px;">
                                ${community.type}
                            </span>
                        </div>
                        <p style="font-size: 0.75rem; color: #ccc; margin: 0; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                            ${community.description || 'No description available'}
                        </p>
                    </div>
                `).join('');

                if (nonMemberCommunities.length === 0) {
                    recommendedContainer.innerHTML = '<p style="color: #666; font-size: 0.8rem;">No new communities to discover</p>';
                }
            }
        }

        // Initialize Community Manager
        const communityManager = new CommunityManager();

        // Chat System
        class ChatSystem {
            constructor() {
                this.messages = [];
                this.isOpen = false;
                this.agentResponses = [
                    "Thanks for your message! Our team will get back to you soon.",
                    "I'm here to help! Can you provide more details about your issue?",
                    "That's a great question! Let me connect you with a specialist.",
                    "I understand your concern. We're working on improving that feature.",
                    "Thanks for using SmileX! Is there anything specific I can help you with?",
                    "I appreciate your feedback! We're always looking to improve our platform.",
                    "Let me help you with that. Can you tell me more about what you're experiencing?",
                    "That's an interesting point! Our development team would love to hear about this.",
                    "I'm glad you reached out! Customer satisfaction is our top priority.",
                    "Thanks for being part of the SmileX community! How can I assist you today?"
                ];
            }

            toggleChat() {
                this.isOpen = !this.isOpen;
                const chatContainer = document.getElementById('chat-container');
                const chatToggle = document.getElementById('chat-toggle-btn');
                
                if (this.isOpen) {
                    chatContainer.classList.add('active');
                    chatToggle.innerHTML = '<i class="fas fa-times"></i>';
                    chatToggle.setAttribute('aria-label', 'Close live chat');
                } else {
                    chatContainer.classList.remove('active');
                    chatToggle.innerHTML = '<i class="fas fa-comment-dots"></i>';
                    chatToggle.setAttribute('aria-label', 'Open live chat');
                }
            }

            sendMessage(messageText) {
                if (!messageText.trim()) return;

                const state = stateManager.getState();
                const userMessage = {
                    id: utils.generateId(),
                    sender: state.currentUser ? state.currentUser.fullName : "You",
                    text: messageText.trim(),
                    timestamp: new Date(),
                    type: 'user'
                };

                this.messages.push(userMessage);
                this.renderMessages();

                // Simulate agent response
                setTimeout(() => {
                    const agentMessage = {
                        id: utils.generateId(),
                        sender: "Support Agent",
                        text: this.agentResponses[Math.floor(Math.random() * this.agentResponses.length)],
                        timestamp: new Date(),
                        type: 'agent'
                    };

                    this.messages.push(agentMessage);
                    this.renderMessages();
                }, 1000 + Math.random() * 2000); // Random delay between 1-3 seconds
            }

            renderMessages() {
                const messagesContainer = document.getElementById('chat-messages');
                if (!messagesContainer) return;

                messagesContainer.innerHTML = this.messages.map(message => `
                    <div class="message ${message.type}" role="listitem">
                        <div class="message-user">${message.sender}</div>
                        <div class="message-text">${message.text}</div>
                        <div class="message-time">${utils.getPreciseTimeAgo(message.timestamp)}</div>
                    </div>
                `).join('');

                // Scroll to bottom
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
        }

        // Initialize Chat System
        const chatSystem = new ChatSystem();

        // Live Updates System
        class LiveUpdatesSystem {
            constructor() {
                this.updateInterval = null;
                this.isActive = false;
            }

            start() {
                if (this.isActive) return;
                
                this.isActive = true;
                this.updateInterval = setInterval(() => {
                    this.performLiveUpdates();
                }, CONFIG.LIVE_UPDATE_INTERVAL);
            }

            stop() {
                if (this.updateInterval) {
                    clearInterval(this.updateInterval);
                    this.updateInterval = null;
                }
                this.isActive = false;
            }

            performLiveUpdates() {
                const state = stateManager.getState();
                
                // Simulate live user activity with more realistic numbers
                const onlineChange = Math.floor(Math.random() * 2000) - 1000; // 1000 users
                const pollChange = Math.floor(Math.random() * 10) - 5; // 5 polls
                const postChange = Math.floor(Math.random() * 50); // +0-50 posts

                const newOnlineUsers = Math.max(100000, state.onlineUsers + onlineChange);
                const newActivePolls = Math.max(0, state.activePolls + pollChange);
                const newPostsToday = state.postsToday + postChange;

                stateManager.setState({
                    onlineUsers: newOnlineUsers,
                    activePolls: newActivePolls,
                    postsToday: newPostsToday
                });

                this.updateLiveStats();
                
                // Occasionally show update indicator
                if (Math.random() < 0.1) { // 10% chance
                    this.showUpdateIndicator();
                }
            }

            updateLiveStats() {
                const state = stateManager.getState();
                
                const onlineUsersEl = document.getElementById('onlineUsers');
                const activePollsEl = document.getElementById('activePolls');
                const postsTodayEl = document.getElementById('postsToday');
                const totalCommunitiesEl = document.getElementById('totalCommunities');

                if (onlineUsersEl) onlineUsersEl.textContent = utils.formatNumber(state.onlineUsers);
                if (activePollsEl) activePollsEl.textContent = utils.formatNumber(state.activePolls);
                if (postsTodayEl) postsTodayEl.textContent = utils.formatNumber(state.postsToday);
                if (totalCommunitiesEl) totalCommunitiesEl.textContent = utils.formatNumber(state.totalCommunities);
            }

            showUpdateIndicator() {
                const indicator = document.getElementById('update-indicator');
                if (!indicator) return;

                indicator.classList.add('show');
                setTimeout(() => {
                    indicator.classList.remove('show');
                }, 3000);
            }
        }

        // Initialize Live Updates System
        const liveUpdatesSystem = new LiveUpdatesSystem();

        // Premium System
        class PremiumSystem {
            constructor() {
                this.premiumFeatures = {
                    discoText: true,
                    premiumEmojis: true,
                    adFree: true,
                    premiumBadge: true,
                    prioritySupport: true,
                    customThemes: true
                };
            }

            upgradeToPremium(userId) {
                const state = stateManager.getState();
                
                if (!state.premiumUsers.includes(userId)) {
                    const updatedPremiumUsers = [...state.premiumUsers, userId];
                    stateManager.setState({ premiumUsers: updatedPremiumUsers });
                    
                    // Update user avatar
                    const userAvatar = document.getElementById('userAvatar');
                    if (userAvatar) {
                        userAvatar.classList.add('premium');
                    }
                    
                    utils.showNotification(' Welcome to SmileX Premium! Enjoy your exclusive features!', 'success');
                    
                    // Log activity
                    stateManager.logActivity({
                        type: 'premium_upgrade',
                        userId: userId,
                        timestamp: new Date()
                    });
                    
                    return true;
                }
                
                return false;
            }

            isPremiumUser(userId) {
                const state = stateManager.getState();
                return state.premiumUsers.includes(userId);
            }
        }

        // Initialize Premium System
        const premiumSystem = new PremiumSystem();

        // Global Functions (accessible from HTML)
        window.showProfileUploadOptions = function() {
            // This function is called when clicking on profile preview
        };

        window.openCamera = function() {
            profileManager.openCamera();
        };

        window.openFileUpload = function() {
            document.getElementById('profileImageInput').click();
        };

        window.closeCamera = function() {
            profileManager.closeCamera();
        };

        window.capturePhoto = function() {
            profileManager.capturePhoto();
        };

        window.handleProfileImageUpload = function(event) {
            const file = event.target.files[0];
            if (file) {
                profileManager.handleFileUpload(file);
            }
        };

        window.checkNameAvailability = function(name) {
            const result = nameValidator.checkAvailability(name);
            nameValidator.displayValidation('nameValidation', result);
        };

        window.validateCommunityName = function(name) {
            const result = nameValidator.checkAvailability(name);
            nameValidator.displayValidation('communityNameValidation', result);
        };

        window.applySuggestion = function(suggestion) {
            const nameInput = document.getElementById('fullName') || document.getElementById('communityName');
            if (nameInput) {
                nameInput.value = suggestion;
                nameInput.dispatchEvent(new Event('input'));
            }
        };

        window.performGlobalSearch = function(query) {
            searchSystem.performSearch(query);
        };

        window.navigateToResult = function(type, id) {
            searchSystem.hideSearchResults();
            
            switch (type) {
                case 'post':
                    openPostDetail(id);
                    break;
                case 'community':
                    viewCommunityDetails(id);
                    break;
                case 'user':
                    // Navigate to user profile (not implemented in this demo)
                    utils.showNotification('User profiles coming soon!', 'info');
                    break;
            }
        };

        window.openPostDetail = function(postId) {
            const state = stateManager.getState();
            const post = state.posts.find(p => p.id === postId);
            
            if (!post) return;

            const modal = document.getElementById('post-detail-modal');
            const content = document.getElementById('postDetailContent');
            
            content.innerHTML = `
                <div class="modal-header">
                    <h3>${post.title}</h3>
                    <button onclick="hideModal('post-detail-modal')" class="modal-close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    ${postManager.createPostHTML(post)}
                </div>
            `;
            
            showModal('post-detail-modal');
        };

        window.toggleComments = function(postId) {
            const commentsSection = document.getElementById(`comments-${postId}`);
            const button = document.querySelector(`[onclick="toggleComments('${postId}')"]`);
            
            if (commentsSection.classList.contains('active')) {
                commentsSection.classList.remove('active');
                button.setAttribute('aria-expanded', 'false');
            } else {
                commentsSection.classList.add('active');
                button.setAttribute('aria-expanded', 'true');
                
                // Load comments if not already loaded
                const state = stateManager.getState();
                const post = state.posts.find(p => p.id === postId);
                if (post) {
                    commentsSystem.renderComments(postId, post.commentsData || []);
                }
            }
        };

        window.showReplyInput = function(commentId, postId) {
            const replyInput = document.getElementById(`reply-input-${commentId}`);
            if (replyInput) {
                replyInput.style.display = replyInput.style.display === 'none' ? 'flex' : 'none';
                if (replyInput.style.display === 'flex') {
                    replyInput.querySelector('input').focus();
                }
            }
        };

        window.addReply = function(postId, parentCommentId, replyText, inputElement) {
            commentsSystem.addComment(postId, replyText, inputElement, parentCommentId);
            
            // Hide reply input
            const replyInput = document.getElementById(`reply-input-${parentCommentId}`);
            if (replyInput) {
                replyInput.style.display = 'none';
            }
        };

        window.likeComment = function(commentId) {
            // Implementation for liking comments
            utils.showNotification('Comment liked!', 'success');
        };

        window.insertEmoji = function(emoji) {
            commentsSystem.insertEmoji(emoji);
        };

        window.sharePost = function(postId) {
            const state = stateManager.getState();
            const post = state.posts.find(p => p.id === postId);
            
            if (!post) return;

            if (navigator.share) {
                navigator.share({
                    title: post.title,
                    text: post.content,
                    url: window.location.href
                }).catch(console.error);
            } else {
                // Fallback: copy to clipboard
                const shareText = `${post.title}\n\n${post.content}\n\nShared from SmileX`;
                navigator.clipboard.writeText(shareText).then(() => {
                    utils.showNotification('Post copied to clipboard!', 'success');
                }).catch(() => {
                    utils.showNotification('Unable to share post', 'error');
                });
            }
        };

        window.savePost = function(postId) {
            // In a real app, this would save to user's saved posts
            utils.showNotification('Post saved!', 'success');
        };

        window.viewCommunityDetails = function(communityId) {
            const state = stateManager.getState();
            const community = state.communities.find(c => c.id === communityId);
            
            if (!community) return;

            // Set current community and show modal
            stateManager.setState({ currentCommunity: community });
            showCommunityDetailModal(community);
        };

        window.openMediaViewer = function(mediaUrl, mediaType) {
            const modal = document.getElementById('media-viewer-modal');
            const content = document.getElementById('mediaViewerContent');
            
            if (mediaType === 'image') {
                content.innerHTML = `<img src="${mediaUrl}" style="max-width: 100%; max-height: 100%; object-fit: contain;" alt="Full size image">`;
            } else if (mediaType === 'video') {
                content.innerHTML = `<video src="${mediaUrl}" controls style="max-width: 100%; max-height: 100%;" autoplay>Your browser does not support the video tag.</video>`;
            }
            
            modal.classList.add('active');
        };

        window.toggleVideoPlayback = function(button) {
            const video = button.closest('.video-container').querySelector('video');
            const icon = button.querySelector('i');
            
            if (video.paused) {
                video.play();
                icon.className = 'fas fa-pause';
            } else {
                video.pause();
                icon.className = 'fas fa-play';
            }
        };

        window.searchCommunities = function(query) {
            const state = stateManager.getState();
            let filteredCommunities = state.communities;
            
            if (query.trim()) {
                filteredCommunities = communityManager.searchCommunities(query);
            }
            
            displayBrowseCommunities(filteredCommunities);
        };

        window.filterCommunities = function(filterType) {
            // Update active tab
            const tabButtons = document.querySelectorAll('[data-tab]');
            tabButtons.forEach(btn => {
                btn.classList.remove('active');
                btn.setAttribute('aria-selected', 'false');
            });
            
            const activeTab = document.querySelector(`[data-tab="${filterType}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
                activeTab.setAttribute('aria-selected', 'true');
            }
            
            // Filter communities
            const state = stateManager.getState();
            const filteredCommunities = communityManager.filterCommunities(state.communities, filterType);
            displayBrowseCommunities(filteredCommunities);
        };

        window.toggleUserMenu = function() {
            // Implementation for user menu toggle
            const state = stateManager.getState();
            if (state.currentUser && utils.isPremiumUser(state.currentUser.userId)) {
                utils.showNotification('Premium user menu coming soon!', 'info');
            } else {
                utils.showNotification('User menu coming soon!', 'info');
            }
        };

        // Initialize Sample Data
        function initializeSampleData() {
            const state = stateManager.getState();
            
            if (state.posts.length === 0) {
                const samplePosts = [
                    {
                        id: utils.generateId(),
                        title: " WELCOME EVERYONE TO SMILEX! ",
                        content: "Welcome, everyone and those viewing this message to explore and have fun on this page, but remember the rules and regulations. This is a fully functional social media platform with real-time features, live polls, media sharing, community management, advanced search, premium features, and much more!",
                        author: "SmileX Team",
                        authorId: "system",
                        community: "SmileX Official",
                        communityId: "c1",
                        visibility: "general",
                        votes: 15420,
                        comments: 3247,
                        timestamp: new Date(Date.now() - 3600000),
                        type: "text",
                        media: [],
                        userVotes: [],
                        commentsData: [
                            {
                                id: utils.generateId(),
                                author: "TechEnthusiast",
                                authorId: "user1",
                                text: "This platform looks amazing! Love the real-time features and the advanced search!",
                                timestamp: new Date(Date.now() - 3000000),
                                votes: 45,
                                replies: [
                                    {
                                        id: utils.generateId(),
                                        author: "SmileX Team",
                                        authorId: "system",
                                        text: "Thank you! We've worked hard to make this the best social platform possible. Enjoy exploring! ",
                                        timestamp: new Date(Date.now() - 2900000),
                                        votes: 23,
                                        isPremium: true
                                    }
                                ],
                                isPremium: false
                            },
                            {
                                id: utils.generateId(),
                                author: "CommunityBuilder",
                                authorId: "user2",
                                text: "The community management features are incredible! Already created my first community ",
                                timestamp: new Date(Date.now() - 2800000),
                                votes: 32,
                                replies: [],
                                isPremium: false
                            }
                        ],
                        isPremium: true
                    },
                    {
                        id: utils.generateId(),
                        title: " What's your favorite feature so far?",
                        content: "",
                        author: "FeatureExplorer",
                        authorId: "user3",
                        community: "General",
                        communityId: null,
                        visibility: "general",
                        votes: 234,
                        comments: 89,
                        timestamp: new Date(Date.now() - 7200000),
                        type: "poll",
                        media: [],
                        pollOptions: [
                            { text: "Live Polls & Real-time Updates", votes: 145, percentage: 35, voters: [] },
                            { text: "Advanced Search System", votes: 98, percentage: 24, voters: [] },
                            { text: "Community Management", votes: 87, percentage: 21, voters: [] },
                            { text: "Premium Features", votes: 54, percentage: 13, voters: [] },
                            { text: "Media Sharing", votes: 28, percentage: 7, voters: [] }
                        ],
                        pollActive: true,
                        totalVotes: 412,
                        userVotes: [],
                        commentsData: [],
                        isPremium: false
                    },
                    {
                        id: utils.generateId(),
                        title: " Premium Features Showcase",
                        content: "Check out these **amazing premium features** that make SmileX stand out!  Premium users get access to disco text, exclusive emojis, ad-free experience, and priority support!",
                        author: "PremiumUser",
                        authorId: "premium1",
                        community: "Premium Lounge",
                        communityId: "c2",
                        visibility: "general",
                        votes: 567,
                        comments: 123,
                        timestamp: new Date(Date.now() - 10800000),
                        type: "text",
                        media: [],
                        userVotes: [],
                        commentsData: [
                            {
                                id: utils.generateId(),
                                author: "PremiumFan",
                                authorId: "user4",
                                text: "The **disco text** looks absolutely amazing!  Worth every penny!",
                                timestamp: new Date(Date.now() - 10000000),
                                votes: 78,
                                replies: [],
                                isPremium: true
                            }
                        ],
                        isPremium: true
                    },
                    {
                        id: utils.generateId(),
                        title: " Advanced Search Demo",
                        content: "Try searching for anything in the search bar above! You can search for posts, communities, users, and get instant results with relevance scoring. The search system indexes everything in real-time!",
                        author: "SearchMaster",
                        authorId: "user5",
                        community: "Tech Talk",
                        communityId: "c3",
                        visibility: "general",
                        votes: 189,
                        comments: 45,
                        timestamp: new Date(Date.now() - 14400000),
                        type: "text",
                        media: [],
                        userVotes: [],
                        commentsData: [],
                        isPremium: false
                    },
                    {
                        id: utils.generateId(),
                        title: " Live Stats are Amazing!",
                        content: "Look at the live stats in the sidebar! Over 127,000 users online right now, thousands of active polls, and posts being created every minute. This platform is truly alive! ",
                        author: "StatsLover",
                        authorId: "user6",
                        community: "General",
                        communityId: null,
                        visibility: "general",
                        votes: 345,
                        comments: 67,
                        timestamp: new Date(Date.now() - 18000000),
                        type: "text",
                        media: [],
                        userVotes: [],
                        commentsData: [],
                        isPremium: false
                    }
                ];

                const sampleCommunities = [
                    {
                        id: "c1",
                        name: "smilex-official",
                        displayName: "SmileX Official",
                        description: "Official announcements, updates, and discussions about SmileX platform features and improvements.",
                        type: "public",
                        createdBy: "SmileX Team",
                        createdByUserId: "system",
                        createdAt: new Date(Date.now() - 86400000 * 30).toISOString(),
                        memberCount: 15420,
                        topics: ["announcements", "updates", "platform", "official"],
                        members: ["system"]
                    },
                    {
                        id: "c2",
                        name: "premium-lounge",
                        displayName: "Premium Lounge",
                        description: "Exclusive community for premium members to discuss features, share feedback, and connect with other premium users.",
                        type: "private",
                        createdBy: "SmileX Team",
                        createdByUserId: "system",
                        createdAt: new Date(Date.now() - 86400000 * 25).toISOString(),
                        memberCount: 2847,
                        topics: ["premium", "exclusive", "features", "vip"],
                        members: ["system"]
                    },
                    {
                        id: "c3",
                        name: "tech-talk",
                        displayName: "Tech Talk",
                        description: "Discuss the latest in technology, programming, AI, and digital innovations. Share your projects and get feedback from the community.",
                        type: "public",
                        createdBy: "TechGuru",
                        createdByUserId: "user7",
                        createdAt: new Date(Date.now() - 86400000 * 20).toISOString(),
                        memberCount: 8934,
                        topics: ["technology", "programming", "ai", "innovation"],
                        members: ["user7"]
                    },
                    {
                        id: "c4",
                        name: "creative-corner",
                        displayName: "Creative Corner",
                        description: "A space for artists, designers, writers, and creators to share their work, get inspiration, and collaborate on projects.",
                        type: "public",
                        createdBy: "ArtisticSoul",
                        createdByUserId: "user8",
                        createdAt: new Date(Date.now() - 86400000 * 15).toISOString(),
                        memberCount: 5672,
                        topics: ["art", "design", "creativity", "inspiration"],
                        members: ["user8"]
                    },
                    {
                        id: "c5",
                        name: "gaming-hub",
                        displayName: "Gaming Hub",
                        description: "Connect with fellow gamers, discuss the latest games, share gameplay clips, and organize gaming sessions.",
                        type: "public",
                        createdBy: "GameMaster",
                        createdByUserId: "user9",
                        createdAt: new Date(Date.now() - 86400000 * 10).toISOString(),
                        memberCount: 12456,
                        topics: ["gaming", "esports", "reviews", "community"],
                        members: ["user9"]
                    }
                ];

                stateManager.setState({
                    posts: samplePosts,
                    communities: sampleCommunities,
                    totalCommunities: sampleCommunities.length
                });
            }
        }

        // Modal Management
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                
                // Focus management for accessibility
                const firstFocusable = modal.querySelector('button, input, select, textarea, [tabindex]:not([tabindex="-1"])');
                if (firstFocusable) {
                    firstFocusable.focus();
                }
            }
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        window.showModal = showModal;
        window.hideModal = hideModal;

        function showCommunityDetailModal(community) {
            const modal = document.getElementById('community-detail-modal');
            const header = document.getElementById('communityDetailHeader');
            const description = document.getElementById('communityDetailDescription');
            const creator = document.getElementById('communityCreator');
            const creationDate = document.getElementById('communityCreationDate');
            const memberCount = document.getElementById('communityMemberCount');
            const communityType = document.getElementById('communityType');
            const topics = document.getElementById('communityTopics');
            const joinLeaveButton = document.getElementById('joinLeaveButton');
            const deleteButton = document.getElementById('deleteCommunityButton');
            const postsContainer = document.getElementById('communityPosts');

            const state = stateManager.getState();
            const isMember = state.userMemberships.includes(community.id);
            const isCreator = state.userCreatedCommunities.includes(community.id);

            // Header
            header.innerHTML = `
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <span class="community-icon ${utils.getCommunityColor(community.name)}" style="width: 60px; height: 60px; font-size: 24px;">
                        ${community.name.charAt(0)}
                    </span>
                    <div>
                        <h3 id="community-detail-title">${community.displayName}</h3>
                        <p style="color: #666; margin: 0;">c/${community.name}</p>
                    </div>
                    ${community.type === 'private' ? '<i class="fas fa-lock" style="color: #ef4444;" title="Private community"></i>' : ''}
                </div>
                <button onclick="hideModal('community-detail-modal')" class="modal-close" aria-label="Close community details">
                    <i class="fas fa-times"></i>
                </button>
            `;

            // Description
            description.textContent = community.description || 'No description available';

            // Info
            creator.textContent = community.createdBy;
            creationDate.textContent = new Date(community.createdAt).toLocaleDateString();
            memberCount.textContent = utils.formatNumber(community.memberCount);
            communityType.innerHTML = `
                <span style="background: ${community.type === 'private' ? '#ef4444' : '#10b981'}; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px;">
                    ${community.type}
                </span>
            `;

            // Topics
            if (community.topics && community.topics.length > 0) {
                topics.innerHTML = community.topics.map(topic => 
                    `<span style="background: #333; color: #ccc; padding: 4px 8px; border-radius: 12px; font-size: 12px; margin: 2px;">#${topic}</span>`
                ).join('');
            } else {
                topics.innerHTML = '<span style="color: #666;">No topics specified</span>';
            }

            // Join/Leave button
            if (isCreator) {
                joinLeaveButton.style.display = 'none';
                deleteButton.classList.remove('hidden');
                deleteButton.onclick = () => {
                    communityManager.deleteCommunity(community.id);
                    hideModal('community-detail-modal');
                };
            } else {
                joinLeaveButton.style.display = 'block';
                deleteButton.classList.add('hidden');
                
                if (isMember) {
                    joinLeaveButton.textContent = 'Leave Community';
                    joinLeaveButton.className = 'btn';
                    joinLeaveButton.style.background = '#ef4444';
                    joinLeaveButton.onclick = () => {
                        communityManager.leaveCommunity(community.id);
                        hideModal('community-detail-modal');
                    };
                } else {
                    joinLeaveButton.textContent = 'Join Community';
                    joinLeaveButton.className = 'btn btn-primary';
                    joinLeaveButton.style.background = '';
                    joinLeaveButton.onclick = () => {
                        communityManager.joinCommunity(community.id);
                        hideModal('community-detail-modal');
                    };
                }
            }

            // Recent posts
            const communityPosts = state.posts.filter(p => p.communityId === community.id).slice(0, 3);
            if (communityPosts.length > 0) {
                postsContainer.innerHTML = communityPosts.map(post => `
                    <div style="background: #2a2a2a; padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem; cursor: pointer;" onclick="openPostDetail('${post.id}')">
                        <h4 style="font-size: 0.9rem; margin-bottom: 0.5rem;">${post.title}</h4>
                        <p style="font-size: 0.8rem; color: #ccc; margin-bottom: 0.5rem;">${post.content.substring(0, 100)}${post.content.length > 100 ? '...' : ''}</p>
                        <div style="display: flex; justify-content: space-between; font-size: 0.7rem; color: #666;">
                            <span>${post.author}</span>
                            <span>${utils.getTimeAgo(post.timestamp)}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                postsContainer.innerHTML = '<p style="color: #666; text-align: center; padding: 2rem;">No posts in this community yet</p>';
            }

            showModal('community-detail-modal');
        }

        function displayBrowseCommunities(communities) {
            const container = document.getElementById('communitiesBrowseList');
            const noMessage = document.getElementById('noCommunitiesMessage');
            
            if (communities.length === 0) {
                container.innerHTML = '';
                noMessage.classList.remove('hidden');
                return;
            }
            
            noMessage.classList.add('hidden');
            
            container.innerHTML = communities.map(community => {
                const state = stateManager.getState();
                const isMember = state.userMemberships.includes(community.id);
                const isCreator = state.userCreatedCommunities.includes(community.id);
                
                return `
                    <div style="background: #2a2a2a; padding: 1.5rem; border-radius: 12px; cursor: pointer; transition: all 0.3s ease; border: 1px solid #404040;" 
                         onclick="viewCommunityDetails('${community.id}')"
                         onmouseover="this.style.borderColor='#6a11cb'"
                         onmouseout="this.style.borderColor='#404040'">
                        <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                            <span class="community-icon ${utils.getCommunityColor(community.name)}" style="margin-right: 1rem; width: 48px; height: 48px; font-size: 20px;">
                                ${community.name.charAt(0)}
                            </span>
                            <div style="flex: 1;">
                                <h3 style="font-size: 1.1rem; margin: 0; display: flex; align-items: center; gap: 0.5rem;">
                                    ${community.displayName}
                                    ${community.type === 'private' ? '<i class="fas fa-lock" style="font-size: 12px; color: #ef4444;" title="Private community"></i>' : ''}
                                    ${isCreator ? '<i class="fas fa-crown" style="font-size: 12px; color: #ffd700;" title="You created this community"></i>' : ''}
                                </h3>
                                <p style="font-size: 0.8rem; color: #999; margin: 0;">c/${community.name}</p>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 0.9rem; font-weight: bold; color: #6a11cb;">${utils.formatNumber(community.memberCount)}</div>
                                <div style="font-size: 0.7rem; color: #666;">members</div>
                            </div>
                        </div>
                        
                        <p style="color: #ccc; font-size: 0.85rem; line-height: 1.4; margin-bottom: 1rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                            ${community.description || 'No description available'}
                        </p>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; gap: 0.25rem; flex-wrap: wrap;">
                                ${community.topics ? community.topics.slice(0, 3).map(topic => 
                                    `<span style="background: #404040; color: #ccc; padding: 2px 6px; border-radius: 8px; font-size: 10px;">#${topic}</span>`
                                ).join('') : ''}
                            </div>
                            
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                ${isMember ? '<span style="background: #10b981; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px;"><i class="fas fa-check"></i> Joined</span>' : ''}
                                <span style="background: ${community.type === 'private' ? '#ef4444' : '#10b981'}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px;">
                                    ${community.type}
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Event Listeners Setup
        function setupEventListeners() {
            // Registration form
            const registrationForm = document.getElementById('registrationForm');
            if (registrationForm) {
                registrationForm.addEventListener('submit', handleRegistration);
                
                // Form validation
                const inputs = registrationForm.querySelectorAll('input, select');
                inputs.forEach(input => {
                    input.addEventListener('input', validateRegistrationForm);
                    input.addEventListener('change', validateRegistrationForm);
                });
            }

            // Create post modal
            const createPostInput = document.getElementById('createPostInput');
            if (createPostInput) {
                createPostInput.addEventListener('click', () => showModal('create-post-modal'));
            }

            // Post type buttons
            const postTypeButtons = document.querySelectorAll('.post-type-button');
            postTypeButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const postType = e.target.dataset.postType;
                    document.getElementById('postType').value = postType;
                    showModal('create-post-modal');
                });
            });

            // Mobile navigation
            const mobileCreatePost = document.getElementById('mobileCreatePost');
            if (mobileCreatePost) {
                mobileCreatePost.addEventListener('click', (e) => {
                    e.preventDefault();
                    showModal('create-post-modal');
                });
            }

            const mobileCreateCommunity = document.getElementById('mobileCreateCommunity');
            if (mobileCreateCommunity) {
                mobileCreateCommunity.addEventListener('click', (e) => {
                    e.preventDefault();
                    showModal('create-community-modal');
                });
            }

            const mobileBrowseBtn = document.getElementById('mobileBrowseBtn');
            if (mobileBrowseBtn) {
                mobileBrowseBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    showModal('browse-communities-modal');
                });
            }

            // Create post form
            const createPostForm = document.getElementById('createPostForm');
            if (createPostForm) {
                createPostForm.addEventListener('submit', handleCreatePost);
                
                // Post type change
                const postTypeSelect = document.getElementById('postType');
                if (postTypeSelect) {
                    postTypeSelect.addEventListener('change', handlePostTypeChange);
                }
                
                // Visibility change
                const visibilitySelect = document.getElementById('postVisibility');
                if (visibilitySelect) {
                    visibilitySelect.addEventListener('change', handleVisibilityChange);
                }
            }

            // Create community form
            const createCommunityForm = document.getElementById('createCommunityForm');
            if (createCommunityForm) {
                createCommunityForm.addEventListener('submit', handleCreateCommunity);
            }

            // Community buttons
            const createCommunityBtn = document.getElementById('createCommunityBtn');
            if (createCommunityBtn) {
                createCommunityBtn.addEventListener('click', () => showModal('create-community-modal'));
            }

            const browseCommunityBtn = document.getElementById('browseCommunityBtn');
            if (browseCommunityBtn) {
                browseCommunityBtn.addEventListener('click', () => showModal('browse-communities-modal'));
            }

            // Sort buttons
            const sortButtons = document.querySelectorAll('.sort-button[data-sort]');
            sortButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const sortType = e.target.dataset.sort;
                    handleSortChange(sortType);
                });
            });

            // Feed filter
            const feedFilter = document.getElementById('feedFilter');
            if (feedFilter) {
                feedFilter.addEventListener('change', (e) => {
                    const filterType = e.target.value;
                    stateManager.setState({ currentFeedFilter: filterType });
                    postManager.renderPosts();
                });
            }

            // Community tabs
            const communityTabButtons = document.querySelectorAll('.my-communities-tabs button');
            communityTabButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const tabType = e.target.dataset.tab;
                    handleCommunityTabChange(tabType);
                });
            });

            // Media upload
            const mediaUploadArea = document.getElementById('mediaUploadArea');
            const mediaInput = document.getElementById('mediaInput');
            
            if (mediaUploadArea && mediaInput) {
                mediaUploadArea.addEventListener('click', () => mediaInput.click());
                mediaUploadArea.addEventListener('dragover', handleDragOver);
                mediaUploadArea.addEventListener('drop', handleDrop);
                mediaInput.addEventListener('change', handleMediaUpload);
            }

            // Poll options
            const addPollOptionBtn = document.getElementById('addPollOption');
            if (addPollOptionBtn) {
                addPollOptionBtn.addEventListener('click', addPollOption);
            }

            // Chat system
            const chatToggleBtn = document.getElementById('chat-toggle-btn');
            const chatCloseBtn = document.getElementById('chat-close-btn');
            const chatSendBtn = document.getElementById('chat-send-btn');
            const chatInput = document.getElementById('chat-input');

            if (chatToggleBtn) {
                chatToggleBtn.addEventListener('click', () => chatSystem.toggleChat());
            }

            if (chatCloseBtn) {
                chatCloseBtn.addEventListener('click', () => chatSystem.toggleChat());
            }

            if (chatSendBtn) {
                chatSendBtn.addEventListener('click', () => {
                    const message = chatInput.value.trim();
                    if (message) {
                        chatSystem.sendMessage(message);
                        chatInput.value = '';
                    }
                });
            }

            if (chatInput) {
                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const message = e.target.value.trim();
                        if (message) {
                            chatSystem.sendMessage(message);
                            e.target.value = '';
                        }
                    }
                });
            }

            // Premium button
            const premiumBtn = document.getElementById('premiumBtn');
            if (premiumBtn) {
                premiumBtn.addEventListener('click', handlePremiumUpgrade);
            }

            // Search input
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', utils.debounce((e) => {
                    performGlobalSearch(e.target.value);
                }, 300));
                
                searchInput.addEventListener('blur', () => {
                    setTimeout(() => searchSystem.hideSearchResults(), 200);
                });
            }

            // Modal close buttons
            const modalCloseButtons = document.querySelectorAll('.modal-close, [id*="close"][id*="Modal"]');
            modalCloseButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const modal = e.target.closest('.modal');
                    if (modal) {
                        modal.classList.remove('active');
                        document.body.style.overflow = '';
                    }
                });
            });

            // Media viewer close
            const closeMediaViewer = document.getElementById('closeMediaViewer');
            if (closeMediaViewer) {
                closeMediaViewer.addEventListener('click', () => {
                    hideModal('media-viewer-modal');
                });
            }

            // Click outside to close modals
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal') || e.target.classList.contains('overlay')) {
                    e.target.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });

            // Keyboard navigation for accessibility
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    const activeModal = document.querySelector('.modal.active, .overlay.active');
                    if (activeModal) {
                        activeModal.classList.remove('active');
                        document.body.style.overflow = '';
                    }
                }
            });
        }

        // Event Handlers
        function handleRegistration(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const userData = {
                fullName: formData.get('fullName'),
                email: formData.get('email'),
                gender: formData.get('gender'),
                country: formData.get('country'),
                ageConsent: formData.get('ageConsent'),
                termsConsent: formData.get('termsConsent'),
                privacyConsent: formData.get('privacyConsent'),
                userId: utils.generateId(),
                createdAt: new Date().toISOString(),
                profileImage: null
            };

            // Get profile image if set
            const profilePreview = document.getElementById('profilePreview');
            const profileImg = profilePreview.querySelector('img');
            if (profileImg) {
                userData.profileImage = profileImg.src;
            }

            // Validate required fields
            if (!userData.fullName || !userData.email || !userData.gender || !userData.country) {
                utils.showNotification('Please fill in all required fields', 'error');
                return;
            }

            if (!userData.ageConsent || !userData.termsConsent || !userData.privacyConsent) {
                utils.showNotification('Please accept all required consents', 'error');
                return;
            }

            // Check name availability one more time
            const nameCheck = nameValidator.checkAvailability(userData.fullName);
            if (!nameCheck.available) {
                utils.showNotification(nameCheck.message, 'error');
                return;
            }

            // Save user data
            const state = stateManager.getState();
            const updatedUsers = [...state.registeredUsers, userData];
            
            stateManager.setState({ 
                currentUser: userData,
                registeredUsers: updatedUsers
            });

            // Store in localStorage for persistence
            localStorage.setItem('smilex_user', JSON.stringify(userData));

            // Update UI
            updateUserInterface(userData);
            
            // Hide onboarding
            document.getElementById('onboardingOverlay').classList.remove('active');
            
            utils.showNotification(`Welcome to SmileX, ${userData.fullName}!`, 'success');
            
            // Log activity
            stateManager.logActivity({
                type: 'user_registered',
                userId: userData.userId,
                timestamp: new Date()
            });
        }

        function validateRegistrationForm() {
            const form = document.getElementById('registrationForm');
            const submitBtn = document.getElementById('submitBtn');
            
            const fullName = form.fullName.value.trim();
            const email = form.email.value.trim();
            const gender = form.gender.value;
            const country = form.country.value;
            const ageConsent = form.ageConsent.checked;
            const termsConsent = form.termsConsent.checked;
            const privacyConsent = form.privacyConsent.checked;

            const isValid = fullName && email && gender && country && ageConsent && termsConsent && privacyConsent;
            
            submitBtn.disabled = !isValid;
            
            if (isValid) {
                submitBtn.classList.remove('btn-secondary');
                submitBtn.classList.add('btn-primary');
            } else {
                submitBtn.classList.remove('btn-primary');
                submitBtn.classList.add('btn-secondary');
            }
        }

        function handleCreatePost(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const postData = {
                title: formData.get('title'),
                content: formData.get('content'),
                postType: formData.get('postType'),
                visibility: formData.get('visibility'),
                community: formData.get('community')
            };

            // Add poll options if it's a poll
            if (postData.postType === 'poll') {
                let optionIndex = 1;
                while (formData.get(`option${optionIndex}`)) {
                    postData[`option${optionIndex}`] = formData.get(`option${optionIndex}`);
                    optionIndex++;
                }
            }

            if (!postData.title.trim()) {
                utils.showNotification('Please enter a title for your post', 'error');
                return;
            }

            try {
                postManager.createPost(postData);
                hideModal('create-post-modal');
                e.target.reset();
                postManager.renderPosts();
                
                // Reset form state
                handlePostTypeChange({ target: { value: 'text' } });
                handleVisibilityChange({ target: { value: 'general' } });
                
            } catch (error) {
                utils.showNotification(error.message, 'error');
            }
        }

        function handleCreateCommunity(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const communityData = {
                name: formData.get('name'),
                displayName: formData.get('displayName'),
                description: formData.get('description'),
                type: formData.get('type'),
                topics: formData.get('topics')
            };

            if (!communityData.name.trim() || !communityData.displayName.trim()) {
                utils.showNotification('Please enter both community name and display name', 'error');
                return;
            }

            try {
                communityManager.createCommunity(communityData);
                hideModal('create-community-modal');
                e.target.reset();
                communityManager.updateCommunityLists();
                updatePostCommunityOptions();
                
            } catch (error) {
                utils.showNotification(error.message, 'error');
            }
        }

        function handlePostTypeChange(e) {
            const postType = e.target.value;
            const contentContainer = document.getElementById('contentContainer');
            const pollOptionsContainer = document.getElementById('pollOptionsContainer');
            const mediaUploadContainer = document.getElementById('mediaUploadContainer');

            // Reset visibility
            contentContainer.classList.remove('hidden');
            pollOptionsContainer.classList.add('hidden');
            mediaUploadContainer.classList.remove('hidden');

            if (postType === 'poll') {
                pollOptionsContainer.classList.remove('hidden');
                mediaUploadContainer.classList.add('hidden');
            }
        }

        function handleVisibilityChange(e) {
            const visibility = e.target.value;
            const communityContainer = document.getElementById('postCommunityContainer');
            const communitySelect = document.getElementById('postCommunity');

            if (visibility === 'community') {
                communityContainer.classList.remove('hidden');
                communitySelect.required = true;
                updatePostCommunityOptions();
            } else {
                communityContainer.classList.add('hidden');
                communitySelect.required = false;
            }
        }

        function updatePostCommunityOptions() {
            const communitySelect = document.getElementById('postCommunity');
            if (!communitySelect) return;

            const state = stateManager.getState();
            const userCommunities = state.communities.filter(c => 
                state.userMemberships.includes(c.id) || state.userCreatedCommunities.includes(c.id)
            );

            communitySelect.innerHTML = '<option value="">Select a community</option>' +
                userCommunities.map(community => 
                    `<option value="${community.id}">${community.displayName}</option>`
                ).join('');
        }

        function handleSortChange(sortType) {
            // Update active button
            const sortButtons = document.querySelectorAll('.sort-button[data-sort]');
            sortButtons.forEach(btn => {
                btn.classList.remove('active');
                btn.setAttribute('aria-pressed', 'false');
            });
            
            const activeButton = document.querySelector(`[data-sort="${sortType}"]`);
            if (activeButton) {
                activeButton.classList.add('active');
                activeButton.setAttribute('aria-pressed', 'true');
            }

            stateManager.setState({ currentSort: sortType });
            postManager.renderPosts();
        }

        function handleCommunityTabChange(tabType) {
            // Update active tab
            const tabButtons = document.querySelectorAll('.my-communities-tabs button');
            tabButtons.forEach(btn => {
                btn.classList.remove('active');
                btn.setAttribute('aria-selected', 'false');
            });
            
            const activeTab = document.querySelector(`[data-tab="${tabType}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
                activeTab.setAttribute('aria-selected', 'true');
            }

            // Show/hide content
            const createdList = document.getElementById('createdCommunitiesList');
            const joinedList = document.getElementById('joinedCommunitiesList');
            
            if (tabType === 'created') {
                createdList.classList.remove('hidden');
                joinedList.classList.add('hidden');
            } else {
                createdList.classList.add('hidden');
                joinedList.classList.remove('hidden');
            }
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.target.classList.add('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.target.classList.remove('dragover');
            
            const files = Array.from(e.dataTransfer.files);
            mediaManager.handleFiles(files);
        }

        function handleMediaUpload(e) {
            const files = Array.from(e.target.files);
            mediaManager.handleFiles(files);
        }

        function addPollOption() {
            const pollOptions = document.getElementById('pollOptions');
            const optionCount = pollOptions.children.length;
            
            if (optionCount >= CONFIG.MAX_POLL_OPTIONS) {
                utils.showNotification(`Maximum ${CONFIG.MAX_POLL_OPTIONS} poll options allowed`, 'warning');
                return;
            }

            const newOption = document.createElement('input');
            newOption.type = 'text';
            newOption.className = 'form-control poll-option-input';
            newOption.placeholder = `Option ${optionCount + 1}`;
            newOption.style.marginBottom = 'var(--spacing-sm)';
            
            pollOptions.appendChild(newOption);
            newOption.focus();
        }

        function handlePremiumUpgrade() {
            const state = stateManager.getState();
            
            if (!state.currentUser) {
                utils.showNotification('Please complete registration first', 'warning');
                return;
            }

            if (utils.isPremiumUser(state.currentUser.userId)) {
                utils.showNotification('You are already a premium user!', 'info');
                return;
            }

            // Simulate payment process
            if (confirm('Upgrade to SmileX Premium for $9.99/month?\n\nFeatures include:\n Disco text effects\n Premium emojis\n Ad-free experience\n Premium badge\n Priority support')) {
                premiumSystem.upgradeToPremium(state.currentUser.userId);
                
                // Update UI immediately
                updateUserInterface(state.currentUser);
            }
        }

        function updateUserInterface(user) {
            // Update user avatar and initials
            const userAvatar = document.getElementById('userAvatar');
            const userInitial = document.getElementById('userInitial');
            const createPostUserInitial = document.getElementById('createPostUserInitial');

            if (user.profileImage) {
                userAvatar.innerHTML = `<img src="${user.profileImage}" alt="Profile picture">`;
                if (createPostUserInitial) {
                    createPostUserInitial.parentElement.innerHTML = `<img src="${user.profileImage}" alt="Profile picture">`;
                }
            } else {
                const initial = user.fullName.charAt(0).toUpperCase();
                if (userInitial) userInitial.textContent = initial;
                if (createPostUserInitial) createPostUserInitial.textContent = initial;
            }

            // Add premium styling if user is premium
            if (utils.isPremiumUser(user.userId)) {
                userAvatar.classList.add('premium');
            }

            // Update community lists
            communityManager.updateCommunityLists();
            updatePostCommunityOptions();
        }

        // Initialize Application
        function initializeApp() {
            // Hide preloader
            setTimeout(() => {
                const preloader = document.getElementById('preloader');
                if (preloader) {
                    preloader.style.opacity = '0';
                    setTimeout(() => {
                        preloader.style.display = 'none';
                    }, 500);
                }
            }, 2000);

            // Check for existing user
            const existingUser = localStorage.getItem('smilex_user');
            if (existingUser) {
                try {
                    const userData = JSON.parse(existingUser);
                    stateManager.setState({ currentUser: userData });
                    updateUserInterface(userData);
                } catch (error) {
                    console.error('Error loading user data:', error);
                    localStorage.removeItem('smilex_user');
                }
            } else {
                // Show onboarding for new users
                setTimeout(() => {
                    document.getElementById('onboardingOverlay').classList.add('active');
                }, 2500);
            }

            // Initialize sample data
            initializeSampleData();

            // Setup event listeners
            setupEventListeners();

            // Initialize components
            postManager.renderPosts();
            communityManager.updateCommunityLists();
            liveUpdatesSystem.start();

            // Subscribe to state changes
            stateManager.subscribe((state) => {
                liveUpdatesSystem.updateLiveStats();
                communityManager.updateCommunityLists();
            });

            console.log(' SmileX initialized successfully!');
            console.log('Features available:');
            console.log(' Advanced onboarding with profile picture upload');
            console.log(' Real-time name validation and suggestions');
            console.log(' Global search with instant results');
            console.log(' Live statistics and updates');
            console.log(' Advanced comments system with emojis');
            console.log(' Community management with restrictions');
            console.log(' Premium features and disco text');
            console.log(' Live polls and voting');
            console.log(' Media sharing and viewing');
            console.log(' Live chat support');
            console.log(' Activity logging and analytics');
        }

        // Start the application when DOM is loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }

        // Export for debugging (remove in production)
        window.SmileXDebug = {
            stateManager,
            postManager,
            communityManager,
            searchSystem,
            utils,
            CONFIG
        };
    </script>
</body>
</html>


<Actions>
  <Action name="Test Premium Features" description="Try upgrading to premium to see disco text and exclusive features" />
  <Action name="Create a Community" description="Test the community creation with name validation" />
  <Action name="Try Advanced Search" description="Search for posts, communities, or users in the search bar" />
  <Action name="Upload Profile Picture" description="Test camera or file upload for profile pictures" />
  <Action name="Create Live Poll" description="Create an interactive poll and see real-time voting" />
</Actions>

