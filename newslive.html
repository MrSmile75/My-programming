<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Shorts - Infinite Scroll</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            color: white;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        /* Main Container - 9:16 Aspect Ratio */
        .shorts-container {
            width: 100vw;
            height: 100vh;
            max-width: calc(100vh * 9/16);
            margin: 0 auto;
            position: relative;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scrollbar-width: none;
            -ms-overflow-style: none;
            background: #000;
            scroll-behavior: smooth;
        }

        .shorts-container::-webkit-scrollbar {
            display: none;
        }

        /* Individual Short Card */
        .short-card {
            width: 100%;
            height: 100vh;
            position: relative;
            scroll-snap-align: start;
            background: #000;
            overflow: hidden;
        }

        /* Video Background */
        .video-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .video-iframe {
            width: 100%;
            height: 100%;
            border: none;
            object-fit: cover;
        }

        .video-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            text-align: center;
            padding: 20px;
        }

        .video-placeholder .icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.8;
        }

        .video-placeholder .text {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .video-placeholder .subtext {
            font-size: 14px;
            opacity: 0.7;
        }

        /* Gradient Overlays */
        .top-gradient {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.6), transparent);
            z-index: 5;
        }

        .bottom-gradient {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 200px;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            z-index: 5;
        }

        /* Navigation Arrows */
        .nav-arrows {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 200;
        }

        .nav-arrow {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .nav-arrow:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.4);
        }

        .nav-arrow:active {
            transform: scale(0.95);
        }

        .nav-arrow.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        /* Audio Control */
        .audio-control {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
            transition: all 0.3s ease;
        }

        .audio-control:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: scale(1.1);
        }

        .audio-control.muted {
            color: #ff3b5c;
        }

        /* Search Bar */
        .search-container {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            width: 300px;
        }

        .search-bar {
            width: 100%;
            padding: 12px 20px 12px 45px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            color: white;
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
        }

        .search-bar:focus {
            background: rgba(0, 0, 0, 0.9);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .search-bar::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.6);
            font-size: 16px;
        }

        /* Right Side Action Buttons */
        .action-buttons {
            position: absolute;
            right: 12px;
            bottom: 120px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 10;
        }

        .action-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(1.1);
        }

        .action-btn.liked {
            background: rgba(255, 59, 92, 0.3);
            color: #ff3b5c;
        }

        .action-btn.liked i {
            animation: heartBeat 0.6s ease-in-out;
        }

        @keyframes heartBeat {
            0% { transform: scale(1); }
            25% { transform: scale(1.3); }
            50% { transform: scale(1.1); }
            75% { transform: scale(1.25); }
            100% { transform: scale(1); }
        }

        .action-count {
            position: absolute;
            top: 52px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }

        /* Channel Avatar */
        .channel-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 2px solid white;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            position: relative;
            cursor: pointer;
        }

        .subscribe-btn {
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #ff3b5c;
            border: 2px solid white;
            color: white;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .subscribe-btn:hover {
            background: #e6334a;
        }

        .subscribe-btn.subscribed {
            background: #4caf50;
        }

        /* Plus Button for More News */
        .plus-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .plus-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.4);
        }

        .plus-btn:active {
            transform: scale(0.95);
        }

        .plus-btn.loading {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Bottom Content Overlay */
        .content-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 70px;
            padding: 20px;
            z-index: 10;
        }

        /* Channel Info */
        .channel-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .channel-avatar-small {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
        }

        .channel-name {
            font-size: 14px;
            font-weight: 600;
            color: white;
        }

        .follow-btn {
            background: transparent;
            border: 1px solid white;
            color: white;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .follow-btn:hover {
            background: white;
            color: black;
        }

        .follow-btn.following {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }

        /* News Content */
        .news-title {
            font-size: 16px;
            font-weight: 700;
            line-height: 1.3;
            margin-bottom: 8px;
            text-shadow: 0 1px 3px rgba(0,0,0,0.7);
        }

        .news-description {
            font-size: 14px;
            line-height: 1.4;
            opacity: 0.9;
            margin-bottom: 12px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.7);
        }

        .hashtags {
            color: #4fc3f7;
            font-weight: 600;
        }

        /* Audio Track Info */
        .audio-track {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            padding: 8px 12px;
            border-radius: 20px;
            margin-top: 12px;
            max-width: fit-content;
        }

        .music-icon {
            width: 20px;
            height: 20px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            animation: spinMusic 3s linear infinite;
        }

        @keyframes spinMusic {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .track-info {
            font-size: 12px;
            font-weight: 500;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Loading Spinner */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Cache Info */
        .cache-info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 11px;
            z-index: 100;
            font-weight: 500;
        }

        /* Infinite Scroll Indicator */
        .infinite-indicator {
            position: fixed;
            bottom: 80px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 11px;
            z-index: 100;
            font-weight: 500;
            display: none;
        }

        /* Floating Heart Animation */
        .floating-heart {
            position: fixed;
            font-size: 30px;
            color: #ff3b5c;
            pointer-events: none;
            z-index: 1000;
            animation: floatUp 2s ease-out forwards;
        }

        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            50% {
                opacity: 0.8;
                transform: translateY(-50px) scale(1.2);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(0.8);
            }
        }

        /* Alert Styles */
        .alert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(15px);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            z-index: 2000;
            text-align: center;
            min-width: 250px;
            animation: alertSlideIn 0.3s ease-out;
        }

        @keyframes alertSlideIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .alert.success {
            border: 2px solid #4caf50;
        }

        .alert.info {
            border: 2px solid #2196f3;
        }

        .alert.warning {
            border: 2px solid #ff9800;
        }

        .alert.error {
            border: 2px solid #f44336;
        }

        /* Offline Indicator */
        .offline-indicator {
            position: fixed;
            top: 80px;
            left: 20px;
            background: rgba(244, 67, 54, 0.9);
            backdrop-filter: blur(10px);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 11px;
            z-index: 100;
            font-weight: 500;
            display: none;
        }

        /* Video Progress Bar */
        .video-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: rgba(255, 255, 255, 0.3);
            z-index: 15;
        }

        .video-progress-bar {
            height: 100%;
            background: #ff3b5c;
            width: 0%;
            transition: width 0.1s ease;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .shorts-container {
                max-width: 100vw;
            }
            
            .news-title {
                font-size: 15px;
            }
            
            .news-description {
                font-size: 13px;
            }
            
            .action-buttons {
                right: 8px;
                bottom: 100px;
            }
            
            .content-overlay {
                right: 60px;
                padding: 16px;
            }

            .search-container {
                width: 250px;
            }

            .nav-arrows {
                right: 10px;
            }

            .nav-arrow {
                width: 45px;
                height: 45px;
                font-size: 18px;
            }

            .plus-btn {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .short-card {
            animation: fadeInUp 0.5s ease-out;
        }

        /* Auto-loading indicator */
        .auto-loading {
            position: fixed;
            bottom: 50%;
            left: 50%;
            transform: translate(-50%, 50%);
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            border-radius: 25px;
            font-size: 14px;
            z-index: 1000;
            display: none;
            align-items: center;
            gap: 10px;
        }

        .auto-loading .spinner-small {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <div class="cache-info" id="cacheInfo">
        <i class="fas fa-signal"></i> Loading...
    </div>

    <div class="infinite-indicator" id="infiniteIndicator">
        <i class="fas fa-infinity"></i> Infinite Mode
    </div>

    <div class="offline-indicator" id="offlineIndicator">
        <i class="fas fa-wifi-slash"></i> Offline Mode
    </div>

    <div class="auto-loading" id="autoLoading">
        <div class="spinner-small"></div>
        <span>Loading more shorts...</span>
    </div>

    <!-- Audio Control -->
    <button class="audio-control" id="audioControl" onclick="toggleAudio()">
        <i class="fas fa-volume-up"></i>
    </button>

    <!-- Navigation Arrows -->
    <div class="nav-arrows">
        <button class="nav-arrow" id="upArrow" onclick="scrollUp()">
            <i class="fas fa-chevron-up"></i>
        </button>
        <button class="nav-arrow" id="downArrow" onclick="scrollDown()">
            <i class="fas fa-chevron-down"></i>
        </button>
    </div>

    <!-- Search Bar -->
    <div class="search-container">
        <i class="fas fa-search search-icon"></i>
        <input type="text" class="search-bar" id="searchBar" placeholder="Search news, topics, or keywords...">
    </div>

    <!-- Plus Button for More News -->
    <button class="plus-btn" id="plusBtn" onclick="fetchMoreNews()">
        <i class="fas fa-plus"></i>
    </button>

    <div class="shorts-container" id="shortsContainer">
        <!-- News shorts will be inserted here -->
    </div>

    <script>
        // API Configuration
        const NEWS_API_KEY = 'dcb071f269784ec280990d91a82ecc23'; // Replace with your NewsAPI key
        const YOUTUBE_API_KEY = 'AIzaSyDBKjt_vLZJhVqq7hpwXbvEgsOoD9NDu4A'; // Replace with your YouTube API key
        
        // Cache configuration
        const CACHE_DURATION = 30 * 60 * 1000; // 30 minutes
        const CACHE_KEY_NEWS = 'newsCache';
        const CACHE_KEY_VIDEOS = 'videosCache';
        const CACHE_KEY_OFFLINE = 'offlineNewsCache';

        let newsData = [];
        let currentIndex = 0;
        let isOnline = navigator.onLine;
        let searchTimeout;
        let isAudioMuted = false;
        let isInfiniteScrollEnabled = true;
        let isLoadingMore = false;
        let currentPage = 1;
        let totalPages = 5; // Simulate pagination
        let userInteractions = {
            likes: new Set(),
            subscriptions: new Set(),
            following: new Set()
        };

        // Network status monitoring
        window.addEventListener('online', () => {
            isOnline = true;
            hideOfflineIndicator();
            showAlert('Back online! Fresh content loading...', 'success');
            updateCacheInfo();
        });

        window.addEventListener('offline', () => {
            isOnline = false;
            showOfflineIndicator();
            showAlert('You are offline. Showing cached content.', 'warning');
            updateCacheInfo();
        });

        // Navigation functions
        function scrollUp() {
            const container = document.getElementById('shortsContainer');
            container.scrollBy({ top: -window.innerHeight, behavior: 'smooth' });
            updateCurrentIndex(-1);
        }

        function scrollDown() {
            const container = document.getElementById('shortsContainer');
            container.scrollBy({ top: window.innerHeight, behavior: 'smooth' });
            updateCurrentIndex(1);
            
            // Check if we need to load more content
            checkInfiniteScroll();
        }

        function updateCurrentIndex(direction) {
            const container = document.getElementById('shortsContainer');
            const scrollTop = container.scrollTop;
            const cardHeight = window.innerHeight;
            currentIndex = Math.round(scrollTop / cardHeight);
            
            // Update arrow states
            updateArrowStates();
            
            // Update audio for current video
            updateVideoAudio();
        }

        function updateArrowStates() {
            const upArrow = document.getElementById('upArrow');
            const downArrow = document.getElementById('downArrow');
            
            upArrow.classList.toggle('disabled', currentIndex <= 0);
            // Never disable down arrow in infinite mode
            downArrow.classList.remove('disabled');
        }

        // Audio control functions
        function toggleAudio() {
            const audioControl = document.getElementById('audioControl');
            isAudioMuted = !isAudioMuted;
            
            if (isAudioMuted) {
                audioControl.innerHTML = '<i class="fas fa-volume-mute"></i>';
                audioControl.classList.add('muted');
                showAlert('Audio muted', 'info');
            } else {
                audioControl.innerHTML = '<i class="fas fa-volume-up"></i>';
                audioControl.classList.remove('muted');
                showAlert('Audio enabled with high volume!', 'success');
            }
            
            updateVideoAudio();
        }

        function updateVideoAudio() {
            const currentVideo = document.querySelector(`[data-index="${currentIndex}"] .video-iframe`);
            if (currentVideo) {
                // Update iframe src to control audio
                const src = currentVideo.src;
                const hasAutoplay = src.includes('autoplay=1');
                const hasMute = src.includes('mute=1');
                
                if (!isAudioMuted && hasMute) {
                    // Enable audio
                    currentVideo.src = src.replace('mute=1', 'mute=0').replace('autoplay=0', 'autoplay=1');
                } else if (isAudioMuted && !hasMute) {
                    // Mute audio
                    currentVideo.src = src.replace('mute=0', 'mute=1');
                }
            }
        }

        // Infinite scroll functionality
        function checkInfiniteScroll() {
            if (!isInfiniteScrollEnabled || isLoadingMore) return;
            
            const container = document.getElementById('shortsContainer');
            const scrollTop = container.scrollTop;
            const scrollHeight = container.scrollHeight;
            const clientHeight = container.clientHeight;
            
            // Load more when user is near the bottom (80% scrolled)
            if (scrollTop + clientHeight >= scrollHeight * 0.8) {
                loadMoreInfinite();
            }
        }

        async function loadMoreInfinite() {
            if (isLoadingMore || !isOnline) return;
            
            isLoadingMore = true;
            const autoLoading = document.getElementById('autoLoading');
            autoLoading.style.display = 'flex';
            
            try {
                currentPage++;
                const response = await fetch(`https://newsapi.org/v2/top-headlines?country=us&pageSize=5&page=${currentPage}&apiKey=${NEWS_API_KEY}`);
                const data = await response.json();
                
                if (data.status === 'ok' && data.articles.length > 0) {
                    const newArticles = data.articles;
                    await loadVideosForArticles(newArticles);
                    
                    const startIndex = newsData.length;
                    newsData = [...newsData, ...newArticles];
                    appendNews(newArticles, startIndex);
                    setOfflineCache(newsData);
                    
                    showAlert(`Loaded ${newArticles.length} more shorts!`, 'success');
                } else {
                    // If no more news from API, generate more demo content
                    const demoArticles = generateMoreDemoNews(5);
                    const startIndex = newsData.length;
                    newsData = [...newsData, ...demoArticles];
                    appendNews(demoArticles, startIndex);
                    
                    showAlert('Generated more content for you!', 'info');
                }
            } catch (error) {
                console.error('Error loading more content:', error);
                // Generate demo content as fallback
                const demoArticles = generateMoreDemoNews(5);
                const startIndex = newsData.length;
                newsData = [...newsData, ...demoArticles];
                appendNews(demoArticles, startIndex);
                
                showAlert('Loaded offline content', 'warning');
            } finally {
                isLoadingMore = false;
                autoLoading.style.display = 'none';
            }
        }

        function generateMoreDemoNews(count) {
            const demoTopics = [
                'Technology Breakthrough',
                'Climate Change Update',
                'Space Exploration',
                'Medical Discovery',
                'Economic News',
                'Sports Update',
                'Entertainment News',
                'Science Innovation',
                'Political Development',
                'Cultural Event'
            ];
            
            const articles = [];
            for (let i = 0; i < count; i++) {
                const topic = demoTopics[Math.floor(Math.random() * demoTopics.length)];
                articles.push({
                    title: `Breaking: ${topic} - Latest Development #${Date.now() + i}`,
                    description: `Important update on ${topic.toLowerCase()} with significant implications for the future. Stay informed with the latest developments.`,
                    source: { name: `News${Math.floor(Math.random() * 100)}` },
                    publishedAt: new Date().toISOString(),
                    urlToImage: null
                });
            }
            return articles;
        }

        // Cache management
        function setCache(key, data) {
            const cacheData = {
                data: data,
                timestamp: Date.now()
            };
            localStorage.setItem(key, JSON.stringify(cacheData));
            updateCacheInfo();
        }

        function getCache(key) {
            const cached = localStorage.getItem(key);
            if (!cached) return null;
            
            const cacheData = JSON.parse(cached);
            const isExpired = Date.now() - cacheData.timestamp > CACHE_DURATION;
            
            if (isExpired && isOnline) {
                localStorage.removeItem(key);
                return null;
            }
            
            return cacheData.data;
        }

        function setOfflineCache(data) {
            localStorage.setItem(CACHE_KEY_OFFLINE, JSON.stringify(data));
        }

        function getOfflineCache() {
            const cached = localStorage.getItem(CACHE_KEY_OFFLINE);
            return cached ? JSON.parse(cached) : null;
        }

        function updateCacheInfo() {
            const cacheInfo = document.getElementById('cacheInfo');
            const infiniteIndicator = document.getElementById('infiniteIndicator');
            
            if (isOnline) {
                const newsCache = getCache(CACHE_KEY_NEWS);
                const status = newsCache ? 'Cached' : 'Live';
                cacheInfo.innerHTML = `<i class="fas fa-signal"></i> ${status}`;
            } else {
                cacheInfo.innerHTML = `<i class="fas fa-wifi-slash"></i> Offline`;
            }
            
            if (isInfiniteScrollEnabled) {
                infiniteIndicator.style.display = 'block';
            }
        }

        function showOfflineIndicator() {
            document.getElementById('offlineIndicator').style.display = 'block';
        }

        function hideOfflineIndicator() {
            document.getElementById('offlineIndicator').style.display = 'none';
        }

        // Alert system
        function showAlert(message, type = 'info') {
            const alert = document.createElement('div');
            alert.className = `alert ${type}`;
            alert.textContent = message;
            document.body.appendChild(alert);

            setTimeout(() => {
                alert.remove();
            }, 3000);
        }

        // Floating heart animation
        function createFloatingHeart(x, y) {
            const heart = document.createElement('div');
            heart.className = 'floating-heart';
            heart.innerHTML = '<i class="fas fa-heart"></i>';
            heart.style.left = x + 'px';
            heart.style.top = y + 'px';
            document.body.appendChild(heart);

            setTimeout(() => {
                heart.remove();
            }, 2000);
        }

        // Interaction handlers
        function toggleLike(index, event) {
            const isLiked = userInteractions.likes.has(index);
            if (isLiked) {
                userInteractions.likes.delete(index);
                showAlert('Removed like from this short', 'info');
            } else {
                userInteractions.likes.add(index);
                showAlert('You liked this short!', 'success');
                
                // Create floating heart animation
                const rect = event.target.getBoundingClientRect();
                createFloatingHeart(rect.left, rect.top);
            }
            updateActionButton(index, 'like', !isLiked);
        }

        function openComments(index) {
            showAlert('You commented on this short!', 'success');
        }

        function shareShort(index) {
            if (navigator.share) {
                navigator.share({
                    title: newsData[index]?.title || 'News Short',
                    text: newsData[index]?.description || 'Check out this news short!',
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(window.location.href);
                showAlert('Link copied to clipboard!', 'success');
            }
        }

        function toggleSubscribe(index) {
            const isSubscribed = userInteractions.subscriptions.has(index);
            if (isSubscribed) {
                userInteractions.subscriptions.delete(index);
                showAlert('Unsubscribed from channel', 'info');
            } else {
                userInteractions.subscriptions.add(index);
                showAlert('Subscribed to channel!', 'success');
            }
            updateSubscribeButton(index, !isSubscribed);
        }

        function toggleFollow(index) {
            const isFollowing = userInteractions.following.has(index);
            if (isFollowing) {
                userInteractions.following.delete(index);
                showAlert('Unfollowed channel', 'info');
            } else {
                userInteractions.following.add(index);
                showAlert('Following channel!', 'success');
            }
            updateFollowButton(index, !isFollowing);
        }

        function updateActionButton(index, type, state) {
            const button = document.querySelector(`[data-index="${index}"] .action-btn.${type}`);
            if (button) {
                if (state) {
                    button.classList.add('liked');
                } else {
                    button.classList.remove('liked');
                }
            }
        }

        function updateSubscribeButton(index, state) {
            const button = document.querySelector(`[data-index="${index}"] .subscribe-btn`);
            if (button) {
                button.innerHTML = state ? '<i class="fas fa-check"></i>' : '<i class="fas fa-plus"></i>';
                button.classList.toggle('subscribed', state);
            }
        }

        function updateFollowButton(index, state) {
            const button = document.querySelector(`[data-index="${index}"] .follow-btn`);
            if (button) {
                button.textContent = state ? 'Following' : 'Follow';
                button.classList.toggle('following', state);
            }
        }

        // Search functionality
        function setupSearch() {
            const searchBar = document.getElementById('searchBar');
            
            searchBar.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                const query = e.target.value.trim();
                
                if (query.length > 2) {
                    searchTimeout = setTimeout(() => {
                        searchNews(query);
                    }, 500);
                } else if (query.length === 0) {
                    loadNews();
                }
            });

            searchBar.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const query = e.target.value.trim();
                    if (query) {
                        searchNews(query);
                    }
                }
            });
        }

        async function searchNews(query) {
            if (!isOnline) {
                showAlert('Search requires internet connection', 'warning');
                return;
            }

            const loading = document.getElementById('loading');
            loading.style.display = 'block';

            try {
                const response = await fetch(`https://newsapi.org/v2/everything?q=${encodeURIComponent(query)}&pageSize=10&sortBy=publishedAt&apiKey=${NEWS_API_KEY}`);
                const data = await response.json();
                
                if (data.status === 'ok' && data.articles.length > 0) {
                    newsData = data.articles;
                    await loadVideosForArticles(newsData);
                    displayNews(newsData);
                    currentIndex = 0;
                    updateArrowStates();
                    showAlert(`Found ${data.articles.length} results for "${query}"`, 'success');
                } else {
                    showAlert(`No results found for "${query}"`, 'info');
                }
            } catch (error) {
                console.error('Search error:', error);
                showAlert('Search failed. Please try again.', 'error');
            } finally {
                loading.style.display = 'none';
            }
        }

        // Fetch more news
        async function fetchMoreNews() {
            const plusBtn = document.getElementById('plusBtn');
            plusBtn.classList.add('loading');
            plusBtn.innerHTML = '<i class="fas fa-spinner"></i>';

            try {
                if (!isOnline) {
                    showAlert('Loading more requires internet connection', 'warning');
                    return;
                }

                const response = await fetch(`https://newsapi.org/v2/top-headlines?country=us&pageSize=5&page=${Math.floor(newsData.length / 5) + 1}&apiKey=${NEWS_API_KEY}`);
                const data = await response.json();
                
                if (data.status === 'ok' && data.articles.length > 0) {
                    const newArticles = data.articles;
                    await loadVideosForArticles(newArticles);
                    
                    const startIndex = newsData.length;
                    newsData = [...newsData, ...newArticles];
                    appendNews(newArticles, startIndex);
                    setOfflineCache(newsData);
                    
                    showAlert(`Added ${newArticles.length} new shorts!`, 'success');
                } else {
                    showAlert('No more news available', 'info');
                }
            } catch (error) {
                console.error('Error fetching more news:', error);
                showAlert('Failed to load more news', 'error');
            } finally {
                plusBtn.classList.remove('loading');
                plusBtn.innerHTML = '<i class="fas fa-plus"></i>';
            }
        }

        // Fetch news from NewsAPI
        async function fetchNews() {
            if (!isOnline) {
                const offlineData = getOfflineCache();
                if (offlineData) {
                    return offlineData;
                }
            }

            const cached = getCache(CACHE_KEY_NEWS);
            if (cached) {
                console.log('Using cached news data');
                return cached;
            }

            try {
                const response = await fetch(`https://newsapi.org/v2/top-headlines?country=us&pageSize=10&apiKey=${NEWS_API_KEY}`);
                const data = await response.json();
                
                if (data.status === 'ok') {
                    setCache(CACHE_KEY_NEWS, data.articles);
                    setOfflineCache(data.articles);
                    return data.articles;
                } else {
                    throw new Error(data.message || 'Failed to fetch news');
                }
            } catch (error) {
                console.error('Error fetching news:', error);
                const offlineData = getOfflineCache();
                return offlineData || getDemoNews();
            }
        }

        // Fetch YouTube videos
        async function fetchYouTubeVideo(query) {
            if (!isOnline) return null;

            const cacheKey = `${CACHE_KEY_VIDEOS}_${encodeURIComponent(query)}`;
            const cached = getCache(cacheKey);
            if (cached) {
                console.log('Using cached video data for:', query);
                return cached;
            }

            try {
                const searchQuery = encodeURIComponent(`${query} news short`);
                const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${searchQuery}&type=video&maxResults=1&videoDuration=short&key=${YOUTUBE_API_KEY}`);
                const data = await response.json();
                
                if (data.items && data.items.length > 0) {
                    const videoId = data.items[0].id.videoId;
                    setCache(cacheKey, videoId);
                    return videoId;
                }
            } catch (error) {
                console.error('Error fetching YouTube video:', error);
            }
            
            return null;
        }

        async function loadVideosForArticles(articles) {
            const videoPromises = articles.map(async (article) => {
                const videoId = await fetchYouTubeVideo(article.title);
                article.videoId = videoId;
                return article;
            });
            
            await Promise.all(videoPromises);
        }

        // Demo data fallback
        function getDemoNews() {
            return [
                {
                    title: "Breaking: Major AI Breakthrough Changes Everything",
                    description: "Revolutionary artificial intelligence system demonstrates unprecedented capabilities in solving complex problems. Industry experts call it a game-changer for technology.",
                    source: { name: "TechNews" },
                    publishedAt: new Date().toISOString(),
                    urlToImage: null
                },
                {
                    title: "Climate Summit: Historic Global Agreement Reached",
                    description: "World leaders unite for ambitious carbon reduction targets. The landmark deal promises to reshape environmental policy worldwide.",
                    source: { name: "EcoDaily" },
                    publishedAt: new Date().toISOString(),
                    urlToImage: null
                },
                {
                    title: "Mars Mission: Rover Discovers Potential Signs of Life",
                    description: "NASA's latest Mars rover uncovers intriguing geological formations that could indicate past microbial activity on the Red Planet.",
                    source: { name: "SpaceNews" },
                    publishedAt: new Date().toISOString(),
                    urlToImage: null
                },
                {
                    title: "Cryptocurrency Market Sees Massive Surge",
                    description: "Digital currencies experience unprecedented growth as institutional investors show renewed confidence in blockchain technology.",
                    source: { name: "CryptoWatch" },
                    publishedAt: new Date().toISOString(),
                    urlToImage: null
                },
                {
                    title: "Medical Breakthrough: New Treatment Shows Promise",
                    description: "Researchers announce successful trials of innovative therapy that could revolutionize treatment for chronic diseases.",
                    source: { name: "MedToday" },
                    publishedAt: new Date().toISOString(),
                    urlToImage: null
                }
            ];
        }

        // Generate random engagement numbers
        function generateEngagement() {
            return {
                likes: Math.floor(Math.random() * 50000) + 1000,
                comments: Math.floor(Math.random() * 5000) + 100,
                shares: Math.floor(Math.random() * 2000) + 50
            };
        }

        // Format numbers for display
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        // Create news short HTML
        function createNewsShort(article, index) {
            const publishedDate = new Date(article.publishedAt).toLocaleDateString();
            const videoId = article.videoId;
            const engagement = generateEngagement();
            const channelInitials = article.source.name.substring(0, 2).toUpperCase();
            
            // Extract hashtags from title/description
            const hashtags = ['#breaking', '#news', '#trending', '#shorts'];
            const randomHashtags = hashtags.sort(() => 0.5 - Math.random()).slice(0, 3).join(' ');
            
            const audioParam = isAudioMuted ? 'mute=1' : 'mute=0';
            const autoplayParam = isAudioMuted ? 'autoplay=0' : 'autoplay=1';
            
            return `
                <div class="short-card" data-index="${index}">
                    <!-- Video Background -->
                    <div class="video-background">
                        ${videoId ? 
                            `<iframe class="video-iframe" 
                                src="https://www.youtube.com/embed/${videoId}?${autoplayParam}&${audioParam}&controls=0&modestbranding=1&rel=0&showinfo=0&loop=1&playlist=${videoId}" 
                                allowfullscreen>
                            </iframe>` :
                            `<div class="video-placeholder">
                                <div class="icon"><i class="fas fa-play-circle"></i></div>
                                <div class="text">News Video Loading...</div>
                                <div class="subtext">Immersive news experience</div>
                            </div>`
                        }
                    </div>

                    <!-- Video Progress Bar -->
                    <div class="video-progress">
                        <div class="video-progress-bar" style="width: ${Math.random() * 100}%"></div>
                    </div>

                    <!-- Gradient Overlays -->
                    <div class="top-gradient"></div>
                    <div class="bottom-gradient"></div>

                    <!-- Right Side Action Buttons -->
                    <div class="action-buttons">
                        <!-- Like Button -->
                        <div style="position: relative;">
                            <button class="action-btn like" onclick="toggleLike(${index}, event)">
                                <i class="fas fa-heart"></i>
                            </button>
                            <div class="action-count">${formatNumber(engagement.likes)}</div>
                        </div>

                        <!-- Comment Button -->
                        <div style="position: relative;">
                            <button class="action-btn comment" onclick="openComments(${index})">
                                <i class="fas fa-comment"></i>
                            </button>
                            <div class="action-count">${formatNumber(engagement.comments)}</div>
                        </div>

                        <!-- Share Button -->
                        <div style="position: relative;">
                            <button class="action-btn share" onclick="shareShort(${index})">
                                <i class="fas fa-share"></i>
                            </button>
                            <div class="action-count">${formatNumber(engagement.shares)}</div>
                        </div>

                        <!-- Channel Avatar with Subscribe -->
                        <div class="channel-avatar" onclick="toggleSubscribe(${index})">
                            ${channelInitials}
                            <div class="subscribe-btn"><i class="fas fa-plus"></i></div>
                        </div>
                    </div>

                    <!-- Bottom Content Overlay -->
                    <div class="content-overlay">
                        <!-- Channel Info -->
                        <div class="channel-info">
                            <div class="channel-avatar-small">${channelInitials}</div>
                            <div class="channel-name">@${article.source.name.toLowerCase().replace(/\s+/g, '')}</div>
                            <button class="follow-btn" onclick="toggleFollow(${index})">Follow</button>
                        </div>

                        <!-- News Content -->
                        <div class="news-title">${article.title}</div>
                        <div class="news-description">
                            ${article.description || 'Breaking news update with all the latest developments.'}
                            <span class="hashtags">${randomHashtags}</span>
                        </div>

                        <!-- Audio Track Info -->
                        <div class="audio-track">
                            <div class="music-icon"><i class="fas fa-music"></i></div>
                            <div class="track-info">Original sound - ${article.source.name}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Display news
        function displayNews(articles) {
            const container = document.getElementById('shortsContainer');
            const newsHTML = articles.map((article, index) => createNewsShort(article, index)).join('');
            container.innerHTML = newsHTML;
            currentIndex = 0;
            updateArrowStates();
        }

        // Append new news
        function appendNews(articles, startIndex) {
            const container = document.getElementById('shortsContainer');
            const newsHTML = articles.map((article, index) => createNewsShort(article, startIndex + index)).join('');
            container.insertAdjacentHTML('beforeend', newsHTML);
        }

        // Load and display news
        async function loadNews() {
            const loading = document.getElementById('loading');
            const container = document.getElementById('shortsContainer');
            
            loading.style.display = 'block';
            
            try {
                // Fetch news articles
                const articles = await fetchNews();
                newsData = articles;
                
                // Load videos for articles
                await loadVideosForArticles(articles);
                
                // Display news
                displayNews(articles);
                
                if (!isOnline) {
                    showAlert('Showing offline content', 'info');
                }
                
            } catch (error) {
                console.error('Error loading news:', error);
                container.innerHTML = `
                    <div class="short-card">
                        <div class="video-placeholder">
                            <div class="icon"><i class="fas fa-exclamation-triangle"></i></div>
                            <div class="text">Error loading news</div>
                            <div class="subtext">Please check your connection</div>
                        </div>
                    </div>
                `;
                showAlert('Failed to load news', 'error');
            } finally {
                loading.style.display = 'none';
                updateCacheInfo();
            }
        }

        // Initialize the app
        function init() {
            // Check if API keys are set
            if (NEWS_API_KEY === 'YOUR_NEWS_API_KEY' || YOUTUBE_API_KEY === 'YOUR_YOUTUBE_API_KEY') {
                console.warn('⚠️ API keys not set. Using demo data.');
            }
            
            // Initialize network status
            updateCacheInfo();
            if (!isOnline) {
                showOfflineIndicator();
            }
            
            // Setup search
            setupSearch();
            
            // Load initial news
            loadNews();
            
            // Add smooth scrolling behavior and infinite scroll
            const container = document.getElementById('shortsContainer');
            let isScrolling = false;
            
            container.addEventListener('scroll', () => {
                if (!isScrolling) {
                    window.requestAnimationFrame(() => {
                        updateCurrentIndex(0);
                        checkInfiniteScroll();
                        isScrolling = false;
                    });
                }
                isScrolling = true;
            });

            // Show infinite scroll indicator
            setTimeout(() => {
                showAlert('Infinite scroll enabled! Swipe up for endless content', 'info');
            }, 2000);
        }

        // Start the application
        document.addEventListener('DOMContentLoaded', init);

        // Add keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowDown' || e.key === ' ') {
                e.preventDefault();
                scrollDown();
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                scrollUp();
            } else if (e.key === 'm' || e.key === 'M') {
                e.preventDefault();
                toggleAudio();
            }
        });

        // Add touch/swipe support for mobile
        let startY = 0;
        let endY = 0;

        document.addEventListener('touchstart', (e) => {
            startY = e.touches[0].clientY;
        });

        document.addEventListener('touchend', (e) => {
            endY = e.changedTouches[0].clientY;
            const diff = startY - endY;
            
            if (Math.abs(diff) > 50) { // Minimum swipe distance
                if (diff > 0) {
                    // Swipe up - next video
                    scrollDown();
                } else {
                    // Swipe down - previous video
                    scrollUp();
                }
            }
        });
    </script>
</body>
</html>